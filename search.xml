<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[è®¾ç½®SSHè¯ä¹¦è¿œç¨‹ç™»é™†]]></title>
    <url>%2F2019%2F11%2F25%2Fssh%2F</url>
    <content type="text"><![CDATA[æ¯æ¬¡è¿œç¨‹ç™»å½•æœåŠ¡å™¨æ—¶éƒ½è¦æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥é€šè¿‡SSHè¯ä¹¦å®ç°è¿œç¨‹ä¸€é”®ç™»é™†æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ï¼šmacOS 10.15.1 æœåŠ¡å™¨: Centos7 å®¢æˆ·ç«¯é…ç½® ç”Ÿæˆsshå…¬é’¥ã€ç§é’¥ï¼š 1$ ssh-keygen ä¼ é€å…¬é’¥åˆ°æœåŠ¡å™¨ä¸Š: 1$ scp ~/.ssh/id_rsa_server.pub root@12.34.567.89:~ æŒ‡å®šç™»é™†æœåŠ¡å™¨ä½¿ç”¨çš„ç§é’¥ï¼š 1$ vi ~/etc/ssh/ssh_config æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š 12HOST 12.34.567.89 IdentityFile ~/.ssh/id_rsa_server æœåŠ¡å™¨é…ç½® å°†ä¸Šä¸€æ­¥æ¥æ”¶åˆ°çš„å…¬é’¥æ·»åŠ åˆ°authorized_keysä¸­ 1$ cat ~/id_rsa_server.pub &gt;&gt; ~/.ssh/authorized_keys é…ç½®sshd_configï¼Œå¼€å¯è¯ä¹¦ç™»é™† 1vim ~/etc/ssh/sshd_config ä¿®æ”¹å†…å®¹ä¸ºï¼š 12RSAAuthentication yesPubkeyAuthentication yes é‡å¯sshdä½¿åˆšæ‰çš„ä¿®æ”¹ç”Ÿæ•ˆ 1$ service restart sshd ä¸€é”®ç™»å½•æ¥ä¸‹æ¥å°±ä¸ç”¨è¾“å…¥å¯†ç ç›´æ¥ç™»é™†æœåŠ¡å™¨ï¼š 1$ ssh root@12.34.567.89 å…¶å®ƒssh-keygenssh_configä¸sshd_config]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ]]></title>
    <url>%2F2019%2F03%2F27%2Fperfomance%2F</url>
    <content type="text"><![CDATA[å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼ŸåŠ è½½æ—¶é—´æ˜¯æˆ‘ä»¬ç”¨äºè¯„ä»·å‰ç«¯æ€§èƒ½å¥½åçš„ä¸€ä¸ªå‚è€ƒæ•°æ®ï¼Œä½†æ˜¯åŠ è½½æ—¶é—´ä¸ç”¨æˆ·ä½¿ç”¨çš„æ‰‹æœºç±»å‹ä»¥åŠå½“å‰ç½‘ç»œçŠ¶å†µæœ‰å…³ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå³ä½¿é¡µé¢åŠ è½½å®Œæˆç”¨æˆ·ä¹Ÿå¯èƒ½æ— æ³•æ“ä½œï¼Œæ‰€ä»¥ä»…ä»…ç”¨ä¸€ä¸ªåŠ è½½æ—¶é—´æ˜¯ä¸èƒ½æè¿°å‰ç«¯æ€§èƒ½çš„å¥½åï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¥—å®Œæ•´çš„æ€§èƒ½è¯„ä»·ä½“ç³»ã€‚ æ­¤å‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸»è¦çš„äº‹ä»¶æ¥æµ‹é‡æ€§èƒ½ï¼š DomContentLoadedï¼šé¡µé¢åŠ è½½æ—¶è§¦å‘ï¼Œä½†è„šæœ¬åˆšåˆšå¼€å§‹æ‰§è¡Œ loadï¼šåœ¨é¡µé¢å®Œå…¨åŠ è½½åè§¦å‘ï¼Œæ­¤æ—¶ç”¨æˆ·å·²ç»å¯ä»¥ä½¿ç”¨é¡µé¢å’Œåº”ç”¨ ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç½‘ç»œç¯å¢ƒè¾ƒå·®æˆ–è€…è„šæœ¬æ‰§è¡Œæ—¶é—´å¤ªé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»DCLåˆ°loadä¼šç»å†ä¸€æ®µå¾ˆé•¿å¾ˆé•¿çš„æ—¶é—´ï¼Œå¹¶ä¸”loadäº‹ä»¶è§¦å‘å¤ªæ™šï¼Œå°±æ— æ³•åˆ†æå‡ºé¡µé¢çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªä»é¡µé¢å¼€å§‹åŠ è½½åˆ°åŠ è½½å®Œæˆçš„è¯„ä»·ä½“ç³»ï¼Œè®°å½•ç”¨æˆ·æ•´ä¸ªæ„ŸçŸ¥è¿‡ç¨‹ã€‚ æ¸è¿›å¼ç½‘é¡µæŒ‡æ ‡ é¦–æ¬¡ç»˜åˆ¶(FP)ï¼š æ ‡è®°æµè§ˆå™¨æ¸²æŸ“ä»»ä½•åœ¨è§†è§‰ä¸Šä¸åŒäºå¯¼èˆªå‰å±å¹•å†…å®¹ä¹‹å†…å®¹çš„æ—¶é—´ç‚¹ é¦–æ¬¡å†…å®¹ç»˜åˆ¶(FCP)ï¼šæ ‡è®°çš„æ˜¯æµè§ˆå™¨æ¸²æŸ“æ¥è‡ª DOM ç¬¬ä¸€ä½å†…å®¹çš„æ—¶é—´ç‚¹ï¼Œè¯¥å†…å®¹å¯èƒ½æ˜¯æ–‡æœ¬ã€å›¾åƒã€SVG ç”šè‡³ &lt;canvas&gt; å…ƒç´ ã€‚ é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ï¼ˆFMPï¼‰/ä¸»è§’å…ƒç´ è®¡æ—¶ï¼šæ ‡è®°çš„æ˜¯é¡µé¢ä¸»è¦å†…å®¹ç»˜åˆ¶çš„æ—¶é—´ç‚¹ï¼Œä¾‹å¦‚è§†é¢‘åº”ç”¨çš„è§†é¢‘ç»„ä»¶ã€å¤©æ°”åº”ç”¨çš„å¤©æ°”ä¿¡æ¯ã€æ–°é—»åº”ç”¨ä¸­çš„æ–°é—»æ¡ç›®ã€‚ å¯äº¤äº’æ—¶é—´ï¼ˆTTIï¼‰ï¼šé¡µé¢æ¸²æŸ“å®Œæˆï¼Œèƒ½å¯é çš„å“åº”ç”¨æˆ·çš„æ“ä½œçš„æ—¶é—´ç‚¹ã€‚ï¼ˆè¿™ä¸ªæ—¶é—´ä¸ä»…å–å†³äºä¹‹å‰çš„åŠ è½½æ—¶é—´ï¼Œè¿˜å–å†³äºå½“å‰æ˜¯å¦æœ‰é•¿ä»»åŠ¡é˜»å¡ä¸»çº¿ç¨‹ï¼‰ æµè§ˆå™¨é¡µé¢åŠ è½½æµç¨‹å…ˆè°ˆè°ˆæµè§ˆå™¨çš„é¡µé¢å¤§è‡´çš„åŠ è½½æµç¨‹ï¼š æµè§ˆå™¨è¾“å…¥urlï¼Œæµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å‘é€HTMLç»™æµè§ˆå™¨ã€‚ æµè§ˆå™¨ä¸‹è½½HTMLç„¶åä»ä¸Šå¾€ä¸‹è§£æ å¦‚æœåœ¨è§£æHTMLè¿‡ç¨‹ä¸­é‡åˆ°CSSã€JSå¤–é“¾ï¼Œä¼šæ‰§è¡Œä¸‹åˆ—æ“ä½œ Send Requestï¼šå‘è¿™ä¸ªå¤–é“¾å¯¹åº”çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ Receive Responseï¼šæ¥å—å“åº”ï¼Œè¡¨ç¤ºå¯ä»¥å¼€å§‹ä»ç½‘ç»œæ¥å—æ•°æ® Receive Dataï¼šå¼€å§‹æ¥å—æ•°æ® Finish Lodingï¼šè¡¨ç¤ºå®Œæˆæ•°æ®çš„ä¸‹è½½ Parse Stylesheet/Evaluateï¼šè§£æCSSæˆ–æ‰§è¡ŒJS æ‰€æœ‰çš„CSSä¸‹è½½å®Œæˆåè¿›è¡Œparseï¼Œæ„å»ºCSSOM DOMå’ŒCSSOMåˆæˆä¸€ä¸ªRender tree æ ¹æ®Render treeçš„å†…å®¹è®¡ç®—å¤„å„ä¸ªèŠ‚ç‚¹åœ¨ç½‘é¡µä¸­çš„å¤§å°å’Œä½ç½®ï¼ˆLayoutï¼‰ æ ¹æ®Layoutç»˜åˆ¶å†…å®¹åœ¨æµè§ˆå™¨ä¸Šï¼ˆPaintï¼‰ å¦‚ä½•ç»Ÿè®¡ä¸Šè¿°çš„æŒ‡æ ‡é€šè¿‡performanceæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å½“å‰é¡µé¢ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ï¼›ç„¶åé€šè¿‡navogator.sendBeaconæˆ–Google Analyticså‘æœåŠ¡å™¨å‘é€ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚ é‚£ä¹ˆï¼Œå…·ä½“çš„æ€§èƒ½æŒ‡æ ‡å¦‚ä½•ç»Ÿè®¡å‘¢ï¼ŸğŸ‘‡ğŸ‘‡ğŸ‘‡ é¦–æ¬¡ç»˜åˆ¶(First Paintï¼ŒFP)è¿™ä¸ªæŒ‡æ ‡è¡¨ç¤ºé¡µé¢ç»˜åˆ¶çš„æ—¶é—´ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡çœ‹åˆ°â€œç™½å±â€çš„æ—¶é—´ï¼Œæ ‡å¿—â€œIt is happening?â€ é¦–æ¬¡ç»˜åˆ¶åŒ…æ‹¬äº†ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„èƒŒæ™¯ç»˜åˆ¶ï¼Œå®ƒæ˜¯é¦–å…ˆå°†åƒç´ ç»˜åˆ¶åˆ°å±å¹•çš„æ—¶åˆ»ã€‚ ä»€ä¹ˆæ—¶å€™è§¦å‘FPäº‹ä»¶å‘¢ï¼ŸFPäº‹ä»¶æ˜¯åœ¨å›¾å±‚è¿›è¡Œç»˜åˆ¶çš„æ—¶å€™è§¦å‘ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰å…ƒç´ å‡ºç°çš„æ—¶å€™ï¼ˆè¿™ä¸ªæ—¶å€™è§¦å‘çš„æ˜¯FCPäº‹ä»¶ï¼‰ æ€ä¹ˆç»Ÿè®¡è¿™ä¸ªFPæ—¶é—´å‘¢ï¼Ÿ window.perfomance.getEntriesByType(â€˜paintâ€™)ï¼Œè¿™ä¼šè¿”å›FPã€FCPå‘ç”Ÿçš„æ—¶é—´ç‚¹ã€‚å…·ä½“å‚è€ƒhttps://developer.mozilla.org/zh-CN/docs/Web/API/Performance é€šè¿‡ä½¿ç”¨ Google Analyticsï¼Œå¯è·Ÿè¸ªé¦–æ¬¡ç»˜åˆ¶æ—¶é—´ 12345678910111213141516171819202122232425262728293031&lt;head&gt; &lt;!-- Add the async Google Analytics snippet first. --&gt; &lt;script&gt; window.ga=window.ga||function()&#123;(ga.q=ga.q||[]).push(arguments)&#125;;ga.l=+new Date; ga('create', 'UA-XXXXX-Y', 'auto'); ga('send', 'pageview'); &lt;/script&gt; &lt;script async src='https://www.google-analytics.com/analytics.js'&gt;&lt;/script&gt; &lt;!-- Register the PerformanceObserver to track paint timing. --&gt; &lt;script&gt; const observer = new PerformanceObserver((list) =&gt; &#123; for (const entry of list.getEntries()) &#123; // `name` will be either 'first-paint' or 'first-contentful-paint'. const metricName = entry.name; const time = Math.round(entry.startTime + entry.duration); ga('send', 'event', &#123; eventCategory:'Performance Metrics', eventAction: metricName, eventValue: time, nonInteraction: true, &#125;); &#125; &#125;); observer.observe(&#123;entryTypes: ['paint']&#125;); &lt;/script&gt; &lt;!-- Include any stylesheets after creating the PerformanceObserver. --&gt; &lt;link rel="stylesheet" href="..."&gt;&lt;/head&gt; é¦–æ¬¡å†…å®¹ç»˜åˆ¶(First Content Paintï¼ŒFCP)å½“ç”¨æˆ·é¦–æ¬¡çœ‹è§ä¸€äº›å…ƒç´ ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰ï¼‰ï¼Œéâ€ç™½å±â€œçš„æ—¶åˆ»å°±æ˜¯FCPï¼Œè¿™ä¸ªæ ‡å¿—â€œit is running?â€ ç»Ÿè®¡çš„æ–¹æ³•ä¸ä¸Šè¿°FPçš„ç»Ÿè®¡æ–¹æ³•ç±»ä¼¼ï¼ŒGoogleçš„Analysisç›‘å¬çš„paintå®é™…æœ‰ä¸¤ç§ç±»å‹ï¼Œâ€˜first paintâ€™å’Œâ€˜first content painâ€™ã€‚ FCPåœ¨æ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰ç»˜åˆ¶çš„æ—¶å€™å°±è§¦å‘äº†ï¼Œæ‰€ä»¥è·ŸFPå¯ä»¥ç›¸å·®å‡ æ¯«ç§’ï½å‡ ç§’çš„æ—¶é—´ã€‚ é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶(First Meaningful Paintï¼ŒFMP)FMPå°±æ˜¯é¡µé¢ä¸»è¦å†…å®¹å‘ˆç°çš„æ—¶åˆ»ï¼Œç›®å‰æ²¡æœ‰æ ‡å‡†åŒ–çš„FMPå®šä¹‰ï¼Œæ‰€ä»¥å¾ˆä»¥é€šç”¨çš„æ–¹å¼ç¡®å®šâ€œæœ‰æ•ˆâ€å¯¹äºæ‰€æœ‰é¡µé¢æ„å‘³ç€ä»€ä¹ˆã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€ä¹ˆç»Ÿè®¡FMPå‘¢ï¼Ÿå®ƒçš„ç»Ÿè®¡åœ¨é¡µé¢å‘ç”Ÿäº†é‡å¤§çš„å¸ƒå±€å˜åŒ–ä¹‹åï¼›LayoutAnalyzerä¼šç»Ÿè®¡æ‰€æœ‰çš„å¸ƒå±€å˜åŒ–ï¼Œå½“å¸ƒå±€å˜åŒ–æœ€å¤§æ—¶ï¼Œè¿™ä¸ªæ—¶åˆ»å°±æ˜¯FMPã€‚ å¦‚æœä¸»è¦å†…å®¹æ¸²æŸ“å¤ªæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ·å¼ã€å­—ä½“ã€è„šæœ¬ã€å›¾ç‰‡ä¸Šå»æ€è€ƒï¼Œå› ä¸ºè¿™äº›å…ƒç´ æœ‰å¾ˆå¤§å¯èƒ½é˜»å¡äº†FMPã€‚ å¯äº¤äº’æ—¶é—´ï¼ˆTime To Interactiveï¼ŒTTIï¼‰ä¸ FMP ç›¸åŒï¼Œå¾ˆéš¾è§„èŒƒåŒ–é€‚ç”¨äºæ‰€æœ‰ç½‘é¡µçš„ TTI æŒ‡æ ‡å®šä¹‰ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Google Analyticsæ¥è·Ÿè¸ªåº”ç”¨TTIã€‚ TTIå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼ŸFMP &amp;&amp; DOMContentLoaderäº‹ä»¶è§¦å‘ &amp;&amp; é¡µé¢è§†è§‰åŠ è½½85% TTIåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæŒ‡æ ‡ï¼ŒTTFIï¼ˆé¦–æ¬¡äº¤äº’æ—¶é—´ï¼‰ã€TTCIï¼ˆé¦–æ¬¡æŒç»­äº¤äº’æ—¶é—´ï¼‰ TTFI: åœ¨FMPå‘ç”Ÿååº”è¯¥æœ‰3sçš„quiet windowï¼Œè¿™ä¸ªæ—¶é—´è¶³å¤Ÿè¯´æ˜é¡µé¢å¯¹ç”¨æˆ·æ˜¯å¯äº¤äº’çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰é•¿ä»»åŠ¡åœ¨è¿™ä¸ªquiet windowæœŸé—´æˆ–ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œå®ƒä»¬å¯ä»¥è¢«å¿½ç•¥ã€‚ TTCI: ä»è¿½ç»ˆçº¿çš„å°¾éƒ¨å¼€å§‹çœ‹ï¼Œé¡µé¢åŠ è½½åæœ‰5sçš„quietå¹¶ä¸”æ²¡æœ‰é•¿ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå¾—åˆ°äº†ä¸€æ®µquiet windowã€‚quiet windowä¹‹ååˆ°ç¬¬ä¸€ä¸ªé•¿ä»»åŠ¡ä¹‹å‰çš„æ—¶é—´å°±æ˜¯TTCIã€‚ å½±å“ä¸Šé¢æŸäº›æŒ‡æ ‡çš„å› ç´ FP/FCPï¼šâ€œç™½å±â€ï¼Œä»æ–‡æ¡£çš„ &lt;head&gt; ä¸­ç§»é™¤ä»»ä½•é˜»å¡æ¸²æŸ“çš„è„šæœ¬æˆ–æ ·å¼è¡¨ï¼Œå¯ä»¥å‡å°‘é¦–æ¬¡ç»˜åˆ¶å’Œé¦–æ¬¡å†…å®¹ç»˜åˆ¶å‰çš„ç­‰å¾…æ—¶é—´ã€‚FCPï¼šé¦–æ¬¡å†…å®¹ç»˜åˆ¶è€—æ—¶å¤ªé•¿ï¼Œç›´è§‚ä¸Šå°±æ˜¯â€œç™½æ¿æ—¶é—´å¤ªé•¿â€ï¼Œå½±å“å› ç´ å°±æ˜¯ç½‘ç»œè¿æ¥å­˜åœ¨æ€§èƒ½é—®é¢˜ã€èµ„æºï¼ˆä¾‹å¦‚index.htmlï¼‰å¤ªå¤§ä¼ è¾“è€—æ—¶ã€‚ FMP/TTIï¼šå¦‚æœä¸»è¦å†…å®¹å¾ˆä¹…éƒ½æ²¡å±•ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯å›¾ç‰‡ã€æ ·å¼ã€å­—ä½“ã€JavaScriptæœ‰è¾ƒé«˜çš„åŠ è½½ä¼˜å…ˆçº§ï¼Œé˜»å¡äº†FMPã€‚ç¡®å®šé¡µé¢ä¸Šæœ€å…³é”®çš„ç•Œé¢å…ƒç´ ï¼ˆä¸»è§’å…ƒç´ ï¼‰ä¹‹åï¼Œæ‚¨åº”ç¡®ä¿åˆå§‹è„šæœ¬åŠ è½½ä»…åŒ…å«æ¸²æŸ“è¿™äº›å…ƒç´ å¹¶ä½¿å…¶å¯äº¤äº’æ‰€éœ€çš„ä»£ç ã€‚ åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„å°±æ˜¯è®©åˆ˜ç¯®çƒå°½å¯èƒ½å¿«åœ°ç»˜åˆ¶ç½‘é¡µï¼Œå‡å°‘ç”¨æˆ·çœ‹åˆ°â€œç™½å±çš„æ—¶é—´â€ï¼Œä»FPåˆ°FCPï¼›æ‰€ä»¥æ•´ä¸ªæ—¶é—´å°±åŒ…æ‹¬äº†è·å–èµ„æºï¼ˆCSSã€JSã€HTMLï¼‰ä»¥åŠæµè§ˆå™¨å¤„ç†å¯¹åº”çš„æ–‡ä»¶ã€‚ å…³é”®èµ„æºï¼šå¯èƒ½é˜»æ­¢ç½‘é¡µé¦–æ¬¡æ¸²æŸ“çš„èµ„æº å…³é”®è·¯å¾„é•¿åº¦ï¼šè·å–æ‰€æœ‰å…³é”®èµ„æºæ‰€éœ€çš„å¾€è¿”æ¬¡æ•°æˆ–æ€»æ—¶é—´ å…³é”®å­—èŠ‚ï¼šå®ç°ç½‘é¡µé¦–æ¬¡æ¸²æŸ“æ‰€éœ€çš„æ€»å­—èŠ‚æ•°ï¼Œå®ƒæ˜¯æ‰€æœ‰å…³é”®èµ„æºä¼ é€æ–‡ä»¶å¤§å°çš„æ€»å’Œã€‚ HTMLã€Imageå¯¹äºHTMLï¼Œæµè§ˆå™¨ä¸‹è½½HTMLæ–‡ä»¶ï¼Œå½“HTMLå†…å®¹å¯ç”¨æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè§£æHTMLï¼Œç”Ÿæˆtokenï¼Œè¿›è€Œæ„å»ºDOMæ ‘ï¼ŒDOMæ ‘æ„å»ºå®ŒæˆåŒæ—¶æ„å‘³ç€DOMContentLoadedäº‹ä»¶è§¦å‘ï¼›è·å–å›¾ç‰‡å¹¶ä¸ä¼šå½±å“DOMContentLoadedäº‹ä»¶çš„è§¦å‘ï¼Œæ‰€ä»¥å›¾ç‰‡ä¸ä¼šå½±å“åˆ°é¦–æ¬¡ç»˜åˆ¶ã€‚ å…³é”®èµ„æºï¼ˆHTMLï¼‰ï¼Œå…³é”®è·¯å¾„é•¿åº¦ï¼ˆæœ€å°‘1æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ5KBï¼‰ HTMLã€CSSåŠ è½½è§£æHTMLï¼Œç„¶åè·å–CSSæ–‡ä»¶ï¼Œè§£æä¸ºCSSOMï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œç»˜åˆ¶é¡µé¢ã€‚ å…³é”®èµ„æºï¼ˆHTMLã€CSSï¼‰ï¼Œå…³é”®è·¯å¾„é•¿åº¦ï¼ˆæœ€å°‘2æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ9KBï¼‰ CSSã€JavaScriptã€HTML123456789101112&lt;html&gt; &lt;head&gt; &lt;title&gt;Critical Path: Measure Script&lt;/title&gt; &lt;meta name="viewport" content="width=device-width,initial-scale=1"&gt; &lt;link href="style.css" rel="stylesheet"&gt; &lt;/head&gt; &lt;body onload="measureCRP()"&gt; &lt;p&gt;Hello &lt;span&gt;web performance&lt;/span&gt; students!&lt;/p&gt; &lt;div&gt;&lt;img src="awesome-photo.jpg"&gt;&lt;/div&gt; &lt;script src="timing.js"&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; é™¤äº†è·å–HTMLã€è§£æä¸ºDOMæ ‘ï¼Œæˆ‘ä»¬è¿˜ä¼šå»åŠ è½½CSSæ–‡ä»¶æ„å»ºCSSOMï¼Œç„¶åé€šè¿‡DOMå’ŒCSSOMæ„å»ºæ¸²æŸ“æ ‘ï¼ŒæŒ‰é“ç†æ¥è¯´ï¼ŒDCLä¹Ÿåº”è¯¥åœ¨DOMæ ‘ç”Ÿæˆåå°±è§¦å‘ï¼Œä½†æ˜¯æµè§ˆå™¨åœ¨ä¸‹è½½è§£æCSSæ–‡ä»¶ä¹‹å‰ä¼šé˜»æ­¢DCLäº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºJSå¯èƒ½ä¼šå»æŸ¥è¯¢CSSOMã€‚å³ä½¿å°†è„šæœ¬æ›´æ”¹ä¸ºå†…è”ï¼Œä¹Ÿæ— æµäºäº‹ã€‚ æ‰€ä»¥ï¼Œåªè¦æµè§ˆå™¨é‡åˆ°scriptæ ‡è®°å°±ä¼šé˜»æ­¢ï¼Œå¹¶ç­‰åˆ°CSSOMæ„å»ºå®Œæ¯•ã€‚ å…³é”®èµ„æºï¼ˆHTMLã€CSSã€JSï¼‰ï¼Œå…³é”®è·¯å¾„ï¼ˆæœ€å°‘2æ¬¡ï¼Œè·å–cssã€jsæ—¶ä¸ºå¹¶è¡Œï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ11KBï¼‰ asyncï¼Œå¼‚æ­¥è„šæœ¬çš„ç”¨å¤„ 123456789101112&lt;html&gt; &lt;head&gt; &lt;title&gt;Critical Path: Measure Script&lt;/title&gt; &lt;meta name="viewport" content="width=device-width,initial-scale=1"&gt; &lt;link href="style.css" rel="stylesheet"&gt; &lt;/head&gt; &lt;body onload="measureCRP()"&gt; &lt;p&gt;Hello &lt;span&gt;web performance&lt;/span&gt; students!&lt;/p&gt; &lt;div&gt;&lt;img src="awesome-photo.jpg"&gt;&lt;/div&gt; &lt;script src="timing.js" async&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; è¿™ç§æƒ…å†µä¸‹ï¼Œè§£æHTMLä¹‹åä¸ä¹…å°±ä¼šè§¦å‘DCLäº‹ä»¶ï¼Œæµè§ˆå™¨çŸ¥é“ä¸éœ€è¦é˜»æ­¢JSï¼Œä¸å¿…ç­‰åˆ°CSSæ–‡ä»¶åŠ è½½è§£æåå†æ‰§è¡ŒJSã€‚ å…³é”®èµ„æºï¼ˆHTMLã€CSSï¼‰ï¼Œå…³é”®è·¯å¾„ï¼ˆæœ€å°‘2æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ9KBï¼‰ ä¼˜åŒ–ä¸Šé¢æåˆ°ï¼Œæœ‰ä¸‰ç§å› ç´ ï¼ˆå…³é”®èµ„æºã€å…³é”®è·¯å¾„ã€å…³é”®å­—èŠ‚ï¼‰å½±å“ç€é¦–æ¬¡æ¸²æŸ“ï¼Œæ‰€ä»¥ä¼˜åŒ–ä¹Ÿåº”è¯¥ä»è¿™ä¸‰ç‚¹å…¥æ‰‹ã€‚ å‡å°‘å…³é”®èµ„æºçš„æ•°é‡ï¼šåˆ é™¤ã€å»¶è¿Ÿã€æ ‡è®°å¼‚æ­¥ç­‰ ä¼˜åŒ–å…³é”®å­—èŠ‚æ•°ä»¥ç¼©çŸ­ä¸‹è½½æ—¶é—´ï¼ˆå‹ç¼©ï¼‰ ä¼˜åŒ–å…¶ä½™å…³é”®èµ„æºçš„åŠ è½½é¡ºåºï¼ˆå°½æ—©ä¸‹è½½æ‰€æœ‰çš„å…³é”®èµ„äº§ï¼Œç¼©çŸ­å…³é”®è·¯å¾„é•¿åº¦ï¼‰ ä¸šç•Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç­–ç•¥Google PageSpeed Insights Rules1. **æ¶ˆé™¤é˜»å¡æ¸²æŸ“çš„JavaScriptå’ŒCSS**(æœ€å¤§é™åº¦å‡å°‘ç½‘é¡µä¸Šå…³é”®èµ„æºçš„æ•°é‡å¹¶å°½å¯èƒ½æ¶ˆé™¤è¿™äº›èµ„æºï¼Œå‡å°‘ä¸‹è½½å…³é”®å­—èŠ‚æ•°ï¼Œä¼˜åŒ–å…³é”®è·¯å¾„é•¿åº¦) 2. **ä¼˜åŒ–JavaScriptçš„ä½¿ç”¨**ï¼ˆJavaScriptèµ„æºä¼šé˜»å¡è§£æå™¨ï¼Œæ‰€ä»¥å°†å…¶æ ‡è®°ä¸ºasyncæˆ–é€šè¿‡ä¸“é—¨çš„JavaScriptä»£ç è¿›è¡Œæ·»åŠ ã€‚**é˜»å¡è§£æå™¨çš„JavaScriptå¼ºåˆ¶æµè§ˆå™¨ç­‰å¾…CSSOMå¹¶æš‚åœDOMçš„æ„å»ºï¼Œç»§è€Œå¤§å¤§å»¶è¿Ÿé¦–æ¬¡æ¸²æŸ“çš„æ—¶é—´**ï¼‰ 3. **å»¶è¿Ÿè§£æJavaScript**ï¼ˆå»¶è¿ŸåŠ è½½å¯¹æ„å»ºé¦–æ¬¡æ¸²æŸ“çš„å¯è§å†…å®¹æ— å…³ç´§è¦çš„è„šæœ¬ï¼‰ 4. **é¿å…è¿è¡Œæ—¶é—´é•¿çš„JavaScript** 5. **ä¼˜åŒ–CSSçš„ä½¿ç”¨**ï¼ˆCSSç½®äºæ–‡æ¡£headæ ‡ç­¾å†…ã€é¿å…ä½¿ç”¨CSS importã€å†…è”é˜»å¡æ¸²æŸ“çš„CSSï¼‰ Yahoo Best Practices for Speeding Up Your Web Site å‡å°‘httpè¯·æ±‚ ä½¿ç”¨CDN åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ å‹ç¼©é¡µé¢å…ƒç´  æ ·å¼è¡¨æ”¾åœ¨head JavaScriptæ–‡ä»¶æ”¾åœ¨åº•éƒ¨ é¿å…CSSè¡¨è¾¾å¼ JSã€CSSæ”¾åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­ å‡å°‘CDNæŸ¥è¯¢ å‹ç¼©JavaScript é¿å…é‡å®šå‘ ç°ä»£å‰ç«¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ å‰ç«¯èµ„æºæ–‡ä»¶ç¦»çº¿åŒ– é¡µé¢ç»„ä»¶åŒ–å¹¶æŒ‰éœ€åŠ è½½ é¢„æ¸²æŸ“æå‡æ„Ÿå®˜æ€§èƒ½ RAIL å“åº”ï¼šåœ¨100msä»¥å†…å“åº”åœ¨ç”¨æˆ·æ³¨æ„åˆ°æ»åä¹‹å‰æœ‰100msçš„æ—¶é—´å¯ä»¥å“åº”ç”¨æˆ·è¾“å…¥ã€‚ åŠ¨ç”»ï¼šæ¯10msç”Ÿæˆä¸€å¸§å°½ç®¡æ¯ç§’ç”Ÿæˆ60å¸§ï¼Œä¸€å¸§16.6msï¼Œä½†æ˜¯æ¯å¸§åªæœ‰10msæ¥æ‰§è¡Œä»£ç ï¼Œå…¶ä½™çš„æ—¶é—´ç”¨äºå°†æ–°å¸§ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚ ç©ºé—²ï¼šæœ€å¤§ç¨‹åº¦å¢åŠ ç©ºé—²æ—¶é—´åˆ©ç”¨ç©ºé—²æ—¶é—´å®Œæˆæ¨è¿Ÿçš„å·¥ä½œï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è®©ä¸»çº¿ç¨‹åœ¨UIçº¿ç¨‹å’ŒJSçº¿ç¨‹ä¸­åˆ‡æ¢ã€‚ åŠ è½½ï¼šåœ¨1000msä»¥å†…å‘ˆç°å†…å®¹åœ¨ 1 ç§’é’Ÿå†…åŠ è½½æ‚¨çš„ç½‘ç«™ã€‚ æ€»ç»“ å‚è€ƒèµ„æ–™ Performance metrics. Whatâ€™s this all about? Paint Timing 1 User-centric Performance Metrics User Timing and Custom Metrics åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½ æ€§èƒ½ä¸ºä½•å¦‚æ­¤é‡è¦ ä½¿ç”¨RAILæ¨¡å‹è¯„ä¼°æ€§èƒ½]]></content>
      <categories>
        <category>æ€§èƒ½</category>
      </categories>
      <tags>
        <tag>FP/FCP</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨è¿›ç¨‹æ± æé«˜Node.jså¹¶è¡Œè®¡ç®—èƒ½åŠ›]]></title>
    <url>%2F2019%2F03%2F22%2Fnode-process-pool%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨è¿›ç¨‹æ± æé«˜Node.jså¹¶è¡Œè®¡ç®—èƒ½åŠ›èƒŒæ™¯Nodeæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå½“éœ€è¦æ‰§è¡Œå¤šä¸ªç‹¬ç«‹ä¸”è€—æ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œåªèƒ½é€šè¿‡child_processæ¥åˆ†å‘ä»»åŠ¡ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼›ä¸åƒJavaè¿™ç§å¤šçº¿ç¨‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ¥è§£å†³å¹¶è¡Œé—®é¢˜ï¼ŒNodeåªèƒ½åˆ›å»ºè¿›ç¨‹æ¥è¿›è¡Œå¤„ç†ï¼›ä½†æ˜¯è¿›ç¨‹ç›¸å¯¹äºçº¿ç¨‹æ¥è¯´ï¼Œå¼€é”€å¤ªå¤§ã€‚ä¸€æ—¦è¿›ç¨‹æ•°è¾ƒå¤šæ—¶ï¼ŒCPUå’Œå†…å­˜æ¶ˆè€—ä¸¥é‡ï¼ˆå½±å“æˆ‘å¹²å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„è¿›ç¨‹æ± ï¼Œç”¨æ¥è§£å†³å¹¶è¡Œä»»åŠ¡çš„å¤„ç†ã€‚ é€‚ç”¨åœºæ™¯ï¼šç›¸åŒä¸”ç‹¬ç«‹ä¸”è€—æ—¶çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œæ‹¿åˆ°æŸç½‘ç«™1000ä¸ªç”¨æˆ·çš„è´¦å·å¯†ç ï¼Œæˆ‘ç°åœ¨æƒ³è¦ä»–ä»¬çš„ä¿¡æ¯ï¼Œçˆ¬ä»–ï¼Œnode-process-pooléå¸¸é€‚åˆã€‚ æ€è·¯ä¸»æ§è¿›ç¨‹+å·¥ä½œè¿›ç¨‹ç¾¤ ProcessPoolæ˜¯æˆ‘ä»¬ç®¡ç†è¿›ç¨‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’é…ç½®å‚æ•°ï¼ˆä»»åŠ¡è„šæœ¬ã€è„šæœ¬éœ€è¦çš„å‚æ•°ã€æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼‰ç”Ÿæˆä¸€ä¸ªProcessPoolå®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹æ¥ç®¡æ§è¿›ç¨‹æ± ã€‚ ProcessItemæ˜¯æˆ‘ä»¬è¿›ç¨‹æ± é‡Œçš„è¿›ç¨‹å¯¹è±¡ï¼ŒProcessItemå¯¹è±¡é™¤äº†processçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¢åŠ äº†å”¯ä¸€æ ‡è¯†å’ŒçŠ¶æ€ï¼ˆå¿™ç¢Œã€ä»»åŠ¡å¤±è´¥ã€ä»»åŠ¡å®Œæˆã€è¿›ç¨‹ä¸å¯ç”¨ï¼‰ã€‚ ä¸€æ‰¹ä»»åŠ¡å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸€æ¬¡æ€§forkåˆ°æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼Œç„¶åå¼€å§‹ç›‘æ§æ˜¯å¦æœ‰å·¥ä½œè¿›ç¨‹å®Œæˆä»»åŠ¡ï¼Œå¦‚æœæœ‰å·¥ä½œè¿›ç¨‹å®Œæˆäº†ä»»åŠ¡ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¤ç”¨è¿™ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œè®©å…¶æ‰§è¡Œæ–°ä»»åŠ¡ï¼›å¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬ä¼šå°†ä»»åŠ¡å½’è¿˜ç»™è¿›ç¨‹æ± ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åˆ†å‘ã€‚ ç”±äºæ˜¯ç›¸åŒä¸”ç‹¬ç«‹ä¸”è€—æ—¶çš„ä»»åŠ¡ï¼Œæ‰€ä»¥å½“æŸä¸ªå·¥ä½œè¿›ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦å»æ£€æµ‹æ‰€æœ‰çš„å·¥ä½œè¿›ç¨‹æ˜¯å¦å·²å®Œæˆä»»åŠ¡ï¼Œè€Œä¸åªæ˜¯å¤ç”¨è¿™ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œæˆ‘ä»¬è¦ä¸€æ‰¹ä¸€æ‰¹çš„å¤ç”¨ï¼ï¼ï¼ å› ä¸ºå·®ä¸å¤šçš„æ—¶é—´å¼€å§‹æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œå½“ä¸€ä¸ªå·¥ä½œè¿›ç¨‹å®Œæˆæ—¶ï¼Œå®Œå…¨å¯ä»¥ç›¸ä¿¡å…¶ä»–å·¥ä½œè¿›ç¨‹ä¹Ÿå®Œæˆäº†ä»»åŠ¡ï¼Œæ‰€ä»¥æ£€æµ‹ä¸€è½®æ‰€æœ‰çš„å·¥ä½œè¿›ç¨‹ï¼Œè‹¥ç©ºé—²ï¼Œç»™ä»–ä»¬åˆ†é…æ–°ä»»åŠ¡ã€‚ æ—¢ç„¶æ˜¯æ‰¹é‡åˆ†é…ä»»åŠ¡ï¼Œå°±ä¸ä¼šå­˜åœ¨åªæœ‰æŸä¸ªå·¥ä½œè¿›ç¨‹åœ¨è¾›è‹¦çš„è¿è¡Œï¼Œå…¶ä»–å·¥ä½œè¿›ç¨‹è¢–æ‰‹æ—ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œæ€»å¾—é›¨éœ²å‡æ²¾å˜›ã€‚ ç”±äºä¸»æ§è¿›ç¨‹å³è¦è´Ÿè´£IPCåˆè¦ä¸æ–­ç›‘å¬æ‰¹ä»»åŠ¡å®Œæˆçš„æƒ…å†µï¼Œç›®å‰æˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯setIntervalåˆ‡å‰²ï¼Œè®©IPCå’Œç›‘æ§èƒ½äº¤æ›¿è¿›è¡Œï¼ˆpsï¼šåº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³• æˆ‘ä»¬çœŸçš„éœ€è¦setIntervalæ¥å»è½®è¯¢ä»»åŠ¡çŠ¶æ€å—ï¼Œä»€ä¹ˆæ—¶å€™æ‰éœ€è¦è½®è¯¢ä»»åŠ¡çŠ¶æ€ç„¶åè°ƒåº¦ï¼Ÿå·¥ä½œè¿›ç¨‹çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰æ˜¯æˆ‘ä»¬éœ€è¦å»æ£€æµ‹ä»»åŠ¡çŠ¶æ€å’Œè°ƒåº¦çš„æ—¶æœºï¼›æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨IPCæ¥é€šçŸ¥ä¸»æ§è¿›ç¨‹è¿›è¡Œæ£€æµ‹ä»»åŠ¡çŠ¶æ€å’Œè°ƒåº¦ã€‚psï¼šå½“ç„¶ï¼Œè¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œå˜¿å˜¿ å®ç°ProcessPool.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182const fs = require('fs')const ProcessItem = require('./ProcessItem')const isCorrectType = require('./util').isCorrectType/** * è¿›ç¨‹æ± ç±» * @param maxParallelProcessï¼Œæœ€å¤§å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•° * @param timeToCloseï¼Œä»»åŠ¡æœ€é•¿è€—æ—¶æ—¶é—´ * @param taskParamsï¼Œæ‰€æœ‰ä»»åŠ¡è„šæœ¬éœ€è¦çš„å‚æ•° * @param dependencyï¼Œä»»åŠ¡è„šæœ¬æ‰€éœ€ä¾èµ– * @param taskName, å·¥ä½œè„šæœ¬åç§° * @param script è„šæœ¬å†…å®¹ * @param workDir å·¥ä½œç›®å½• */function ProcessPool(&#123; maxParallelProcess = 50, timeToClose = 60 * 1000, taskParams = [], dependency = '', workDir ='', taskName = Date.now(), script = '',&#125;) &#123; try &#123; isCorrectType('task', script, 'function') isCorrectType('maxParallelProcess', maxParallelProcess, 'number') isCorrectType('timeToClose', timeToClose, 'number') isCorrectType('dependency', dependency, 'string') isCorrectType('workDir', workDir, 'string') &#125; catch (e) &#123; throw new Error('å‚æ•°ä¸åˆæ³•' + e) &#125; this.timeToClose = timeToClose this.processList = new Map() // ä½¿ç”¨Mapå­˜å‚¨è¿›ç¨‹å¯¹è±¡ this.currentProcessNum = 0 // å½“å‰æ´»åŠ¨è¿›ç¨‹æ•° this.dependency = dependency // ä»»åŠ¡è„šæœ¬ä¾èµ– this.workDir = workDir // ä¸»æ§å‡½æ•°å·¥ä½œç›®å½• this.taskName = taskName // ä»»åŠ¡è„šæœ¬åç§° this.task = `$&#123;this.workDir&#125;/$&#123;this.taskName&#125;.js`// ä»»åŠ¡è„šæœ¬è·¯å¾„ this.taskParamsTodo = taskParams // å¾…å®Œæˆçš„ä»»åŠ¡å‚æ•°æ•°ç»„ï¼ŒåŒ…å«äº†nä¸ªå°ä»»åŠ¡æ‰€éœ€å‚æ•°ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ this.maxParallelProcess = maxParallelProcess // æœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•° this.script = script // ä»»åŠ¡è„šæœ¬å†…å®¹ this.ready = false // ä»»åŠ¡è„šæœ¬æ˜¯å¦æ„å»ºå®Œæˆ try &#123; this.buildTaskScript() // æ ¹æ®æ¨¡ç‰ˆåˆ›å»ºä»»åŠ¡è„šæœ¬ &#125; catch (e) &#123; throw new Error('åˆ›å»ºä»»åŠ¡è„šæœ¬å¤±è´¥' + e) &#125;&#125;/** * å¯åŠ¨è¿›ç¨‹æ±  */ProcessPool.prototype.run = function() &#123; if (this.ready) &#123; let flag = this.hasWorkProcessRunning() // åˆ¤æ–­æ˜¯å¦æœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œæˆ–æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡å¤„ç†ä»»åŠ¡ const taskTodoNum = this.taskParamsTodo.length if (flag === 1 &amp;&amp; taskTodoNum) &#123; // åˆå§‹é˜¶æ®µï¼Œfork min&#123;ä»»åŠ¡æ•°ï¼Œæœ€å¤§è¿›ç¨‹æ•°&#125; çš„è¿›ç¨‹ while (this.currentProcessNum &lt; this.maxParallelProcess &amp;&amp; this.currentProcessNum &lt; taskTodoNum) &#123; this.addProcess() &#125; &#125; else if (flag === 2 &amp;&amp; !taskTodoNum) &#123; // æœ‰å¿™ç¢Œçš„å·¥ä½œè¿›ç¨‹ï¼Œä¸”ä»»åŠ¡å·²ä¸‹å‘å®Œ &#125; else if (flag === 2 &amp;&amp; taskTodoNum) &#123; // æœ‰å¿™ç¢Œçš„å·¥ä½œè¿›ç¨‹ï¼Œä½†è¿˜æœ‰ä»»åŠ¡éœ€ä¸‹å‘ const processList = this.processList.values() for (const p of processList) &#123; if (p.state !== 1 || p.state !== 4) &#123; this.reuseProcess(p.id) &#125; &#125; &#125; else if (flag === -1 &amp;&amp; taskTodoNum) &#123; // æ‰€æœ‰å·¥ä½œè¿›ç¨‹ç©ºé—²ï¼Œä½†è¿˜æœ‰ä»»åŠ¡éœ€ä¸‹å‘ const processList = this.processList.values() for (const p of processList) &#123; if (p.state !== 1 || p.state !== 4) &#123; this.reuseProcess(p.id) &#125; &#125; &#125; else if (flag &lt; 0 &amp;&amp; !taskTodoNum) &#123; // æ‰€æœ‰è¿›ç¨‹ç©ºé—²ï¼Œä¸”ä»»åŠ¡å·²ä¸‹å‘å®Œ this.closeProcessPool() &#125; &#125;&#125;/** * ç”Ÿæˆä»»åŠ¡è„šæœ¬ */ProcessPool.prototype.buildTaskScript = function() &#123; const taskDir = this.task const templateDir = `$&#123;__dirname&#125;/task.js` const dependency = `$&#123;this.dependency&#125;\n` const taskBody = this.script.toString() const templateReadStream = fs.createReadStream(templateDir) const taskWriteStream = fs.createWriteStream(taskDir) taskWriteStream.write(dependency) templateReadStream.pipe(taskWriteStream).write(taskBody) taskWriteStream.on('finish', () =&gt; &#123; this.ready = true this.run() &#125;)&#125;/** * æ·»åŠ ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ã€æŒ‡æ´¾ä»»åŠ¡ä¸”ç›‘å¬IPC */ProcessPool.prototype.addProcess = function() &#123; if (this.currentProcessNum &lt;= this.maxParallelProcess) &#123; let workParam = this.taskParamsTodo.shift() const newProcess = new ProcessItem(&#123;task: this.task, workParam&#125;) this.processList.set(newProcess.id, newProcess) this.currentProcessNum++ this.listenProcessState(newProcess, workParam) &#125;&#125;/** * å·¥ä½œè¿›ç¨‹ä¸ä¸»æ§è¿›ç¨‹IPC * @param workProcess * @param params */ProcessPool.prototype.listenProcessState = function(workProcess, params) &#123; workProcess.process.on('message', message =&gt; &#123; if (message === 'finish') &#123; workProcess.finishTask() &#125; else if (message === 'failed') &#123; this.taskParamsTodo.unshift(params) workProcess.unFinishTask() &#125; this.run() &#125;)&#125;/** * ç›‘æµ‹å½“å‰æ˜¯å¦æœ‰æ­£åœ¨å¤„ç†ä»»åŠ¡çš„å·¥ä½œè¿›ç¨‹ * @returns &#123;number&#125; */ProcessPool.prototype.hasWorkProcessRunning = function() &#123; if (!this.processList) return -1 if (this.processList &amp;&amp; !this.processList.size) return 1 // è¿›ç¨‹æ± åˆšå¯åŠ¨ï¼Œå°šæ— å·¥ä½œè¿›ç¨‹ const processList = this.processList.values() for (const p of processList) &#123; if (p.state === 1) return 2 // æœ‰å¿™ç¢Œçš„è¿›ç¨‹ &#125; return -1&#125;/** * å¤ç”¨ç©ºé—²è¿›ç¨‹ * @param idï¼Œå·¥ä½œè¿›ç¨‹çš„pid */ProcessPool.prototype.reuseProcess = function(id) &#123; const workProcess = this.processList.get(id) if (this.taskParamsTodo.length &amp;&amp; workProcess &amp;&amp; workProcess.state !== 1) &#123; const taskParam = this.taskParamsTodo.shift() workProcess.state = 1 // è®¾ç½®ä¸ºå¿™ç¢Œ workProcess.process.send(taskParam) &#125;&#125;/** * å…³é—­å·¥ä½œè¿›ç¨‹ * @param id */ProcessPool.prototype.removeProcess = function(id) &#123; let workProcess = this.processList.get(id) if (workProcess) &#123; workProcess.terminate() this.currentProcessNum-- &#125;&#125;/** * å…³é—­æ‰€æœ‰å·¥ä½œè¿›ç¨‹ */ProcessPool.prototype.removeAllProcess = function() &#123; const processItems = this.processList.values() for (const processItem of processItems) &#123; processItem.terminate() &#125;&#125;/** * å…³é—­è¿›ç¨‹æ±  */ProcessPool.prototype.closeProcessPool = function() &#123; this.removeAllProcess() this.ready = false this.processList = null&#125;module.exports = ProcessPool ProcessItem.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748const ChildProcess = require('child_process')/** * å·¥ä½œè¿›ç¨‹ç±» */function ProcessItem(&#123; task = './task.js', workParam = [] &#125;) &#123; /** * state çŠ¶æ€ç  * 1: å¿™ç¢Œ * 2: å®Œæˆä»»åŠ¡ * 3: æœªå®Œæˆä»»åŠ¡ * 4ï¼š ä¸å¯ç”¨ */ if (!Array.isArray(workParam)) &#123; throw new Error('workParam must be a array') &#125; if (typeof task !== 'string') &#123; throw new Error('workParam must be a string') &#125; this.process = this.createProcess(task, workParam) this.state = 1 this.id = this.process.pid&#125;ProcessItem.prototype.finishTask = function() &#123; if (this.state === 1) &#123; this.state = 2 &#125;&#125;ProcessItem.prototype.unFinishTask = function() &#123; this.state = 3&#125;ProcessItem.prototype.terminate = function() &#123; try &#123; this.process.kill() this.state = 4 &#125; catch (e) &#123; throw new Error(`å…³é—­è¿›ç¨‹$&#123;this.id&#125;å¤±è´¥`) &#125;&#125;ProcessItem.prototype.createProcess = function (task, workParam) &#123; let childProcess = ChildProcess.fork(task, workParam) if (childProcess) &#123; return childProcess &#125; else &#123; throw new Error('create process failed') &#125;&#125;module.exports = ProcessItem Task.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * å½“è¿›ç¨‹è¢«å­è¿›ç¨‹åˆ›å»ºåï¼Œç«‹åˆ»æ‰§è¡Œå·¥ä½œä»»åŠ¡ */async function firstTask() &#123; const workParam = process.argv.slice(2) await task(workParam)&#125;/** * å®Œæˆä»»åŠ¡ï¼Œæç¤ºè¿›ç¨‹æ± å·²å®Œæˆï¼Œå·¥ä½œè¿›ç¨‹ç©ºé—² */async function finishTask() &#123; await process.send('finish')&#125;/** * ä»»åŠ¡å¤±è´¥ï¼Œæç¤ºè¿›ç¨‹æ± æœªå®Œæˆï¼Œå½’è¿˜ä»»åŠ¡ */async function unFinishTask() &#123; await process.send('failed')&#125;/** * ç›‘å¬è¿›ç¨‹æ± åç»­æŒ‡æ´¾çš„ä»»åŠ¡ */process.on('message', async workParam =&gt; &#123; await task(workParam) try &#123; await finishTask() &#125; catch (e) &#123; await unFinishTask() &#125;&#125;)/** * è¿›ç¨‹è¢«åˆ›å»ºæ—¶ç«‹å³æ‰§è¡Œè¿›ç¨‹æ± æŒ‡æ´¾çš„ä»»åŠ¡ * @returns &#123;Promise&lt;void&gt;&#125; */async function main() &#123; try &#123; await firstTask() await finishTask() &#125; catch (e) &#123; await unFinishTask() &#125;&#125;main()/** * @name å·¥ä½œè¿›ç¨‹è´Ÿè´£çš„ä»»åŠ¡ * @param workParam // æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å‚æ•°æ•°ç»„ * åŠ¨æ€æ·»åŠ ä»»åŠ¡è„šæœ¬åˆ°æ­¤æ–‡ä»¶å°¾éƒ¨ */ Util.js12345678910111213function isCorrectType(name,value, type) &#123; if (type === 'array') &#123; if (!Array.isArray(value)) &#123; throw new Error(`$&#123;name&#125; must be a array`) &#125; &#125; else &#123; if (typeof value !== type) &#123; throw new Error(`$&#123;name&#125; must be a $&#123;type&#125;`) &#125; &#125;&#125;exports.isCorrectType = isCorrectType ä½¿ç”¨æ–¹æ³•å®‰è£…1npm install node-process-pool ä½¿ç”¨1234567891011121314151617181920// è¿›ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹const ProcessPool = require('../src/ProcessPool')const taskParams = []for (let i = 0; i &lt; 100; i++) &#123; taskParams[i] = [i]&#125;// åˆ›å»ºè¿›ç¨‹æ± å®ä¾‹const processPool = new ProcessPool(&#123; maxParallelProcess: 50, // æ”¯æŒæœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•° timeToClose: 60 * 1000, // å•ä¸ªä»»åŠ¡è¢«æ‰§è¡Œæœ€å¤§æ—¶é•¿ dependency: `const path = require('path')`, // ä»»åŠ¡è„šæœ¬ä¾èµ– workDir: __dirname, // å½“å‰ç›®å½• taskName: 'test', // ä»»åŠ¡è„šæœ¬åç§° script: async function task(workParam) &#123; console.log(workParam) &#125;, // ä»»åŠ¡è„šæœ¬å†…å®¹ taskParams // éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å‚æ•°åˆ—è¡¨ï¼ŒäºŒç»´æ•°ç»„&#125;)// åˆ©ç”¨è¿›ç¨‹æ± è¿›è¡Œå¤„ç†å¤§è§„æ¨¡ä»»åŠ¡processPool.run() å…¶ä»–githubåœ°å€ï¼šhttps://github.com/GeniusFunny/ProcessPool]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
        <tag>å•çº¿ç¨‹</tag>
        <tag>è¿›ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯è·¯ç”±çš„è®¾è®¡æ€æƒ³ä¸å®ç° && React-Router v4]]></title>
    <url>%2F2019%2F02%2F25%2Freact-router%2F</url>
    <content type="text"><![CDATA[å‰ç«¯è·¯ç”±çš„å®ç°å‰ç«¯è·¯ç”±åˆ†ä¸ºä¸¤ç§å®ç°æ–¹å¼ï¼š HashHistoryï¼Œé€šè¿‡ä¿®æ”¹location.hashï¼Œç„¶åç›‘å¬hashchangeäº‹ä»¶æ¥è¿›è¡Œå¯¹åº”æ“ä½œã€‚ BroswerHistoryï¼Œé€šè¿‡HTML5æä¾›çš„Historyå¯¹è±¡çš„pushStateã€replaceStateAPIï¼Œç„¶åç›‘å¬popstateäº‹ä»¶æ¥è¿›è¡Œå¯¹åº”æ“ä½œã€‚ äºŒè€…çš„ä¼˜åŠ£ï¼š ç¬¬ä¸€ç§æ–¹æ³•å…¼å®¹æ€§æ›´å¥½ï¼Œä½†æ˜¯å®ç°æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸”urlæ¯”è¾ƒä¸‘é™‹ï¼ˆä¾‹å¦‚ï¼šhttp://www.test.com/#/xxxï¼‰ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¯æµè§ˆå™¨æä¾›çš„èƒ½åŠ›ï¼Œæ‰€ä»¥å®ç°æ¯”è¾ƒç®€å•ï¼Œurlä¸æ­£å¸¸ç›¸åŒï¼ˆä¾‹å¦‚ï¼šhttp://www.test.com/xxxï¼‰ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚ å…¶å®è¿˜æœ‰ç¬¬ä¸‰ç§ï¼ŒMemoryHistoryï¼Œç”¨äºnon-DOMç¯å¢ƒä¸‹ï¼Œä¾‹å¦‚React Nativeã€‚ åŸºäºhashçš„å‰ç«¯è·¯ç”±å®ç°_routesç”¨æ¥å­˜å‚¨è·¯ç”±å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œå½“hashå˜åŒ–æ—¶è°ƒç”¨refreshå‡½æ•°ï¼ˆä»_routesæ€»æ‰¾åˆ°å¯¹åº”çš„å›è°ƒå‡½æ•°ç„¶åæ‰§è¡Œï¼‰ï¼›é€šè¿‡backå‡½æ•°è¿›è¡Œå›é€€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥å¸ƒå°”å€¼åˆ¤å®šå½“å‰æ“ä½œæ˜¯å¦ä¸ºå›é€€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738class HashRouter &#123; constructor() &#123; this._routes = new Map() this._history = [] this._currentUrl = '' this._backIndex = this._routes.length - 1 this._currentIndex = this._routes.length - 1 this._isBack = false this._bindEvent() &#125; _bindEvent = () =&gt; &#123; window.addEventListener('laod', this.refresh, false) // åŠ è½½åå°±è§¦å‘æ›´æ–° window.addEventListener('hashchange', this.refresh, false) //ç›‘å¬hashçš„å˜åŒ–ï¼Œç„¶åè°ƒç”¨æ›´æ–°å‡½æ•° &#125; route(path, cb = function() &#123;&#125;) &#123; this._routes.set(path, cb) &#125; refresh = () =&gt; &#123; this._currentUrl = location.hash.slice(1) || '/' //è¯»å–urlä¸­'#'åé¢çš„å†…å®¹ this._history.push(this._currentUrl) this._currentIndex++ if (!this._isBack) &#123; this._backIndex = this._currentIndex &#125; let cb = this._routes.get(this._currentUrl) if (typeof cb === 'function') cb() // æ‰§è¡Œè·¯ç”±å¯¹åº”çš„å›è°ƒå‡½æ•° this._isBack = false &#125; back = () =&gt; &#123; this._isBack = true if (this._backIndex &lt;= 0) &#123; this._backIndex = 0 &#125; else &#123; this._backIndex -= 1 &#125; location.hash = `#&#123;this._history[this._backIndex]&#125;` &#125;&#125; åŸºäºHistoryçš„å‰ç«¯è·¯ç”±å®ç°ä¾èµ–äºHTML5æä¾›çš„Historyå¯¹è±¡ï¼ŒRouterçš„å®ç°ç®€ä¾¿å¾ˆå¤šï¼›ä½¿ç”¨goæ¥è¿›è¡Œå‰å¾€æŒ‡å®šè·¯ç”±ï¼Œç”¨backå›é€€ã€‚ 1234567891011121314151617181920212223242526272829class BroswerRouter &#123; constructor() &#123; this._routes = new Map() this._bindEvent() &#125; _bindEvent = () =&gt; &#123; window.addEventListener('popstate', e =&gt; &#123; let path = e.state &amp;&amp; e.state.path let cb = this._routes.get(path) if (typeof cb = 'function') cb() &#125;) &#125; init(path) &#123; history.replaceState(&#123;path: path&#125;, '', path) let cb = this._routes.get(path) if (typeof cb = 'function') cb() &#125; route(path, cb = function() &#123;&#125;) &#123; this._routes.set(path, cb) &#125; go = (path) =&gt; &#123; history.pushState(&#123;path: path&#125;, '', path) let cb = this._routes.get(path) if (typeof cb === 'function') cb() &#125; back = () =&gt; &#123; history.back() &#125;&#125; React-Router v4ğŸ‘†ğŸ‘†ğŸ‘†åªæ˜¯ç®€å•çš„å‰åº¦è·¯ç”±çš„æ¨¡æ‹Ÿï¼Œä½†æ˜¯æ¶‰åŠåˆ°Reactæˆ–è€…Vueçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–å¤„ç†æ¸²æŸ“é€»è¾‘ï¼Œæ‰€ä»¥ä¼šç‰µæ‰¯åˆ°ç”Ÿå‘½å‘¨æœŸå’Œç»„ä»¶é€šä¿¡ã€‚ ä¸‹é¢ç®€å•åˆ†ææ¦‚è¿°ä¸€ä¸‹React-Router v4 æ¨¡å—ç»“æ„React-Routeråˆ†ä¸º4ä¸ªpackageï¼Œåˆ†åˆ«ä¸ºï¼šreact-routerã€react-router-domã€react-router-nativeã€react-router-configã€‚ react-routerï¼šè´Ÿè´£é€šç”¨çš„è·¯ç”±é€»è¾‘ï¼Œè¢«å…¶ä»–packageæ‰€ä¾èµ–ï¼Œæ— éœ€ç‰¹åˆ«å¼•å…¥ã€‚ react-router-dom: è´Ÿè´£æµè§ˆå™¨çš„è·¯ç”±ç®¡ç†ã€‚ react-router-nativeï¼šè´Ÿè´£react-nativeçš„è·¯ç”±ç®¡ç†ã€‚ react-router-config: ç”¨äºé…ç½®ç‰¹åˆ«çš„react-routerï¼Œæ¯”å¦‚SSRç¯å¢ƒä¸‹ã€‚ ä¸‹é¢ä»‹ç»ä¸€ä¸‹react-routerä¸­åªè¦çš„æ¨¡å—ğŸ‘‡ğŸ‘‡ğŸ‘‡ Routerï¼ˆreact-router/Routerã€react-router/RouterContextã€react-router-dom/BrowserRouterï¼‰BroswerRouteråœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡historyï¼Œç„¶åé€šè¿‡propsä¼ é€’ç»™Routerç»„ä»¶ï¼ŒRouterç»„ä»¶å†å°†è¿™ä¸ªhistoryå±æ€§ä½œä¸ºcontextä¼ é€’ç»™å­ç»„ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768// åˆ›å»ºcontextï¼Œç”¨äºå…¨å±€ä¼ é€’ä¿¡æ¯const createNamedContext = name =&gt; &#123; const context = React.createContext(); context.Provider.displayName = `$&#123;name&#125;.Provider`; context.Consumer.displayName = `$&#123;name&#125;.Consumer`; return context;&#125;const RouterContext = createNamedContext('Router')class Router extends Component &#123; static computeRootMatch(pathname) &#123; return &#123; path: "/", url: "/", params: &#123;&#125;, isExact: pathname === "/" &#125;; &#125; constructor(props) &#123; super(props); this.state = &#123; location: props.history.location &#125;; // This is a bit of a hack. We have to start listening for location // changes here in the constructor in case there are any &lt;Redirect&gt;s // on the initial render. If there are, they will replace/push when // they mount and since cDM fires in children before parents, we may // get a new location before the &lt;Router&gt; is mounted. this._isMounted = false; this._pendingLocation = null; if (!props.staticContext) &#123; // ï¼ï¼ï¼åœ¨è¿™é‡Œè¿›è¡Œç›‘å¬ï¼Œæ¯æ¬¡è·¯ç”±å˜åŒ–éƒ½ä¼šè§¦å‘é¡¶å±‚Routerçš„å›è°ƒäº‹ä»¶ï¼Œç„¶åRouterè¿›è¡ŒsetStateï¼Œå†å‘ä¸‹ä¼ é€’contextï¼Œæœ€ä¸‹é¢çš„Routeæ ¹æ®contextå†…å®¹åˆ¤æ–­æ˜¯å¦è¿›è¡Œæ¸²æŸ“ï¼ï¼ï¼ this.unlisten = props.history.listen(location =&gt; &#123; if (this._isMounted) &#123; this.setState(&#123; location &#125;); &#125; else &#123; this._pendingLocation = location; &#125; &#125;); &#125; &#125; componentDidMount() &#123; this._isMounted = true; if (this._pendingLocation) &#123; this.setState(&#123; location: this._pendingLocation &#125;); &#125; &#125; componentWillUnmount() &#123; if (this.unlisten) this.unlisten(); &#125; render() &#123; return ( &lt;RouterContext.Provider children=&#123;this.props.children || null&#125; value=&#123;&#123; history: this.props.history, location: this.state.location, match: Router.computeRootMatch(this.state.location.pathname), staticContext: this.props.staticContext &#125;&#125; /&gt; ); &#125;&#125;class BrowserRouter extends React.Component &#123; history = createHistory(this.props); render() &#123; return &lt;Router history=&#123;this.history&#125; children=&#123;this.props.children&#125; /&gt;; &#125;&#125; Routeï¼ˆreact-router/Routeï¼‰Routeræ˜¯å€ŸåŠ©contextå‘Routeä¼ é€’å†…å®¹çš„ï¼ŒRouterä½œä¸ºProviderã€Routeä½œä¸ºComsumerï¼Œæ‰€ä»¥Routeå¿…é¡»åŒ…å«åœ¨Routerå†…éƒ¨ã€‚ åŒæ—¶ï¼ŒRouteå€ŸåŠ©contextå°†historyã€locationã€matchä½œä¸ºä¸‰ä¸ªç‹¬ç«‹çš„å±æ€§ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class Route extends Component &#123; render() &#123; return ( &lt;RouterContext.Consumer&gt; &#123;context =&gt; &#123; const location = this.props.location || context.location const match = this.props.computedMatch ? this.props.computedMatch // &lt;Switch&gt; already computed the match for us : this.props.path ? matchPath(location.pathname, this.props) : context.match const props = &#123; ...context, location, match &#125; // ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶ let &#123; children, component, render &#125; = this.props // Preact uses an empty array as children by // default, so use null if that's the case. if (Array.isArray(children) &amp;&amp; children.length === 0) &#123; children = null; &#125; if (typeof children === "function") &#123; children = children(props); if (children === undefined) &#123; children = null; &#125; &#125; return ( // æä¾›äº†å¤šç§æ¸²æŸ“çš„æ–¹å¼ï¼Œchildren(å­å…ƒç´ )ã€componentï¼ˆpropsï¼‰ã€render(props) &lt;RouterContext.Provider value=&#123;props&#125;&gt; &#123;children &amp;&amp; !isEmptyChildren(children) ? children : props.match ? component ? React.createElement(component, props) // è¿™é‡Œæ˜¯é€šè¿‡React.creareElementåˆ›å»ºç»„ä»¶çš„ï¼Œæ‰€ä»¥React Diffè®¤ä¸ºæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œæ›´æ–°çš„æ—¶å€™ä¼šå…ˆå¸è½½ä¹‹å‰çš„ç»„ä»¶å†é‡æ–°å®‰è£…æ–°çš„ç»„ä»¶ã€‚ : render ? render(props) : null : null&#125; &lt;/RouterContext.Provider&gt; ); &#125;&#125; &lt;/RouterContext.Consumer&gt; ); &#125;&#125; Switchï¼ˆreact-router/Switchï¼‰Switchçš„ä½œç”¨æ˜¯ï¼Œå½“Switchä¸­çš„ç¬¬ä¸€ä¸ªRouteåŒ¹é…åå°±ä¸ä¼šæ¸²æŸ“å…¶ä»–çš„Routeï¼Œç±»ä¼¼swichè¿™ä¸ªè¯­æ³•ã€‚æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435class Switch extends Component &#123; render() &#123; return ( &lt;RouterContext.Consumer&gt; &#123;context =&gt; &#123; const location = this.props.location || context.location; let element, match; // We use React.Children.forEach instead of React.Children.toArray().find() // here because toArray adds keys to all child elements and we do not want // to trigger an unmount/remount for two &lt;Route&gt;s that render the same // component at different URLs. React.Children.forEach(this.props.children, child =&gt; &#123; // æŒ‰childrençš„é¡ºåºä¾æ¬¡éå†å­å…ƒç´ ï¼ŒæˆåŠŸå°±æ ‡è®°è¿™ä¸ªå­å…ƒç´ å’Œå¯¹åº”çš„locationå’ŒcomutedMatchï¼Œæœ€åè°ƒç”¨React.cloneElementæ¸²æŸ“ï¼Œå¦åˆ™è¿”å›null if (match == null &amp;&amp; React.isValidElement(child)) &#123; element = child; const path = child.props.path || child.props.from; // Switché€šè¿‡matchPathæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸ match = path ? matchPath(location.pathname, &#123; ...child.props, path &#125;) : context.match; &#125; &#125;); return match ? React.cloneElement(element, &#123; location, computedMatch: match &#125;) : null; &#125;&#125; &lt;/RouterContext.Consumer&gt; ); &#125;&#125; matchPathï¼ˆreact-router/matchPathï¼‰å‰é¢å¤šæ¬¡æåˆ°ä½¿ç”¨matchPathæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯å¦‚ä½•è¿›è¡ŒåŒ¹é…çš„å‘¢ï¼Ÿä¸‹é¢æ˜¯matchPathçš„æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960// ç¼“å­˜ï¼Œä¸å¿…æ¯æ¬¡éƒ½ç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç”¨äºåˆ¤æ–­const cache = &#123;&#125;;const cacheLimit = 10000;let cacheCount = 0;function compilePath(path, options) &#123; const cacheKey = `$&#123;options.end&#125;$&#123;options.strict&#125;$&#123;options.sensitive&#125;`; const pathCache = cache[cacheKey] || (cache[cacheKey] = &#123;&#125;); if (pathCache[path]) return pathCache[path]; const keys = []; const regexp = pathToRegexp(path, keys, options); const result = &#123; regexp, keys &#125;; if (cacheCount &lt; cacheLimit) &#123; pathCache[path] = result; cacheCount++; &#125; return result;&#125;/** * Public API for matching a URL pathname to a path. */function matchPath(pathname, options = &#123;&#125;) &#123; if (typeof options === "string") options = &#123; path: options &#125;; const &#123; path, exact = false, strict = false, sensitive = false &#125; = options; const paths = [].concat(path); return paths.reduce((matched, path) =&gt; &#123; if (matched) return matched; const &#123; regexp, keys &#125; = compilePath(path, &#123; end: exact, strict, sensitive &#125;); const match = regexp.exec(pathname); if (!match) return null; const [url, ...values] = match; const isExact = pathname === url; if (exact &amp;&amp; !isExact) return null; return &#123; path, // the path used to match url: path === "/" &amp;&amp; url === "" ? "/" : url, // the matched portion of the URL isExact, // whether or not we matched exactly params: keys.reduce((memo, key, index) =&gt; &#123; memo[key.name] = values[index]; return memo; &#125;, &#123;&#125;) &#125;; &#125;, null);&#125; Linkï¼ˆreact-router-dom/Linkï¼‰Linkæ˜¯react-router-domä¸­çš„ï¼Œè€Œä¸æ˜¯é€šç”¨æ¨¡å—é‡Œçš„å…ƒç´ ï¼›Linkæ˜¯ä¸€ä¸ªç”¨aæ ‡ç­¾åŒ…è£¹ã€ç”¨æ¥å®ç°è·³è½¬çš„å…ƒç´ ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344class Link extends React.Component &#123; handleClick(event, history) &#123; if (this.props.onClick) this.props.onClick(event); if ( !event.defaultPrevented &amp;&amp; // onClick prevented default event.button === 0 &amp;&amp; // ignore everything but left clicks (!this.props.target || this.props.target === "_self") &amp;&amp; // let browser handle "target=_blank" etc. !isModifiedEvent(event) // ignore clicks with modifier keys ) &#123; event.preventDefault(); const method = this.props.replace ? history.replace : history.push; method(this.props.to); &#125; &#125; render() &#123; const &#123; innerRef, replace, to, ...rest &#125; = this.props; // eslint-disable-line no-unused-vars return ( &lt;RouterContext.Consumer&gt; &#123;context =&gt; &#123; const location = typeof to === "string" ? createLocation(to, null, null, context.location) : to; const href = location ? context.history.createHref(location) : ""; return ( &lt;a &#123;...rest&#125; onClick=&#123;event =&gt; this.handleClick(event, context.history)&#125; href=&#123;href&#125; ref=&#123;innerRef&#125; /&gt; ); &#125;&#125; &lt;/RouterContext.Consumer&gt; ); &#125;&#125; H5çš„historyå¯¹è±¡ä¸­é€šè¿‡pushStateã€replaceStateåªä¼šæ”¹å˜è·¯ç”±è€Œä¸ä¼šå‘ç”Ÿè·³è½¬ï¼Œä½†æ˜¯ä¹‹å‰æçš„Routerä¸­çš„listenå¯ä»¥ç›‘å¬åˆ°è·¯ç”±çš„å˜åŒ–ç„¶åæ›´æ–°propså’Œcontextï¼Œè®©ä¸‹å±‚çš„Routeé‡æ–°åŒ¹é…ï¼Œå®Œæˆéœ€è¦æ¸²æŸ“éƒ¨åˆ†çš„æ›´æ–°ã€‚å¦‚ä½•ç›‘å¬çš„å‘¢ï¼Ÿè¿™éƒ¨åˆ†åœ¨historyåº“ä¸­çš„createTransitionManagerä¸­ï¼ˆReact-Routerä¾èµ–äºhistoryï¼‰ã€‚ createTransitionManagerï¼ˆhistory/createTransitionManagerï¼‰ä¸‹é¢å°±æ˜¯æºç ï¼Œè§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªåº”ç”¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667function createTransitionManager() &#123; let prompt = null; function setPrompt(nextPrompt) &#123; prompt = nextPrompt; return () =&gt; &#123; if (prompt === nextPrompt) prompt = null; &#125;; &#125; function confirmTransitionTo( location, action, getUserConfirmation, callback ) &#123; // TODO: If another transition starts while we're still confirming // the previous one, we may end up in a weird state. Figure out the // best way to handle this. if (prompt != null) &#123; const result = typeof prompt === 'function' ? prompt(location, action) : prompt; if (typeof result === 'string') &#123; if (typeof getUserConfirmation === 'function') &#123; getUserConfirmation(result, callback); &#125; else &#123; callback(true); &#125; &#125; else &#123; // Return false from a transition hook to cancel the transition. callback(result !== false); &#125; &#125; else &#123; callback(true); &#125; &#125; let listeners = []; function appendListener(fn) &#123; let isActive = true; function listener(...args) &#123; if (isActive) fn(...args); &#125; listeners.push(listener); return () =&gt; &#123; isActive = false; listeners = listeners.filter(item =&gt; item !== listener); &#125;; &#125; function notifyListeners(...args) &#123; listeners.forEach(listener =&gt; listener(...args)); &#125; return &#123; setPrompt, confirmTransitionTo, appendListener, notifyListeners &#125;;&#125; WithRouterï¼ˆreact-router/WithRouterï¼‰å…‰ä»åå­—ä¸Šçœ‹å°±çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªHOCï¼Œè¿™ä¸ªé«˜é˜¶ç»„ä»¶çš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬åœ¨éRouteä¸­çš„ç»„ä»¶ä¹Ÿèƒ½è·å–åˆ°è·¯ç”±ä¿¡æ¯ã€‚ 123456789101112131415161718192021function withRouter(Component) &#123; const C = props =&gt; &#123; const &#123; wrappedComponentRef, ...remainingProps &#125; = props; return ( &lt;Route children=&#123;routeComponentProps =&gt; ( &lt;Component &#123;...remainingProps&#125; &#123;...routeComponentProps&#125; ref=&#123;wrappedComponentRef&#125; /&gt; )&#125; /&gt; ); &#125;; C.displayName = `withRouter($&#123;Component.displayName || Component.name&#125;)`; C.WrappedComponent = Component; return hoistStatics(C, Component);&#125; æ€»ç»“ç°åœ¨æˆ‘ä»¬æ¥å¤§è‡´æ¢³ç†ä¸€ä¸‹ï¼Œå‰ç«¯è·¯ç”±çš„è¿‡ç¨‹ã€‚ å½“Routerç»„ä»¶åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸Šé¢æ³¨å†Œä¸€ä¸ªäº‹ä»¶ç”¨äºç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œä¸€æ—¦è·¯ç”±å˜åŒ–å°±ä¼šè§¦å‘setStateã€‚ ç‚¹å‡»Linkå…¶å®å°±æ˜¯ç‚¹å‡»aæ ‡ç­¾è¿›è¡Œè·³è½¬ï¼Œä½†æ˜¯æˆ‘ä»¬é˜»æ­¢äº†è·³è½¬ï¼›å®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œè°ƒç”¨historyçš„pushStateæ–¹æ³•ï¼Œå°†å½“å‰pathå­˜å‚¨ï¼Œå¹¶ä¿®æ”¹è·¯ç”±ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰æ”¹å˜é¡µé¢çš„æ¸²æŸ“ï¼‰ã€‚ æ¯æ¬¡è·¯ç”±çš„å˜åŒ–å°±ä¼šè§¦å‘Routerçš„setStateï¼Œæ‰€ä»¥æ­¤æ—¶ä¼šæˆæ–°contextä¼ é€’ç»™ä¸‹å±‚ã€‚ ä¸‹å±‚çš„Routeæ‹¿åˆ°æ–°çš„contextåæ ¹æ®matchPathåˆ¤æ–­pathæ˜¯å¦å’ŒlocationåŒ¹é…ï¼ŒåŒ¹é…å°±æ¸²æŸ“ï¼Œä¸åŒ¹é…ä¸æ¸²æŸ“ï¼Œæ­¤æ—¶é¡µé¢çš„æ¸²æŸ“æ”¹å˜ã€‚ æ‰€ä»¥è¯´æ•´ä¸ªå‰ç«¯è·¯ç”±çš„æ€è·¯ï¼ˆä»¥React-Routerä¸ºä¾‹ï¼‰å°±æ˜¯ï¼š é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œé€šè¿‡context APIå‘ä¸‹ä¼ é€’histpryå¯¹è±¡ï¼Œä»è€Œæ§åˆ¶å…·ä½“çš„æ¸²æŸ“ï¼›ï¼ˆæ¸²æŸ“å˜åŒ–ï¼‰ æ·»åŠ ä¸€ä¸ªEvent Emitterï¼Œç”¨äºå“åº”è·¯ç”±å˜åŒ–/Hashå˜åŒ–ï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„é€»è¾‘å¤„ç†ï¼›ï¼ˆè·¯ç”±å˜åŒ–ï¼‰ è·¯ç”±å˜åŒ–/Hashå˜åŒ–å¯¼è‡´contextå˜åŒ–ï¼Œcontextå˜åŒ–åˆå¯¼è‡´æ¸²æŸ“æ”¹å˜ï¼›ï¼ˆæ¸²æŸ“å˜åŒ–ï¼‰ é‚£ä¹ˆï¼Œå‰ç«¯è·¯ç”±è·Ÿåç«¯è·¯ç”±æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ åç«¯è·¯ç”±ï¼Œæ•°æ®æ¸²æŸ“æ˜¯ç”±æœåŠ¡å™¨è§£å†³ï¼Œä¾‹å¦‚åˆ©ç”¨expressæ„å»ºçš„æœåŠ¡ç«¯åº”ç”¨ï¼Œrender(â€˜xxx.pugâ€™)ï¼ŒæœåŠ¡å™¨æ¸²æŸ“å¥½é¡µé¢åè¿”å›ç»™æµè§ˆå™¨ç«¯ï¼Œæµè§ˆå™¨æ˜¾ç¤ºã€‚è¡¨ç°å½¢å¼å°±æ˜¯ï¼Œè·³è½¬é¡µé¢ä¼šç™½å±ï¼ŒåŠ è½½ï½ å‰ç«¯è·¯ç”±ï¼Œæ•°æ®æ¸²æŸ“æ˜¯ç”±æµè§ˆå™¨ç«¯è§£å†³ï¼Œä¾‹å¦‚ä¸Šè¿°çš„ä¾‹å­ï¼Œä½†æ˜¯è·¯ç”±å˜åŒ–å’Œæ¸²æŸ“å˜åŒ–æ˜¯åˆ†éš”å¼€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡hashchange or popstateå°†è·¯ç”±å˜åŒ–å’Œæ¸²æŸ“å˜åŒ–è¿æ¥èµ·æ¥ã€‚è¡¨ç°å½¢å¼åˆ™æ˜¯ï¼Œè·³è½¬é¡µé¢ä¸ä¼šç™½å±ï½ é‚£æ˜¯ä¸æ˜¯å‰ç«¯è·¯ç”±å°±å¯ä»¥å®Œå…¨å–ä»£åç«¯è·¯ç”±äº†å‘¢ï¼Ÿä¸æ˜¯çš„ï¼Œå‰ç«¯è·¯ç”±ä¹Ÿå­˜åœ¨ä¸è¶³ï¼ŒSEOå°±æ˜¯ä¸€ä¸ªbig problemã€‚ é‚£æ˜¯ä¸æ˜¯å‰ç«¯è·¯ç”±å’Œåç«¯è·¯ç”±å°±æ˜¯ç›¸äº’éš”ç»çš„å‘¢ï¼Ÿä¸æ˜¯çš„ï¼ŒäºŒè€…ä¹‹é—´åˆè¡ç”Ÿå‡ºè®¸å¤šæ–°çš„hackæ‰‹æ®µï¼Œä¾‹å¦‚é¢„æ¸²æŸ“ï¼ˆæœåŠ¡ç«¯çº¿æ„å»ºå‡ºä¸€éƒ¨åˆ†é™æ€HTMLï¼Œç”¨äºç›´å‡ºæµè§ˆå™¨ï¼Œç„¶åå‰©ä½™ä½¿ç”¨å‰ç«¯æ¸²æŸ“æ¥å®ç°ï¼‰ã€SSRã€‚ æ—¢ç„¶è°ˆåˆ°äº†é¢„æ¸²æŸ“å’ŒSSRï¼›é‚£å°±å…ˆå ä¸ªå‘ä½ï¼Œå­¦ä¹ ä¸€ä¸‹SSRå’Œé¢„æ¸²æŸ“ï½ å‚è€ƒèµ„æº å‰ç«¯è·¯ç”±çš„ä¸¤ç§å®ç°åŸç† é¢è¯•å®˜ï¼šä½ äº†è§£å‰ç«¯è·¯ç”±å— React-Routeræºç  historyæºç â€”Manage session history with JavaScript]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>å‰ç«¯è·¯ç”±</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Processes and Threads]]></title>
    <url>%2F2018%2F12%2F09%2Fprocesses-and-threads%2F</url>
    <content type="text"><![CDATA[Process and Thread are most important concepts in Operating System. Processes and ThreadsProcessConceptIn process model, all the runnable software on the computer, sometimes include operating system, is organized into a number of sequential process. A process is just an instance of an executing program, including the current vlaues of program counter, registers, and variables. A CPU can really run only one process at a time. In traditional operating systems, each process has an address space and a single thread of control. In many situations , it is desirable to have multiple threads of control in the same address space running in quasi-parallel, as though they were (almost) separate processes(except for the shared address spaces). Process Creation System initialization. Execution of a process-creation system call by running process. A user request to create a new process. A initiation of a batch job. Daemons: Processes that stay in the background to handle some activity. Fork: this system call creates an exact clone of the calling process. After the fork, the two processes, the parent and the child, have the same memory image, the same environment strings, and the same open files. Process Termination Normal exit(voluntary). Error exit(voluntary). Fatal error(involuntary). Killed by aother process(involuntary). Process HierarchiesIn UNIX, a process and all of its children and further descendants together from a process group. Windows has no concept of a process hierarchy, all processes are equal. The only hint of a process hierarchy is that when a process is created, the parent is given a special token (called a handle) that it can use to control the child. Process States Running.ï¼ˆactually using the CPU at that instantï¼‰ Ready. (runnable; temporatily stopped to let another process run) Blocked.(unable to run until some external event happens) Implementation of ProcessesProcess Table: contains per process, each entry contains important information about the process state, including its program counter, stack pointer, memory allocation, the status of its open files, its accounting and scheduling infomation, and everything else about the process that must be saved when the process is switched from running to ready or blocked state so that it can be restarted later as if it had never been stopped. Skeleton of what the lowest level of the operating system does when an interrupt occurs: Hardware stacks program counter, etc. Hardware loads new program counter from interrupt vector. Assembly-language procedure saves registers. Assembly-language procedure sets up new stack. C interrupt service runs (typically reads and buffers input). Scheduler decides which process is to run next. C procedure returns to the assembly code. Assembly-language procedure starts up new current process. A process may be interrputed thousands of times during its execution, but the key idea is that after each interrupt the interrupted process returns to precisely the same state it was in before the interrupt occurred. ThreadConceptA thread can be reguard as a miniprocess. Why would anyone want to have threads? Only now with threads we add a element: the ability for parallel entities to share an address space and all of its data, which is why having multiple processes (with their separate address spaces) will not work. Threads are lighter weight than processes, they are easier to create and destory than process. Threads yield no performance gain when all of then are CPU bound, but when where is substantial computing and also substantial I/O, having threads allows these activities to overlap, thus speeding up the application. The Classical Thread ModelThe process model is based on two independent concepts: resource grouping and execution. A process has a thread of execution, usually shortened to just thread. Processes are used to group resources together; threads are the entities scheduled for executing on the CPU. Implementing Threads in User SpaceAdvantage : When a thread is finished running for the moment, for example, when it calls thread yield, the code ofthread yield can save the threadâ€™s information in the thread table itself. Furthermore, it can then call the thread scheduler to pick another thread to run. The procedure that saves the threadâ€™s state and the scheduler are just local procedures, so invoking them is much more efficient than making a kernel call. Among other issues, no trap is needed, no context switch is needed, the memory cache need not be flushed, and so on. This makes thread scheduling very fast. They allow each process to have its own customized scheduling algorithm. Problem: How implement blocking system call? if a thread starts running, no other thread in that process will ever run unless the first thread voluntarily gives up the CPU. Implementing Threads in the Kernel All calls that might block a thread are implemented as system calls, at consid-erably greater cost than a call to a run-time system procedure. Kernel threads do not require any new, nonblocking system calls. While kernel threads solve some problems, they do not solve all problems. Hybird ImplementationsUsing kernel-level threads and then multiplex user-level threads onto some or all of them.With this approach, the kernel is aware of only the kernel-level threads and schedules those. Some of those threads may have multiple user-level threads multiplexed on top of them. Scheduler ActivationsThe goals of the scheduler activation work are to mimic the functionality of kernel threads, but with the better performance and greater flexibility usually associated with threads packages implemented in user space. When scheduler activations are used, the kernel assigns a certain number of virtual processors to each process and lets the (user-space) run-time system allocate threads to processors. The basic idea that makes this scheme work is that when the kernel knows that a thread has blocked (e.g., by its having executed a blocking system call or caused a page fault), the kernel notifies the processâ€™ run-time system, passing as parameters on the stack the number of the thread in question and a description of the event that occurred. The notification happens by having the kernel activate the run-time system at a known starting address, roughly analogous to a signal in UNIX. This mechanism is called an upcall.]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»0åˆ°1æ‰“é€ ä¸€æ¬¾æ²¡äººç”¨çš„å‰ç«¯æ¡†æ¶]]></title>
    <url>%2F2018%2F12%2F07%2FX-react%2F</url>
    <content type="text"><![CDATA[å¦‚æœå¯ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸è‡ªå·±æ‰“é€ ä¸€æ¬¾æ²¡äººç”¨çš„å‰ç«¯æ¡†æ¶å‘¢ï¼Ÿ é¦–å…ˆä»‹ç»å¦‚ä½•åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹ä»¥åŠå°†è™šæ‹ŸDOMèŠ‚ç‚¹è½¬åŒ–ä¸ºçœŸå®DOMèŠ‚ç‚¹ï¼Œå‚ç…§React/Preact åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹æˆ‘ä»¬åœ¨Reactä¼šç»å¸¸å†™å‡ºä¸‹åˆ—ç±»ä¼¼çš„ä»£ç  1const Example = &lt;span id='example'&gt;Hello, Example&lt;/span&gt; è¿™æ®µä»£ç ä¸æ˜¯åˆæ³•çš„JavaScriptä»£ç ï¼Œè¿™æ®µæ˜¯JSXä»£ç ã€‚JSXæ˜¯JavaScriptçš„è¯­æ³•æ‹“å±•ï¼Œç”¨æ¥å£°æ˜Reactä¸­çš„å…ƒç´ ã€‚çœ‹èµ·æ¥å®ƒå°±åƒä¸€ä¸ªæ¨¡ç‰ˆè¯­è¨€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ï¼Œå®ƒæ˜¯å®Œå…¨æ˜¯åœ¨JavaScriptå†…éƒ¨å®ç°çš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬å†™çš„JSXä»£ç æ˜¯å¦‚ä½•è¢«JavaScriptè§£æçš„å‘¢ï¼Ÿ è¿™é‡Œå°±ä¸å¾—ä¸æä¸€ä¸‹Babelï¼ŒBabelæ˜¯ä¸€ä¸ªJavaScriptç¼–è¯‘å™¨ï¼Œå°†ç”¨ES6/ES7ç­‰ESæœ€æ–°çš„è¯­æ³•ä¹¦å†™çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨æ”¯æŒçš„ESç‰ˆæœ¬ï¼ˆå¦‚ES5ã€ES3ï¼‰ã€‚è¿™å°±è®©æˆ‘ä»¬å¼€å‘è€…èƒ½å¤Ÿæœ€å¿«çš„ç”¨ä¸ŠESçš„æ–°è¯­æ³•ç³– Awesomeï¼ï¼ï¼ğŸ‰ğŸ‰ğŸ‰ Babelåœ¨è¿™é‡Œç”¨äºå°†æˆ‘ä»¬ä¹¦å†™çš„JSXä»£ç è½¬æ¢ä¸ºæ ‡å‡†javaScriptä»£ç ï¼Œä¸Šé¢çš„ä¾‹å­å°±è¢«è½¬æ¢ä¸ºï¼š 1var foo = h('span', &#123;id: 'example'&#125;, 'Hello, Example') æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¹¦å†™ä¸€ä¸ªhå‡½æ•°ç”¨äºè¢«è½¬è¯‘çš„ä»£ç è°ƒç”¨ï¼Œè‡³äºä¸ºä»€ä¹ˆå«hï¼Œå› ä¸ºå®ƒæ¥æºäºhyperscriptä¸­çš„hå‡½æ•°ã€‚ æ¥ä¸‹æ¥å°±æ˜¯å®Œæˆä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„hå‡½æ•°ï¼š 12345678910111213/*** åˆ›å»ºä¸€ä¸ªVirtual DOM å¯¹è±¡* @param nodeName æ ‡ç­¾åç§°* @param attributes å±æ€§* @param ...args ç»„ä»¶çš„å­©å­*/function h(nodeName, attributes, ...args) &#123; let children = args.length ? [].concat(...args) : null; return &#123; nodeName, attributes, children &#125;&#125; é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½åˆ›å»ºä¸€ä¸ªç®€å•çš„Virtual Domå¯¹è±¡ï¼Œæ¯”å¦‚ä¸Šé¢çš„JSXä¾‹å­ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¼šå¾—åˆ°ï¼š 1234567&#123; nodeName: "span", attributes: &#123; "id": "example" &#125;, children: ["Hello, Example"]&#125; å½“ç„¶è¿™ä¸ªå‡½æ•°æ˜¯è¿œè¿œä¸èƒ½æ»¡è¶³å®é™…ç”Ÿäº§ä¸­çš„è¦æ±‚ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬ä¼šæ…¢æ…¢å®Œå–„å®ƒã€‚ è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOMæ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªrenderå‡½æ•°ï¼Œç”¨äºå°†Virtual DOMå¯¹è±¡æ¸²æŸ“ä¸ºçœŸå®çš„DOMèŠ‚ç‚¹ã€‚ 123456789101112function render(vnode) &#123; if (vnode.split) &#123; return document.createTextNode(vnode); &#125; let node = document.createElement(vnode.nodeName) let attributes = vnode.attributes || &#123;&#125; Object.keys(attributes).forEach(k =&gt; &#123; node.setAttribute(k, attributes[k]) &#125;) (vnode.children || []).forEach(c =&gt; node.appendChild(render(c))) return node&#125; ä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¼šå°†åˆ›å»ºå‡ºæ¥çš„çœŸå®DOMèŠ‚ç‚¹æŒ‚åœ¨ç°å­˜çš„èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥renderå‡½æ•°éœ€è¦æ”¹é€ ä¸€ä¸‹ï¼š 1234function render(vnode, container) &#123; //... return container.appendChild(node)&#125;]]></content>
      <categories>
        <category>å‰ç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Preact</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æRedisé›†ç¾¤]]></title>
    <url>%2F2018%2F11%2F27%2Fredis-cluster%2F</url>
    <content type="text"><![CDATA[Redis Clusteræ˜¯Redisçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œæœ‰æ•ˆåœ°è§£å†³äº†Redisåˆ†å¸ƒå¼æ–¹é¢çš„éœ€æ±‚ã€‚å½“é‡åˆ°å•æœºå†…å­˜ã€å¹¶å‘ã€æµé‡ç­‰ç“¶é¢ˆæ—¶ï¼Œå¯ä»¥é‡‡ç”¨Clusterçš„æ¶æ„æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚ æ•°æ®åˆ†å¸ƒåˆ†å¸ƒå¼æ•°æ®åº“é¦–å…ˆè¦è§£å†³æŠŠæ•´ä¸ªæ•°æ®é›†æŒ‰ç…§åˆ†åŒºè§„åˆ™æ˜ å°„åˆ°å¤šä¸ªèŠ‚ç‚¹çš„é—®é¢˜ï¼Œå³å°†æ•°æ®å§åˆ’åˆ†åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£æ•´ä½“æ•°æ®çš„ä¸€ä¸ªå­é›†ã€‚å¸¸è§çš„åˆ†åŒºè§„åˆ™æœ‰é¡ºåºåˆ†åŒºå’Œå“ˆå¸Œåˆ†åŒºä¸¤ç§ï¼ŒRedisé‡‡ç”¨çš„å“ˆå¸Œåˆ†åŒºè§„åˆ™ã€‚ ä¸‹é¢æ˜¯å¸¸è§çš„å‡ ç§å“ˆå¸Œåˆ†åŒºè§„åˆ™ èŠ‚ç‚¹å–ä½™åˆ†åŒºä½¿ç”¨ç‰¹å®šçš„æ•°æ®keyï¼Œå†æ ¹æ®èŠ‚ç‚¹çš„æ•°é‡Nä½¿ç”¨å…¬å¼ï¼šhash(key)%Nè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ® æ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™æ ·çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨è§„åˆ™ï¼Œä¸€èˆ¬é‡‡ç”¨é¢„åˆ†åŒºçš„çš„æ–¹å¼ï¼Œæå‰æ ¹æ®æ•°æ®é‡è§„åˆ’å¥½åˆ†åŒºæ•°ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œæ‰©å®¹å’Œæ”¶ç¼©æ—¶ï¼Œæ•°æ®èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»éœ€è¦é‡æ–°è®¡ç®—ï¼Œä¼šå¯¼è‡´æ•°æ®çš„é‡å†™è¿ç§»ã€‚ ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºç³»ç»Ÿä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªtokenï¼ŒèŒƒå›´ä¸€èˆ¬åœ¨0ï½2^32ï¼Œè¿™äº›tokenæ„æˆä¸€ä¸ªå“ˆå¸Œç¯ã€‚æ•°æ®è¯»å†™æ‰§è¡Œæ—¶ï¼Œå…ˆæ ¹æ®keyè®¡ç®—hashå€¼ï¼Œç„¶åé¡ºæ—¶é’ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸å°äºè¯¥å“ˆå¸Œå€¼çš„tokenèŠ‚ç‚¹ã€‚ç›¸å¯¹äºèŠ‚ç‚¹å–ä½™çš„æ–¹å¼ï¼ŒåŠ å…¥æˆ–åˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå–œæ¬¢ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚ä½†æ˜¯ï¼Œä¸€è‡´æ€§å“ˆå¸Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼šåŠ å‡èŠ‚ç‚¹ä¼šé€ æˆå“ˆå¸Œç¯ä¸­éƒ¨åˆ†æ•°æ®æ— æ³•å‘½ä¸­ï¼›å½“ä½¿ç”¨å°‘é‡èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹å˜åŒ–å°†å¤§èŒƒå›´å½±å“å“ˆå¸Œç¯ä¸­æ•°æ®æ˜ å°„ï¼›æ™®é€šçš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºåœ¨å¢å‡èŠ‚ç‚¹æ—¶éœ€è¦å¢åŠ ä¸€å€æˆ–åˆ å»ä¸€æ¯èŠ‚ç‚¹æ‰èƒ½ä¿è¯æ•°æ®å’Œè´Ÿè½½çš„å‡è¡¡ã€‚ç™½è¯è§£æâ€”ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• è™šæ‹Ÿæ§½åˆ†åŒºè™šæ‹Ÿæ§½åˆ†åŒºä½¿ç”¨åˆ†æ•£åº¦è‰¯å¥½çš„å“ˆå¸Œå‡½æ•°æŠŠæ‰€æœ‰çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šèŒƒå›´çš„æ•´æ•°é›†åˆä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸ºæ§½(slot)ã€‚Redis Clusterçš„æ§½èŒƒå›´ä¸º0ï½16383ï¼Œè¿œè¿œå¤§äºå®é™…ä¸­çš„æ•°æ®èŠ‚ç‚¹æ•°ã€‚slotæ˜¯é›†ç¾¤å†…æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½ã€‚ Redisæ•°æ®åˆ†åŒºRedis Clusteré‡‡ç”¨è™šæ‹Ÿæ§½åˆ†åŒºï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0ï½16383æ•´æ•°æ§½å†…ã€‚æ¯ä¸€ä¸ªç»“ç‚¹å¤åˆ¶ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šè§£è€¦æ•°æ®ä¸èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼›èŠ‚ç‚¹è‡ªèº«ç»´æŠ¤æ§½çš„æ˜ å°„å…³ç³»ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯æˆ–ä»£ç†æœåŠ¡ç»´æŠ¤æ§½åˆ†åŒºå…ƒæ•°æ®ï¼›æ”¯æŒèŠ‚ç‚¹ã€æ§½ã€é”®ä¹‹é—´çš„æ˜ å°„æŸ¥è¯¢ï¼Œç”¨äºæ•°æ®è·¯ç”±ã€åœ¨çº¿ä¼¸ç¼©ç­‰åœºæ™¯ã€‚ æ­å»ºé›†ç¾¤æ­å»ºé›†ç¾¤åˆ†ä¸ºå‡†å¤‡èŠ‚ç‚¹ã€èŠ‚ç‚¹æ¡æ‰‹ã€åˆ†é…æ§½ç­‰ä¸‰ä¸ªæ­¥éª¤ã€‚ï¼ˆå¯ä»¥ç”¨redis-trib.rbæ­å»ºé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®Redisæ‰‹åŠ¨å»ºç«‹ä¸€ä¸ªé›†ç¾¤ï¼‰ å‡†å¤‡èŠ‚ç‚¹ç•¥ èŠ‚ç‚¹æ¡æ‰‹èŠ‚ç‚¹æ¡æ‰‹æ˜¯æŒ‡ä¸€æ‰¹è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é€šè¿‡Gossipåè®®å½¼æ­¤é€šä¿¡ï¼Œè¾¾åˆ°æ„ŸçŸ¥å¯¹æ–¹çš„è¿‡ç¨‹ã€‚ åˆ†é…æ§½åªæœ‰æŠŠ16384ä¸ªæ§½å…¨éƒ¨åˆ†é…ç»™èŠ‚ç‚¹åï¼Œé›†ç¾¤æ‰è¿›å…¥åœ¨çº¿çŠ¶æ€ã€‚Redis Clusterä¼šæŠŠæ‰€æœ‰æ•°æ®æ˜ å°„åˆ°è¿™16384ä¸ªæ§½ä¸­ï¼Œæ¯ä¸ªkeyä¼šæ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„æ§½ä¸­ï¼Œåªæœ‰å½“èŠ‚ç‚¹åˆ†é…äº†æ§½ï¼Œæ‰èƒ½å“åº”å’Œè¿™äº›æ§½å…³è”çš„é”®å‘½ä»¤ã€‚ èŠ‚ç‚¹é€šä¿¡åœ¨åˆ†å¸ƒå¼å­˜å‚¨ä¸­éœ€è¦æä¾›ç»´æŠ¤èŠ‚ç‚¹å…ƒæ•°æ®ï¼ˆèŠ‚ç‚¹è´Ÿè´£å“ªäº›æ•°æ®ï¼Œæ˜¯å¦å‡ºç°æ•…éšœç­‰çŠ¶æ€ä¿¡æ¯ï¼‰ä¿¡æ¯çš„æœºåˆ¶ã€‚Redis Clusteré‡‡ç”¨ç”¨äºp2pçš„Gossipåè®®ï¼ŒGossipåè®®çš„å·¥ä½œåŸç†å°±æ˜¯èŠ‚ç‚¹ä¸æ–­é€šä¿¡äº¤æ¢ä¿¡æ¯ï¼Œä¸€æ®µæ—¶é—´åæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šçŸ¥é“é›†ç¾¤å®Œæ•´çš„ä¿¡æ¯ï¼Œç±»ä¼¼æµè¡Œç—…ä¼ æ’­ã€‚ é€šä¿¡è¿‡ç¨‹ é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå•ç‹¬å¼€è¾Ÿä¸€ä¸ªTCPé€šé“ï¼Œç”¨äºèŠ‚ç‚¹ä¹‹é—´å½¼æ­¤é€šä¿¡ï¼Œé€šä¿¡ç«¯å£å·åœ¨åŸºç¡€ç«¯å£ä¸ŠåŠ 10000ã€‚ æ¯ä¸ªèŠ‚ç‚¹åœ¨å›ºå®šå‘¨æœŸå†…é€šè¿‡ç‰¹å®šè§„åˆ™é€‰æ‹©å‡ ä¸ªèŠ‚ç‚¹å‘é€pingæ¶ˆæ¯ã€‚ æ¥åˆ°pingæ¶ˆæ¯çš„èŠ‚ç‚¹ç”¨pongæ¶ˆæ¯ä½œä¸ºå“åº”ã€‚ Gossipæ¶ˆæ¯Gossipåè®®çš„ä¸»è¦èŒè´£å°±æ˜¯ä¿¡æ¯äº¤æ¢ï¼Œä¿¡æ¯äº¤æ¢çš„è½½ä½“å°±æ˜¯èŠ‚ç‚¹å½¼æ­¤å‘é€çš„Gossipæ¶ˆæ¯ã€‚å¸¸ç”¨çš„Gossipæ¶ˆæ¯åˆ†ä¸ºï¼špingæ¶ˆæ¯ã€pongæ¶ˆæ¯ã€meetæ¶ˆæ¯ã€failæ¶ˆæ¯ã€‚æ‰€æœ‰çš„æ¶ˆæ¯æ ¼å¼åˆ’åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´åŒ…å«å‘é€èŠ‚ç‚¹è‡ªèº«çŠ¶æ€æ•°æ®ï¼Œæ¥å—èŠ‚ç‚¹æ ¹æ®æ¶ˆæ¯å¤´å°±å¯ä»¥è·å–åˆ°å‘é€èŠ‚ç‚¹çš„ç›¸å…³æ•°æ®ã€‚ meetæ¶ˆæ¯ï¼šç”¨äºé€šçŸ¥æ–°èŠ‚ç‚¹åŠ å…¥ã€‚ pingæ¶ˆæ¯ï¼šé›†ç¾¤å†…äº¤æ¢æœ€é¢‘ç¹çš„æ¶ˆæ¯ï¼Œé›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹æ¯ç§’å‘å¤šä¸ªå…¶ä»–èŠ‚ç‚¹å‘é€pingæ¶ˆæ¯ï¼Œç”¨äºæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿å’Œäº¤æ¢å½¼æ­¤çŠ¶æ€æ¶ˆæ¯ã€‚ pongæ¶ˆæ¯ï¼šå½“æ¥æ”¶åˆ°pingã€meetæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºå“åº”æ¶ˆæ¯å›å¤ç»™å‘é€æ–¹ ç¡®è®¤æ¶ˆæ¯æ­£å¸¸é€šä¿¡ã€‚pongæ¶ˆæ¯å†…éƒ¨é£ä¸­äº†è‡ªèº«çŠ¶æ€æ•°æ®ã€‚ failæ¶ˆæ¯ï¼šå½“èŠ‚ç‚¹åˆ¤æ–­é›†ç¾¤å†…å¦ä¸€ä¸ªç»“ç‚¹ä¸‹çº¿æ—¶ï¼Œä¼šå‘é›†ç¾¤å†…å¹¿æ’­ä¸€ä¸ªfailæ¶ˆæ¯ï¼Œå…¶ä»–èŠ‚ç‚¹æ¥æ”¶åˆ°failæ¶ˆæ¯ä¹‹åæŠŠå¯¹åº”èŠ‚ç‚¹æ›´æ–°ä¸ºä¸‹çº¿çŠ¶æ€ã€‚ èŠ‚ç‚¹é€‰æ‹©Redis Clusterå†…èŠ‚ç‚¹é€šä¿¡é‡‡ç”¨å›ºå®šé¢‘ç‡ï¼ˆå®šæ—¶ä»»åŠ¡æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼‰ã€‚å› æ­¤èŠ‚ç‚¹æ¯æ¬¡é€‰æ‹©éœ€è¦é€šä¿¡çš„èŠ‚ç‚¹åˆ—è¡¨å˜å¾—éå¸¸é‡è¦ã€‚é€šä¿¡èŠ‚ç‚¹é€‰æ‹©è¿‡å¤šè™½ç„¶å¯ä»¥åšåˆ°ä¿¡æ¯åŠæ—¶äº¤æ¢ä½†æˆæœ¬è¿‡é«˜ï¼ŒèŠ‚ç‚¹é€‰æ‹©è¿‡å°‘ä¼šé™ä½é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹å½¼æ­¤ä¿¡æ¯äº¤æ¢é¢‘ç‡ï¼Œä»è€Œå½±å“æ•…éšœåˆ¤æ–­ã€æ–°èŠ‚ç‚¹å‘ç°ç­‰éœ€æ±‚çš„é€Ÿåº¦ã€‚ é›†ç¾¤ä¼¸ç¼©Redis Clusteræä¾›äº†çµæ´»çš„èŠ‚ç‚¹æ‰©å®¹å’Œæ”¶ç¼©æ–¹æ¡ˆï¼Œåœ¨ä¸å½±å“å¯¹å¤–æœåŠ¡çš„åŒæ—¶ï¼Œä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹æˆ–ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹è¿›è¡Œç¼©å®¹ï¼Œå…¶ä¸­åŸç†å¯æŠ½è±¡ä¸ºæ§½å’Œå¯¹åº”æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´çµæ´»ç§»åŠ¨ã€‚ æ‰©å®¹é›†ç¾¤æ‰©å®¹é›†ç¾¤çš„è¿‡ç¨‹ä¸ºå‡†å¤‡æ–°èŠ‚ç‚¹ã€æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€è¿ç§»æ§½å’Œæ•°æ®ç­‰ä¸‰ä¸ªæ­¥éª¤ã€‚ è¿ç§»æ§½å’Œæ•°æ®æ§½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œé›†ç¾¤å¯ä»¥æ­£å¸¸æä¾›è¯»å†™æœåŠ¡ã€‚æ§½æ˜¯Redis Clusteræ•°æ®ç®¡ç†å’Œè¿ç§»çš„æœ€å°å•ä½ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦ä¸ºæ–°èŠ‚ç‚¹åˆ¶å®šæ§½è¿ç§»è®¡åˆ’ã€‚æ§½è¿ç§»è®¡åˆ’éœ€è¦ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹åˆ†é…çš„æ§½æ•°é‡æ¥è¿‘ï¼Œä»è€Œä¿è¯å„èŠ‚ç‚¹çš„æ•°æ®å‡åŒ€ã€‚ æ•°æ®è¿ç§»è¿‡ç¨‹æ˜¯é€ä¸ªæ§½è¿›è¡Œçš„ï¼Œå¤§ä½“æµç¨‹ä¸ºï¼šï¼ˆ1ï¼‰ç›®æ ‡èŠ‚ç‚¹å‡†å¤‡å¯¼å…¥æ§½ï¼›ï¼ˆ2ï¼‰æºèŠ‚ç‚¹å‡†å¤‡å¯¼å‡ºæ§½ï¼›ï¼ˆ3ï¼‰è·å–æ§½ä¸‹{count}ä¸ªé”®ï¼›ï¼ˆ4ï¼‰æ‰¹é‡è¿ç§»ç›¸å…³é”®çš„æ•°æ®ï¼›ï¼ˆ5ï¼‰å¾ªç¯è¿ç§»é”®ï¼Œé‡å¤ç¬¬3ã€4æ­¥ï¼›ï¼ˆ6ï¼‰é€šçŸ¥æ§½åˆ†é…ç»™ç›®æ ‡èŠ‚ç‚¹ã€‚ æ”¶ç¼©é›†ç¾¤æ”¶ç¼©é›†ç¾¤ä»¥ä¸ºéœ€è¦ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯åˆ†ä¸ºä¸‹çº¿è¿ç§»æ§½ã€å¿˜è®°èŠ‚ç‚¹ç­‰ä¸¤ä¸ªæ­¥éª¤ã€‚ ä¸‹çº¿è¿ç§»æ§½ä¸æ‰©å®¹é›†ç¾¤ä¸­çš„è¿ç§»æ§½å’Œæ•°æ®ç›¸ä¼¼ï½ å¿˜è®°èŠ‚ç‚¹ç”±äºé›†ç¾¤å†…çš„èŠ‚ç‚¹ä¸æ–­é€šè¿‡Gossipæ¶ˆæ¯å½¼æ­¤äº¤æ¢èŠ‚ç‚¹çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦è®©å…¶ä»–èŠ‚ç‚¹ä¸å†ä¸è¦ä¸‹çº¿çš„èŠ‚ç‚¹è¿›è¡ŒGossipæ¶ˆæ¯äº¤æ¢ã€‚ è¯·æ±‚è·¯ç”±ä¸ºäº†è¿½æ±‚æ€§èƒ½æœ€å¤§åŒ–ï¼ŒRedis Clusteré‡‡ç”¨çš„æ˜¯å®¢æˆ·ç«¯ç›´è¿èŠ‚ç‚¹çš„æ–¹å¼ã€‚ è¯·æ±‚é‡å®šå‘åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRedisæ¥å—ä»»ä½•keyç›¸å…³çš„å‘½ä»¤æ—¶é¦–å…ˆè®¡ç®—å¯¹åº”çš„æ§½ï¼Œå†æ ¹æ®æ§½æ‰¾å‡ºå¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯è‡ªèº«ï¼Œåˆ™å¤„ç†å‘½ä»¤ï¼›å¦åˆ™è¿”å›MOVEDé‡å®šå‘é”™è¯¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯è¯·æ±‚æ­£ç¡®çš„èŠ‚ç‚¹ã€‚èŠ‚ç‚¹å¯¹äºä¸å±äºå®ƒçš„é”®å‘½ä»¤åªå›å¤é‡å®šå‘å“åº”ï¼Œå¹¶ä¸è´Ÿè´£è½¬å‘ã€‚é”®å‘½ä»¤æ‰§è¡Œæ­¥éª¤ä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼šè®¡ç®—æ§½ã€æŸ¥æ‰¾æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ã€‚ è®¡ç®—æ§½é€šè¿‡CRC16è®¡ç®—keyçš„æœ‰æ•ˆéƒ¨åˆ†çš„hashå€¼ï¼Œå†å¯¹16383å–ä½™ï¼Œä½¿æ¯ä¸ªé”®éƒ½èƒ½æ˜ å°„åˆ°0ï½16383æ§½èŒƒå›´å†…ã€‚ æ§½èŠ‚ç‚¹æŸ¥è¯¢Redisè®¡ç®—å¾—åˆ°keyå¯¹åº”çš„æ§½åï¼Œéœ€è¦æŸ¥è¯¢å¯¹åº”çš„èŠ‚ç‚¹ã€‚é›†ç¾¤å†…é€šè¿‡æ¶ˆæ¯äº¤æ¢æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šçŸ¥é“æ‰€æœ‰èŠ‚ç‚¹çš„æ§½ä¿¡æ¯ï¼Œå†…éƒ¨ä¿å­˜åœ¨clusterStateç»“æ„ä¸­ã€‚ Smartå®¢æˆ·ç«¯Smartå®¢æˆ·ç«¯åœ¨å†…éƒ¨ç»´æŠ¤è€…ä»slot-&gt;nodeçš„æ˜ å°„å…³ç³»ï¼Œæœ¬åœ°å°±å¯ä»¥å®ç°é”®åˆ°èŠ‚ç‚¹çš„æŸ¥è¯¢ï¼Œä»è€Œä¿è¯IOæ•ˆç‡æœ€å¤§åŒ–ï¼Œè€ŒMOVEDé‡å®šå‘è´Ÿè´£ååŠ©Smartå®¢æˆ·ç«¯æ›´æ–°slot-&gt;nodeæ˜ å°„ã€‚ ASKé‡å®šå‘Redisé›†ç¾¤æ”¯æŒåœ¨çº¿è¿ç§»æ§½å’Œæ•°æ®æ¥å®Œæˆæ°´å¹³ä¼¸ç¼©ã€‚ASKé‡å®šå‘è¯´æ˜é›†ç¾¤æ­£åœ¨è¿›è¡Œslotæ•°æ®è¿ç§»ï¼Œå®¢æˆ·ç«¯æ— æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™è¿ç§»å®Œæˆï¼Œå› æ­¤åªèƒ½æ˜¯ä¸´æ—¶æ€§çš„é‡å®šå‘ï¼Œå®¢æˆ·ç«¯ä¸ä¼šæ›´æ–°slotsç¼“å­˜ã€‚ä½†æ˜¯MOVEDé‡å®šå‘è¯´æ˜é”®å¯¹åº”çš„æ§½å·²ç»æ˜ç¡®æŒ‡å®šåˆ°æ–°çš„èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦æ›´æ–°slotsç¼“å­˜ã€‚ æ•…éšœè½¬ç§»Redis Clusterå®ç°äº†é«˜å¯ç”¨ï¼Œå½“é›†ç¾¤å†…å°‘é‡èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶é€šè¿‡è‡ªåŠ¨æ•…éšœè½¬ç§»ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸çš„å¯¹å¤–æä¾›æœåŠ¡ã€‚ æ•…éšœå‘ç°Redisé›†ç¾¤å†…èŠ‚ç‚¹é€šè¿‡ping/pongæ¶ˆæ¯å®ç°èŠ‚ç‚¹é€šä¿¡ï¼Œæ¶ˆæ¯ä¸ä½†å¯ä»¥ä¼ æ’­èŠ‚ç‚¹æ§½ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä¼ æ’­ä¸»ä»çŠ¶æ€ã€èŠ‚ç‚¹æ•…éšœç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ•…éšœå‘ç°ä¹Ÿæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ æ’­æœºåˆ¶å®ç°çš„ã€‚ ä¸»è§‚ä¸‹çº¿æŒ‡æŸä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå³ä¸‹çº¿çŠ¶æ€ã€‚ å®¢è§‚ä¸‹çº¿æŒ‡æ ‡è®°ä¸€ä¸ªèŠ‚ç‚¹çœŸæ­£çš„ä¸‹çº¿ï¼Œé›†ç¾¤å†…å¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œä»è€Œè¾¾æˆå…±è¯†çš„ç»“æœã€‚ æ•…éšœæ¢å¤æ•…éšœèŠ‚ç‚¹å˜ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå¦‚æœä¸‹çº¿èŠ‚ç‚¹æ˜¯æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦ä»å®ƒçš„ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªæ›¿æ¢ä»–ï¼Œä»è€Œä¿è¯è§çš„é«˜å¯ç”¨ã€‚æ•´ä¸ªå¤§è‡´åˆ†ä¸ºèµ„æ ¼æ£€æŸ¥ã€å‡†å¤‡é€‰ä¸¾æ—¶é—´ã€å‘èµ·é€‰ä¸¾ã€é€‰ä¸¾æŠ•ç¥¨ã€æ›¿æ¢ä¸»èŠ‚ç‚¹ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>é›†ç¾¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æRediså“¨å…µå®ç°åŸç†]]></title>
    <url>%2F2018%2F11%2F23%2Fredis-sentinel%2F</url>
    <content type="text"><![CDATA[Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„(SentinelèŠ‚ç‚¹ã€Redisæ•°æ®èŠ‚ç‚¹ã€Rediså®¢æˆ·ç«¯åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†èŠ‚ç‚¹ä¸Š)ï¼Œå…¶ä¸­åŒ…æ‹¬äº†è‹¥å¹²ä¸ªSentinelèŠ‚ç‚¹å’ŒRedisæ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹å¯¹æ•°æ®èŠ‚ç‚¹å’Œå…¶ä»–SentinelèŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå½“å®ƒå‘ç°èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œä¼šå¯¹èŠ‚ç‚¹åšä¸‹çº¿æ ‡è¯†ã€‚è‹¥è¯¥èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹ï¼Œå®ƒä¼šå’Œå…¶ä»–SentinelèŠ‚ç‚¹å…±åŒåå•†ï¼Œè‹¥å¤§éƒ¨åˆ†èŠ‚ç‚¹çš†è¡¨ç¤ºè¯¥ä¸»èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œé‚£ä¹ˆå°±ä¼šä»Sentinelä¸­é€‰ä¸¾å‡ºä¸€ä¸ªSentinelèŠ‚ç‚¹æ¥å®Œæˆè‡ªåŠ¨æ•…éšœè½¬ç§»çš„å·¥ä½œï¼ŒåŒæ—¶å°†è¿™ä¸ªå˜åŒ–å®æ—¶é€šçŸ¥ç»™Redisåº”ç”¨æ–¹ã€‚ å®ç°åŸç†ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡Redisé€šè¿‡ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡å®Œæˆå¯¹å„ä¸ªèŠ‚ç‚¹çš„å‘ç°å’Œç›‘æ§ã€‚_s_ è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„æ¯éš”10sï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€infoå‘½ä»¤è·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æ„ã€‚ ä½œç”¨ï¼š é€šè¿‡å‘ä¸»èŠ‚ç‚¹æ‰§è¡Œinfoå‘½ä»¤ï¼Œè·å–ä»èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ‰€ä»¥SentinelèŠ‚ç‚¹ä¸éœ€è¦æ˜¾å¼é…ç½®ç›‘æ§ä»èŠ‚ç‚¹ã€‚ å½“æœ‰æ–°çš„ä»èŠ‚ç‚¹åŠ å…¥æ—¶éƒ½å¯ä»¥ç«‹åˆ»æ„ŸçŸ¥å‡ºæ¥ã€‚ èŠ‚ç‚¹ä¸å¯è¾¾æˆ–è€…æ•…éšœè½¬ç§»åï¼Œå¯ä»¥é€šè¿‡infoå‘½ä»¤å®æ—¶æ›´æ–°èŠ‚ç‚¹æ‹“æ‰‘ä¿¡æ¯ã€‚ SentinelèŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…sentinel:helloé¢‘é“æ¯éš”2sï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹ä¼šå‘Redisæ•°æ®èŠ‚ç‚¹çš„__sentinel__:helloé¢‘é“å‘é€è¯¥sentinelèŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ä»¥åŠå½“å‰SentinelèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ¯ä¸ªSentinelèŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¯¥é¢‘é“æ¥äº†è§£å…¶ä»–SentinelèŠ‚ç‚¹ä»¥åŠå®ƒä»¬å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ã€‚ ä½œç”¨ï¼š å‘ç°æ–°çš„SentinelèŠ‚ç‚¹ã€‚ SentinelèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä½œä¸ºåé¢å®¢è§‚ä¸‹çº¿ä»¥åŠé¢†å¯¼è€…é€‰ä¸¾çš„ä¾æ®ã€‚ å¿ƒè·³æ£€æµ‹æ¯éš”1sï¼Œæ¯éš”SentinelèŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶ä½™SentinelèŠ‚ç‚¹å‘é€ä¸€æ¡pingå‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œæ¥ç¡®å®šè¿™äº›èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚ ä½œç”¨ï¼š åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å¯è¾¾çš„é‡è¦ä¾æ®ã€‚ ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ä¸»è§‚ä¸‹çº¿ä¸Šé¢æåˆ°å¿ƒè·³æ£€æµ‹ï¼Œå¦‚æœè¿™äº›èŠ‚ç‚¹è¶…è¿‡down-after-millionsectionsè¿˜æ²¡æœ‰è¿›è¡Œæœ‰æ•ˆå›å¤ï¼ŒSentinelèŠ‚ç‚¹å°±ä¼šå¯¹è¯¥èŠ‚ç‚¹åšå¤±è´¥åˆ¤æ–­ï¼Œè¿™ä¸ªè¡Œä¸ºå«åšä¸»è§‚ä¸‹çº¿ã€‚SentinelèŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ï¼Œä¸»è§‚ä¸‹çº¿åæ²¡æœ‰åç»­çš„æ•…éšœè½¬ç§»æ“ä½œã€‚ å®¢è§‚ä¸‹çº¿å½“SentinelèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹æ—¶ï¼Œè¯¥SentinelèŠ‚ç‚¹ä¼šé€šè¿‡sentinel is-master-down-by-addrå‘½ä»¤å‘å…¶ä»–SentinelèŠ‚ç‚¹è¯¢é—®å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“è¶…è¿‡ä¸ªæ•°ï¼ŒSentinelè®¤ä¸ºä¸»èŠ‚ç‚¹çš„ç¡®å‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶è¯¥Sentinelå¯¹ä¸»èŠ‚ç‚¹åšå‡ºå®¢è§‚ä¸‹çº¿çš„å†³å®šã€‚ é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾å½“SentinelèŠ‚ç‚¹å¯¹ä¸»èŠ‚ç‚¹å®Œæˆäº†å®¢è§‚ä¸‹çº¿åï¼ŒSentinelèŠ‚ç‚¹ä¹‹é—´è¿˜ä¼šé€‰ä¸¾å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºé¢†å¯¼è€…è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œï¼›Redisä½¿ç”¨äº†Raftç®—æ³•å®ç°é¢†å¯¼è€…é€‰ä¸¾ã€‚ Raftç®—æ³•å¤§è‡´æ€è·¯ æ¯ä¸ªåœ¨çº¿çš„SentinelèŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œå½“å®ƒç¡®è®¤ä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿åï¼Œä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€sentinel is-master-down-by-addrå‘½ä»¤ï¼Œè¦æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…ã€‚ æ”¶åˆ°å‘½ä»¤çš„SentinelèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–çš„SentinelèŠ‚ç‚¹çš„sentinel is-master-down-by-addrå‘½ä»¤ï¼Œå°†åŒæ„è¯¥è¯·æ±‚ï¼Œåä¹‹æ‹’ç»ã€‚ å¦‚æœè¯¥SentinelèŠ‚ç‚¹å‘ç°è‡ªå·±çš„ç¥¨æ•°å·²ç»å¤§äºæˆ–ç­‰äºmax(quorum, num(sentinels) / 2 + 1)ï¼Œé‚£ä¹ˆå®ƒå°±æˆä¸ºé¢†å¯¼è€…ã€‚ å¦‚æœæ­¤è¿‡ç¨‹æ²¡æœ‰é€‰ä¸¾å‡ºé¢†å¯¼è€…ï¼Œå°†è¿›å…¥ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚ åŸºæœ¬ä¸Šè°å…ˆå®Œæˆå®¢è§‚ä¸‹çº¿ï¼Œè°å°±æ˜¯é¢†å¯¼è€…ã€‚ æ•…éšœè½¬ç§»é¢†å¯¼è€…é€‰ä¸¾å‡ºçš„Sentinelå°†è´Ÿè´£æ•…éšœè½¬ç§»ã€‚ è¿‡ç¨‹ ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚ è¿‡æ»¤æ‰ä¸ä¸»è§‚ä¸‹çº¿ã€æ‰çº¿ã€5ç§’å†…æ²¡æœ‰å›å¤Sentinel pingå“åº”ç­‰ç­‰çš„èŠ‚ç‚¹â€¦ é€‰æ‹©ä»èŠ‚ç‚¹ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚ é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚ é€‰æ‹©runidæœ€å°çš„ä»èŠ‚ç‚¹ã€‚ å¯¹é€‰ä¸¾å‡ºçš„èŠ‚ç‚¹æ‰§è¡Œslave of no oneï¼Œå‡çº§ä¸ºä¸»èŠ‚ç‚¹ã€‚ Sentinelé¢†å¯¼è€…èŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚ Sentinelé›†åˆèŠ‚ç‚¹å°†åŸä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå¹¶ä¿æŒå¯¹å…¶å…³æ³¨ï¼Œå½“å…¶æ¢å¤åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>å“¨å…µ</tag>
        <tag>é«˜å¯ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æRediså¤åˆ¶åŸç†]]></title>
    <url>%2F2018%2F11%2F11%2FRedis-Replication%2F</url>
    <content type="text"><![CDATA[åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸ºäº†è§£å†³å•ç‚¹é—®é¢˜ï¼Œé€šå¸¸ä¼šæŠŠæ•°æ®å¤åˆ¶æˆå¤šä¸ªå‰¯æœ¬éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œä»¥æ»¡è¶³è´Ÿè½½å‡è¡¡å’Œæ•…éšœæ¢å¤ç­‰éœ€æ±‚ï¼ŒRedisä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒRedisæ”¯æŒç®€å•ä¸”æ˜“ç”¨çš„ä¸»ä»å¤åˆ¶ï¼ˆmaster-slave replicationï¼‰åŠŸèƒ½ã€‚ å¤åˆ¶è¿‡ç¨‹ slaveæ‰§è¡Œslaveofå‘½ä»¤ï¼Œslaveåªä¿å­˜masterçš„åœ°å€ä¿¡æ¯åå°±è¿”å›ã€‚ slaveé€šè¿‡å†…éƒ¨æ¯ç§’è¿è¡Œçš„å®šæ—¶ä»»åŠ¡ç»´æŠ¤å¤åˆ¶ç›¸å…³çš„é€»è¾‘ï¼Œå½“å®šæ—¶ä»»åŠ¡å‘ç°æ–°çš„masterä¿¡æ¯æ—¶ï¼Œå¼€å§‹å°è¯•ä¸masterå»ºç«‹ç½‘ç»œè¿æ¥ã€‚å¦‚æœæ— æ³•å»ºç«‹è¿æ¥ï¼Œslaveä¼šä¸€ç›´æ— é™æ¬¡é‡è¿ç›´åˆ°è¿æ¥æˆåŠŸæˆ–è€…å–æ¶ˆå¤åˆ¶ã€‚ è¿æ¥å»ºç«‹æˆåŠŸåslaveä¼šå‘é€pingè¯·æ±‚è¿›è¡Œé¦–æ¬¡é€šä¿¡ï¼Œæ£€æµ‹ä¸»ä»ä¹‹é—´ç½‘ç»œå¥—æ¥å­—æ˜¯å¦å¯ç”¨ã€æ£€æµ‹msaterå½“å‰æ˜¯å¦å¯æ¥å—å¤„ç†å‘½ä»¤ã€‚ å¦‚æœmasterè®¾ç½®äº†requirepasså‚æ•°ï¼Œåˆ™éœ€è¦å¯†ç éªŒè¯ã€‚ é¦–æ¬¡å»ºç«‹å¤åˆ¶ï¼Œä¸»ä»èŠ‚ç‚¹ä¼šè¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ã€‚ åŒæ­¥æ•°æ®é›†æˆåŠŸåï¼ŒmasteræŒç»­æŠŠåç»­çš„å†™å‘½ä»¤å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»ä¸€è‡´æ€§ã€‚ æ•°æ®åŒæ­¥å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Ÿå¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰å‚ä¸ä¸»ä»å¤åˆ¶çš„masterå’Œslaveä¼šä¿å­˜å„è‡ªçš„å¤åˆ¶åç§»é‡ï¼Œslaveçš„å¤åˆ¶åç§»é‡åˆå§‹å€¼ä¸º-1ã€‚masterå¤„ç†å†™å…¥å‘½ä»¤åï¼Œä¼šå¯¹è‡ªå·±çš„å¤åˆ¶åç§»é‡è¿›è¡Œç´¯åŠ ï¼›slaveæ”¶åˆ°masterå‘é€çš„å‘½ä»¤åï¼Œä¹Ÿä¼šå¯¹è‡ªå·±çš„å¤åˆ¶åç§»é‡è¿›è¡Œç´¯åŠ ï¼Œå¹¶ä¸”slaveæ¯ç§’ä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ç»™masterï¼Œæ‰€ä»¥masterä¹Ÿä¿å­˜äº†slaveçš„å¤åˆ¶åç§»é‡ã€‚å€˜è‹¥ä¸»ä»å¤åˆ¶åç§»é‡å·®è·è¿‡å¤§ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯å› ä¸ºé˜»å¡æˆ–ç½‘ç»œå»¶è¿Ÿé«˜é€ æˆçš„ã€‚ å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¿å­˜åœ¨masterä¸Šçš„ä¸€ä¸ªå›ºå®šé•¿åº¦çš„é˜Ÿåˆ—ã€‚å½“masterå¤„ç†å†™å…¥å‘½ä»¤åï¼Œä¸ä»…ä¼šæŠŠå‘½ä»¤å‘é€ç»™slaveï¼Œä¹Ÿä¼šæŠŠå‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚å¤åˆ¶ç§¯å‹ç¼“å†²åŒºç”¨äºä¿å­˜æœ€è¿‘å·²å¤åˆ¶æ•°æ®ï¼Œå¯ç”¨äºéƒ¨åˆ†å¤åˆ¶æˆ–å¤åˆ¶å‘½ä»¤ä¸¢å¤±çš„æ•°æ®è¡¥æ•‘ã€‚ ä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼ˆrunIdï¼‰æ¯ä¸ªRediså¯åŠ¨åä¼šåŠ¨æ€åˆ†é…ä¸€ä¸ª40ä½çš„åå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²ä½œä¸ºè¿è¡ŒIDï¼Œè¿è¡ŒIDçš„ä¸»è¦ä½œç”¨æ˜¯å”¯ä¸€è¯†åˆ«RedisèŠ‚ç‚¹ã€‚å¦‚æœmasterè¿è¡ŒIDå‘ç”Ÿå˜åŒ–åï¼Œä¸»ä»èŠ‚ç‚¹å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ psyncå‘½ä»¤slaveä½¿ç”¨psyncå‘½ä»¤å®Œæˆéƒ¨åˆ†å¤åˆ¶å’Œå…¨é‡å¤åˆ¶åŠŸèƒ½ï¼Œå‘½ä»¤æ ¼å¼ï¼špsync {runId} {offset}ã€‚slaveå‘é€psyncå‘½ä»¤ç»™masterï¼Œmasteræ ¹æ®psyncçš„å‚æ•°å’Œè‡ªèº«æ•°æ®å†³å®šå“åº”ç»“æœï¼ˆå…¨é‡å¤åˆ¶ã€éƒ¨åˆ†å¤åˆ¶ã€é”™è¯¯ï¼‰ã€‚ å…¨é‡å¤åˆ¶å…¨é‡å¤åˆ¶æ˜¯redisæœ€æ—©æ”¯æŒçš„å¤åˆ¶æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹åå¿…é¡»ç»å†çš„é˜¶æ®µã€‚ è¿‡ç¨‹ å‘é€psyncå‘½ä»¤è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œå¤åˆ¶ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰å¤åˆ¶åç§»é‡å’Œä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼Œæ‰€ä»¥å‘é€psync ? -1ã€‚ ä¸»èŠ‚ç‚¹æ ¹æ®psyncè§£æå½“å‰ä¸ºå…¨é‡å¤åˆ¶ï¼Œå›å¤+FULLRESYNCå“åº”ã€‚ slaveæ¥æ”¶åˆ°masterçš„å“åº”æ•°æ®ï¼Œä¿å­˜runIdå’Œoffsetã€‚ masterå¼€å§‹æ‰§è¡Œbgsaveï¼Œä¿å­˜RDBåˆ°æœ¬åœ°ã€‚ masterå‘é€RDBæ–‡ä»¶ç»™slaveï¼Œslaveæ¥å—åˆ°RDBæ–‡ä»¶åå­˜å‚¨ä¸ºè‡ªå·±çš„æ•°æ®æ–‡ä»¶ã€‚ï¼ˆå¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œå­˜åœ¨è¶…æ—¶å…¨é‡å¤åˆ¶å¤±è´¥çš„é£é™©ï¼‰ã€‚ ä»slaveå¼€å§‹æ¥å—RDBåˆ°æ¥å—å®ŒæˆæœŸé—´ï¼Œmasterä»åœ¨å¤„ç†è¯»å†™å‘½ä»¤ã€‚åœ¨è¿™æœŸé—´ï¼Œmasterå°†å†™å‘½ä»¤å†™å…¥å®¢æˆ·ç«¯ç¼“å†²åŒºï¼Œå½“slaveåŠ è½½å®ŒRDBåï¼Œå†æŠŠç¼“å†²åŒºå†…çš„æ•°æ®å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ã€‚ slaveæ¥å—å®Œmasterä¼ é€çš„æ•°æ®åä¼šæ¸…ç©ºè‡ªèº«æ—§æ•°æ®ã€‚ slaveæ¸…ç©ºæ•°æ®åå¼€å§‹ä»·å€¼RDBæ–‡ä»¶ï¼Œå¦‚æœRDBæ–‡ä»¶è¿‡å¤§ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸è€—æ—¶ã€‚å¦‚æœslaveæ­£å¤„äºå…¨é‡å¤åˆ¶é˜¶æ®µæˆ–è€…å¤åˆ¶ä¸­æ–­ï¼Œé‚£ä¹ˆslaveå“åº”è¯»å‘½ä»¤æ—¶å¯èƒ½æ‹¿åˆ°è¿‡æœŸæˆ–é”™è¯¯çš„æ•°æ®ï¼Œæ•°æ®å‡ºç°ä¸ä¸€è‡´ã€‚ï¼ˆå¯ä»¥é€šè¿‡è®¾ç½®slave-serve-stable-dataå‚æ•°æ¥å…³é—­å¯¹è¯»å‘½ä»¤çš„å“åº”ï¼‰ slaveåŠ è½½å®ŒRDBåï¼Œå¦‚æœslaveå¼€å¯äº†AOFæŒä¹…åŒ–ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œbgrewriteaofæ“ä½œï¼Œä¿è¯å…¨é‡å¤åˆ¶åAOFæŒä¹…åŒ–æ–‡ä»¶ç«‹åˆ»å¯ç”¨ã€‚ æ—¶é—´å¼€é”€ master bgsaveæ—¶é—´ RDBæ–‡ä»¶ç½‘ç»œä¼ è¾“æ—¶é—´ salveæ¸…ç©ºæ•°æ®æ—¶é—´ slaveåŠ è½½RDBæ—¶é—´ å¯èƒ½çš„AOFé‡å†™æ—¶é—´ ç”±æ­¤å¯è§ï¼Œå…¨é‡å¤åˆ¶çš„æ—¶é—´å¼€é”€å¤§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„CPUã€å†…å­˜ã€ç½‘ç»œèµ„æºã€‚æ‰€ä»¥é™¤äº†ç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œå…¶ä½™åœºæ™¯åº”è¯¥è§„é¿å…¨é‡å¤åˆ¶çš„å‘ç”Ÿã€‚ éƒ¨åˆ†å¤åˆ¶éƒ¨åˆ†å¤åˆ¶ä¸»è¦æ˜¯Redisé’ˆå¯¹å…¨é‡å¤åˆ¶è¿‡é«˜å¼€é”€ä½œå‡ºçš„ä¸€ç§ä¼˜åŒ–æªæ–½ã€‚å½“slaveæ­£åœ¨å¤åˆ¶masteræ—¶ï¼Œå¦‚æœå‡ºç°ç½‘ç»œé—ªæ–­æˆ–è€…å‘½ä»¤ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼Œslaveä¼šå‘masterè¦æ±‚è¡¥å‘ä¸¢å¤±çš„å‘½ä»¤æ•°æ®ï¼Œå¦‚æœmasterçš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå†…å­˜åœ¨è¿™éƒ¨åˆ†æ•°æ®åˆ™ä¹‹é—´å‘ç»™slaveï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä¸»ä»èŠ‚ç‚¹å¤åˆ¶çš„ä¸€è‡´æ€§ã€‚è¡¥å‘çš„è¿™éƒ¨åˆ†æ•°æ®ä¸€èˆ¬è¿œè¿œå°äºå…¨é‡æ•°æ®ï¼Œæ‰€ä»¥å¼€é”€å¾ˆå°ã€‚ è¿‡ç¨‹ ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºç°ä¸­æ–­æ—¶ï¼Œå¦‚æœè¶…è¿‡repl-timeoutæ—¶é—´ï¼Œmasterä¼šè®¤ä¸ºslaveæ•…éšœå¹¶ä¸­æ–­å¤åˆ¶è¿æ¥ã€‚ ä¸»ä»è¿æ¥ä¸­æ–­æœŸé—´masterä¾ç„¶å“åº”å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œä½†å¤åˆ¶è¿æ¥ä¸­æ–­å‘½ä»¤æ— æ³•å‘é€ç»™slaveï¼Œä¸è¿‡masterå†…éƒ¨å­˜åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œå¯ä»¥ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å‘½ä»¤æ•°æ®ï¼Œé»˜è®¤æœ€å¤§ç¼“å­˜1MBã€‚ ä¸»ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼Œslaveå†æ¬¡è¿ä¸Šmasterã€‚ ä¸»ä»è¿æ¥æ¢å¤åï¼Œç”±äºslaveä¿å­˜äº†è‡ªèº«å·²å¤åˆ¶çš„åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDï¼Œæ­¤æ—¶å°†ä»–ä»¬ä½œä¸ºå‚æ•°å‘é€ç»™masterï¼Œè¦æ±‚è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚ masteræ¥åˆ°psyncå‘½ä»¤åè¿›è¡Œæ ¸å¯¹ï¼Œç„¶åæ ¹æ®offsetåœ¨è‡ªèº«å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ’åº§ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äºç¼“å†²åŒºï¼Œåˆ™å¯¹slaveå‘é€+CONTINUEå“åº”ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚ masteræ ¹æ®offsetæŠŠå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œçš„æ•°æ®å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»å¤åˆ¶è¿›å…¥æ­£å¸¸çŠ¶æ€ã€‚ å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å‘½ä»¤åŒæ­¥ï¼‰masterä¸ä»…è´Ÿè´£æ•°æ®è¯»å†™ï¼Œè¿˜è´Ÿè´£æŠŠå†™å‘½ä»¤åŒæ­¥ç»™slaveã€‚å†™å‘½ä»¤çš„å‘é€æ˜¯å¼‚æ­¥å®Œæˆï¼Œmasterè‡ªèº«å¤„ç†å®Œå†™å‘½ä»¤åç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ç­‰å¾…slaveå¤åˆ¶å®Œæˆã€‚ç”±äºä¸»ä»å¤åˆ¶è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå°±ä¼šé€ æˆsalveæ•°æ®ç›¸å¯¹masterå­˜åœ¨å»¶è¿Ÿã€‚ å¿ƒè·³æœºåˆ¶ä¸»ä»èŠ‚ç‚¹å»ºç«‹å¤åˆ¶åï¼Œå®ƒä»¬ä¹‹é—´ç»´æŠ¤ç€é•¿è¿æ¥å¹¶å½¼æ­¤å‘é€å¿ƒè·³å‘½ä»¤ã€‚ ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶ ä¸»ä»èŠ‚ç‚¹å„è‡ªéƒ½æœ‰å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œå„è‡ªæ¨¡æ‹Ÿæˆå¯¹æ–¹çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚ masteré»˜è®¤æ¯éš”10så¯¹slaveå‘é€pingå‘½ä»¤ï¼Œåˆ¤æ–­slaveçš„å­˜æ´»æ€§å’Œè¿æ¥çŠ¶æ€ã€‚ slaveæ¯éš”1så¯¹masterå‘é€replconf ack {offset}å‘½ä»¤ï¼Œç»™masterä¸ŠæŠ¥è‡ªèº«å½“å‰çš„å¤åˆ¶åç§»é‡ã€‚replconfå‘½ä»¤å¸¸ç”¨äºæ£€æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ã€ä¸ŠæŠ¥è‡ªèº«å¤åˆ¶åç§»é‡ï¼Œæ£€æµ‹å¤åˆ¶æ•°æ®æ˜¯å¦ä¸¢å¤±ï¼Œå¦‚æœslaveæ•°æ®ä¸¢å¤±ï¼Œå†ä»masterçš„å¤åˆ¶ç¼“å†²åŒºæ‹‰å–ä¸¢å¤±æ•°æ®ã€‚ã€å®ç°ä¿è¯slaveçš„æ•°é‡å’Œå»¶è¿Ÿæ€§åŠŸèƒ½ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>ä¸»ä»å¤åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€å•äº†è§£Redisä¸­çš„æŒä¹…åŒ–æœºåˆ¶]]></title>
    <url>%2F2018%2F11%2F09%2FRedis-Rersistence%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼ŸæŒä¹…åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹è½¬æ¢ä¸ºå­˜å‚¨æ¨¡å‹ï¼Œæ›´é€šä¿—çš„è¯´ï¼Œå°±æ˜¯å°†æ•°æ®ä¿å­˜åˆ°ç³»ç»Ÿç¡¬ç›˜ä¸­ã€‚ Redisæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦ç¨‹åºå´©æºƒæˆ–é‡å¯ï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–ã€‚ RDBï¼ˆé»˜è®¤å¼€å¯ï¼‰ä»‹ç»RDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹ï¼Œé€‚ç”¨äºå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ã€‚ è¿‡ç¨‹ æ‰§è¡Œbgsaveå‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹å¦‚AOFå­è¿›ç¨‹ï¼Œè‹¥æœ‰ç›´æ¥è¿”å›ã€‚ çˆ¶è¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œforkæ“ä½œä¼šé˜»å¡çˆ¶è¿›ç¨‹ã€‚ forkå®Œæˆåï¼Œçˆ¶è¿›ç¨‹å¤„ç†å…¶ä»–å‘½ä»¤ã€‚ å­è¿›ç¨‹åˆ›å»ºRDBæ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆåå¯¹æ—§æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢ã€‚ å­è¿›ç¨‹å‘é€ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡æ¶ˆæ¯ã€‚ ä¼˜ç‚¹ RDBæ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¿å­˜ç€Redisåœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¸Šçš„æ•°æ®é›†ï¼Œéå¸¸é€‚åˆå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ã€‚ RDBéå¸¸é€‚ç”¨äºç¾éš¾æ¢å¤ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”éå¸¸ç´§å‡‘ï¼Œå¯ä»¥åŠ å¯†åä¼ é€åˆ°å…¶ä»–æ•°æ®ä¸­å¿ƒã€‚ çˆ¶è¿›ç¨‹ä¿å­˜RDBæ–‡ä»¶æ—¶ä»…ä»…éœ€è¦èŠ±è´¹forkä¸€ä¸ªå­è¿›ç¨‹çš„æ—¶é—´ï¼Œæ— éœ€æ‰§è¡Œä»»ä½•ç£ç›˜I/Oæ“ä½œã€‚ RedisåŠ è½½RDBæ¢å¤æ•°æ®è¿œè¿œå¿«äºAOFçš„æ–¹å¼ã€‚ ç¼ºç‚¹ å› ä¸ºRDBæ–‡ä»¶éœ€è¦ä¿å­˜æ•´ä¸ªæ•°æ®é›†çš„çŠ¶æ€ï¼ŒèŠ±è´¹æ•°åˆ†é’Ÿçš„æ—¶é—´ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç”Ÿæ•…éšœåœæœºï¼Œå¯èƒ½ä¼šä¸¢å¤±æ•°åˆ†é’Ÿçš„æ•°æ®ã€‚ æ¯æ¬¡ä¿å­˜RDBæ—¶ï¼ŒRediséœ€è¦forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ç”±å­è¿›ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼›å¦‚æœæ•°æ®é›†å¾ˆåºå¤§ï¼Œfork()å¯èƒ½ä¼šéå¸¸è€—æ—¶ï¼Œé€ æˆæœåŠ¡å™¨åœ¨çŸ­æ—¶é—´ï¼ˆæ¯«ç§’çº§ï¼‰å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯ï¼›å¦‚æœCPUæ¯”è¾ƒç´§å¼ ï¼Œforkè¿‡ç¨‹å¯èƒ½é•¿è¾¾æ•´æ•´ä¸€ç§’ã€‚ AOFä»‹ç»AOFæŒä¹…åŒ–æ˜¯ä»¥ç‹¬ç«‹çš„æ—¥å¿—è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼ŒRedisé‡å¯çš„æ—¶å€™æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚ è¿‡ç¨‹ æ‰€æœ‰å†™å‘½ä»¤éƒ½ä¼šè¿½åŠ åˆ°AOFç¼“å†²åŒºã€‚ AOFç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œã€‚ éšç€AOFæ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å®šæœŸå¯¹AOFæ–‡ä»¶è¿›è¡Œé‡å†™ä»¥è¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚ AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥å¯ä»¥é…ç½®Rediså¤šä¹…å°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸€æ¬¡ã€‚ always: æ¯æ¬¡æœ‰å†™å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒºæ—¶å°±è°ƒç”¨ç³»ç»Ÿfsyncæ“ä½œåŒæ­¥åˆ°AOFæ–‡ä»¶ã€‚ everysecï¼šå‘½ä»¤å†™å…¥AOFç¼“å†²åŒºåè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼ŒfsyncåŒæ­¥æ–‡ä»¶æ“ä½œç”±ä¸“é—¨çº¿ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡ã€‚ noï¼šå‘½ä»¤å†™å…¥AOFç¼“å†²åŒºåè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼Œä¸å¯¹AOFæ–‡ä»¶åšfsyncæ“ä½œï¼ŒåŒæ­¥ç¡¬ç›˜ç”±ç³»ç»Ÿè´Ÿè´£ï¼Œé€šå¸¸åŒæ­¥å‘¨æœŸä¸º30sã€‚ AOFé‡å†™æœºåˆ¶AOFæ–‡ä»¶é‡å†™æ˜¯æŠŠRedisè¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–°AOFæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ï¼ˆå› ä¸ºé‡å†™AOFæ–‡ä»¶æ—¶ï¼ŒRedisä¼šåˆå¹¶å¤šæ¡å†™å‘½ä»¤ã€ä¸¢å¼ƒè¶…æ—¶çš„æ•°æ®ã€åˆ é™¤æ— æ•ˆå‘½ä»¤ï¼Œæ‰€ä»¥é‡å†™åçš„AOFæ–‡ä»¶è¦å°äºæ—§æ–‡ä»¶ï¼‰ ä¼˜ç‚¹ ä½¿ç”¨AOFæŒä¹…åŒ–ä½¿å¾—Redisæ›´åŠ è€ä¹…ï¼ŒAOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥å¯ä»¥ä½¿å¾—Rediså°±ç®—å‘ç”Ÿæ•…éšœåœæœºï¼Œä¹Ÿæœ€å¤šä¸¢å¤±1sçš„æ•°æ®ï¼ˆå®é™…ä¸Šæœ€å¤šä¸º2sï¼‰ã€‚ AOFæ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥Redisåè®®çš„æ ¼å¼ä¿å­˜ï¼Œæ–‡ä»¶å†…å®¹æ˜“æ‡‚ä¸”å®¹æ˜“åˆ†æã€å¯¼å‡ºã€‚ ç¼ºç‚¹ AOFæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸å¤§äºRDBæ–‡ä»¶çš„ä½“ç§¯ã€‚ AOFçš„é€Ÿåº¦å¯èƒ½æ…¢äºRDBã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>æŒä¹…åŒ– ç¼“å­˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®—æ³•å…¥é—¨ä¹‹åˆçº§æ’åºï¼ˆé€‰æ‹©ã€æ’å…¥ã€å¸Œå°”ï¼‰]]></title>
    <url>%2F2018%2F10%2F03%2Fsort-1%2F</url>
    <content type="text"><![CDATA[ä¸‹é¢æ˜¯é€‰æ‹©æ’åºã€æ’å…¥æ’åºã€å¸Œå°”æ’åºç­‰åˆçº§æ’åºçš„ç®€å•ä»‹ç»åŠå®ç°ã€‚ é€‰æ‹©æ’åºæ­¥éª¤ é¦–å…ˆæ‰¾åˆ°æ•°ç»„ä¸­æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ç½®æ¢ä½ç½®ã€‚ ä»å‰©ä½™çš„å…ƒç´ ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶ä¸ç¬¬äºŒä¸ªå…ƒç´ ç½®æ¢ä½ç½®ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ•°ç»„å®Œå…¨æœ‰åºã€‚ é€‰æ‹©æ’åºæ‰€éœ€çš„æ—¶é—´å–å†³äºå…ƒç´ çš„æ•°é‡ å®ç°123456789101112131415161718public class Selection&#123; public static void sort(Comparable[] a) &#123; int N = a.length; int temp = 0; for (int i = 0; i &lt; N; i++) &#123; int min = i; for (int j = i + 1; j &lt; N; j++) &#123; if (a[min] &gt; a[j]) &#123; min = j; &#125; &#125; temp = a[min]; a[min] = a[i]; a[i] = temp; &#125; &#125;&#125; æ’å…¥æ’åºæ­¥éª¤ ç¬¬äºŒä¸ªå…ƒç´ ä¸å·¦ä¾§çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚ ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸å·¦ä¾§çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ•°ç»„å®Œå…¨æœ‰åºã€‚ å®ç°12345678910111213141516public class Insertion&#123; public static void sort(Comparable[] a) &#123; int N = a.length; int temp = 0; for (int i = 1; i &lt; N; i++) &#123; for (int j = i; j &gt; 0; j--) &#123; if (a[j] &lt; a[j-1]) &#123; temp = a[j]; a[j] = a[j-1]; a[j-1] = temp; &#125; &#125; &#125; &#125;&#125; æ’å…¥æ’åºæ‰€éœ€çš„æ—¶é—´å–å†³äºå…ƒç´ çš„åˆå§‹é¡ºåº å¸Œå°”æ’åºå¸Œå°”æ’åºæ˜¯åŸºäºæ’å…¥æ’åºçš„å¿«é€Ÿæ’åºï¼Œæ€æƒ³æ˜¯ä½¿æ•°ç»„ä¸­ä»»æ„é—´éš”ä¸ºhçš„å…ƒç´ æ˜¯æœ‰åºçš„ã€‚ æ­¥éª¤ï¼ˆåºåˆ—1/2(3^k - 1)ï¼‰ å¢å¹…hä¸ºæ•°ç»„é•¿åº¦çš„æŸä¸ªå€æ•°ï¼ˆæœ€å°å€¼ä¸º1ï¼‰ï¼Œç„¶åè®¡ç®—å‡ºå¢é•¿åºåˆ—(1, 4, 13, â€¦)ã€‚ h = h(max)ï¼Œç¡®ä¿é—´éš”ä¸ºhçš„å…ƒç´ æœ‰åºã€‚ h = h / 3ï¼Œç¡®ä¿é—´éš”ä¸ºhçš„å…ƒç´ æœ‰åºã€‚ é‡å¤ç¬¬3æ­¥ï¼Œç›´è‡³æ•°ç»„å®Œå…¨æœ‰åºã€‚ å®ç°1234567891011121314151617181920212223public class Shell&#123; public static void sort(Comparable[] a) &#123; int N = a.length; int h = 1; int temp = 0; System.out.print(h); while (h &lt; N / 3) h = h * 3 + 1; while (h &gt;= 1) &#123; for (int i = h; i &lt; N; i++) &#123; for (int j = i; j &gt;= h; j -= h) &#123; if (a[j - h] &gt; a[j]) &#123; temp = a[j - h]; a[j - h] = a[j]; a[j] = temp; &#125; &#125; &#125; h /= 3; &#125; &#125;&#125; åç§° ä½¿ç”¨åœºæ™¯ æ—¶é—´å¤æ‚åº¦ æ•ˆç‡å½±å“å› ç´  é€‰æ‹©æ’åº å°å‹æ•°ç»„ O(N^2) æ•°ç»„å¤§å° æ’å…¥æ’åº å°å‹æ•°ç»„ï¼Œæ•°ç»„éƒ¨åˆ†æœ‰åº O(N^2) å…ƒç´ åˆå§‹é¡ºåº å¸Œå°”æ’åº ä¸­å°å‹æ•°ç»„ï¼Œæ•°ç»„éƒ¨åˆ†æœ‰åº O(N^3/2), O(N^4/3), O(N^6/5)â€¦ å…ƒç´ åˆå§‹é¡ºåºï¼Œå¢é•¿åºåˆ—]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React Diff]]></title>
    <url>%2F2018%2F09%2F23%2Freact-diff%2F</url>
    <content type="text"><![CDATA[è®¡ç®—ä¸€æ£µæ ‘å½¢ç»“æ„è½¬æ¢æˆå¦ä¸€æ£µæ ‘å½¢ç»“æ„ï¼Œä¼ ç»Ÿçš„diffç®—æ³•ç®—æ³•å¤æ‚åº¦è¾¾åˆ°O(n^3)ã€‚Reacté€šè¿‡åˆ¶å®šç­–ç•¥ï¼Œå°†O(n^3)å¤æ‚åº¦çš„é—®é¢˜è½¬æ¢æˆO(n)å¤æ‚åº¦ã€‚ Diff ç­–ç•¥ Web UI ä¸­DOMèŠ‚ç‚¹è·¨å±‚çº§çš„ç§»åŠ¨æ“ä½œç‰¹åˆ«å°‘ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ æ‹¥æœ‰ç›¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆç›¸ä¼¼çš„æ ‘å½¢ç»“æ„ï¼Œæ‹¥æœ‰ä¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆä¸åŒçš„æ ‘å½¢ç»“æ„ã€‚ å¯¹äºåŒä¸€å±‚çº§çš„ä¸€ç»„å­èŠ‚ç‚¹ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡å”¯ä¸€idè¿›è¡ŒåŒºåˆ†ã€‚ Tree Diffå¯¹æ ‘è¿›è¡Œåˆ†å±‚æ¯”è¾ƒï¼Œä¸¤æ£µæ ‘åªä¼šå¯¹åŒä¸€å±‚æ¬¡çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚ å½“èŠ‚ç‚¹è·¨å±‚çº§ç§»åŠ¨æ—¶ï¼Œå¹¶ä¸ä¼šå‡ºç°æƒ³è±¡ä¸­çš„ç§»åŠ¨æ“ä½œï¼Œè€Œæ˜¯è¿›è¡Œcreate-deleteæ“ä½œï¼ˆå½±å“æ€§èƒ½ï¼‰ã€‚ Component Diff å¦‚æœæ˜¯åŒç±»å‹çš„ç»„ä»¶ï¼ŒæŒ‰åŸç­–ç•¥ç»§ç»­æ¯”è¾ƒVirtual DOM treeã€‚ å¦‚æœä¸æ˜¯åŒç±»å‹çš„ç»„ä»¶ï¼Œåˆ™å°†ç»„ä»¶åˆ¤æ–­ä¸ºdirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚ å¦‚æœæ˜¯åŒä¸€ç±»å‹çš„ç»„ä»¶ï¼Œå¹¶ä¸”Virtual DOMæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šçœä¸‹å¤§é‡çš„diffè¿ç®—æ—¶é—´ï¼Œå› æ­¤Reactå…è®¸ç”¨æˆ·é€šè¿‡shouldComponentUpdate()æ¥åˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦è¿›è¡Œdiffã€‚ Element Diffå½“èŠ‚ç‚¹å¤„äºåŒä¸€å±‚çº§æ—¶ï¼ŒReact Diffæä¾›äº†ä¸‰ç§èŠ‚ç‚¹æ“ä½œï¼Œåˆ†åˆ«ä¸ºï¼šINSERT_MARKUPã€MOVE_EXISTINGã€REMOVE_NODE INSERT_MARKUP: åŸé›†åˆä¸åŒ…å«æ–°çš„componentç±»å‹ï¼Œæ–°èŠ‚ç‚¹éœ€æ‰§è¡Œæ’å…¥æ“ä½œ MOVE_EXISTING: åŸé›†åˆåŒ…å«æ–°çš„componentç±»å‹ï¼Œä¸”elementæ—¶å¯æ›´æ–°çš„ç±»å‹ï¼ŒgenerateComponentChildrenå·²è°ƒç”¨receiveComponetï¼Œè¿™ç§æƒ…å†µä¸‹prevChild=nextChildï¼Œå°±éœ€è¦åšç§»åŠ¨æ“ä½œï¼Œå¯ä»¥å¤ç”¨ä»¥å‰çš„DOMèŠ‚ç‚¹ã€‚ REMOVE_NODE: è€componeç±»å‹ï¼Œåœ¨æ–°é›†åˆä¹Ÿæœ‰ï¼Œä½†å¯¹åº”çš„elementä¸åŒåˆ™ä¸èƒ½ç›´æ¥å¤ç”¨å’Œæ›´æ–°ï¼Œéœ€æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œæˆ–è€…è€componentä¸åœ¨æ–°é›†åˆä¸­ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œã€‚ å…è®¸å¼€å‘è€…å¯¹åŒä¸€å±‚çº§çš„åŒç»„å­èŠ‚ç‚¹æ·»åŠ å”¯ä¸€keyä½œä¸ºæ ‡è¯†ã€‚]]></content>
      <categories>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£JavaScriptä¹‹Event Loop]]></title>
    <url>%2F2018%2F06%2F27%2Fevent-loop%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘é˜…è¯»ã€Šé«˜æ€§èƒ½JavaScriptã€‹æ—¶ï¼Œç¬¬å…­ç« è°ˆåˆ°â€œé€šè¿‡å®šæ—¶å™¨å°†JavaScriptæ‰§è¡Œä»£ç çš„æ§åˆ¶æƒå…ˆè®©ç»™æµè§ˆå™¨ç”¨äºæ›´æ–°UIçŠ¶æ€ï¼Œç„¶åå†å°†æ§åˆ¶æƒäº¤å›ç»™JavaScriptä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿å¾—é¡µé¢æ›´ä¸ºæµç•…â€ï¼Œå°±è”æƒ³åˆ°äº†ä¹‹å‰ç†è§£çš„äº‹ä»¶å¾ªç¯ã€‚ è¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¹ˆåšå¯ä»¥æå‡é¡µé¢çš„æµç•…åº¦ã€‚ äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ å•çº¿ç¨‹çš„JavaScriptæ€»æ‰€å‘¨çŸ¥ï¼ŒJavaScriptè¯­è¨€çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªæ—¶é—´æ®µé‡Œï¼ŒJavaScriptåªèƒ½åšä¸€ä»¶äº‹æƒ…ï¼ˆæµè§ˆå™¨æ˜¯å¤šçº¿ç¨‹ï¼‰ã€‚å¤šçº¿ç¨‹å¯ä»¥å®ç°åº”ç”¨çš„å¹¶è¡Œå¤„ç†ï¼Œä»è€Œä»¥æ›´é«˜çš„CPUåˆ©ç”¨ç‡æé«˜æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œååé‡ã€‚ ä½†æ˜¯JavaScriptå´ä»¥å•çº¿ç¨‹è¿›è¡Œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ JavaScriptæ˜¯æµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œç”¨äºä¸ç”¨æˆ·äº¤äº’ä»¥åŠæ“ä½œDOMã€‚è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå¹¶å‘çš„æ“ä½œï¼Œå¯¹åŒä¸€ä¸ªDOMèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œåˆ é™¤å’Œä¿®æ”¹æ ·å¼ï¼Œæ­¤æ—¶æµè§ˆå™¨å°±æ— æ³•å†³å®šåˆ°åº•é‡‡ç”¨å“ªä¸ªçº¿ç¨‹çš„æ“ä½œã€‚ç±»ä¼¼æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨â€œé”â€æ¥å¤„ç†å¹¶å‘ï¼Œä½†æ˜¯è¿™ä¼šå¹³æ·»å¤æ‚åº¦ã€‚æ‰€ä»¥ï¼ŒJavaScriptè¯­è¨€æ²¡æœ‰æ”¯æŒå¤šçº¿ç¨‹æ“ä½œã€‚é‚£åˆè€ƒè™‘è¿™ç§æƒ…å†µï¼Œæ—¢ç„¶JavaScriptæ˜¯å•çº¿ç¨‹ï¼Œåœ¨æŸä¸€æ—¶åˆ»å†…åªèƒ½æ‰§è¡Œç‰¹å®šçš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šé˜»å¡å…¶å®ƒä»»åŠ¡æ‰§è¡Œã€‚é‚£ä¹ˆå¦‚æœç”¨æˆ·è§¦å‘äº†ä¸€ä¸ªéå¸¸è€—æ—¶çš„I/Oæ“ä½œï¼Œé‚£ä¹ˆæŒ‰é“ç†åç»­çš„æ‰€æœ‰æ“ä½œéƒ½å¾—ç­‰åˆ°I/Oæ“ä½œå®Œæˆåæ–¹å¯è¿›è¡Œã€‚ä½†æ˜¯ï¼Œäº‹å®ä¸Šï¼Œåç»­çš„ä»»åŠ¡ä¸å¿…ç­‰å¾…è¿™ä¸ªè€—æ—¶çš„I/Oæ“ä½œå®Œæˆï¼ŒåŸå› å°±æ˜¯JavaScriptä¸ç”Ÿä¿±æ¥çš„å¼‚æ­¥å’Œå›è°ƒã€‚ è€Œè¿™èƒŒåæ°å¥½å°±æ˜¯æœ¬æ–‡çš„ä¸»é¢˜â€”â€”â€”â€”â€”â€”äº‹ä»¶å¾ªç¯ å®šä¹‰äº‹ä»¶å¾ªç¯åŒ…å«äº†è‡³å°‘ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ å®ä»»åŠ¡å®ä»»åŠ¡åŒ…å«åˆ›å»ºæ–‡æ¡£å¯¹è±¡ã€è§£æHTMLã€æ‰§è¡Œä¸»çº¿JavaScriptä»£ç ã€æ›´æ”¹å½“å‰URLä»¥åŠå„ç§äº‹ä»¶ï¼Œä¾‹å¦‚é¡µé¢åŠ è½½ã€è¾“å…¥ã€ç½‘ç»œäº‹ä»¶å’Œå®šæ—¶å™¨ç­‰ç­‰ã€‚å®ä»»åŠ¡è¿è¡Œå®Œæˆåï¼Œæµè§ˆå™¨ç»§ç»­å…¶ä»–çš„ä»»åŠ¡è°ƒåº¦ï¼Œå¦‚é‡æ–°æ¸²æŸ“é¡µé¢æˆ–è€…åƒåœ¾å›æ”¶ã€‚ å¾®ä»»åŠ¡å¾®ä»»åŠ¡åŒ…æ‹¬promiseã€å›è°ƒå‡½æ•°ã€DOMå‘ç”Ÿå˜åŒ–ç­‰ã€‚å¾®ä»»åŠ¡æ›´æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå¿…é¡»åœ¨æµè§ˆå™¨ä»»åŠ¡ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼ˆæ¸²æŸ“UIè§†å›¾æˆ–è€…è¿›è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼‰ä¹‹å‰æ‰§è¡Œã€‚ ä¸¤ä¸ªåŸºæœ¬åŸåˆ™ ä¸€æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡ ä¸€ä¸ªä»»åŠ¡å¼€å§‹ç›´åˆ°è¿è¡Œå®Œæˆï¼Œä¸ä¼šè¢«å…¶ä»–ä»»åŠ¡ä¸­æ–­ æ— è®ºæ˜¯å®ä»»åŠ¡é˜Ÿåˆ—è¿˜æ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒäºŒè€…åœ¨åŒä¸€æ—¶åˆ»éƒ½åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¸è¿‡äºŒè€…ä¹Ÿæœ‰é‡è¦çš„åŒºåˆ«ï¼šåœ¨ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œæœ€å¤šå¤„ç†ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè€Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å¾®ä»»åŠ¡éƒ½ä¼šè¢«å¤„ç†ã€‚ åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œäº‹ä»¶å¾ªç¯ä¼šæ£€æŸ¥å½“å‰æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“UIï¼Œå¦‚æœéœ€è¦åˆ™æ¸²æŸ“UIè§†å›¾ã€‚ è¡¥å…… ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—éƒ½æ˜¯ç‹¬ç«‹äºäº‹ä»¶å¾ªç¯çš„ï¼Œè¿™æ„å‘³ç€ä»»åŠ¡é˜Ÿåˆ—çš„æ·»åŠ å‘ç”Ÿåœ¨äº‹ä»¶å¾ªç¯å¤–ã€‚ æ‰€æœ‰å¾®ä»»åŠ¡éƒ½ä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“å‰å®Œæˆï¼Œç›®çš„æ˜¯åœ¨æ¸²æŸ“å‰æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚ æµè§ˆå™¨ä¼šå°è¯•ä»¥æ¯ç§’æ¸²æŸ“60æ¬¡é¡µé¢ï¼Œä»¥è¾¾åˆ°æ¯ç§’60å¸§çš„é€Ÿåº¦ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡å¾ªç¯æœ€ç†æƒ³çš„æ—¶é—´åº”è¯¥ä¸è¶…è¿‡16msã€‚ æµè§ˆå™¨å®Œæˆé¡µé¢æ¸²æŸ“åï¼Œè¿›å…¥ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯è¿­ä»£åï¼Œå¯èƒ½å‡ºç°3ç§æƒ…å†µ å¦‚æœäº‹ä»¶å¾ªç¯æ‰§è¡Œåˆ°â€œis rendering neededâ€ä¸”æµè§ˆå™¨å¤„äºå¦ä¸€ä¸ª16msç»“æŸä¹‹å‰ï¼ˆå³æµè§ˆå™¨å°šæœªè‡ªåŠ¨è§¦å‘é¡µé¢æ¸²æŸ“æ—¶ï¼‰ï¼Œæµè§ˆå™¨å¯èƒ½ä¸ä¼šé€‰æ‹©åœ¨å½“å‰çš„æ—¶é—´å¾ªç¯ä¸­æ‰§è¡Œæ›´æ–°UIæ“ä½œï¼Œå› ä¸ºæ›´æ–°UIæ˜¯ä¸€ä¸ªå¤æ‚ä¸”è€—æ€§èƒ½çš„æ“ä½œã€‚ å¦‚æœäº‹ä»¶å¾ªç¯æ‰§è¡Œåˆ°â€œis rendering neededâ€ä¸”æµè§ˆå™¨åˆšå¥½ç¦»ä¸Šä¸€æ¬¡æ¸²æŸ“16mså·¦å³æ—¶ï¼ˆå³æµè§ˆå™¨å³å°†è‡ªåŠ¨è§¦å‘é¡µé¢æ¸²æŸ“æ—¶ï¼‰ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šè¿›è¡ŒUIæ›´æ–°ã€‚ æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è€—æ—¶è¶…è¿‡16msï¼Œæµè§ˆå™¨å°†æ— æ³•ä»¥ç›®æ ‡å¸§ç‡é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œä¸”UIæ— æ³•è¢«æ›´æ–°ã€‚å¦‚æœå»¶è¿Ÿä¸å¤§æ˜¯å¾ˆéš¾å¯Ÿè§‰åˆ°ï¼Œä½†æ˜¯ï¼Œå¦‚æœæœ‰éå¸¸è€—æ—¶çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·ä¼šè§‰å¾—ç½‘é¡µååˆ†å¡é¡¿ï¼Œç”šè‡³æµè§ˆå™¨ä¼šæç¤ºâ€œæ— å“åº”è„šæœ¬â€ã€‚ å‰æƒ…å›é¡¾ç°åœ¨ï¼Œç”¨äº‹ä»¶å¾ªç¯å’Œç®€å•çš„ä¾‹å­æ¥åˆ†æã€Šé«˜æ€§èƒ½çš„JavaScriptã€‹ä¸­çš„é‚£å¥è¯ã€‚éœ€æ±‚ï¼šç»™åŒ…å«1000ä¸ªæ•°å­—çš„æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å–ç»å¯¹å€¼ï¼ˆå‡è®¾å¯¹ä¸€ä¸ªæ•°å­—è¿›è¡Œéœ€æ±‚æ“ä½œè€—æ—¶1msï¼‰ã€‚ æƒ…å†µ1ï¼ˆä¸ä½¿ç”¨å®šæ—¶å™¨ï¼‰:ç”±äºJavaScriptä¸»çº¿ç¨‹ä»£ç å±äºå®ä»»åŠ¡çš„ä¸€ç§ï¼Œæ‰€ä»¥ä¸€æ¬¡äº‹ä»¶å¾ªç¯éœ€è¦å¤„ç†1000ä¸ªæ•°å­—ï¼Œæ‰€ä»¥1säº‹ä»¶å¾ªç¯æ‰è¿›è¡Œåˆ°UIæ›´æ–°é˜¶æ®µï¼Œä½†æ˜¯ç”±äºè€—æ—¶è¿‡é•¿ï¼ŒUIçŠ¶æ€ä¸ä¼šè¢«æ›´æ–°ï¼Œé¡µé¢å‡ºç°å¡é¡¿ç”šè‡³å µå¡ã€‚ æƒ…å†µ2ï¼ˆä½¿ç”¨å®šæ—¶å™¨ï¼‰ï¼šå°†ä¸€æ¬¡å¤„ç†1000ä¸ªæ•°å­—çš„ä»»åŠ¡åˆ†å‰²ä¸º20ä¸ªæ¯æ¬¡å¤„ç†50ä¸ªæ•°å­—çš„ä»»åŠ¡ã€‚ç”±äºå®šæ—¶å™¨æ˜¯å®ä»»åŠ¡çš„ä¸€ç§ï¼Œæ‰€ä»¥ä¸€æ¬¡äº‹ä»¶å¾ªç¯åªå¤„ç†50ä¸ªæ•°å­—ï¼Œç”±äºæ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰€ä»¥50msåäº‹ä»¶å¾ªç¯è¿›è¡Œåˆ°UIæ›´æ–°é˜¶æ®µï¼Œç„¶åæ ¹æ®æƒ…å†µè¿›è¡ŒUIæ¸²æŸ“ï¼Œé¡µé¢æœªå‡ºç°å¡é¡¿æˆ–è€…å µå¡ã€‚ å½“ç„¶ï¼Œå¦‚æœåªæ˜¯å•çº¯çš„å¤„ç†æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Web Workersã€‚ æ€»ç»“ JavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼ŒåŒä¸€æ—¶åˆ»æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ äº‹ä»¶å¾ªç¯åŒ…å«ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—å’Œè‡³å°‘ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯ä¸€æ¬¡è¿­ä»£ï¼Œè‡³å¤šæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ä½†æ˜¯ä¼šæ‰§è¡Œå®Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚ Webåº”ç”¨è¶Šå¤æ‚ï¼Œç§¯æä¸»åŠ¨ç®¡ç†UIçº¿ç¨‹å°±è¶Šé‡è¦ï¼Œå³ä½¿JavaScriptä»£ç å¾ˆé‡è¦ï¼Œä¹Ÿä¸èƒ½å½±å“ç”¨æˆ·ä½“éªŒã€‚ å‚è€ƒ ã€ŠHigh Performance JavaScriptã€‹ ã€ŠSecrets of the JavaScript Ninjaã€‹ ã€ŠHTML 5.2ã€‹]]></content>
      <categories>
        <category>JavaScriptæ ¸å¿ƒ</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬ä¸€æ¬¡é¢è¯•ç»å†]]></title>
    <url>%2F2018%2F05%2F24%2Fmy-first-interview%2F</url>
    <content type="text"><![CDATA[ç¬¬ä¸€æ¬¡æŠ•ç®€å†é¢è¯•â€¦â€¦ è…¾è®¯MIGäº‹ä¸šç¾¤ äº‘å®‰å…¨éƒ¨ï¼ˆ5.21ï¼‰ç¬¬ä¸€æ¬¡æŠ€æœ¯é¢è¯•ï¼Œæ¯”è¾ƒç´§å¼ ï¼Œé¢è¯•è¿‡ç¨‹20å¤šåˆ†é’Ÿï¼Œæœ€åé—®äº†é¢è¯•å®˜é¹…å‚å‰ç«¯ç”Ÿæ€å’Œéƒ¨é—¨æŠ€æœ¯æ ˆï¼Œä¸‹é¢æ˜¯é¢è¯•å†…å®¹ï¼š ä»‹ç»ä¸€ä¸‹è‡ªå·±ï¼Œæœ€è¿‘åœ¨çœ‹ä»€ä¹ˆä¹¦ï¼Œå¦‚ä½•å­¦ä¹ å‰ç«¯çš„ã€‚ CSSå¦‚ä½•å®ç°å‚ç›´å±…ä¸­ã€æ°´å¹³å±…ä¸­ å¯¹CSS3äº†è§£ç¨‹åº¦ï¼Œç”¨è¿‡å“ªäº›ç‰¹æ€§ HTTPçŠ¶æ€ç ã€Webç¼“å­˜ è·¨åŸŸ ä»‹ç»ä¸€ä¸‹XSSå’ŒCSRFï¼Œå¦‚ä½•é¿å… JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹ MVVMçš„åŸç† è¯´è¯´ä½ çš„é¡¹ç›®ï¼Œè®²è®²æ”¶è·å¤§çš„åœ°æ–¹ã€‚ 5.17å°±æ¥åˆ°äº†è…¾è®¯é¢è¯•å®˜çš„ç”µè¯ï¼Œé—®äº†æˆ‘ä¸€äº›åŸºæœ¬æƒ…å†µï¼Œçœ‹äº†æˆ‘çš„githubå’Œåšå®¢ï¼Œåé¢ä¹ŸåŠ äº†å¾®ä¿¡ï¼Œç»™äº†æˆ‘ä¸€äº›å¾ˆå¥½çš„å»ºè®®ï¼Œäººéå¸¸niceã€‚ï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡é¢è¯•ï¼‰ ç™¾åº¦å‰ç«¯æŠ€æœ¯éƒ¨ï¼ˆ5.23ï¼‰è¿™æ¬¡é¢è¯•ä¹Ÿæ˜¯ä¸€ä½å°å§å§å®˜ï¼Œä¸€å¼€å§‹æ¯”è¾ƒç´§å¼ ï¼Œåé¢å°±å¥½å¤šäº†ï¼Œé¢è¯•è¿‡ç¨‹50åˆ†é’Ÿã€‚åœ¨ç¬¬ä¸€ä¸ªé—®é¢˜ä¸­ï¼Œé¢è¯•å®˜è®¤ä¸ºæˆ‘çš„æ–¹æ³•ä¸å¯è¡Œï¼ˆfilter + indexOfï¼‰ï¼Œåæ¥è¢«è®¤å¯äº†ã€‚å› ä¸ºæ²¡é—®æˆ‘JavaScriptæˆ‘è§‰å¾—é‡è¦çš„æ¦‚å¿µï¼ˆåŸå‹ã€é—­åŒ…ã€äº‹ä»¶å¾ªç¯ç­‰ï¼‰æ¯”è¾ƒæƒŠè®¶ï¼Œç„¶åé¢è¯•å®˜è®©æˆ‘ä»‹ç»ï¼ˆè™½ç„¶ç­”ä¸Šäº†ï¼Œä½†æ˜¯ä¸‹æ¬¡å†ä¹Ÿä¸ä¸»åŠ¨ç»™è‡ªå·±åŠ é¢˜äº†ğŸ¤¦ï¸ï¼‰ï¼Œæœ€åæˆ‘é—®äº†é—®å¥¹ä»¬éƒ¨é—¨çš„ä¸šåŠ¡å’Œç”Ÿæ€ã€‚ä¸‹é¢æ˜¯é¢è¯•å†…å®¹ï¼š æ•°ç»„å»é‡ å¦‚ä½•å®ç°å›¾ç‰‡å……æ»¡ç›’å­ å¦‚ä½•å®ç°CSSå‚ç›´å±…ä¸­ CSS3çš„æ–°ç‰¹æ€§ Flexå¸ƒå±€ HTTPçŠ¶æ€ç  Webç¼“å­˜ æ€§èƒ½ä¼˜åŒ– äº‹ä»¶æµ ç”¨è¿‡çš„ES6ç‰¹æ€§ è°ˆè°ˆé¡¹ç›®ä¸­æ¯”è¾ƒéš¾çš„åœ°æ–¹ æ€»ç»“è…¾è®¯å’Œç™¾åº¦ä¸¤æ¬¡é¢è¯•éƒ½æ˜¯å¾ˆå¥½çš„ä½“éªŒï¼Œå› ä¸ºæ‰å¤§äºŒï¼Œæ‰€ä»¥æ²¡æœ‰åšé¢è¯•çš„å‡†å¤‡ï¼ŒæŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€æŠ•é€’äº†ç®€å†ï¼Œé¢è¯•è¿‡ç¨‹ä¸­ä¹Ÿå‘ç°è‡ªå·±çš„ä¸€äº›ä¸è¶³ï¼Œå¤§ç¥ä»¬çš„å»ºè®®ä¼šä»”ç»†å¬å–çš„ã€‚æœ€åä¹Ÿæ‹¿åˆ°äº†å®ä¹ offerï¼ŒKeep hungry, keep foolish.]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é…ç½®NginxäºŒçº§åŸŸåå¹¶éƒ¨ç½²hexoåšå®¢]]></title>
    <url>%2F2018%2F05%2F09%2Fhow-to-deploy-a-static-website%2F</url>
    <content type="text"><![CDATA[å› ä¸ºæœ‰ä¸åŒçš„é¡¹ç›®éœ€è¦éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—ä¸ºæ¯ä¸ªé¡¹ç›®åˆ†é…ä¸€ä¸ªäºŒçº§åŸŸåã€‚ä¸‹é¢æ˜¯æ•´ä¸ªæµç¨‹çš„å¤ç›˜: å®‰è£…nginxå’Œgityum -y install nginx git è·å–èµ„æºæ–‡ä»¶ æ–°å»º /var/www/blog ç›®å½•ï¼šmkidr /var/www/blog åˆ‡æ¢åˆ°blogç›®å½•ä¸‹å¹¶è·å–æ–‡ä»¶ï¼š cd /var/www/blog &amp;&amp; git clone git@github.com:GeniusFunny/GeniusFunny.github.io.git, æ­¤æ—¶blogç›®å½•ä¸‹æœ‰ä¸€ä¸ªGeniusFunny.github.ioæ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯æˆ‘çš„hexoèµ„æºæ–‡ä»¶å¤¹ï¼Œé…ç½®.confæ–‡ä»¶æ—¶ä¼šç”¨åˆ°ã€‚ DNSæ·»åŠ äºŒçº§åŸŸåå‰å¾€ä½ è´­ä¹°çš„æœåŠ¡å™¨å•†ï¼ˆæˆ‘è´­ä¹°çš„æ˜¯è…¾è®¯äº‘çš„æœåŠ¡ï¼‰ä¸ºåœ¨åŸŸåè§£æä¸­æ·»åŠ è§£æè®°å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼šç‚¹å‡»æ·»åŠ è®°å½•ï¼Œåœ¨ä¸»æœºè®°å½•æ·»åŠ ä½ è¦çš„åŸŸåï¼ˆå¦‚blogï¼‰ï¼Œåœ¨è®°å½•å€¼å¤„å¡«å†™æœåŠ¡å™¨çš„ipåœ°å€ã€‚é‚£ä¹ˆå°±æœ‰ä¸€ä¸ªæ–°çš„åŸŸåï¼Œå¦‚:blog.geniusfunny.xyzã€‚æ·»åŠ å®Œæˆåï¼Œæˆ‘ä»¬å°±å¼€å§‹é…ç½®æˆ‘ä»¬çš„nginxã€‚ nginxé…ç½®äºŒçº§åŸŸåå¹¶éƒ¨ç½² è¿›å…¥nginxé»˜è®¤é…ç½®æ–‡ä»¶vim /etc/nginx/nginx.conf åœ¨httpæ¨¡å—ä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼ˆå¼•å…¥sites-enabledæ–‡ä»¶å¤¹ï¼‰ï¼šinclude /etc/nginx/sites-enabled/*; åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªsites-enabledæ–‡ä»¶å¤¹ï¼šmkdir sites-enabled è¿›å…¥sites-enabledæ–‡ä»¶å¤¹ï¼Œæ·»åŠ ä»¥äºŒçº§åŸŸåï¼ˆblog.geniusfunny.xyzï¼‰ä¸ºåç§°çš„é…ç½®æ–‡ä»¶: vim blog.geniusfunny.xyz é…ç½®äºŒçº§åŸŸåé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456server &#123; listen 80; server_name blog.geniusfunny.xyz; root /var/www/blog/GeniusFunny.github.io; //è¿™æ˜¯æˆ‘ä»¬çš„èµ„æºæ–‡ä»¶ç›®å½• index index.html index.htm index.nginx-debian.html;&#125; é…ç½®å¿«æ·linuxå‘½ä»¤ è¿›å…¥.bashrcæ–‡ä»¶ï¼Œvim ~/.bashrc æ·»åŠ å¿«æ·linuxè‡ªå®šä¹‰å‘½ä»¤ï¼Œalias myBlog=&#39;cd /var/www/blog/GeniusFunny.github.io, ä¿å­˜ ä½¿.bashrcæ–‡ä»¶ç”Ÿæ•ˆï¼Œsource ~/.bashrc ä»¥åæˆ‘ä»¬å°±å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹è¾“å…¥myBlogè¿›å…¥èµ„æºæ–‡ä»¶å¤¹ç›®å½•ï¼Œç„¶ågit pullï¼Œè·å–æœ€æ–°çš„èµ„æº å¸¸ç”¨çš„å…³äºnginxçš„å‘½ä»¤æ£€æŸ¥nginxé…ç½®ï¼šnginx -t nginx.confå¼€å¯nginxæœåŠ¡ï¼šnginxå…³é—­nginxæœåŠ¡ï¼šnginx -s stopå¼ºåˆ¶å…³é—­nginxæœåŠ¡ï¼špkill -9 nginxé‡å¯nginxæœåŠ¡ï¼šnginx -s reload]]></content>
      <categories>
        <category>å®è·µ</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>éƒ¨ç½²</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»ä¸€è¡Œurlåˆ°ä¸€ä¸ªé¡µé¢æˆ‘ä»¬ç»å†äº†ä»€ä¹ˆï¼Ÿ(æ›´æ–°ä¸­)]]></title>
    <url>%2F2018%2F05%2F03%2Fweb-life-cycle%2F</url>
    <content type="text"><![CDATA[å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä¸€è¡Œurlï¼Œæ•´ä¸ªé¡µé¢å‘ˆç°ï¼Œæ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæˆ‘å¤§è‡´æŠŠæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³ç½‘ç»œè¡Œä¸ºä¸é¡µé¢å‘¨æœŸã€‚æµè§ˆå™¨ç¼“å­˜ â€”&gt; DNS â€”&gt; TCPè¿æ¥ â€“&gt; HTTPè¯·æ±‚/å“åº” â€”&gt; æ„å»ºé¡µé¢ â€”&gt; äº‹ä»¶å¤„ç† ç½‘ç»œè¡Œä¸ºæµè§ˆå™¨ç¼“å­˜æœºåˆ¶æµè§ˆå™¨å’ŒæœåŠ¡å™¨æ˜¯åº”ç­”æ¨¡å¼ï¼Œå³ï¼šæµè§ˆå™¨å‘èµ·HTTPè¯·æ±‚ â€”&gt; æœåŠ¡å™¨è¿”å›å“åº”ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æ‹¿åˆ°çš„HTTPå“åº”å¤´çš„é…ç½®æ¥å†³å®šæ˜¯å¦ç¼“å­˜æ­¤æ¬¡çš„å“åº”ç»“æœã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š1. æµè§ˆå™¨æ¯æ¬¡å‘èµ·HTTPè¯·æ±‚æ—¶ï¼Œéƒ½ä¼šæ ¹æ®è¯·æ±‚å»æµè§ˆå™¨ç¼“å­˜ä¸­åŒ¹é…å¯¹åº”çš„è¯·æ±‚ç»“æœå’Œç¼“å­˜æ ‡è¯†ã€‚2. æµè§ˆå™¨æ¯æ¬¡æˆåŠŸè·å–åˆ°è¯·æ±‚ç»“æœï¼Œéƒ½ä¼šå°†è¯·æ±‚ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ã€‚æ ¹æ®æµè§ˆå™¨æ˜¯å¦éœ€è¦å‘æœåŠ¡å™¨é‡æ–°å‘èµ·HTTPè¯·æ±‚ï¼Œå°†ç¼“å­˜è¿‡ç¨‹åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼šå¼ºåˆ¶ç¼“å­˜ä¸åå•†ç¼“å­˜ å¼ºåˆ¶ç¼“å­˜æ¦‚å¿µå¼ºåˆ¶ç¼“å­˜å°±æ˜¯å‘æµè§ˆå™¨ç¼“å­˜æŸ¥æ‰¾å¯¹åº”çš„è¯·æ±‚ç»“æœï¼Œå¹¶æ ¹æ®è¯¥ç»“æœçš„ç¼“å­˜è§„åˆ™æ¥å†³å®šæ˜¯å¦ä½¿ç”¨è¯¥ç¼“å­˜ç»“æœçš„è¿‡ç¨‹ã€‚ åœºæ™¯ä¸€ï¼šä¸å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šé‡æ–°å‘æœåŠ¡å™¨å‘èµ·HTTPè¯·æ±‚ã€‚ åœºæ™¯äºŒï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä½†å·²å¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œé‡‡ç”¨åå•†ç¼“å­˜å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œä½†ç¼“å­˜å·²ç»å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šé‡‡ç”¨åå•†ç¼“å­˜ã€‚ åœºæ™¯ä¸‰ï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥è¿”å›è¯¥ç»“æœå¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”ç¼“å­˜å°šæœªå¤±æ•ˆï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¼“å­˜ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚ è§„åˆ™å¼ºåˆ¶ç¼“å­˜ä¸HTTPå“åº”å¤´ä¸­çš„å­—æ®µCache-Controlå’ŒExpiresæœ‰å…³ï¼ŒCache-Controlä¼˜å…ˆäºExpiresã€‚Cache-Control: HTTP/1.1ï¼Œä¸»è¦å–å€¼å¦‚ä¸‹ï¼š public: å“åº”å¯ä»¥è¢«ä»»ä½•ç¼“å­˜åŒºï¼ˆå®¢æˆ·ç«¯ã€ä»£ç†æœåŠ¡å™¨ï¼‰ç¼“å­˜ private: å“åº”åªå¯ä»¥è¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼ˆCache-Controlé»˜è®¤å€¼ï¼‰ no-cache: å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œä½†éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡ŒéªŒè¯åæ–¹å¯ä½¿ç”¨ no-store: ç¦æ­¢ç¼“å­˜å¯¹å“åº”è¿›è¡Œå¤åˆ¶ max-age=xxx: ç¼“å­˜å°†åœ¨xxxç§’åè¿‡æœŸExpires: HTTP/1.0, é™„åŠ ä¸€ä¸ªExpiresæ—¥æœŸé¦–éƒ¨åˆ°å“åº”ä¸­å»,è¿™ä¸ªæ—¥æœŸä¸ºç»å¯¹æ—¥æœŸï¼Œä¾‹å¦‚ï¼šExpires: Fri, 05 Jul 2002, 05:00:00 GMT åå•†ç¼“å­˜æ¦‚å¿µåå•†ç¼“å­˜å°±æ˜¯åœ¨å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆåï¼Œæµè§ˆå™¨æºå¸¦ç¼“å­˜æ ‡è¯†å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„è¿‡ç¨‹ã€‚ åœºæ™¯ä¸€ï¼š åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å›304å¦‚æœæœåŠ¡å™¨æç¤ºèµ„æºå°šæœªå¤±æ•ˆï¼Œåˆ™è¿”å›304ï¼Œæµè§ˆå™¨å¯ç»§ç»­ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ä¸­è¯¥èµ„æºçš„ç¼“å­˜ç»“æœã€‚ åœºæ™¯äºŒï¼š åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å›200å¦‚æœæœåŠ¡å™¨æç¤ºèµ„æºå°šå·²å¤±æ•ˆï¼Œåˆ™è¿”å›200ï¼ŒæœåŠ¡å™¨é‡æ–°è¿”å›æœ€æ–°çš„èµ„æºï¼Œæµè§ˆå™¨å°†ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ã€‚ è§„åˆ™HTTPå…è®¸ç¼“å­˜å‘åŸå§‹æœåŠ¡å™¨å‘é€ä¸€ä¸ªâ€œæ¡ä»¶GETâ€ï¼Œè¯·æ±‚æœåŠ¡å™¨åªæœ‰åœ¨æ–‡æ¡£ä¸ç¼“å­˜ä¸­ç°æœ‰çš„å‰¯æœ¬ä¸åŒæ—¶ï¼Œæ‰å›é€å¯¹è±¡çš„ä¸»ä½“ã€‚â€”- ã€ŠHTTPæƒå¨æŒ‡å—ã€‹åå•†ç¼“å­˜ä¸HTTPå¤´ä¸­çš„å­—æ®µLast-Modified / If-Modified-Sinceï¼ˆè¯·æ±‚å¤´ï¼‰å’ŒEtag / If-None-Match(è¯·æ±‚å¤´)æœ‰å…³ï¼ŒEtag / If-None-Matchä¼˜å…ˆçº§æ¯”Last-Modified / If-Modified-Sinceé«˜ã€‚Last-Modified / If-Modified-Since:If-Modified-Since:Dateå†éªŒè¯è¯·æ±‚é€šå¸¸è¢«ç§°ä¸ºIMSè¯·æ±‚ï¼Œåªæœ‰æŸä¸ªæ—¥æœŸä¹‹åèµ„æºå‘ç”Ÿäº†æ”¹å˜ï¼ŒIMSè¯·æ±‚æ‰ä¼šæŒ‡ç¤ºæœåŠ¡å™¨æ‰§è¡Œè¯·æ±‚ï¼š1.å¦‚æœè‡ªæŒ‡å®šæ—¥æœŸåï¼Œèµ„æºæ›´æ–°äº†ï¼ŒIf-Modified-Sinceæ¡ä»¶å°±ä¸ºçœŸï¼Œé€šå¸¸GETå°±ä¼šæ‰§è¡Œï¼Œæºå¸¦æ–°é¦–éƒ¨ï¼ˆé™¤äº†å…¶ä»–ä¿¡æ¯è¿˜æœ‰ä¸€ä¸ªæ–°çš„è¿‡æœŸæ—¥æœŸï¼‰çš„æ–°èµ„æºå°±ä¼šè¿”å›ç»™ç¼“å­˜ã€‚2.å¦‚æœè‡ªæŒ‡å®šæ—¥æœŸåï¼Œèµ„æºæœªæ›´æ–°ï¼ŒIf-Modified-Sinceæ¡ä»¶å°±ä¸ºå‡ï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå°çš„304 Not Modified å“åº”æŠ¥æ–‡ï¼Œä¸ºäº†æé«˜æœ‰æ•ˆæ€§ï¼ŒæŠ¥æ–‡ä¸­ä¸ä¼šåŒ…å«èµ„æºçš„ä¸»ä½“ã€‚ä¾‹ï¼šIf-Modified-Since: Sat, 29 Jun 2002, 14:30:00 GMTEtag / If-None-Match å®ä½“æ ‡ç­¾å†éªŒè¯:æœ‰äº›æƒ…å†µï¼ˆå‘¨æœŸæ€§åœ°é‡å†™ã€èµ„æºä¿®æ”¹æ— å½±å“çš„éƒ¨åˆ†ã€æœ‰äº›æœåŠ¡å™¨æ— æ³•å‡†ç¡®åˆ¤æ–­å…¶é¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´ç­‰ç­‰ï¼‰ä¸‹ä»…æ ¹æ®ä¿®æ”¹æ—¥æœŸè¿›è¡Œå†éªŒè¯æ˜¯ä¸å¤Ÿçš„ï¼ŒHTTPå…è®¸ç”¨æˆ·å¯¹è¢«ç§°ä¸ºå®ä½“æ ‡ç­¾ï¼ˆEtagï¼‰çš„â€œç‰ˆæœ¬æ ‡è¯†ç¬¦â€è¿›è¡Œæ¯”è¾ƒã€‚å½“å‘å¸ƒè€…å¯¹èµ„æºè¿›è¡Œä¿®æ”¹æ—¶ï¼Œå°±å¯ä»¥ä¿®æ”¹èµ„æºçš„å®ä½“æ ‡ç­¾æ¥è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚1.å¦‚æœå®ä½“æ ‡ç­¾ä»åŒ¹é…ï¼ŒIf-None-Matchå†éªŒè¯æˆåŠŸï¼Œè¿”å›304 Not Modifiedã€‚2.å¦‚æœæœåŠ¡å™¨ä¸Šçš„å®ä½“æ ‡ç­¾å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ä¸€ä¸ª200 OK å“åº”ä¸­è¿”å›æ–°çš„å†…å®¹åŠç›¸åº”çš„æ–°Etagã€‚ä¾‹ï¼šIf-None-Match: â€œv2.6â€If-None-Match: â€œv2.4â€, â€œv2.5â€ æµè§ˆå™¨çš„ç¼“å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿæµè§ˆå™¨çš„ç¼“å­˜é€šå¸¸å­˜æ”¾å…¥ç¡¬ç›˜ï¼ˆfrom disk cacheï¼‰æˆ–å†…å­˜ï¼ˆfrom memory cacheï¼‰ã€‚ from disk cacheç¡¬ç›˜ç¼“å­˜(from disk cache)åˆ™æ˜¯ç›´æ¥å°†ç¼“å­˜å†™å…¥ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œè¯»å–ç¼“å­˜éœ€è¦å¯¹è¯¥ç¼“å­˜å­˜æ”¾çš„ç¡¬ç›˜æ–‡ä»¶è¿›è¡ŒI/Oæ“ä½œï¼Œç„¶åé‡æ–°è§£æè¯¥ç¼“å­˜å†…å®¹ï¼Œè¯»å–å¤æ‚ï¼Œé€Ÿåº¦æ¯”å†…å­˜ç¼“å­˜æ…¢ã€‚ from memory cacheå†…å­˜ç¼“å­˜(from memory cache)ï¼šå†…å­˜ç¼“å­˜å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼Œåˆ†åˆ«æ˜¯å¿«é€Ÿè¯»å–å’Œæ—¶æ•ˆæ€§ï¼šå¿«é€Ÿè¯»å–ï¼šå†…å­˜ç¼“å­˜ä¼šå°†ç¼–è¯‘è§£æåçš„æ–‡ä»¶ï¼Œç›´æ¥å­˜å…¥è¯¥è¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œå æ®è¯¥è¿›ç¨‹ä¸€å®šçš„å†…å­˜èµ„æºï¼Œä»¥æ–¹ä¾¿ä¸‹æ¬¡è¿è¡Œä½¿ç”¨æ—¶çš„å¿«é€Ÿè¯»å–ã€‚æ—¶æ•ˆæ€§ï¼šä¸€æ—¦è¯¥è¿›ç¨‹å…³é—­ï¼Œåˆ™è¯¥è¿›ç¨‹çš„å†…å­˜åˆ™ä¼šæ¸…ç©ºã€‚ è§„åˆ™åœ¨æµè§ˆå™¨ä¸­ï¼Œæµè§ˆå™¨ä¼šåœ¨jså’Œå›¾ç‰‡ç­‰æ–‡ä»¶è§£ææ‰§è¡Œåç›´æ¥å­˜å…¥å†…å­˜ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå½“åˆ·æ–°é¡µé¢æ—¶åªéœ€ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¯»å–(from memory cache)ï¼›è€Œcssæ–‡ä»¶åˆ™ä¼šå­˜å…¥ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡æ¸²æŸ“é¡µé¢éƒ½éœ€è¦ä»ç¡¬ç›˜è¯»å–ç¼“å­˜(from disk cache)ã€‚ ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ å‡å°‘äº†æ•°æ®çš„å†—ä½™ä¼ è¾“ ç¼“è§£äº†ç½‘ç»œçš„å¸¦å®½ç“¶é¢ˆé—®é¢˜ å‡è½»äº†æœåŠ¡å™¨çš„è´Ÿæ‹… å‡è½»äº†è·ç¦»æ—¶å»¶ ç¼“å­˜ä¸cookieç¼“å­˜é‚£äº›ä¸cookieäº‹åŠ¡æœ‰å…³çš„æ–‡æ¡£æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œcookieå’Œç¼“å­˜çš„è§„åˆ™æ²¡æœ‰å¾ˆå¥½åœ°å»ºç«‹èµ·æ¥ã€‚ä¸‹é¢æ˜¯å¤„ç†ç¼“å­˜æ—¶çš„ä¸€äº›æŒ‡å¯¼æ€§è§„åˆ™ï¼š å¦‚æœæ— æ³•ç¼“å­˜æ–‡æ¡£ï¼Œè¦å°†å…¶è¡¨ç¤ºå‡ºæ¥ã€‚å¦‚å¯¹ä¸å¯ç¼“å­˜çš„æ–‡æ¡£è®¾ç½®ï¼šCache-Control:no-cache=â€Set-Cookieâ€ï¼Œå¯¹å¯ç¼“å­˜çš„æ–‡æ¡£è®¾ç½®ï¼š Cache-Control:publicã€‚ ç¼“å­˜Set-Cookieé¦–éƒ¨è¦å°å¿ƒã€‚å¦‚æœå‘å¤šä¸ªç”¨æˆ·å‘é€äº†ç›¸åŒçš„Set-Cookieé¦–éƒ¨å¯èƒ½ä¼šç ´åç”¨æˆ·çš„å®šä½ï¼›æœ‰äº›ç¼“å­˜ä¼šåœ¨å°†å“åº”ç¼“å­˜èµ·æ¥ä¹‹å‰åˆ é™¤Set-Cookieé¦–éƒ¨ï¼Œé‚£ä¹ˆè¯·æ±‚ç¼“å­˜çš„æ—¶å€™å®¢æˆ·ç«¯å°±æ‹¿ä¸åˆ°cookieäº†ã€‚å¼ºåˆ¶ç¼“å­˜ä¸åŸå§‹æœåŠ¡å™¨é‡æ–°éªŒè¯æ¯æ¡è¯·æ±‚ï¼Œå¹¶å°†Set-Cookieé¦–éƒ¨åˆå¹¶åˆ°å®¢æˆ·ç«¯çš„å“åº”ä¸­å»ï¼Œå°±å¯ä»¥æ”¹å–„è¿™ç§æƒ…å†µï¼ŒåŸå§‹æœåŠ¡å™¨å¯å‘ç¼“å­˜å‰¯æœ¬æ·»åŠ è¿™ä¸ªé¦–éƒ¨æ¥è¿›è¡Œè¿™ç§éªŒè¯ï¼šCache-Control: must-revalidate, max-age=0 å°å¿ƒå¤„ç†å¸¦æœ‰cookieé¦–éƒ¨çš„è¯·æ±‚å¸¦æœ‰cookieçš„è¯·æ±‚ç»“æœåˆ°è¾¾æ—¶ï¼Œå°±æ˜¯æç¤ºæˆ‘ä»¬ï¼Œè¿™ä¸ªè¯·æ±‚ç»“æœå¯èƒ½æ˜¯ç§æœ‰å†…å®¹ï¼Œå¿…é¡»å°†ç§æœ‰å†…å®¹æ ‡è¯†ä¸ºä¸å¯ç¼“å­˜ã€‚ DNSæ¦‚è§ˆDNSï¼ˆDomain Name Systemï¼ŒåŸŸåè§£æç³»ç»Ÿï¼‰çš„ä½œç”¨æ˜¯å°†ä¸»æœºåï¼ˆhostnameï¼‰è§£æä¸ºå¯¹åº”çš„IPåœ°å€ã€‚DNSæ˜¯ä¸€ä¸ªç”±åˆ†å±‚çš„DNSæœåŠ¡å™¨å®ç°çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä¸€ä¸ªä½¿å¾—ä¸»æœºèƒ½å¤ŸæŸ¥è¯¢åˆ†å¸ƒå¼æ•°æ®åº“çš„åº”ç”¨å±‚åè®®ã€‚DNSåè®®è¿è¡Œåœ¨UDPä¸Šï¼Œä½¿ç”¨53å·ç«¯å£ã€‚ å¸¸è§„æµç¨‹ æµè§ˆå™¨ä»URLä¸­æŠ½å‡ºä¸»æœºåï¼Œå°†å…¶å‘é€ç»™è¿è¡Œä¸­çš„DNSåº”ç”¨å®¢æˆ·ç«¯ã€‚ DNSå®¢æˆ·ç«¯å‘DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ä¸»æœºåçš„è¯·æ±‚ã€‚ DNSå®¢æˆ·ç«¯ä¼šæ”¶åˆ°æ¥è‡ªDNSæœåŠ¡å™¨çš„å›ç­”æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸ä¸»æœºåå¯¹åº”çš„IPåœ°å€ã€‚ æµè§ˆå™¨è·å–åˆ°IPåœ°å€ï¼Œå‘ä½äºè¯¥åœ°å€çš„æœåŠ¡å™¨è¿›ç¨‹çš„æŸä¸ªç«¯å£ï¼ˆHTTPä¸º80ç«¯å£ï¼ŒHTTPSä¸º443ç«¯å£ï¼‰å‘èµ·ä¸€ä¸ªTCPè¿æ¥ã€‚ åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­çš„DNSæœåŠ¡å™¨å¤§è‡´æœ‰ä¸‰ç§ï¼Œæ ¹DNSæœåŠ¡å™¨ã€é¡¶çº§åŸŸDNSæœåŠ¡å™¨ã€æƒå¨DNSæœåŠ¡å™¨ã€‚æ ¹DNSæœåŠ¡å™¨â€”&gt;é¡¶çº§åŸŸDNSæœåŠ¡å™¨â€”&gt;æƒå¨DNSæœåŠ¡å™¨ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ã€‚å¦‚æœè¦æŸ¥è¯¢www.baidu.comå¯¹åº”çš„IPåœ°å€ï¼ŒæŸ¥è¯¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼ˆåˆ†çº§æŸ¥è¯¢ï¼‰ï¼š é¦–å…ˆè·Ÿæ ¹æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—é¡¶çº§åŸŸåcomçš„TLDæœåŠ¡å™¨çš„IPåœ°å€ã€‚ ç„¶åTLDæœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—baidu.comæƒå¨æœåŠ¡å™¨çš„IPåœ°å€ã€‚ æœ€åä¸baidu.comæƒå¨æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—ä¸»æœºåwww.baidu.comå¯¹åº”çš„IPåœ°å€ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç±»DNSæœåŠ¡å™¨å¾ˆé‡è¦ï¼Œå³ï¼šæœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆå°½ç®¡å®ƒä¸åœ¨DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­ï¼‰ã€‚æ¯ä¸ªISPéƒ½æœ‰ä¸€ä¸ªæœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå½“ä¸»æœºä¸è¯¥ISPè¿æ¥æ—¶ï¼ŒISPä¼šè¿”å›ä¸€ä¸ªIPåœ°å€ï¼Œè¯¥åœ°å€å…·æœ‰ä¸€å°æˆ–å¤šå°çš„æœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚å½“ä¸»æœºå‘èµ·DNSè¯·æ±‚æ—¶ï¼Œè¯·æ±‚è¢«å‘é€åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå®ƒèµ·ç€ä»£ç†å’Œå°†è¯·æ±‚è½¬å‘åˆ°DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­ï¼ˆç±»ä¼¼HTTPçš„ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚ä»è¯·æ±‚ä¸»æœºåˆ°æœ¬åœ°DNSæœåŠ¡å™¨çš„æŸ¥è¯¢æ˜¯é€’å½’æŸ¥è¯¢ï¼ˆå› ä¸ºæŸ¥è¯¢è¯·æ±‚æ˜¯ä»¥è‡ªå·±çš„åä¹‰ï¼ŒæŸ¥è¯¢ç»“æœç›´æ¥è¿”å›ç»™è¯·æ±‚ä¸»æœºï¼‰ï¼Œå…¶ä½™ä¸ºè¿­ä»£æŸ¥è¯¢ï¼ˆæŸ¥è¯¢è¯·æ±‚æ˜¯ä»¥æœ¬åœ°DNSæœåŠ¡å™¨ä¸ºåä¹‰ï¼Œè¿”å›çš„ç»“æœä¹Ÿæ˜¯ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼‰ DNSç¼“å­˜ä¸ºäº†æ”¹å–„å®éªŒæ€§èƒ½å¹¶å‡å°‘åœ¨å› ç‰¹ç½‘ä¸Šåˆ°å¤„ä¼ æ’­çš„DNSæŠ¥æ–‡æ•°é‡ï¼ŒDNSå¹¿æ³›ä½¿ç”¨äº†ç¼“å­˜æŠ€æœ¯ã€‚åœ¨ä¸€ä¸ªè¯·æ±‚é“¾ä¸­ï¼Œå½“æŸä¸ªDNSæœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªDNSå›ç­”æ—¶ï¼Œå®ƒèƒ½å°†è¯¥ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°å­˜å‚¨å™¨ä¸­ï¼ˆä¾‹å¦‚ï¼Œå…±ç”¨ä¸€ä¸ªISPçš„å°æ˜ã€å°çº¢ï¼Œå¦‚æœå°æ˜æŸ¥è¯¢äº†www.baidu.comçš„IPåœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªIPåœ°å€å°±å­˜åœ¨äº†æœ¬åœ°DNSæœåŠ¡å™¨ä¸­ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆå‰ï¼Œå°çº¢å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°DNSæœåŠ¡å™¨ä¸­è·å–åˆ°www.baidu.comçš„IPåœ°å€ï¼‰ã€‚æœ¬åœ°æœåŠ¡å™¨èƒ½å¤Ÿç¼“å­˜é¡¶çº§åŸŸæœåŠ¡å™¨çš„IPåœ°å€ï¼Œå› è€Œå…è®¸æœ¬åœ°DNSç»•è¿‡æŸ¥è¯¢é“¾ä¸­çš„æ ¹DNSæœåŠ¡å™¨ã€‚ TCPè¿æ¥ä¸€ä¸ªTCPè¿æ¥æ˜¯ç”±ä¸€å¯¹ç«¯ç‚¹æˆ–å¥—æ¥å­—æ„æˆï¼Œå…¶ä¸­é€šä¿¡çš„æ¯ä¸€ç«¯éƒ½ç”±ä¸€å¯¹ï¼ˆIPåœ°å€ï¼Œç«¯å£å·ï¼‰æ‰€å”¯ä¸€æ ‡è¯†ã€‚ä¸€ä¸ªTCPè¿æ¥é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå¯åŠ¨ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ã€æ•°æ®ä¼ è¾“ã€é€€å‡ºï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰ã€‚ ä¸‰æ¬¡æ¡æ‰‹æ¦‚è§ˆå¦‚å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯ä¸­çš„TCPä¼šç”¨ä¸€ä¸‹æ–¹å¼ä¸æœåŠ¡å™¨ä¸­TCPå»ºç«‹ä¸€æ¡TCPè¿æ¥ï¼š ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯çš„TCPé¦–å…ˆå‘æœåŠ¡å™¨çš„TCPå‘é€ä¸€ä¸ªç‰¹æ®Šçš„TCPæŠ¥æ–‡æ®µï¼Œè¯¥æŠ¥æ–‡æ®µä¸åŒ…å«åº”ç”¨å±‚çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨æŠ¥æ–‡æ®µçš„é¦–éƒ¨ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼ˆå³SYNæ¯”ç‰¹ï¼‰è¢«ç½®ä¸º1ï¼Œå› æ­¤è¿™ä¸ªç‰¹æ®ŠæŠ¥æ–‡æ®µè¢«ç§°ä¸ºSYNæŠ¥æ–‡æ®µã€‚å®¢æˆ·ç«¯ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·ï¼ˆJï¼‰å¹¶å°†æ­¤åºå·æ”¾ç½®äºè¯¥èµ·å§‹çš„TCP SYNæŠ¥æ–‡æ®µçš„åºå·å­—æ®µé‡Œï¼Œæ•´ä¸ªæŠ¥æ–‡å­—æ®µä¼šå°è£…åœ¨ä¸€ä¸ªIPæ•°æ®æŠ¥ä¸­å¹¶å‘ç»™æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥SYN-SENTçŠ¶æ€ã€‚ ç¬¬äºŒæ­¥ï¼Œä¸€æ—¦åŒ…å«TCP SYNæŠ¥æ–‡æ®µçš„IPæ•°æ®æŠ¥åˆ°è¾¾äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±ä¼šä»æ•°æ®æŠ¥ä¸­æå–å‡ºTCP SYNæŠ¥æ–‡æ®µï¼Œä¸ºè¯¥TCPè¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å…è®¸è¿æ¥çš„æŠ¥æ–‡æ®µï¼ˆACK(J + 1)ï¼‰ï¼Œè¯¥æŠ¥æ–‡æ®µä¹Ÿä¸åŒ…å«åº”ç”¨å±‚æ•°æ®ã€‚ä¸æ­¤åŒæ—¶æœåŠ¡å™¨ä¹Ÿéšæœºé€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·ï¼ˆKï¼‰å¹¶å°†æ­¤åºå·æ”¾ç½®äºTCPæŠ¥æ–‡æ®µé¦–éƒ¨çš„åºå·å­—æ®µä¸­ï¼Œå³ï¼ˆSYN(K)ï¼‰,éšç¡®è®¤å­—æ®µACKä¸€å¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚æ­¤æŠ¥æ–‡å­—æ®µé€šå¸¸è¢«ç§°ä¸ºSYNACKæŠ¥æ–‡æ®µï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN-RECEIVEDçŠ¶æ€ã€‚ ç¬¬ä¸‰æ­¥ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°SYNACKæŠ¥æ–‡æ®µï¼Œä¸ºè¯¥è¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDçŠ¶æ€ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¦å¤–ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µæ˜¯å¯¹æœåŠ¡å™¨çš„å…è®¸è¿æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼ˆACK(K + 1)ï¼‰ï¼Œä¸å‰ä¸¤æ¬¡ä¸åŒï¼Œè¿™æ¬¡æŠ¥æ–‡æ®µä¸­å¯æºå¸¦åº”ç”¨å±‚æ•°æ®ï¼Œç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼ŒSYNæ¯”ç‰¹è¢«ç½®ä¸º0ã€‚æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µåï¼Œä¹Ÿè¿›å…¥ESTABISHEDçŠ¶æ€ã€‚å®Œæˆè¿™ä¸‰ä¸ªæ­¥éª¤åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ¯ä¸€ä¸ªæŠ¥æ–‡æ®µä¸­éƒ½å¯ä»¥æºå¸¦åº”ç”¨å±‚çš„æ•°æ®ï¼Œä¸”SYNæ¯”ç‰¹éƒ½å°†è¢«ç½®ä¸º0ã€‚å»ºç«‹TCPè¿æ¥çš„ä¸‰ä¸ªæ­¥éª¤ä¹Ÿè¢«ç§°ä¸ºTCPä¸‰æ¬¡æ¡æ‰‹ã€‚ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„ä¸ä»…åœ¨äºè®©é€šä¿¡åŒæ–¹äº†è§£ä¸€ä¸ªè¿æ¥æ­£åœ¨å»ºç«‹ï¼Œ è¿˜åœ¨äºåˆ©ç”¨æ•°æ®åŒ…çš„é€‰é¡¹æ¥æ‰¿è½½ç‰¹æ®Šçš„ä¿¡æ¯ï¼Œäº¤æ¢åˆå§‹åºåˆ—å·ã€‚â€”â€”-ã€ŠTCP/IP è¯¦è§£ å·ä¸€ï¼šåè®®ã€‹ ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿä¸‰æ¬¡æ¡æ‰‹ï¼šAâ€”-&gt;B: [A: Iâ€™m A.]Bâ€”-&gt;A: [B: Hello A, Iâ€™m B.]Aâ€”-&gt;B: [A: Hello B, nice to meet you.]ç„¶åæ„‰å¿«çš„py äºŒæ¬¡æ¡æ‰‹ï¼šAâ€”-&gt;B: [Iâ€™m A.]Bâ€”-&gt;A: [Hello A, Iâ€™m B.]å¦‚æœAæ”¶åˆ°äº†â€œHello A,Iâ€™m Bâ€ï¼Œæ„‰å¿«çš„pyå¦‚æœAæ²¡æœ‰æ”¶åˆ°â€œHello A,Iâ€™m Bâ€ï¼Œé‚£ä¹ˆwhile(true){ Aâ€”-&gt;B: [Iâ€™m A.] }, ç–¯ç‹‚æ¡æ‰‹ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ç¡®è®¤Aâ€”&gt;B, Bâ€”&gt;Aè¿™ä¸¤ä¸ªä¿¡é“éƒ½æ˜¯å¯é çš„ï¼›å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹å°±æ— æ³•ç¡®è®¤Bâ€”&gt;Açš„ä¿¡é“æ˜¯å¦å¯é ã€‚å¦‚æœåªéœ€è¦Aâ€”&gt;Bä¿¡é“å¯é ï¼Œé‚£å°±ç±»ä¼¼äºUDPçš„éœ€æ±‚äº†ã€‚ å››æ¬¡æŒ¥æ‰‹æ¦‚è§ˆè¿æ¥çš„ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥å‘èµ·å…³é—­è¿æ¥ï¼Œåœ¨ä¼ ç»Ÿæƒ…å†µä¸‹å¾€å¾€ç”±å®¢æˆ·ç«¯æ¥å‘èµ·å…³é—­è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¬¬ä¸€æ­¥ï¼šå®¢æˆ·ç«¯å‘é€FINåŒ…ï¼ˆåŒ…å«äº†å®¢æˆ·ç«¯çš„åºåˆ—å·M)ï¼Œæ­¤å¤–FINåŒ…è¿˜åŒ…å«äº†ä¸€ä¸ªACKæ®µç”¨äºç¡®è®¤å¯¹æ–¹æœ€åä¸€æ¬¡å‘é€çš„æ•°æ®ã€‚ ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„FINåŒ…åï¼Œå°†Må€¼+1ä½œä¸ºå“åº”çš„ACKå€¼ï¼Œè¡¨æ˜å®ƒå·²ç»æˆåŠŸæ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯å‘é€çš„FINã€‚æ­¤æ—¶ï¼Œå¤„äºä¸Šå±‚çš„åº”ç”¨ç¨‹åºä¼šè¢«å‘ŠçŸ¥è¿æ¥çš„å¦ä¸€æ–¹å‘èµ·äº†å…³é—­è¿æ¥çš„è¯·æ±‚ï¼Œè¿™å°†å¯¼è‡´åº”ç”¨ç¨‹åºå‘åŠ¨è‡ªå·±çš„å…³é—­æ“ä½œã€‚æœåŠ¡å™¨ä»è¢«åŠ¨å…³é—­è€…å˜ä¸ºä¸»åŠ¨å…³é—­è€…ï¼Œå‘å®¢æˆ·ç«¯å‘é€FIN(åŒ…å«äº†æœåŠ¡å™¨çš„åºåˆ—å·N)ã€‚ ç¬¬ä¸‰æ­¥ï¼šä¸ºäº†å®Œæˆè¿æ¥çš„å…³é—­ï¼Œå®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨æœ€åçš„æŠ¥æ–‡æ®µä¸­åŒ…å«äº†ä¸€ä¸ªç¡®è®¤æœåŠ¡å™¨å‘é€çš„FINçš„ACKå­—æ®µã€‚ ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿå››æ¬¡æŒ¥æ‰‹ï¼šA â€”&gt; B, [A: â€˜æˆ‘æƒ³å…³é—­è¿æ¥â€™]B â€”&gt; A, [B: â€˜å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œæˆ‘ä¸è¦æ”¶åˆ°ä½ çš„ä¸œè¥¿äº†â€™]B â€”&gt; A, [B: â€˜æˆ‘æƒ³å…³é—­è¿æ¥â€™]A â€”&gt; B, [A: â€˜å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œæˆ‘ä¹Ÿä¸è¦æ”¶åˆ°ä½ çš„ä¸œè¥¿äº†â€™]ä¸»åŠ¨æ–¹å‘é€å…³é—­è¯·æ±‚ï¼Œè¢«åŠ¨æ–¹æ¥å—å¹¶ç¡®è®¤è¯·æ±‚åï¼Œè¢«åŠ¨æ–¹å°±æ— æ³•æ”¶åˆ°ä¸»åŠ¨æ–¹å‘é€çš„æ•°æ®äº†ã€‚åœ¨å‰ä¸¤æ¬¡æŒ¥æ‰‹åï¼ŒæœåŠ¡å™¨å°±æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®äº†ï¼ˆæœåŠ¡å™¨é‡Šæ”¾äº†å…³äºå®¢æˆ·ç«¯çš„èµ„æºï¼‰ï¼Œä½†æ˜¯æœåŠ¡å™¨å¯ä»¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæ‰€ä»¥æœ‰äº†ç¬¬ä¸‰æ¬¡ã€ç¬¬å››æ¬¡æŒ¥æ‰‹ã€‚ é¡µé¢å‘¨æœŸæ¦‚è§ˆé¡µé¢æ„å»ºDOM TreeStyle RulesRendering Treeäº‹ä»¶å¤„ç†å‚è€ƒæ–‡çŒ®ï¼š å½»åº•ç†è§£æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ å›¾è§£TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡åˆ†æ‰‹ ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ ã€ŠJavaScriptå¿è€…ç§˜ç±ã€‹ ã€Šè®¡ç®—æœºç½‘ç»œï¼ˆè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼‰ã€‹]]></content>
      <categories>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Webç¼“å­˜</tag>
        <tag>ç½‘ç»œ</tag>
        <tag>æµè§ˆå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å°ç¨‹åºå¼€å‘ä½“éªŒï¼ˆå¾®ä¿¡VSæ”¯ä»˜å®ï¼‰]]></title>
    <url>%2F2018%2F04%2F14%2Fwx-my-miniApp%2F</url>
    <content type="text"><![CDATA[æ¡†æ¶å¾®ä¿¡æ”¯ä»˜å®å®ç°åŸç†å¾®ä¿¡æ”¯ä»˜å®å¼€å‘å·¥å…·å¾®ä¿¡æ”¯ä»˜å®ç”Ÿæ€å¾®ä¿¡æ”¯ä»˜å®æ€§èƒ½å¾®ä¿¡æ”¯ä»˜å®æ€»ç»“]]></content>
      <categories>
        <category>å‰ç«¯ç”Ÿæ€</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8]]></title>
    <url>%2F2018%2F04%2F14%2Fasync-await%2F</url>
    <content type="text"><![CDATA[åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8ä»¥å‰ï¼ŒJavaScripté¡¹ç›®ä¼šé€æ¸â€˜å¤±å»æ§åˆ¶â€™ï¼Œå…¶ä¸­ä¸»è¦ä¸€ä¸ªåŸå› å°±æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œä¸€æ—¦ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å°±éš¾å…ä¹¦å†™ä¸€äº›å†—é•¿ã€å¤æ‚ã€åµŒå¥—çš„ä»£ç å—ï¼ˆå›è°ƒåœ°ç‹±ï¼‰ï¼Œè¿™ä¼šä¸¥é‡é™ä½ä»£ç çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚ç°åœ¨ï¼ŒJavaScriptæä¾›äº†ä¸€ç§æ–°çš„è¯­æ³•ç³–æ¥å–ä»£å›è°ƒå‡½æ•°ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ç®€æ˜ã€å¯è¯»æ€§é«˜çš„å¼‚æ­¥ä»£ç ã€‚ èƒŒæ™¯AJAXå…ˆæ¥å›é¡¾ä¸€ä¸‹å†å²ã€‚åœ¨20ä¸–çºª90å¹´ä»£åæœŸï¼ŒAjaxæ˜¯å¼‚æ­¥JavaScriptçš„ç¬¬ä¸€ä¸ªé‡å¤§çªç ´ã€‚è¿™ä¸€æŠ€æœ¯å…è®¸ç½‘ç«™åœ¨åŠ è½½HTMLåè·å–å¹¶æ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„æƒ³æ³•ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå¤§å¤šæ•°ç½‘ç«™ä¼šå†æ¬¡ä¸‹è½½æ•´ä¸ªé¡µé¢æ¥æ˜¾ç¤ºæ›´æ–°çš„å†…å®¹ã€‚è¿™ä¸€æŠ€æœ¯(åœ¨jQueryä¸­ä»¥ajaxçš„åç§°æµè¡Œ)ä¸»å¯¼äº†2000-2010çš„webå¼€å‘å¹¶ä¸”Ajaxæ˜¯ç›®å‰ç½‘ç«™ç”¨æ¥è·å–æ•°æ®çš„ä¸»è¦æŠ€æœ¯ï¼Œä½†æ˜¯XMLåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–ä»£äº†JSONã€‚ NodeJSå½“NodeJSåœ¨2009å¹´é¦–æ¬¡å‘å¸ƒæ—¶ï¼ŒæœåŠ¡å™¨ç«¯ç¯å¢ƒçš„ä¸»è¦ç„¦ç‚¹æ˜¯å…è®¸ç¨‹åºä¼˜é›…åœ°å¤„ç†å¹¶å‘æ€§ã€‚å¤§å¤šæ•°æœåŠ¡å™¨ç«¯è¯­è¨€é€šè¿‡é˜»å¡ä»£ç æ¥å¤„ç†I/Oæ“ä½œï¼Œç›´åˆ°æ“ä½œå®Œæˆä¸ºæ­¢ã€‚ç›¸åï¼ŒNodeJSä½¿ç”¨çš„æ˜¯äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œè¿™æ ·å¼€å‘äººå‘˜å¯ä»¥åœ¨éé˜»å¡å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œè°ƒç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†é€»è¾‘ï¼ˆç±»ä¼¼äºAjaxçš„å·¥ä½œæ–¹å¼ï¼‰ã€‚ Promiseså‡ å¹´åï¼ŒNodeJSå’Œæµè§ˆå™¨ç¯å¢ƒä¸­å‡ºç°äº†ä¸€ç§æ–°çš„æ ‡å‡†ï¼Œç§°ä¸ºâ€Promiseâ€ï¼ŒPromiseæä¾›äº†ä¸€ç§å¼ºå¤§çš„ã€æ ‡å‡†åŒ–çš„æ–¹å¼æ¥ç»„æˆå¼‚æ­¥æ“ä½œã€‚Promiseä»ç„¶ä½¿ç”¨åŸºäºå›è°ƒçš„æ ¼å¼ï¼Œä½†ä¸ºé“¾å¼å’Œç»„åˆå¼‚æ­¥æ“ä½œæä¾›äº†ä¸€è‡´çš„è¯­æ³•ã€‚åœ¨2015å¹´ï¼Œç”±æµè¡Œçš„å¼€æºåº“æ‰€å€¡å¯¼çš„Promiseæœ€ç»ˆè¢«æ·»åŠ ä¸ºJavaScriptçš„åŸç”Ÿç‰¹æ€§ã€‚Promiseæ˜¯ä¸€ä¸ªä¸é”™çš„æ”¹è¿›ï¼Œä½†å®ƒä»¬ä»ç„¶å¸¸å¸¸æ˜¯ä¸€äº›å†—é•¿è€Œéš¾ä»¥é˜…è¯»çš„ä»£ç å—çš„åŸå› ã€‚è€Œç°åœ¨æœ‰äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚Async/Awaitæ˜¯ä¸€ç§æ–°çš„è¯­æ³•(ä».netå’ŒC#ä¸­å€Ÿç”¨)ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç¼–å†™Promiseï¼Œä½†å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥ä»£ç ï¼Œæ²¡æœ‰å›è°ƒï¼Œå¯ä»¥ç”¨æ¥ç®€åŒ–å‡ ä¹ä»»ä½•ç°æœ‰çš„JSåº”ç”¨ç¨‹åºã€‚Async/Awaitæ˜¯JavaScriptè¯­è¨€çš„æ–°å¢çš„ç‰¹æ€§ï¼Œåœ¨ES7ä¸­è¢«æ­£å¼æ·»åŠ ä¸ºJavaScriptçš„åŸç”Ÿç‰¹æ€§ã€‚ ç¤ºä¾‹æˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥å±•ç¤ºAsync/Awaitçš„é­…åŠ› *æ³¨ï¼šè¿è¡Œä¸‹é¢çš„ç¤ºä¾‹ä¸éœ€è¦ä»»ä½•åº“ã€‚Async/Awaitå·²ç»è¢«æœ€æ–°ç‰ˆæœ¬çš„Chromeã€FireFoxã€Safariã€Edgeå®Œå…¨æ”¯æŒï¼Œä½ å¯ä»¥åœ¨ä½ çš„æµè§ˆå™¨æ§åˆ¶å°é‡Œè¿è¡Œä¾‹å­ã€‚Async/Awaitéœ€è¦è¿è¡Œåœ¨NodeJS 7.6ç‰ˆæœ¬åŠä»¥ä¸Šï¼ŒåŒæ—¶ä¹Ÿè¢«Babelã€TypeScriptè½¬è¯‘å™¨æ”¯æŒã€‚æ‰€ä»¥Async/Awaitå¯ä»¥è¢«ç”¨äºå®é™…å¼€å‘ä¹‹ä¸­ã€‚* å‡†å¤‡æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„APIç±»ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„ç”µè„‘ä¸Šè¿è¡Œã€‚è¿™ä¸ªç±»é€šè¿‡è¿”å›promiseæ¥æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œpromiseè¢«è°ƒç”¨åï¼Œ200msåä¼šå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚12345678910111213141516171819202122232425262728293031class Api &#123; constructor () &#123; this.user = &#123; id: 1, name: 'test' &#125; this.friends = [ this.user, this.user, this.user ] this.photo = 'not a real photo' &#125; getUser () &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; resolve(this.user), 200) &#125;) &#125; getFriends (userId) &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; resolve(this.friends.slice()), 200) &#125;) &#125; getPhoto (userId) &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; resolve(this.photo), 200) &#125;) &#125; throwError () &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; reject(new Error('Intentional Error')), 200) &#125;) &#125;&#125; æ¯ä¸ªç¤ºä¾‹ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹ä¸‰ä¸ªæ“ä½œï¼š è·å–ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œè·å–è¯¥ç”¨æˆ·çš„æœ‹å‹ï¼Œ è·å–è¯¥ç”¨æˆ·çš„ç…§ç‰‡ã€‚åœ¨æœ€åï¼Œæˆ‘ä»¬ä¼šåœ¨æ§åˆ¶å°ä¸­æ‰“å°è¿™äº›ç»“æœã€‚ æ–¹æ³•ä¸€ â€” Nested Promise Callback Functionsä½¿ç”¨åµŒå¥—çš„promiseå›è°ƒå‡½æ•°12345678910111213function callbackHell () &#123; const api = new Api() let user, friends api.getUser().then(function (returnedUser) &#123; user = returnedUser api.getFriends(user.id).then(function (returnedFriends) &#123; friends = returnedFriends api.getPhoto(user.id).then(function (photo) &#123; console.log('callbackHell', &#123; user, friends, photo &#125;) &#125;) &#125;) &#125;)&#125; å¯¹äºä»»ä½•ä¸€ä¸ªä»äº‹è¿‡JavaScripté¡¹ç›®å¼€å‘çš„äººæ¥è¯´ï¼Œè¿™ä¸ªä»£ç å—éå¸¸ç†Ÿæ‚‰ã€‚éå¸¸ç®€å•çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯ä»£ç å´æ˜¯å†—é•¿ã€æ·±åµŒå¥—ï¼Œå¹¶ä¸”ä»¥è¿™ä¸ªç»“å°¾â€¦..1234 &#125;) &#125;) &#125;)&#125; åœ¨çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ¯ä¸ªå›è°ƒå‡½æ•°å¯èƒ½æ›´å¤æ‚ï¼Œä»£ç å—ä¼šä»¥ä¸€å †å……æ»¡å±‚æ¬¡æ„Ÿçš„})ä¸ºç»“å°¾ã€‚â€œå›è°ƒå‡½æ•°é‡Œé¢åµŒå¥—ç€å›è°ƒå‡½æ•°åµŒå¥—ç€å›è°ƒå‡½æ•°â€ï¼Œè¿™å°±æ˜¯è¢«ä¼ è¯´ä¸­çš„â€œå›è°ƒåœ°ç‹±â€ï¼ˆâ€œå›è°ƒåœ°ç‹±â€çš„è¯ç”Ÿä¸åªæ˜¯å› ä¸ºä»£ç å—çš„æ··ä¹±ï¼Œä¹Ÿæºäºä¿¡ä»»é—®é¢˜ã€‚ï¼‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–ï¼Œè¿˜æ²¡æœ‰åšé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¦‚æœåŠ ä¸Šäº†rejectâ€¦â€¦ç»†æ€ææ æ–¹æ³•äºŒ â€” Promise Chainè®©æˆ‘ä»¬ä¼˜é›…èµ·æ¥12345678910111213141516function promiseChain () &#123; const api = new Api() let user, friends api.getUser() .then((returnedUser) =&gt; &#123; user = returnedUser return api.getFriends(user.id) &#125;) .then((returnedFriends) =&gt; &#123; friends = returnedFriends return api.getPhoto(user.id) &#125;) .then((photo) =&gt; &#123; console.log('promiseChain', &#123; user, friends, photo &#125;) &#125;)&#125; Promiseæœ‰ä¸€ä¸ªå¾ˆæ£’çš„ç‰¹æ€§ï¼šPromise.prototype.then()å’ŒPromise.prototype.catch()è¿”å›Promiseå¯¹è±¡ï¼Œè¿™å°±ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†è¿™äº›promiseè¿æ¥æˆä¸€ä¸ªpromiseé“¾ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å›è°ƒå‡½æ•°æ”¾åœ¨ä¸€ä¸ªç¼©è¿›å±‚æ¬¡é‡Œã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ç®€åŒ–äº†å›è°ƒå‡½æ•°å£°æ˜ã€‚å¯¹æ¯”ä¹‹å‰çš„å›è°ƒåœ°ç‹±ï¼Œä½¿ç”¨promiseé“¾ä½¿å¾—ä»£ç çš„å¯è¯»æ€§å¤§å¤§æé«˜å¹¶ä¸”æ‹¥æœ‰ç€æ›´å¥½çš„åºåˆ—æ„Ÿï¼Œä½†æ˜¯çœ‹èµ·æ¥è¿˜æ˜¯éå¸¸å†—é•¿å¹¶ä¸”æœ‰ä¸€ç‚¹å¤æ‚ã€‚ æ–¹æ³•ä¸‰ â€” Async/Awaitæˆ‘ä»¬å¯ä¸å¯ä»¥ä¸å†™å›è°ƒå‡½æ•°ï¼Ÿå°±å†™7è¡Œä»£ç èƒ½è§£å†³å—ï¼Ÿ1234567async function asyncAwaitIsYourNewBestFriend () &#123; const api = new Api() const user = await api.getUser() const friends = await api.getFriends(user.id) const photo = await api.getPhoto(user.id) console.log('asyncAwaitIsYourNewBestFriend', &#123; user, friends, photo &#125;)&#125; ä¼˜é›…å¤šäº†ï¼Œè°ƒç”¨awaitä¹‹å‰æˆ‘ä»¬ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°promiseè¢«å†³è®®å¹¶å°†å€¼èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡ã€‚é€šè¿‡async/awaitï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¼‚æ­¥æ“ä½œæµç¨‹è¿›è¡Œæ§åˆ¶ï¼Œå°±å¥½åƒå®ƒæ˜¯åŒæ­¥ä»£ç ã€‚ æ³¨ï¼šawaitå¿…é¡»æ­é…asyncä¸€èµ·ä½¿ç”¨ï¼Œæ³¨æ„ä¸Šé¢çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†å…³é”®å­—asyncæ”¾åœ¨äº†å‡½æ•°çš„å£°æ˜å‰ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚ç¨åï¼Œæˆ‘ä»¬ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜ å¾ªç¯Async/Awaitå¯ä»¥è®©ä»¥å‰å¾ˆå¤šå¤æ‚çš„ä»£ç å˜å¾—ç®€æ˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŒ‰åºæ£€ç´¢æ¯ä¸ªç”¨æˆ·çš„æœ‹å‹çš„æœ‹å‹åˆ—è¡¨ã€‚ æ–¹æ³•ä¸€ â€” Recursive Promise Loopä¸‹é¢æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„promiseæ¥æŒ‰åºè·å–æ¯ä¸ªæœ‹å‹çš„æœ‹å‹åˆ—è¡¨1234567891011121314151617181920function promiseLoops () &#123; const api = new Api() api.getUser() .then((user) =&gt; &#123; return api.getFriends(user.id) &#125;) .then((returnedFriends) =&gt; &#123; const getFriendsOfFriends = (friends) =&gt; &#123; if (friends.length &gt; 0) &#123; let friend = friends.pop() return api.getFriends(friend.id) .then((moreFriends) =&gt; &#123; console.log('promiseLoops', moreFriends) return getFriendsOfFriends(friends) &#125;) &#125; &#125; return getFriendsOfFriends(returnedFriends) &#125;)&#125; æˆ‘ä»¬åˆ›å»ºåœ¨promiseLoopsä¸­åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç”¨äºé€’å½’åœ°å»è·å–æœ‹å‹çš„æœ‹å‹åˆ—è¡¨ã€‚è¿™ä¸ªå‡½æ•°ä½“ç°äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªç®€å•çš„ä»»åŠ¡è€Œè¨€ï¼Œè¿™ä¾æ—§æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è§£å†³æ–¹æ¡ˆã€‚ æ–¹æ³•äºŒ â€” Async/Await For-Loopè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹Async/Await12345678910async function asyncAwaitLoops () &#123; const api = new Api() const user = await api.getUser() const friends = await api.getFriends(user.id) for (let friend of friends) &#123; let moreFriends = await api.getFriends(friend.id) console.log('asyncAwaitLoops', moreFriends) &#125;&#125; ä¸éœ€è¦å†™é€’å½’promiseé—­åŒ…ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªforå¾ªç¯å°±èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚ å¹¶è¡Œä¸€ä¸ªä¸€ä¸ªåœ°å»è·å–æœ‹å‹çš„æœ‹å‹çš„åˆ—è¡¨çœ‹èµ·æ¥æœ‰ç‚¹æ…¢ï¼Œä¸ºä»€ä¹ˆä¸å¹¶è¡Œå¤„ç†è¯·æ±‚å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨async/awaitæ¥å¤„ç†å¹¶è¡Œä»»åŠ¡å—ï¼Ÿå½“ç„¶12345678async function asyncAwaitLoopsParallel () &#123; const api = new Api() const user = await api.getUser() const friends = await api.getFriends(user.id) const friendPromises = friends.map(friend =&gt; api.getFriends(friend.id)) const moreFriends = await Promise.all(friendPromises) console.log('asyncAwaitLoopsParallel', moreFriends)&#125; ä¸ºäº†å¹¶è¡Œè¯·æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªpromiseæ•°ç»„å¹¶å°†å®ƒä¼ é€’ç»™æ–¹æ³•Promise.all()ï¼ŒPromise.all()ä¼šè¿”å›ä¸€ä¸ªpromiseï¼Œä¸€æ—¦æ‰€æœ‰çš„è¯·æ±‚å®Œæˆå°±ä¼šå†³è®®ã€‚ é”™è¯¯å¤„ç†ç„¶è€Œï¼Œåœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­æœ‰ä¸€ä¸ªä¸»è¦çš„é—®é¢˜è¿˜æ²¡è§£å†³ï¼šé”™è¯¯å¤„ç†ã€‚åœ¨å¼‚æ­¥æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªæ“ä½œç¼–å†™å•ç‹¬çš„é”™è¯¯å¤„ç†å›è°ƒï¼Œåœ¨è°ƒç”¨æ ˆçš„é¡¶éƒ¨å»æ‰¾å‡ºæ­£ç¡®çš„æŠ¥é”™ä½ç½®å¯èƒ½å¾ˆå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åœ¨æ¯ä¸ªå›è°ƒå¼€å§‹æ—¶å°±å»æ£€æŸ¥æ˜¯å¦æŠ›å‡ºäº†é”™è¯¯ã€‚æ‰€ä»¥ï¼Œå¼•å…¥é”™è¯¯å¤„ç†åçš„å›è°ƒå‡½æ•°ä¼šæ¯”ä¹‹å‰å¤æ‚åº¦æˆå€å¢åŠ ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨å®šä½åˆ°æŠ¥é”™çš„ä½ç½®ï¼Œè¿™äº›é”™è¯¯ç”šè‡³ä¼šè¢«â€œåæ‰â€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç»™ä¹‹å‰çš„ä¾‹å­æ·»ä¸Šé”™è¯¯å¤„ç†æœºåˆ¶ã€‚ä¸ºäº†æµ‹è¯•é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨çœŸæ­£è·å–åˆ°ç”¨æˆ·å›¾ç‰‡ä¹‹å‰ä½¿ç”¨æŠ½è±¡ç±»é‡Œçš„api.throwError()æ–¹æ³•ã€‚ æ–¹æ³•ä¸€ â€” Promise Error Callbacksè®©æˆ‘ä»¬çœ‹çœ‹æœ€åçš„æƒ…å†µ123456789101112131415161718192021222324function callbackErrorHell () &#123; const api = new Api() let user, friends api.getUser().then(function (returnedUser) &#123; user = returnedUser api.getFriends(user.id).then(function (returnedFriends) &#123; friends = returnedFriends api.throwError().then(function () &#123; console.log('Error was not thrown') api.getPhoto(user.id).then(function (photo) &#123; console.log('callbackErrorHell', &#123; user, friends, photo &#125;) &#125;, function (err) &#123; console.error(err) &#125;) &#125;, function (err) &#123; console.error(err) &#125;) &#125;, function (err) &#123; console.error(err) &#125;) &#125;, function (err) &#123; console.error(err) &#125;)&#125; ä»£ç é™¤äº†åˆé•¿åˆä¸‘é™‹ä»¥å¤–ï¼Œä»£ç æ“ä½œæµä¹Ÿä¸ç›´è§‚ï¼Œä¸åƒåŒæ­¥ã€å¯è¯»æ€§é«˜çš„ä»£ç é‚£æ ·ä»ä¸Šå¾€ä¸‹ã€‚ æ–¹æ³•äºŒ â€” Promise Chain â€œCatchâ€ Methodæˆ‘ä»¬å¯ä»¥ç»™promiseé“¾æ·»åŠ catchæ–¹æ³•æ¥æ”¹å–„ä¸€äº›1234567891011121314151617181920212223function callbackErrorPromiseChain () &#123; const api = new Api() let user, friends api.getUser() .then((returnedUser) =&gt; &#123; user = returnedUser return api.getFriends(user.id) &#125;) .then((returnedFriends) =&gt; &#123; friends = returnedFriends return api.throwError() &#125;) .then(() =&gt; &#123; console.log('Error was not thrown') return api.getPhoto(user.id) &#125;) .then((photo) =&gt; &#123; console.log('callbackErrorPromiseChain', &#123; user, friends, photo &#125;) &#125;) .catch((err) =&gt; &#123; console.error(err) &#125;)&#125; çœ‹èµ·æ¥å¥½å¤šäº†ï¼Œæˆ‘ä»¬é€šè¿‡ç»™promiseæ·»åŠ ä¸€ä¸ªé”™è¯¯å¤„ç†å–ä»£äº†ä¹‹å‰ç»™æ¯ä¸ªå›è°ƒå‡½æ•°æ·»åŠ é”™è¯¯å¤„ç†ã€‚ä½†æ˜¯ï¼Œè¿™è¿˜æ˜¯æœ‰ä¸€ç‚¹å¤æ‚å¹¶ä¸”æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å›è°ƒæ¥å¤„ç†å¼‚æ­¥é”™è¯¯è€Œä¸æ˜¯åƒå¯¹å¾…æ­£å¸¸çš„JavaScripté”™è¯¯é‚£æ ·å¤„ç†å®ƒä»¬ã€‚ æ–¹æ³•ä¸‰ â€” Normal Try/Catch Blockæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½123456789101112131415async function aysncAwaitTryCatch () &#123; try &#123; const api = new Api() const user = await api.getUser() const friends = await api.getFriends(user.id) await api.throwError() console.log('Error was not thrown') const photo = await api.getPhoto(user.id) console.log('async/await', &#123; user, friends, photo &#125;) &#125; catch (err) &#123; console.error(err) &#125;&#125; æˆ‘ä»¬å°†å¼‚æ­¥æ“ä½œæ”¾è¿›äº†å¤„ç†åŒæ­¥ä»£ç çš„try/catchä»£ç å—ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åƒå¯¹å¾…åŒæ­¥ä»£ç çš„ä¸€æ ·å¤„ç†å¼‚æ­¥ä»£ç çš„é”™è¯¯ã€‚ä»£ç çœ‹èµ·æ¥éå¸¸ç®€æ˜ ç»„åˆæˆ‘åœ¨å‰é¢æåŠäº†ä»»ä½•ä»¥asyncçš„å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªpromiseã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥çœŸæ­£è½»æ¾åœ°ç»„åˆå¼‚æ­¥æ§åˆ¶æµä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ•´ç†å‰é¢çš„ä¾‹å­ï¼Œå°†è·å–æ•°æ®å’Œå¤„ç†æ•°æ®åˆ†å¼€ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒç”¨asyncå‡½æ•°è·å–æ•°æ®ã€‚12345678910111213async function getUserInfo () &#123; const api = new Api() const user = await api.getUser() const friends = await api.getFriends(user.id) const photo = await api.getPhoto(user.id) return &#123; user, friends, photo &#125;&#125;function promiseUserInfo () &#123; getUserInfo().then((&#123; user, friends, photo &#125;) =&gt; &#123; console.log('promiseUserInfo', &#123; user, friends, photo &#125;) &#125;)&#125; æ›´æ£’çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®æ¥å—å‡½æ•°é‡Œä½¿ç”¨async/awaitï¼Œè¿™å°†ä½¿å¾—æ•´ä¸ªå¼‚æ­¥æ¨¡å—æ›´åŠ æ˜æ˜¾ã€‚å¦‚æœæˆ‘ä»¬è¦è·å–å‰é¢10ä¸ªç”¨æˆ·çš„æ•°æ®å‘¢ï¼Ÿ1234567async function getLotsOfUserData () &#123; const users = [] while (users.length &lt; 10) &#123; users.push(await getUserInfo()) &#125; console.log('getLotsOfUserData', users)&#125; å¹¶å‘å‘¢ï¼Ÿå¹¶ä¸”åŠ ä¸Šé”™è¯¯å¤„ç†å‘¢ï¼Ÿ123456789async function getLotsOfUserDataFaster () &#123; try &#123; const userPromises = Array(10).fill(getUserInfo()) const users = await Promise.all(userPromises) console.log('getLotsOfUserDataFaster', users) &#125; catch (err) &#123; console.error(err) &#125;&#125; ç»“è®ºéšç€SPAçš„å…´èµ·å’ŒNodeJSçš„å¹¿æ³›åº”ç”¨ï¼Œå¯¹äºJavaScriptå¼€å‘äººå‘˜æ¥è¯´ï¼Œä¼˜é›…åœ°å¤„ç†å¹¶å‘æ€§æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½è¦é‡è¦ã€‚Async/Awaitç¼“è§£äº†è®¸å¤šå› ä¸ºbugå¼•èµ·ä¸”å·²ç»å½±å“JavaScriptå¾ˆå¤šå¹´çš„æ§åˆ¶æµé—®é¢˜ï¼Œå¹¶ä¸”ä½¿å¾—ä»£ç æ›´åŠ ä¼˜é›…ã€‚å¦‚ä»Šï¼Œä¸»æµçš„æµè§ˆå™¨å’ŒNodeJSéƒ½å·²ç»æ”¯æŒäº†è¿™äº›è¯­æ³•ç³–ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯ä½¿ç”¨Async/Awaitçš„æœ€å¥½æ—¶æœºã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://blog.patricktriest.com/what-is-async-await-why-should-you-care/æ˜é‡‘åœ°å€ï¼šhttps://juejin.im/post/5ad1cab8f265da238a30e137]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ˜é‡‘ç¿»è¯‘è®¡åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡Nginxåå‘ä»£ç†è·¨åŸŸ]]></title>
    <url>%2F2018%2F04%2F08%2FCross-Origin-using-Nginx%2F</url>
    <content type="text"><![CDATA[ç”±äºé¡¹ç›®å‰åç«¯åˆ†ç¦»ä¸”åç«¯çœŸå®æ¥å£å·²å‡ºï¼Œæ‰€ä»¥æˆ‘å¼€å‘æ—¶é¦–å…ˆè€ƒè™‘é€šè¿‡è·¨åŸŸè·å–çœŸå®æ¥å£æ•°æ®é…åˆå‰ç«¯å¼€å‘ã€‚ï¼ˆèµ¶å·¥æœŸå•Šï¼šï¼‰æ ¹æ®create-react-appå®˜æ–¹æç¤ºï¼Œåœ¨package.jsonä¸­æ·»åŠ å­—æ®µ&quot;proxy&quot;: &quot;http://admin.xiaoyaoeden.top&quot;emmmğŸ¤­æ— æ•ˆ ğŸ˜‚æ‰€ä»¥æ”¹ä¸ºä½¿ç”¨Nginxåå‘ä»£ç†è·¨åŸŸğŸ˜Šcurrent originï¼šhttp://localhost:3000target originï¼šhttp://admin.xiaoyaoeden.top å®‰è£…brew install nginx ä¿®æ”¹é…ç½®é¦–å…ˆè¿›å…¥nginxçš„é…ç½®æ–‡ä»¶ vim /usr/local/etc/nginx/nginx.conf å¢åŠ å¦‚ä¸‹ä¸€ä¸ªserver 12345678910111213server &#123; listen 3001; server_name localhost; location / &#123; proxy_pass http://localhost:3000; &#125; location /api/ &#123; add_header Access-Control-Allow-Origin *; proxy_pass http://admin.xiaoyaoeden.top; &#125; &#125; é‡å¯NginxæœåŠ¡1nginx -s reload æµ‹è¯•æ‰“å¼€localhost:3001ï¼Œè·¨åŸŸé—®é¢˜è§£å†³äº†ï¼Œç°åœ¨å¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„æµ‹è¯•æ¥å£å•¦]]></content>
      <categories>
        <category>å®è·µ</category>
      </categories>
      <tags>
        <tag>è·¨åŸŸ</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¸­çš„ç±»å‹ï¼ˆäºŒï¼‰â€”â€”â€”â€” å¼ºåˆ¶ç±»å‹è½¬æ¢]]></title>
    <url>%2F2018%2F02%2F15%2Ftype-juggling%2F</url>
    <content type="text"><![CDATA[å¼•å…¥JavaScriptä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ç»å¸¸è®©äººè¯Ÿç—…ï¼Œä½†æ˜¯ä¹Ÿå¹¶éä¸€æ— æ˜¯å¤„ã€‚å°†å€¼ä»ä¸€ç§ç±»å‹è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ç§°ä¸ºç±»å‹è½¬æ¢ï¼Œéšå¼è½¬æ¢ç§°ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼›ä¸æ­¤åŒæ—¶ä¹Ÿæœ‰å¦å¤–ä¸€ç§åŒºåˆ†æ–¹å¼ï¼Œç±»å‹è½¬æ¢å‘ç”Ÿåœ¨é™æ€è¯­è¨€ç¼–è¯‘é˜¶æ®µè€Œå¼ºåˆ¶ç±»å‹å‘ç”Ÿåœ¨åŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶ã€‚åœ¨JavaScriptä¸­ï¼Œç»Ÿç§°ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ˜¾éšä¹‹åˆ†å¤šå–å†³äºç¼–ç è€…æ˜¯å¦çŸ¥é“è½¬æ¢çš„æ•ˆæœå’Œå‰¯ä½œç”¨ã€‚]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[â€œå·¥ä½œå®¤æ‹›æ–°é¡µé¢é¡¹ç›®â€å®è·µä¸­é‡åˆ°çš„é—®é¢˜ï¼ˆä¸€ï¼‰â€”â€”â€”â€” Reactç»„ä»¶é€šä¿¡]]></title>
    <url>%2F2018%2F02%2F13%2FReact-Problem-1%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å­¦äº†ReactåŸºç¡€çŸ¥è¯†ï¼Œæ‰€ä»¥æœ‰æ‰“ç®—åšä¸€ä¸ªé¡¹ç›®æ¥è¸©å‘ï¼Œæ°å¥½é€‚é€¢å¤§äºŒå¯’å‡å¹¶ä¸”å·¥ä½œå®¤æ°å¥½éœ€è¦åœ¨å¼€å­¦åæ‹›æ–°ï¼Œæ‰€ä»¥å¤©æ—¶åœ°åˆ©äººå’Œï¼Œæˆ‘å°±ç”¨Reactä½œä¸ºè¿™ä¸ªé¡¹ç›®çš„æŠ€æœ¯æ ˆã€‚äºæ˜¯é¡¹ç›®å¼€å‘ä¸­çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±è¯ç”Ÿäº†â€”â€”â€”â€”Reactç»„ä»¶é€šä¿¡ é—®é¢˜æ¥æºmaterial-uiä¸­çš„ç»„ä»¶AppBarå’ŒDrawerä¹‹é—´çš„é€šä¿¡ï¼ŒäºŒè€…ä¸ºå…„å¼Ÿç»„ä»¶ã€‚ AppBarç»„ä»¶ Drawerç»„ä»¶ åŠŸèƒ½éœ€æ±‚ï¼š æˆ‘éœ€è¦ç‚¹å‡»AppBarçš„å·¦ä¾§çš„iconè°ƒå‡ºDrawerã€‚ ç‚¹å‡»Drawerä¸­çš„MenuItemè·³è½¬åˆ°å…¶ä»–é¡µé¢ è°ƒå‡ºDraweråç‚¹å‡»éDrawerç»„ä»¶åæ”¶èµ·Drawerã€‚ è§£å†³æ–¹æ¡ˆé€šè®¯æ˜¯å•å‘çš„ï¼Œæ•°æ®å¿…é¡»æ˜¯ç”±ä¸€æ–¹ä¼ åˆ°å¦ä¸€æ–¹ã€‚ çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„é€šä¿¡åœ¨ React ä¸­ï¼Œçˆ¶ç»„ä»¶å¯ä»¥å‘å­ç»„ä»¶é€šè¿‡ä¼  props çš„æ–¹å¼ï¼Œå‘å­ç»„ä»¶è¿›è¡Œé€šè®¯ã€‚1234567891011121314151617181920212223242526class Parent extends Component &#123; constructor() &#123; this.state = &#123; msg: 'ä»Šå¤©æ˜¯æƒ…äººèŠ‚è€¶' &#125;; &#125; render() &#123; return ( &lt;div&gt; &lt;Child msg=&#123;this.state.msg&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class Child extends Component &#123; constructor(props) &#123; super(props); &#125; render() &#123; return ( &lt;p&gt;this.props.msg&lt;/p&gt; ) &#125;&#125; å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„é€šä¿¡å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼ŒåŒæ ·éœ€è¦çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’propsï¼Œä¸è¿‡è¿™æ¬¡æ˜¯ä¼ é€’çš„æ˜¯ä»¥çˆ¶ç»„ä»¶è‡ªèº«ä¸ºä½œç”¨åŸŸçš„å‡½æ•°ï¼Œå­ç»„ä»¶è´Ÿè´£è°ƒç”¨ï¼Œå°†è¦ä¼ é€’çš„ä¿¡æ¯ä¼ å…¥å‡½æ•°ä¸­ï¼Œä½œä¸ºå‚æ•°ï¼Œä¼ é€’åˆ°çˆ¶ç»„ä»¶çš„ä½œç”¨åŸŸä¸­ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445class Parent extends Component &#123; constructor() &#123; this.state = &#123; msg: 'ä»Šå¤©æ˜¯æƒ…äººèŠ‚è€¶' &#125;; this.transferMsg = this.transferMsg.bind(this); &#125; componentDidMount() &#123; console.log(this.state.msg); &#125; componentDidUpdate() &#123; console.log(this.state.msg); &#125; transferMsg(msg) &#123; this.setState(&#123; msg: msg &#125;); &#125; render() &#123; return ( &lt;div&gt; &lt;Child transferMsg=&#123;this.transferMsg&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class Child extends Component &#123; constructor(props) &#123; super(props); this.msg = 'æˆ‘ä¹Ÿå–œæ¬¢ä½ '; &#125; componentDidMount() &#123; this.props.transferMsg(this.msg); &#125; render() &#123; return ( &lt;p&gt;æƒ…äººèŠ‚å•Š&lt;/p&gt; ) &#125;&#125; å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡å› ä¸ºAppBarå’ŒDrawerä¸ºå…„å¼Ÿç»„ä»¶ï¼Œå®ƒä»¬çš„å…±åŒç‚¹æ˜¯æ‹¥æœ‰ä¸€ä¸ªç›¸åŒçš„çˆ¶ç»„ä»¶ã€‚å…ˆçœ‹çœ‹ç»„ä»¶ç»“æ„ï¼š1234&lt;Nav&gt; &lt;AppBar /&gt; &lt;Drawer /&gt;&lt;/Nav&gt; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†çˆ¶ç»„ä»¶Navä½œä¸ºä¸­è½¬ç«™ï¼ŒAppBarä¼ é€’ä¿¡æ¯ç»™Navï¼ŒNavå†å°†ä¿¡æ¯ä¼ é€’ç»™Drawer;Draweä¼ é€’ä¿¡æ¯ç»™AppBarä¸æ­¤ç±»ä¼¼ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼Œæˆ‘ä»¬å°†Drawerçš„å¼€å…³çŠ¶æ€æ”¾åœ¨äº†Navçš„stateä¸­ï¼Œå£°æ˜äº†æ›´æ”¹openå€¼çš„transferMsgå‡½æ•°ï¼Œç„¶åå°†è¿™ä¸ªå‡½æ•°åˆ†åˆ«ä¼ é€’ä¸ªNavBarå’ŒDrawerï¼Œè¿™æ ·ä»¥æ¥çœŸæ­£æ§åˆ¶opençš„å€¼å°±æ˜¯NavBarå’ŒDrawerç»„ä»¶ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576class Nav extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; open: false &#125; this.transferMsg = this.transferMsg.bind(this); &#125; transferMsg() &#123; this.setState(&#123; open: !this.state.open &#125;); &#125; render() &#123; return ( &lt;nav&gt; &lt;NavBar transferMsg=&#123;this.transferMsg&#125;/&gt; &lt;NavDrawer msg=&#123;this.state.open&#125; transferMsg=&#123;this.transferMsg&#125; /&gt; &lt;/nav&gt; ); &#125;&#125;class NavBar extends Component &#123; constructor(props) &#123; super(props); this.handleMenuClick = this.handleMenuClick.bind(this); &#125; handleMenuClick(event) &#123; this.props.transferMsg(); &#125; render() &#123; return ( &lt;AppBar title="CTG Club" iconClassNameRight="mudiocs-icon-navigation-expand-more" onLeftIconButtonClick=&#123;this.handleMenuClick&#125; /&gt; ); &#125;&#125;class NavDrawer extends Component &#123; constructor(props) &#123; super(props); this.handleToggle= this.handleToggle.bind(this); this.handleClose = this.handleClose.bind(this); &#125; handleToggle() &#123; this.props.transferMsg(); &#125; handleClose() &#123; this.props.transferMsg(); &#125; render() &#123; return ( &lt;Drawer docked=&#123;false&#125; width=&#123;200&#125; open=&#123;this.props.msg&#125; onRequestChange=&#123;this.handleToggle&#125; &gt; &lt;/Drawer&gt; ) &#125;&#125; è¿™ä¸ªé¡¹ç›®ä¸­çš„é—®é¢˜è¿åˆƒè€Œè§£ã€‚è¿™ä»£ç ç»“æ„ï¼Œä»¿ä½›è¿˜æœ‰ä¸€ç‚¹ä¸œè¥¿ã€‚ å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼å®šä¹‰å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼åˆå«è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚åœ¨ JavaScriptå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨äº‹ä»¶æ¨¡å‹æ¥æ›¿ä»£ä¼ ç»Ÿçš„å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ã€‚ ####è¿ç”¨1.å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼å¯ä»¥å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œåªæ˜¯ä¸€ç§æ›¿ä»£å›è°ƒå‡½æ•°çš„æ–¹æ¡ˆã€‚2ã€‚å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼å¯ä»¥å–ä»£å¯¹è±¡ä¹‹é—´ç¡¬ç¼–ç çš„é€šçŸ¥æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡ä¸å†æ˜¾å¼è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ¥å£ï¼Œè®©ä¸¤ä¸ªå¯¹è±¡æ¾è€¦åˆåœ°è”ç³»åœ¨ä¸€èµ·ã€‚ï¼ˆè¿™ä¸€ç‚¹å°±å¯ä»¥ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆçš„ä¸è¶³çš„åœ°æ–¹ï¼‰ å®ä¾‹æœ€è¿‘ä¸€å¹´é‡åº†æˆ¿ä»·è¹­è¹­å¾€ä¸Šæ¶¨ï¼Œå°æ˜è¿«äºå®¶é‡Œçš„å‹åŠ›ï¼Œæ‰“ç®—åœ¨è§£æ”¾ç¢‘ä¹°ç½®ä¸€å¥—æ€»ä»·200ä¸‡çš„ä¸‰å±…å®¤ã€‚å°æ˜åˆ°äº†å”®æ¥¼å¤„æ‰å‘ç°å¿ƒä»ªçš„æˆ¿å­å·²ç»è¢«åˆ«äººä¹°äº†ï¼Œä¸è¿‡åç»­è¿˜æœ‰ä¸€äº›å°¾æˆ¿æ¨å‡ºï¼Œä½†æ˜¯å¼€å‘å•†ä¹Ÿä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™æ¨å‡ºè¿™äº›å°¾æˆ¿ã€‚äºæ˜¯å”®æ¥¼MMè®°ä¸‹äº†å°æ˜çš„ç”µè¯ï¼Œç­”åº”ä»–å°¾æˆ¿ä¸€æ—¦æ¨å‡ºå°±æ‰“ç”µè¯ç»™ä»–ã€‚åç»­å°ç ä¹Ÿç•™äº†å·ç ï¼Œæ¯å¤©ç­‰ç€å”®æ¥¼MMçš„ç”µè¯ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼çš„ä¾‹å­ï¼Œé€»è¾‘ä»£ç å®ç°å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859//æŠŠå‘å¸ƒâ€”è®¢é˜…çš„åŠŸèƒ½æå–å‡ºæ¥ï¼Œæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡å†…:const event = &#123; clientList: [], listen(key, fn) &#123; if (!this.clientList[key]) &#123; //å¦‚æœè¿˜æ²¡æœ‰è®¢é˜…è¿‡æ­¤ç±»æ¶ˆæ¯ï¼Œç»™è¯¥ç±»æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ—è¡¨ this.clientList[key] = []; &#125; this.clientList[key].push(fn); // è®¢é˜…çš„æ¶ˆæ¯æ·»åŠ è¿›æ¶ˆæ¯ç¼“å­˜åˆ—è¡¨ &#125;, trigger(...message) &#123; let key = Array.prototype.shift.call(message), //å–å‡ºæ¶ˆæ¯ç±»å‹ fns = this.clientList[key]; //å–å‡ºè¯¥æ¶ˆæ¯å¯¹åº”çš„å›è°ƒå‡½æ•°é›†åˆ if (!fns || fns.length === 0) &#123; //å¦‚æœæ²¡æœ‰è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œåˆ™è¿”å› return false; &#125; for (let i = 0, fn = fns[i++]; ) &#123; fn.apply(this, message); //messageæ˜¯å‘å¸ƒæ¶ˆæ¯æ—¶é™„é€çš„å‚æ•° &#125; &#125;, remove(key, fn) &#123; let fns = this.clientList[key]; if (!fns) &#123; // å¦‚æœ key å¯¹åº”çš„æ¶ˆæ¯æ²¡æœ‰è¢«äººè®¢é˜…ï¼Œåˆ™ç›´æ¥è¿”å› return false; &#125; if (!fn) &#123; //// å¦‚æœæ²¡æœ‰ä¼ å…¥å…·ä½“çš„å›è°ƒå‡½æ•°ï¼Œè¡¨ç¤ºéœ€è¦å–æ¶ˆ key å¯¹åº”æ¶ˆæ¯çš„æ‰€æœ‰è®¢é˜… fns &amp;&amp; (fns.length = 0); &#125; else &#123; for (let i = fns.length - 1; i &gt;= 0; i--) &#123; // åå‘éå†è®¢é˜…çš„å›è°ƒå‡½æ•°åˆ—è¡¨ let _fn = fns[i]; if (_fn === fn) &#123; fns.splice(i, 1); // åˆ é™¤è®¢é˜…è€…çš„å›è°ƒå‡½æ•° &#125; &#125; &#125;; &#125;&#125;;//å†å®šä¹‰ä¸€ä¸ª installEvent å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç»™æ‰€æœ‰çš„å¯¹è±¡éƒ½åŠ¨æ€å®‰è£…å‘å¸ƒâ€”è®¢é˜…åŠŸèƒ½:const installEvent = function (obj) &#123; for (let i in event) &#123; obj[i] = event[i]; &#125;&#125;;const salesOffices = &#123;&#125;;installEvent(salesOffices);salesOffices.listen('squareMeter88', fn1 = function (price) &#123; console.log('ä»·æ ¼= ' + price);&#125;);salesOffices.listen('squareMeter88', fn2 = function (price) &#123; console.log('ä»·æ ¼= ' + price);&#125;);salesOffices.remove('squareMeter88', fn1); // åˆ é™¤å°æ˜çš„è®¢é˜…// å°æ˜è®¢é˜…æ¶ˆæ¯// å°çº¢è®¢é˜…æ¶ˆæ¯salesOffices.trigger('squareMeter88', 2000000); // è¾“å‡º:2000000 å¯¹äºæ­¤é¡¹ç›®ä¸­é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185/*onã€oneï¼šon ä¸ one å‡½æ•°ç”¨äºè®¢é˜…è€…ç›‘å¬ç›¸åº”çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶å“åº”æ—¶çš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œon ä¸ one çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œä½¿ç”¨ one è¿›è¡Œè®¢é˜…çš„å‡½æ•°ï¼Œåªä¼šè§¦å‘ä¸€æ¬¡ï¼Œè€Œ ä½¿ç”¨ on è¿›è¡Œè®¢é˜…çš„å‡½æ•°ï¼Œæ¯æ¬¡äº‹ä»¶å‘ç”Ÿç›¸åº”æ—¶éƒ½ä¼šè¢«è§¦å‘ã€‚triggerï¼štrigger ç”¨äºå‘å¸ƒè€…å‘å¸ƒäº‹ä»¶ï¼Œå°†é™¤ç¬¬ä¸€å‚æ•°ï¼ˆäº‹ä»¶åï¼‰çš„å…¶ä»–å‚æ•°ï¼Œä½œä¸ºæ–°çš„å‚æ•°ï¼Œè§¦å‘ä½¿ç”¨ one ä¸ on è¿›è¡Œè®¢é˜…çš„å‡½æ•°ã€‚offï¼šç”¨äºè§£é™¤æ‰€æœ‰è®¢é˜…äº†æŸä¸ªäº‹ä»¶çš„æ‰€æœ‰å‡½æ•°ã€‚*/const eventProxy = &#123; onObj: &#123;&#125;, oneObj: &#123;&#125;, on: function(key, fn) &#123; if (this.onObj[key] === undefined) &#123; this.onObj[key] = []; &#125; this.onObj[key].push(fn); &#125;, one: function(key, fn) &#123; if (this.oneObj[key] === undefined) &#123; this.oneObj[key] = []; &#125; this.oneObj[key].push(fn); &#125;, off: function(key) &#123; this.onObj[key] = []; this.oneObj[key] = []; &#125;, trigger: function(...args) &#123; let key; if (args.length === 0) &#123; return false; &#125; key = args[0]; args = [].concat(Array.prototype.slice.call(args, 1)); if (this.onObj[key] !== undefined &amp;&amp; this.onObj[key].length &gt; 0) &#123; for (let i in this.onObj[key]) &#123; this.onObj[key][i].apply(null, args); &#125; &#125; if (this.oneObj[key] !== undefined &amp;&amp; this.oneObj[key].length &gt; 0) &#123; for (let i in this.oneObj[key]) &#123; this.oneObj[key][i].apply(null, args); this.oneObj[key][i] = undefined; &#125; this.oneObj[key] = []; &#125; &#125;&#125;;const BranchItemDatas = [ &#123; name: 'Webç ”å‘éƒ¨', imgUrl: null, imgTitle: null, intro: null, key:1 &#125;, &#123; name: 'ç§»åŠ¨å¼€å‘éƒ¨', imgUrl: null, imgTitle: null, intro: null, key: 2 &#125;, &#123; name: 'è§†è§‰è®¾è®¡éƒ¨', imgUrl: null, imgTitle: null, intro: null, key: 3 &#125;, &#123; name: 'äº§å“è¿è¥éƒ¨', imgUrl: null, imgTitle: null, intro: null, key: 4 &#125;, &#123; name: 'è¿ç»´å®‰å…¨éƒ¨', imgUrl: null, imgTitle: null, intro: null, key: 5 &#125;];class Nav extends Component &#123; render() &#123; return ( &lt;nav&gt; &lt;NavBar /&gt; &lt;NavDrawer /&gt; &lt;/nav&gt; ); &#125;&#125;class NavBar extends Component &#123; constructor(props) &#123; super(props); this.handleMenuClick = this.handleMenuClick.bind(this); &#125; handleMenuClick() &#123; eventProxy.trigger('open', true); &#125; render() &#123; return ( &lt;AppBar title="CTG Club" onLeftIconButtonClick=&#123;this.handleMenuClick&#125; /&gt; ); &#125;&#125;class NavDrawer extends Component &#123; constructor(props) &#123; super(props); this.handleToggle = this.handleToggle.bind(this); this.handleClose = this.handleClose.bind(this); this.state = &#123; open: false &#125; &#125; handleToggle() &#123; this.setState(&#123; open: !this.state.open &#125;) &#125; handleClose() &#123; this.setState(&#123; open: false &#125;) &#125; componentDidMount() &#123; eventProxy.on('open', () =&gt; &#123; this.setState(&#123; open: true &#125;); &#125;); eventProxy.on('close', () =&gt; &#123; this.setState(&#123; open: false &#125;); &#125;); &#125; render() &#123; return ( &lt;Drawer docked=&#123;false&#125; width=&#123;200&#125; open=&#123;this.state.open&#125; onRequestChange=&#123;this.handleToggle&#125; &gt; &lt;MenuItems /&gt; &lt;/Drawer&gt; ) &#125;&#125;class MenuItems extends Component &#123; handleMenuItemClick() &#123; eventProxy.trigger('close', false); &#125; render() &#123; return ( &lt;ul className='normal-list'&gt; &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;0&#125;&gt;é¦–é¡µ&lt;/MenuItem&gt; &#123;BranchItemDatas.map((item) =&gt; &#123; return ( &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;item.key&#125;&gt;&#123;item.name&#125;&lt;/MenuItem&gt; ); &#125;)&#125; &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;6&#125;&gt;å…³äºCTG&lt;/MenuItem&gt; &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;7&#125;&gt;è”ç³»æˆ‘ä»¬&lt;/MenuItem&gt; &lt;/ul&gt; ) &#125;&#125; å…³äºå‚è€ƒä¹¦ç±æˆ–åšæ–‡ï¼šã€ŠJavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹â€œReact ç»„ä»¶é—´é€šè®¯â€â€”â€”â€”â€”æ·˜å®å‰ç«¯å›¢é˜Ÿ æƒ…äººèŠ‚å¿«ä¹å•Šæƒ…äººèŠ‚å¿«ä¹å•Šæƒ…äººèŠ‚å¿«ä¹å•Šæƒ…äººèŠ‚å¿«ä¹å•Š]]></content>
      <categories>
        <category>å®è·µ</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>Redux</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Learning PostCSS(ä¸€)]]></title>
    <url>%2F2018%2F02%2F07%2FpostCSS-1%2F</url>
    <content type="text"><![CDATA[å¼•å…¥PostCSSæ˜¯ç›®å‰CSSå¤„ç†å™¨ä¸­æœ€æµè¡Œçš„ä¸€ä¸ªå¤„ç†å™¨ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚å®ƒä¸ç­‰åŒäºSassã€Lessç­‰é¢„å¤„ç†å™¨ï¼Œä¹Ÿä¸ç­‰åŒäºCompassï¼ˆCompasså·²ç»æ­»äº†ï¼‰è¿™æ ·çš„åå¤„ç†å™¨ï¼Œå°½ç®¡å®ƒå¸¦æœ‰Postè¿™ä¸ªè‹±æ–‡å•è¯ã€‚PostCSSçš„åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼šç¬¬ä¸€ï¼ŒæŠŠCSSè§£ææˆJavaScriptå¯ä»¥æ“ä½œçš„AST(Abstact Syntax tree,æŠ½è±¡è¯­æ³•æ ‘);ç¬¬äºŒï¼Œè°ƒç”¨æ’ä»¶æ¥å¤„ç†ASTå¹¶å¾—åˆ°ç»“æœã€‚PostCSSçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶ä¸æ–­å‘å±•çš„æ’ä»¶ç”Ÿæ€ã€‚ åˆ›å»ºå˜é‡å’Œæ··åˆå®]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>PostCSS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2018%2F02%2F06%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¸­çš„ç±»å‹ï¼ˆä¸€ï¼‰â€”â€”â€”â€” ç±»å‹]]></title>
    <url>%2F2018%2F02%2F06%2Ftype-js%2F</url>
    <content type="text"><![CDATA[å¼•å…¥ç±»å‹ï¼šå¯¹è¯­è¨€å¼•æ“å’Œå¼€å‘äººå‘˜æ¥è¯´ï¼Œç±»å‹æ˜¯å€¼çš„å†…éƒ¨ç‰¹å¾ï¼Œå®ƒå®šä¹‰äº†å€¼çš„è¡Œä¸ºï¼Œä»¥ä½¿å…¶åŒºåˆ«äºå…¶ä»–å€¼ã€‚JavaScriptæ˜¯ä¸€é—¨å¼±ç±»å‹ï¼ˆåå‘å®¹å¿éšå¼ç±»å‹è½¬æ¢ï¼‰è¯­è¨€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹ï¼ˆç¼–è¯‘çš„æ—¶å€™å°±çŸ¥é“æ¯ä¸ªå˜é‡çš„ç±»å‹ï¼‰è¯­è¨€ã€‚æ²¡æœ‰ä¸¥æ ¼çš„ç±»å‹çš„é™åˆ¶ï¼Œä½¿å¾—JavaScriptæˆä¸ºäº†ä¸€é—¨ç‰¹åˆ«çµæ´»çš„è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†ä¸€äº›éº»çƒ¦ï¼Œä¾‹å¦‚å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ å†…ç½®ç±»å‹JavaScriptä¸­æš‚æ—¶æœ‰7ç§å†…ç½®ç±»å‹ï¼š ç©ºå€¼ï¼ˆnullï¼‰ æœªå®šä¹‰ï¼ˆundefinedï¼‰ å¸ƒå°”å€¼ï¼ˆbooleanï¼‰ æ•°å­—ï¼ˆnumberï¼‰ å­—ç¬¦ä¸²ï¼ˆstringï¼‰ å¯¹è±¡ï¼ˆobjectï¼‰ ç¬¦å·ï¼ˆsymbolï¼‰é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡typeofæ“ä½œç¬¦æ¥æŸ¥çœ‹å€¼çš„ç±»å‹ï¼Œå®ƒä¼šè¿”å›ç±»å‹çš„å­—ç¬¦ä¸²å€¼ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è¿™ä¸ƒç§ç±»å‹å’Œå®ƒä»¬çš„å­—ç¬¦ä¸²å€¼å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”ã€‚123456789101112131415//ä¸‹é¢å…­ç§ç±»å‹å‡æœ‰åŒåçš„å­—ç¬¦ä¸²å€¼ä¸ä¹‹å¯¹åº”,'==='ä¼šè¿”å›trueã€‚typeof undefined === 'undefined'typeof false === 'boolsean'typeof 3 === 'number'typeof '3' === 'string'typeof &#123;number: 3&#125; === 'object'typeof Symbol() === 'symbol'//å¯¹äºnullç±»å‹ï¼Œå­˜åœ¨ä¸€ä¸ªbugï¼ˆä»JavaScriptè¯ç”Ÿå°±ä¸€ç›´å­˜åœ¨ï¼Œä»¥åä¼°è®¡ä¹Ÿä¼šå­˜åœ¨ï¼‰ï¼Œå¯¹nullè¿›è¡Œtypeofæ“ä½œï¼Œè¿”å›çš„å€¼å±…ç„¶æ˜¯'object'ï¼›typeof null === 'object' //truetypeof null === 'null' //false//æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤åˆæ¡ä»¶æ¥æ£€æµ‹nullå€¼çš„ç±»å‹ï¼šconst a = null;//å¯¹äº&amp;&amp;æ“ä½œï¼Œå¦‚æœè¿ç®—ç¬¦å·¦è¾¹çš„å€¼ä¸ºçœŸï¼Œåˆ™è¯¥è¡¨è¾¾å¼ç›´æ¥è¿”å›å³è¾¹çš„å€¼ï¼Œä¾‹å¦‚ 'true &amp;&amp; 3'è¡¨è¾¾å¼çš„ç»“æœä¸º3ã€‚(!a &amp;&amp; typeof a === "object"); //true å‡½æ•°å‡½æ•°æ˜¯â€™objectâ€™çš„ä¸€ä¸ªå­ç±»å‹ï¼Œå‡½æ•°æ˜¯ä¸€ä¸ªâ€œå¯è°ƒç”¨å¯¹è±¡â€ï¼Œå®ƒæœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§[[Call]]ï¼Œè¯¥å±æ€§ä½¿å…¶å¯ä»¥è¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¯¹å‡½æ•°è¿›è¡Œtypeofæ“ä½œæ—¶ï¼Œè¿”å›çš„å€¼å¯ä¸æ˜¯â€™objectâ€™ã€‚12typeof function()&#123;&#125; === 'object' //falsetypeof function()&#123;&#125; === 'function' //true æ²¡é”™ï¼Œå°±æ˜¯â€™functionâ€™ã€‚çœ‹èµ·æ¥functionå°±æ˜¯å¦å¤–ä¸€ç§å†…ç½®ç±»å‹ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ã€‚ï¼šï¼‰ å€¼å’Œç±»å‹å˜é‡æ²¡æœ‰ç±»å‹ï¼Œå€¼æ‰æœ‰ç±»å‹JavaScriptä¸­çš„å˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œåªæœ‰å€¼æ‰å…·æœ‰ç±»å‹ï¼Œå˜é‡å¯ä»¥éšæ—¶æŒæœ‰ä»»ä½•ç±»å‹çš„å€¼ã€‚å‰é¢æåˆ°è¿‡ï¼ŒJavaScriptæ˜¯ä¸€é—¨åŠ¨æ€å¼±ç±»å‹çš„è¯­è¨€ã€‚ä¾‹å¦‚ï¼šå˜é‡aæŒæœ‰çš„å€¼ä¸º42ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼çš„ç±»å‹ä¸ºnumberï¼Œå¹¶ä¸”æ— æ³•ç›´æ¥æ›´æ”¹42çš„ç±»å‹ï¼ˆnumberï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡å¼ºåˆ¶è½¬æ¢å°†è¿™42è½¬æ¢ä¸ºâ€™42â€™ï¼Œæ­¤æ—¶å€¼æ‹¥æœ‰çš„ç±»å‹å°±ä¸ºå­—ç¬¦ä¸²ï¼ˆstring)ã€‚ undefined and undeclaredå˜é‡æœªæŒæœ‰å€¼æ—¶ä¸ºundefinedï¼Œæ­¤æ—¶typeofè¿”å›â€™undefinedâ€™ã€‚å·²åœ¨ä½œç”¨åŸŸä¸­å£°æ˜ä½†æœªèµ‹å€¼çš„æ¯”å˜é‡æ˜¯undefinedçš„ï¼Œæœªåœ¨ä½œç”¨åŸŸå£°æ˜è¿‡çš„å˜é‡æ˜¯undeclaredçš„ã€‚123let a;a; //undefinedb; //ReferenceError:b is not definedï¼ŒæŠ¥é”™ æ¯æ¬¡çœ‹åˆ°â€œnot definedâ€,æ€»ä»¥ä¸ºç­‰ä»·äºâ€undefinedâ€ï¼ŒçœŸè®©äººç³Ÿå¿ƒï¼Œè¿˜æœ‰æ›´ç³Ÿå¿ƒçš„ï¼šï¼‰123let a;typeof a; //undefinedtypeof b; //undefined ä¸€å‘è¢«è®¤ä¸ºæ¯”è¾ƒå®‰å…¨çš„æ“ä½œç¬¦typeofä¹Ÿä¼šè¿™æ ·é—¹ç€ç©ï¼šï¼‰æ³¨ï¼šæ¨èä¸€æœ¬å¿…çœ‹çš„ä¹¦ã€ŠJavaScriptè¯­è¨€ç²¾ç²¹ã€‹ï¼Œä½œè€…æ˜¯Douglas Crockfordï¼ˆå¤§ç¥ï¼‰ã€‚ å®‰å…¨é˜²èŒƒæœºåˆ¶å¹¶ä¸æ˜¯æ²¡æœ‰åŠæ³•è®©å¼€å‘äººå‘˜è§£å†³â€™undeclaredâ€™é—®é¢˜ï¼Œæœ‰æ—¶å€™é€šè¿‡typeofçš„å®‰å…¨é˜²èŒƒæœºåˆ¶ï¼ˆé˜»æ­¢æŠ¥é”™ï¼‰æ¥æ£€æŸ¥undeclaredå˜é‡ä¸å¤±ä¸ºä¸€ä¸ªæ–¹æ³•ã€‚å½“ä¸€ä¸ªçª—å£åŠ è½½å¤šä¸ª.jsæ–‡ä»¶æ—¶ï¼Œè¿™äº›.jsæ–‡ä»¶ä¸­çš„ä»£ç ä¼šå…±äº«ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸï¼Œå¦‚æœæœ‰é‡åçš„å˜é‡åï¼Œé‚£ä¹ˆå°±å¤ªå¯æ€•äº†â€¦â€¦å‡å°‘å…¨å±€å˜é‡æ˜¯ç¼–å†™å¯ç»´æŠ¤çš„ä»£ç çš„åŸºç¡€ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½åº”è¯¥è¢«å°è£…åˆ°æ¨¡å—æˆ–è€…ç§æœ‰/ç‹¬ç«‹çš„å‘½åç©ºé—´é‡Œã€‚ä¾‹å¦‚ï¼šè°ƒè¯•æ¨¡å¼ä¸‹ï¼Œåœ¨debug.jså£°æ˜äº†ä¸€ä¸ªDEBUGçš„å…¨å±€å˜é‡ï¼ŒæŠŠå®ƒä½œä¸ºè°ƒè¯•æ¨¡å¼çš„å¼€å…³ï¼Œåœ¨è¾“å‡ºè°ƒè¯•ä¿¡æ¯æ—¶æˆ‘ä»¬ä¼šå…ˆåˆ¤æ–­DEBUGæ˜¯å¦å·²ç»è¢«å£°æ˜ã€‚å¯æ˜¯å¦‚ä½•åœ¨ç¨‹åºä¸­æ£€æŸ¥å…¨å±€å˜é‡DEBUGä¸”ä¸ä¼šå‡ºç°ReferenceErroré”™è¯¯å‘¢ï¼Ÿtypeofçš„å®‰å…¨é˜²èŒƒæœºåˆ¶å°±æˆäº†æˆ‘ä»¬çš„å¸®æ‰‹12345678//è¿™æ ·åšæ˜¯è¦æŒ¨Errorçš„if (DEBUG) &#123; console.log("è°ƒè¯•å¼€å§‹å•°");&#125;//è¿™æ ·å°±æ¯”è¾ƒå®‰å…¨äº†if (typeof DEBUG !== "undefined") &#123; console.log("è°ƒè¯•å¼€å§‹å•°")&#125; ä¸ä»…å¯¹äºè‡ªå®šä¹‰çš„å˜é‡æœ‰ç”¨ï¼Œå¯¹äºå†…å»ºçš„APIä¹Ÿæœ‰å¸®åŠ©ã€‚ç”šè‡³ä¸ä¸€å®šè¦æ±‚ä½œç”¨åŸŸä¸ºå…¨å±€ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ£€æŸ¥æˆ‘ä»¬çš„å˜é‡æ˜¯å¦åœ¨å®¿ä¸»ä½œç”¨åŸŸå£°æ˜è¿‡ã€‚ è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯æ£€æŸ¥æ‰€æœ‰å…¨å±€å˜é‡æ˜¯å¦æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œæµè§ˆå™¨çš„å…¨å±€å¯¹è±¡æ˜¯windowï¼ŒæœåŠ¡å™¨ç«¯çš„å…¨å±€å¯¹è±¡ä¸ºglobalã€‚ä¸Šè¿°çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š123if (window.DEBUG) &#123; //...&#125; è®¿é—®ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§ä¸undeclaredå˜é‡ä¸åŒï¼Œæ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚ å…³äºå‚è€ƒæ–‡çŒ®ï¼šã€Šä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸­å·ï¼‰ã€‹ã€ŠJavaScriptè¯­è¨€ç²¾ç²¹ã€‹]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptä¸­çš„ç»§æ‰¿æ–¹å¼]]></title>
    <url>%2F2018%2F02%2F03%2Finherit-in-js%2F</url>
    <content type="text"><![CDATA[å¼•å…¥ç»§æ‰¿æ˜¯OOPçš„æ ¸å¿ƒå†…å®¹ä¹‹ä¸€ã€‚JavaScriptä¸­å¸¸è§ç»§æ‰¿æ–¹å¼ä¸ºï¼šç±»å¼ç»§æ‰¿ã€æ„é€ å‡½æ•°å¼ç»§æ‰¿ã€ç»„åˆå¼ç»§æ‰¿ã€åŸå‹å¼ç»§æ‰¿ã€å¯„ç”Ÿå¼ç»§æ‰¿ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ã€‚ ç±»å¼ç»§æ‰¿ç±»å¼ç»§æ‰¿ï¼Œé€šè¿‡å­ç±»çš„åŸå‹prototypeå¯¹çˆ¶ç±»çš„å®ä¾‹åŒ–å®ç°ã€‚ç”±äºå­ç±»é€šè¿‡å…¶åŸå‹prototypeå¯¹çˆ¶ç±»å®ä¾‹åŒ–ç»§æ‰¿äº†çˆ¶ç±»ï¼Œæ‰€ä»¥çˆ¶ç±»ä¸­çš„å…±æœ‰å±æ€§è¦æ˜¯å¼•ç”¨ç±»å‹å°±ä¼šåœ¨å­ç±»ä¸­è¢«æ‰€æœ‰å®ä¾‹å…±ç”¨ã€‚ç”±äºå­ç±»å®ç°çš„ç»§æ‰¿æ˜¯é å…¶åŸå‹prototypeå¯¹çˆ¶ç±»çš„å®ä¾‹åŒ–å®ç°çš„ï¼Œå› æ­¤åœ¨åˆ›å»ºçˆ¶ç±»æ—¶æ˜¯æ— æ³•å‘çˆ¶ç±»ä¼ é€’å‚æ•°çš„ï¼Œå› è€Œåœ¨å®ä¾‹åŒ–çˆ¶ç±»æ—¶æ— æ³•å¯¹çˆ¶ç±»æ„é€ å‡½æ•°å†…çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–ã€‚123456789101112131415161718//å£°æ˜çˆ¶ç±»function SuperClass() &#123; this.superValue = true;&#125;//ä¸ºçˆ¶ç±»æ·»åŠ å…±æœ‰æ–¹æ³•SuperClass.prototype.getsuperValue = function() &#123; return this.superValue;&#125;//å£°æ˜å­ç±»function SubClass() &#123; this.subValue = false;&#125;//ç»§æ‰¿çˆ¶ç±»ï¼ˆSubClass.prototype = new SuperClass();//ä¸ºå­ç±»æ·»åŠ å…±æœ‰æ–¹æ³•SubClass.prototype.getsubValue = function () &#123; return this.subValue;&#125; æ„é€ å‡½æ•°å¼ç»§æ‰¿æ„é€ å‡½æ•°ç»§æ‰¿ï¼Œé€šè¿‡åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä½œç”¨ç¯å¢ƒä¸­æ‰§è¡Œä¸€æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®ç°ï¼›ç”±äºæ²¡ç”¨æ¶‰åŠprototypeï¼Œæ‰€ä»¥çˆ¶ç±»çš„åŸå‹æ–¹æ³•ä¸ä¼šè¢«å­ç±»ç»§æ‰¿ã€‚è¦æƒ³è¢«å­ç±»ç»§æ‰¿ï¼Œå°±å¾—æŠŠå±æ€§å’Œå‡½æ•°æ”¾åˆ°çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œå¹¶ä¸”åˆ›å»ºå‡ºæ¥çš„ï¼ˆå­ç±»çš„ï¼‰å®ä¾‹éƒ½ä¼šå•ç‹¬æ‹¥æœ‰ä¸€ä»½ï¼Œè¿èƒŒäº† â€œä»£ç å¤ç”¨â€ã€‚12345678910111213141516//å£°æ˜çˆ¶ç±»function SuperClass(id) &#123; //å¼•ç”¨ç±»å‹å…±æœ‰å±æ€§ this.books = ['JavaScript', 'html', 'css']; //å€¼ç±»å‹å…±æœ‰å±æ€§ this.id = id;&#125;//çˆ¶ç±»å£°æ˜åŸå‹æ–¹æ³•SuperClass.prototype.showBooks = function() &#123; console.log(this.books);&#125;//å£°æ˜å­ç±»function SubClass(id) &#123; //ç»§æ‰¿çˆ¶ç±» SuperClass.call(this, id); //å°†å­ç±»çš„å˜é‡åœ¨çˆ¶ç±»ä¸­éƒ½æ‰§è¡Œä¸€éï¼Œçˆ¶ç±»ä¸­æ˜¯ç»™thisç»‘å®šå±æ€§çš„ï¼Œæ‰€ä»¥é€šè¿‡callå°±ä½¿å¾—å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å…±æœ‰å±æ€§ã€‚&#125; ç»„åˆç»§æ‰¿ç»„åˆç»§æ‰¿ï¼Œå°†ç±»å¼ç»§æ‰¿å’Œæ„é€ å‡½æ•°å¼ç»§æ‰¿ç»¼åˆï¼Œæ„é€ å‡½æ•°ç»§æ‰¿æ—¶æ‰§è¡Œäº†ä¸€éçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåœ¨å®ç°å­ç±»åŸå‹çš„ç±»å¼ç»§æ‰¿åˆè°ƒç”¨ä¸€éçˆ¶ç±»æ„é€ å‡½æ•°ã€‚12345678910111213141516171819function SuperClass(name) &#123; this.name = name; this.books = ["javascript", "html", "css"];&#125;SuperClass.prototype.getName = function () &#123; return this.name;&#125;function SubClass(name, time) &#123; //æ„é€ å‡½æ•°å¼åŸºç¡€çˆ¶ç±»nameå±æ€§ SuperClass.call(this, name); //å­ç±»æ–°å¢å…±æœ‰å±æ€§ this.time = time;&#125;//ç±»å¼ç»§æ‰¿ å­ç±»åŸå‹ç»§æ‰¿çˆ¶ç±»SubClass.prototype = new SuperClass();//å­ç±»åŸå‹æ–¹æ³•SubClass.prototype.getTime = function () &#123; return this.time;&#125; åŸå‹å¼ç»§æ‰¿åŸå‹å¼ç»§æ‰¿ï¼Œå€ŸåŠ©åŸå‹prototypeå¯ä»¥æ ¹æ®å·²æœ‰çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŒæ—¶ä¸å¿…åˆ›å»ºæ–°çš„è‡ªå®šä¹‰å¯¹è±¡ç±»å‹ã€‚123456789//å¯¹ç±»å¼ç»§æ‰¿çš„å°è£…function inheritObejct(o) &#123; //å£°æ˜ä¸€ä¸ªè¿‡æ¸¡å‡½æ•°å¯¹è±¡ function F() &#123;&#125; //è¿‡æ¸¡å¯¹è±¡çš„åŸå‹ç»§æ‰¿çˆ¶å¯¹è±¡ F.prototype = o; //è¿”å›è¿‡æ¸¡å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œ è¯¥å¯¹è±¡çš„åŸå‹ç»§æ‰¿äº†çˆ¶å¯¹è±¡ return new F();&#125; åŸºäºè¿™ç§åœ¨å¯¹è±¡ä¹‹é—´ç›´æ¥æ„å»ºç»§æ‰¿å…³ç³»çš„ç†å¿µï¼ŒDCå¤§ç¥ç»™å‡ºäº†ä¸Šè¿°çš„å‡½æ•°ï¼Œè¿™ä¸ªinheritObjectå‡½æ•°åæ¥è¢«ES5é‡‡çº³ï¼Œæ›´åä¸ºObject.create()ã€‚ å¯„ç”Ÿå¼ç»§æ‰¿å¯„ç”Ÿå¼ç»§æ‰¿,å¯¹åŸå‹ç»§æ‰¿çš„ç¬¬äºŒæ¬¡å°è£…ï¼Œå¹¶ä¸”åœ¨æ­¤è¿‡ç¨‹ä¸­å¯¹ç»§æ‰¿çš„å¯¹è±¡è¿›è¡Œäº†æ‹“å±•ã€‚123456789101112131415//å£°æ˜åŸºå¯¹è±¡let book = &#123; name: 'js book', alikeBook: ["css book", "html book","html book"]&#125;;function createBook(obj) &#123; //é€šè¿‡åŸå‹ç»§æ‰¿æ–¹å¼åˆ›å»ºæ–°å¯¹è±¡ let o = new inheritObejct(obj); //æ‹“å±•æ–°å¯¹è±¡ o.getName = function() &#123; return name; &#125; //è¿”å›æ‹“å±•åçš„æ–°å¯¹è±¡ return o;&#125; å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿è¿™é‡Œçš„å¯„ç”Ÿç»§æ‰¿å¤„ç†çš„æ˜¯ç±»çš„åŸå‹12345678910111213141516171819202122232425262728293031function inhreitPrototype(SubClass, SuperClass) &#123; //å¤åˆ¶ä¸€ä»½çˆ¶ç±»çš„åŸå‹å‰¯æœ¬ä¿å­˜åœ¨å˜é‡ä¸­ let p = inheritObejct(SuperClass.prototype); //ä¿®æ­£å› ä¸ºé‡å†™å­ç±»åŸå‹å¯¼è‡´å­ç±»çš„constructorå±æ€§è¢«ä¿®æ”¹ p.constructor = SubClass; //è®¾ç½®å­ç±»çš„åŸå‹ SubClass.prototype = p;&#125;//å®ä¾‹//å®šä¹‰çˆ¶ç±»function SuperClass(name) &#123; this.name = name; this.colors = ["red", "blue", "green"];&#125;//å®šä¹‰çˆ¶ç±»çš„åŸå‹æ–¹æ³•SuperClass.prototype.getName = function() &#123; return this.name;&#125;//å®šä¹‰å­ç±»function SubClass(name, time) &#123; //æ„é€ å‡½æ•°å¼ç»§æ‰¿ SuperClass.call(this,name); //å­ç±»æ–°å¢å±æ€§ this.time = time;&#125;/*å¯„ç”Ÿå¼ç»§æ‰¿çˆ¶ç±»åŸå‹*/inhreitPrototype(SubClass, SuperClass);/*å­ç±»æ–°å¢åŸå‹æ–¹æ³•*/SubClass.prototype.getTime = function () &#123; return this.time;&#125; extendä¸deepCopyåœ¨JavaScriptä¸­ç»§æ‰¿æ˜¯ä¾èµ–äºåŸå‹prototypeé“¾å®ç°çš„ï¼Œåªæœ‰ä¸€æ¡åŸå‹é“¾ï¼Œç†è®ºä¸Šä¸èƒ½ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚ä½†æ˜¯ç”±äºJavaScriptæ˜¯ä¸€é—¨å¾ˆçµæ´»çš„è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯æ˜¯è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªç»§æ‰¿å¤šå¯¹è±¡å±æ€§çš„å‡½æ•°ã€‚ åŸå‹é“¾å®šä¹‰JavaScriptä¸­æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æŸä¸€å¯¹è±¡çš„prototypeå±æ€§ï¼Œè¯¥å‡½æ•°è¢«newæ“ä½œç¬¦è°ƒç”¨æ—¶ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæŒ‡å‘å…¶åŸå‹å¯¹è±¡çš„protoå±æ€§ï¼Œå¼•æ“åœ¨èƒŒåé€šè¿‡è¿ç”¨protoå¯ä»¥ä½¿å¾—æ–°å»ºçš„å¯¹è±¡å¯ä»¥è°ƒç”¨ç›¸å…³åŸå‹çš„å¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§ã€‚åŸå‹å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æœ¬èº«ä¹ŸåŒ…å«äº†æŒ‡å‘å…¶åŸå‹çš„proto,ç”±æ­¤å°±å½¢æˆäº†ä¸€æ¡é“¾ï¼Œç§°ä¹‹ä¸ºåŸå‹é“¾ã€‚ ä½œç”¨å¦‚å›¾ï¼Œæœ‰äº†åŸå‹é“¾ï¼Œå¦‚æœæŸä¸ªå±æ€§åœ¨å¯¹è±¡Bä¸­è€Œä¸åœ¨å¯¹è±¡Aä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æŠŠè¿™ä¸ªå±æ€§å½“ä½œAçš„å±æ€§æ¥è®¿é—®ã€‚è¿™å°±æ˜¯ç»§æ‰¿çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥ä½¿å¾—æ¯ä¸ªå¯¹è±¡éƒ½èƒ½è®¿é—®å…¶ç»§æ‰¿é“¾ä¸Šçš„ä»»ä½•å±æ€§ã€‚ ç»§æ‰¿å•å¯¹è±¡å±æ€§çš„extendæ–¹æ³•ï¼ˆé’ˆå¯¹å€¼ç±»å‹çš„å±æ€§ï¼‰123456function extend(child, parent) &#123; for (let prop in parent) &#123; child[prop] = parent[prop]; &#125; return child;&#125; ç»§æ‰¿å¤šå¯¹è±¡çš„å±æ€§12345678910111213function mix() &#123; let i = 1, len = arguments.length, child = arguments[0], arg; for(; i &lt; len; i++) &#123; arg = arguments[i]; for( let prop in arg) &#123; child[prop] = arg[prop]; &#125; &#125; return child;&#125; æ·±æ‹·è´åœ¨JavaScriptä¸­å¤åˆ¶ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§ä¸ºå€¼ç±»å‹åˆ™åªéœ€è¦ç®€å•çš„èµ‹å€¼è¯­å¥å³å¯ï¼Œå¦‚æœå±æ€§ä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆ™éœ€è¦ä¾æ¬¡å¤åˆ¶è¯¥å±æ€§çš„å±æ€§ï¼Œè¿™é‡Œé‡‡ç”¨é€’å½’çš„æ€æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ï¼ˆå¦‚æœä¸ä½¿ç”¨é€’å½’ï¼Œåˆ™é€šè¿‡JSONè§£æè§£å†³ï¼‰ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿå½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°±è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸä¸ªç‰©ç†ä½ç½®ï¼Œç›¸å…³çš„å˜é‡å’Œå±æ€§å°±ä¼šæŒ‡å‘è¿™äº›ä½ç½®ã€‚ åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶è®©å˜é‡AæŒ‡å‘è¯¥å¯¹è±¡ã€‚ åˆ›å»ºä¸€ä¸ªæ–°å˜é‡Bï¼Œå¹¶è®¾ç½®å…¶ä¸Aç›¸ç­‰ï¼Œæ­¤æ—¶Bå’ŒAæŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ä¸­çš„åŒä¸€ä¸ªåœ°å€ã€‚ ä¿®æ”¹å˜é‡Bæ‰€æŒ‡çš„å¯¹è±¡çš„colorå±æ€§ï¼Œå°†å®ƒè®¾ç½®ä¸ºâ€whiteâ€,æ­¤æ—¶A.color çš„å€¼ä¹Ÿä¸ºâ€whiteâ€ã€‚ å†åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè®©å˜é‡BæŒ‡å‘è¿™ä¸ªæ–°å¯¹è±¡ï¼ŒAå’ŒBæ­¤æ—¶æŒ‡å‘äº†å†…å­˜ä¸­ä¸åŒçš„ä½ç½®ï¼ŒAã€Bä»æ­¤å†æ— å…³è”ã€‚å…·ä½“å®ç°1234567891011121314function deepCopy(parent, child) &#123; child = child || &#123;&#125;; for (let prop in parent) &#123; if (parent.hasOwnProperty(prop)) &#123; if (typeof parent[prop] === 'object') &#123; child[i] = Array.isArray(parent[prop])? [] : &#123;&#125;; deepCopy( parent[prop], child); &#125; else &#123; child[prop] = parent[prop]; &#125; &#125; &#125; return child;&#125; æ€»ç»“ å…³äºå‚è€ƒæ–‡çŒ®ï¼šã€ŠJavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹æŒ‡å—ã€‹ã€ŠJavaScriptè®¾è®¡æ¨¡å¼ã€‹ã€Šä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸Šå·ï¼‰ã€‹]]></content>
      <categories>
        <category>JavaScriptè®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†ç±»]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[about]]></title>
    <url>%2Fabout%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>

<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä½¿ç”¨è¿›ç¨‹æ± æé«˜Node.jså¹¶è¡Œè®¡ç®—èƒ½åŠ›</title>
      <link href="/2019/03/22/node-process-pool/"/>
      <url>/2019/03/22/node-process-pool/</url>
      
        <content type="html"><![CDATA[<h3 id="Node-Process-Pool"><a href="#Node-Process-Pool" class="headerlink" title="Node Process Pool"></a>Node Process Pool</h3><h4 id="èƒŒæ™¯-Background"><a href="#èƒŒæ™¯-Background" class="headerlink" title="èƒŒæ™¯ Background"></a>èƒŒæ™¯ Background</h4><p>Nodeæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå½“éœ€è¦æ‰§è¡Œå¤šä¸ªç‹¬ç«‹ä¸”è€—æ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œåªèƒ½é€šè¿‡child_processæ¥åˆ†å‘ä»»åŠ¡ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼›ä¸åƒJavaè¿™ç§å¤šçº¿ç¨‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ¥è§£å†³å¹¶è¡Œé—®é¢˜ï¼ŒNodeåªèƒ½åˆ›å»ºè¿›ç¨‹æ¥è¿›è¡Œå¤„ç†ï¼›ä½†æ˜¯è¿›ç¨‹ç›¸å¯¹äºçº¿ç¨‹æ¥è¯´ï¼Œå¼€é”€å¤ªå¤§ã€‚ä¸€æ—¦è¿›ç¨‹æ•°è¾ƒå¤šæ—¶ï¼ŒCPUå’Œå†…å­˜æ¶ˆè€—ä¸¥é‡ï¼ˆå½±å“æˆ‘å¹²å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„è¿›ç¨‹æ± ï¼Œç”¨æ¥è§£å†³å¹¶è¡Œä»»åŠ¡çš„å¤„ç†ã€‚</p><a id="more"></a><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ä¸»æ§è¿›ç¨‹+å·¥ä½œè¿›ç¨‹ç¾¤</p><p>ProcessPoolæ˜¯æˆ‘ä»¬ç®¡ç†è¿›ç¨‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’é…ç½®å‚æ•°ï¼ˆä»»åŠ¡è„šæœ¬ã€è„šæœ¬éœ€è¦çš„å‚æ•°ã€æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼‰ç”Ÿæˆä¸€ä¸ªProcessPoolå®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹æ¥ç®¡æ§è¿›ç¨‹æ± ã€‚</p><p>ProcessItemæ˜¯æˆ‘ä»¬è¿›ç¨‹æ± é‡Œçš„è¿›ç¨‹å¯¹è±¡ï¼ŒProcessItemå¯¹è±¡é™¤äº†processçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¢åŠ äº†å”¯ä¸€æ ‡è¯†å’ŒçŠ¶æ€ï¼ˆå¿™ç¢Œã€ä»»åŠ¡å¤±è´¥ã€ä»»åŠ¡å®Œæˆã€è¿›ç¨‹ä¸å¯ç”¨ï¼‰ã€‚</p><p>ä¸€æ‰¹ä»»åŠ¡å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸€æ¬¡æ€§forkåˆ°æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼Œç„¶åå¼€å§‹ç›‘æ§æ˜¯å¦æœ‰å·¥ä½œè¿›ç¨‹å®Œæˆä»»åŠ¡ï¼Œå¦‚æœæœ‰å·¥ä½œè¿›ç¨‹å®Œæˆäº†ä»»åŠ¡ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¤ç”¨è¿™ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œè®©å…¶æ‰§è¡Œæ–°ä»»åŠ¡ï¼›å¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬ä¼šå°†ä»»åŠ¡å½’è¿˜ç»™è¿›ç¨‹æ± ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åˆ†å‘ã€‚</p><p>ç”±äºä¸»æ§è¿›ç¨‹å³è¦è´Ÿè´£IPCåˆè¦ä¸æ–­ç›‘å¬æ‰¹ä»»åŠ¡å®Œæˆçš„æƒ…å†µï¼Œç›®å‰æˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯setIntervalåˆ‡å‰²ï¼Œè®©IPCå’Œç›‘æ§èƒ½äº¤æ›¿è¿›è¡Œï¼ˆpsï¼šåº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><h5 id="ProcessPool-js"><a href="#ProcessPool-js" class="headerlink" title="ProcessPool.js"></a>ProcessPool.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ProcessItem = <span class="built_in">require</span>(<span class="string">'./ProcessItem'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿›ç¨‹æ± ç±» Process Pool</span></span><br><span class="line"><span class="comment"> * @param maxParallelProcessï¼Œæœ€å¤§å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°</span></span><br><span class="line"><span class="comment"> * @param timeToCloseï¼Œä»»åŠ¡æœ€é•¿è€—æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment"> * @param taskï¼Œä»»åŠ¡è„šæœ¬</span></span><br><span class="line"><span class="comment"> * @param taskParamsï¼Œæ‰€æœ‰ä»»åŠ¡è„šæœ¬éœ€è¦çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> * Todo: è¯»å†™ç»Ÿä¸€æ–‡ä»¶æ—¶å‡ºç°ä»»åŠ¡ä¸¢å¤±ï¼Œå¾…ä¿®å¤bug</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProcessPool</span>(<span class="params">&#123; maxParallelProcess = <span class="number">50</span>, timeToClose = <span class="number">60</span> * <span class="number">1000</span>, task = <span class="string">''</span>, taskParams = [] &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.processList = <span class="keyword">new</span> <span class="built_in">Map</span>() <span class="comment">// ä½¿ç”¨Mapå­˜å‚¨è¿›ç¨‹å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">this</span>.currentProcessNum = <span class="number">0</span> <span class="comment">// å½“å‰æ´»åŠ¨è¿›ç¨‹æ•°</span></span><br><span class="line">  <span class="comment">// this.timeToClose = timeToClose</span></span><br><span class="line">  <span class="keyword">this</span>.task = task <span class="comment">// ä»»åŠ¡è„šæœ¬è·¯å¾„</span></span><br><span class="line">  <span class="keyword">this</span>.taskParamsTodo = taskParams <span class="comment">// å¾…å®Œæˆçš„ä»»åŠ¡å‚æ•°æ•°ç»„ï¼ŒåŒ…å«äº†nä¸ªå°ä»»åŠ¡æ‰€éœ€å‚æ•°ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„</span></span><br><span class="line">  <span class="keyword">this</span>.taskParamsDone = [] <span class="comment">// å·²å®Œæˆçš„ä»»åŠ¡å‚æ•°æ•°ç»„</span></span><br><span class="line">  <span class="keyword">this</span>.maxParallelProcess = maxParallelProcess <span class="comment">// æœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å¤ç”¨ç©ºé—²è¿›ç¨‹</span></span><br><span class="line"><span class="comment">   * @param keyï¼Œå¯å¤ç”¨è¿›ç¨‹çš„pid</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.reuseProcess = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> workProcess = <span class="keyword">this</span>.processList.get(key)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.taskParamsTodo.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> taskParam = <span class="keyword">this</span>.taskParamsTodo.shift()</span><br><span class="line">      workProcess.state = <span class="number">1</span> <span class="comment">// è®¾ç½®ä¸ºå¿™ç¢Œ</span></span><br><span class="line">      workProcess.process.send(taskParam)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è¿›ç¨‹æ± å¯åŠ¨ï¼Œå¤„ç†ä»»åŠ¡</span></span><br><span class="line"><span class="comment">   * Todoï¼šä¸€æ–¹é¢è¦å®æ—¶ç›‘æ§ä»»åŠ¡çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢è¦å¤„ç†å·¥ä½œè¿›ç¨‹ä¼ é€’è¿‡æ¥çš„messageï¼Œç”±äºå•çº¿ç¨‹æ¨¡å‹ï¼ŒäºŒè€…åªæœ‰ä¸€ä¸ªèƒ½è¿è¡Œï¼Œç›®å‰é‡‡ç”¨å®šæ—¶å™¨åˆ‡æ¢å·¥ä½œä¸Šä¸‹æ–‡ï¼Œåº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.run = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`å¼€å§‹æ—¶é—´ï¼š<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>)</span><br><span class="line">    setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> flag = <span class="keyword">this</span>.hasWorkProcessRunning() <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œæˆ–æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡å¤„ç†ä»»åŠ¡</span></span><br><span class="line">      <span class="keyword">const</span> taskTodoNum = <span class="keyword">this</span>.taskParamsTodo.length</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (flag === <span class="number">1</span> &amp;&amp; taskTodoNum) &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹é˜¶æ®µï¼Œfork min&#123;ä»»åŠ¡æ•°ï¼Œæœ€å¤§è¿›ç¨‹æ•°&#125; çš„è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">this</span>.currentProcessNum &lt;= <span class="keyword">this</span>.maxParallelProcess &amp;&amp; <span class="keyword">this</span>.currentProcessNum &lt;= taskTodoNum) &#123;</span><br><span class="line">          <span class="keyword">this</span>.addProcess()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag &gt; <span class="number">0</span> &amp;&amp; !taskTodoNum) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œä¸”æ²¡æœ‰æ–°çš„ä»»åŠ¡è¦æ‰§è¡Œï¼Œé‚£ä¹ˆç­‰å¾…å·¥ä½œè¿›ç¨‹ç»“æŸä»»åŠ¡</span></span><br><span class="line">        <span class="comment">// console.log('æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œä½†æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€å¿ƒç­‰å¾…')</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag &gt; <span class="number">0</span> &amp;&amp; taskTodoNum) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œä¸”æœ‰æ–°çš„ä»»åŠ¡è¦æ‰§è¡Œï¼Œå¦‚æœæœ‰ç©ºé—²è¿›ç¨‹ï¼Œé‚£ä¹ˆé‡ç”¨ç©ºé—²è¿›ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡</span></span><br><span class="line">        <span class="comment">// console.log('æœ‰æ–°ä»»åŠ¡ï¼Œä¸”æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œé‡ç”¨ç©ºé—²è¿›ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡')</span></span><br><span class="line">        <span class="keyword">const</span> processList = <span class="keyword">this</span>.processList.values()</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> processList) &#123;</span><br><span class="line">          <span class="keyword">if</span> (p.state !== <span class="number">1</span> || p.state !== <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.reuseProcess(p.id)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag &lt; <span class="number">0</span> &amp;&amp; taskTodoNum) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œä¸”æœ‰æ–°çš„ä»»åŠ¡è¦æ‰§è¡Œï¼Œå¦‚æœæœ‰ç©ºé—²è¿›ç¨‹ï¼Œé‚£ä¹ˆé‡ç”¨ç©ºé—²è¿›ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ–°å¯åŠ¨è¿›ç¨‹è¿›è¡Œæ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        <span class="comment">// console.log('æœ‰æ–°ä»»åŠ¡ï¼Œä½†æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œé‡ç”¨ç©ºé—²è¿›ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡')</span></span><br><span class="line">        <span class="keyword">const</span> processList = <span class="keyword">this</span>.processList.values()</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> processList) &#123;</span><br><span class="line">          <span class="keyword">if</span> (p.state !== <span class="number">1</span> || p.state !== <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.reuseProcess(p.id)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag &lt; <span class="number">0</span> &amp;&amp; !taskTodoNum) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰å·¥ä½œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œä¸”æ²¡æœ‰æ–°çš„ä»»åŠ¡è¦æ‰§è¡Œï¼Œå…³é—­è¿›ç¨‹æ± ï¼Œä»»åŠ¡å®Œæˆ</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ'</span>)</span><br><span class="line">        <span class="keyword">this</span>.closeProcessPool()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç›‘æµ‹å½“å‰æ˜¯å¦æœ‰æ­£åœ¨å¤„ç†ä»»åŠ¡çš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment">   * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.hasWorkProcessRunning = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.processList.size) <span class="keyword">return</span> <span class="number">1</span> <span class="comment">// è¿›ç¨‹æ± åˆšå¯åŠ¨ï¼Œå°šæ— è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> <span class="keyword">this</span>.processList.values()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (p.state === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">2</span> <span class="comment">// æœ‰å¿™ç¢Œçš„è¿›ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.listenProcessFinish = <span class="function">(<span class="params">workProcess, params</span>) =&gt;</span> &#123;</span><br><span class="line">    workProcess.process.on(<span class="string">'message'</span>, message =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (message === <span class="string">'finish'</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(`æ”¶åˆ°æ¥è‡ªå·¥ä½œè¿›ç¨‹$&#123;workProcess.id&#125;çš„å®Œæˆæ¶ˆæ¯`)</span></span><br><span class="line">        <span class="keyword">this</span>.taskParamsDone.push(params)</span><br><span class="line">        workProcess.finishTask()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message === <span class="string">'failed'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.taskParamsTodo.unshift(params)</span><br><span class="line">        <span class="comment">// console.log(`æ”¶åˆ°æ¥è‡ªå·¥ä½œè¿›ç¨‹$&#123;workProcess.id&#125;çš„å¤±è´¥æ¶ˆæ¯`)</span></span><br><span class="line">        workProcess.unFinishTask()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.addProcess = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.currentProcessNum &lt;= <span class="keyword">this</span>.maxParallelProcess) &#123;</span><br><span class="line">      <span class="keyword">let</span> workParam = <span class="keyword">this</span>.taskParamsTodo.shift()</span><br><span class="line">      <span class="keyword">const</span> newProcess = <span class="keyword">new</span> ProcessItem(&#123;<span class="attr">task</span>: <span class="keyword">this</span>.task, workParam&#125;)</span><br><span class="line">      <span class="keyword">this</span>.processList.set(newProcess.id, newProcess)</span><br><span class="line">      <span class="keyword">this</span>.currentProcessNum++</span><br><span class="line">      <span class="keyword">this</span>.listenProcessFinish(newProcess, workParam)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'å·²ç»è¾¾åˆ°ç³»ç»Ÿæœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•°'</span> + <span class="keyword">this</span>.currentProcessNum)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä»è¿›ç¨‹æ± ä¸­ç§»é™¤[è¿›ç¨‹id]</span></span><br><span class="line"><span class="comment">   * @param id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.removeProcess = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.processList.has(id)) &#123;</span><br><span class="line">      <span class="keyword">const</span> processToTerminate = <span class="keyword">this</span>.processList.get(id)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ç³»ç»Ÿæ­£å…³é—­è¿›ç¨‹'</span> + processToTerminate.id)</span><br><span class="line">      processToTerminate.terminate()</span><br><span class="line">      <span class="keyword">this</span>.currentProcessNum--</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ä¸å­˜åœ¨è¿›ç¨‹'</span> + id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å…³é—­æ‰€æœ‰è¿›ç¨‹å¹¶æ¸…ç©ºè¿›ç¨‹æ± </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.closeProcessPool = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å…³é—­æ‰€æœ‰å·¥ä½œè¿›ç¨‹'</span>)</span><br><span class="line">    <span class="keyword">const</span> processItems = <span class="keyword">this</span>.processList.values()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> processItem <span class="keyword">of</span> processItems) &#123;</span><br><span class="line">      <span class="comment">// console.log('å…³é—­å·¥ä½œè¿›ç¨‹' + processItem.id)</span></span><br><span class="line">      processItem.terminate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¸…ç©ºè¿›ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">this</span>.processList = <span class="literal">null</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`ç»“æŸæ—¶é—´ï¼š<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å…³é—­ä¸»æ§è¿›ç¨‹'</span>)</span><br><span class="line">    process.kill(process.pid)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = ProcessPool</span><br></pre></td></tr></table></figure><h5 id="ProcessItem-js"><a href="#ProcessItem-js" class="headerlink" title="ProcessItem.js"></a>ProcessItem.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œè¿›ç¨‹ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ChildProcess = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProcessItem</span>(<span class="params">&#123; task = <span class="string">''</span>, workParam = [] &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * state çŠ¶æ€ç </span></span><br><span class="line"><span class="comment">   * 1: å¿™ç¢Œ</span></span><br><span class="line"><span class="comment">   * 2: å®Œæˆä»»åŠ¡</span></span><br><span class="line"><span class="comment">   * 3: æœªå®Œæˆä»»åŠ¡</span></span><br><span class="line"><span class="comment">   * 4ï¼š ä¸å¯ç”¨</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">this</span>.process = <span class="keyword">this</span>.createProcess(task, workParam)</span><br><span class="line">  <span class="keyword">this</span>.state = <span class="number">1</span></span><br><span class="line">  <span class="keyword">this</span>.id = <span class="keyword">this</span>.process.pid</span><br><span class="line">  <span class="keyword">this</span>.finishTask = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.state = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.terminate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.process.kill()</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.unFinishTask = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ProcessItem.prototype.createProcess = <span class="function">(<span class="params">task, workParam</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> childProcess = ChildProcess.fork(task, workParam)</span><br><span class="line">  <span class="keyword">if</span> (childProcess) &#123;</span><br><span class="line">    <span class="keyword">return</span> childProcess</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'åˆ›å»ºè¿›ç¨‹å¤±è´¥'</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'create process failed'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = ProcessItem</span><br></pre></td></tr></table></figure><h5 id="Task-js"><a href="#Task-js" class="headerlink" title="Task.js"></a>Task.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“è¿›ç¨‹è¢«å­è¿›ç¨‹åˆ›å»ºåï¼Œç«‹åˆ»æ‰§è¡Œå·¥ä½œä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">firstTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> workParam = process.argv.slice(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">await</span> task(workParam)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œæˆä»»åŠ¡ï¼Œæç¤ºè¿›ç¨‹æ± å·²å®Œæˆï¼Œå·¥ä½œè¿›ç¨‹ç©ºé—²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">finishTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> process.send(<span class="string">'finish'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»»åŠ¡å¤±è´¥ï¼Œæç¤ºè¿›ç¨‹æ± æœªå®Œæˆï¼Œå½’è¿˜ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">unFinishTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> process.send(<span class="string">'failed'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬è¿›ç¨‹æ± åç»­æŒ‡æ´¾çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">process.on(<span class="string">'message'</span>, <span class="keyword">async</span> workParam =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> task(workParam)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> finishTask()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">await</span> unFinishTask()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿›ç¨‹è¢«åˆ›å»ºæ—¶ç«‹å³æ‰§è¡Œè¿›ç¨‹æ± æŒ‡æ´¾çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * @returns &#123;Promise&lt;void&gt;&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> firstTask()</span><br><span class="line">    <span class="keyword">await</span> finishTask()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">await</span> unFinishTask()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @name å·¥ä½œè¿›ç¨‹è´Ÿè´£çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * @param workParam // æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å‚æ•°æ•°ç»„</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€æ·»åŠ ä»»åŠ¡è„šæœ¬åˆ°æ­¤task.jså°¾éƒ¨</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-process-pool</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿›ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> ProcessPool = <span class="built_in">require</span>(<span class="string">'node-process-pool'</span>)</span><br><span class="line"><span class="keyword">const</span> taskParams = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">  taskParams[i] = [i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºè¿›ç¨‹æ± å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> processPool = <span class="keyword">new</span> ProcessPool(&#123;</span><br><span class="line">  maxParallelProcess: <span class="number">50</span>, <span class="comment">// æ”¯æŒæœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•°</span></span><br><span class="line">  timeToClose: <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// å•ä¸ªä»»åŠ¡è¢«æ‰§è¡Œæœ€å¤§æ—¶é•¿</span></span><br><span class="line">  script: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">task</span>(<span class="params">taskParams</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(taskParams)</span><br><span class="line">  &#125;,</span><br><span class="line">  taskParams <span class="comment">// éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å‚æ•°åˆ—è¡¨ï¼ŒäºŒç»´æ•°ç»„</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// åˆ©ç”¨è¿›ç¨‹æ± è¿›è¡Œå¤„ç†å¤§è§„æ¨¡ä»»åŠ¡</span></span><br><span class="line">processPool.run()</span><br><span class="line"><span class="comment">// æµ‹è¯•ä»»åŠ¡1ï¼šå†™æ—¶é—´æˆ³åˆ°æ–‡æœ¬ä¸­</span></span><br><span class="line"><span class="comment">// è¿›ç¨‹æ± ï¼š5000ä¸ªä»»åŠ¡ï¼Œè€—æ—¶2.7sï¼Œæ¯ä¸ªä»»åŠ¡è€—æ—¶0.54ms</span></span><br><span class="line"><span class="comment">// å•çº¿ç¨‹ï¼š5000ä¸ªä»»åŠ¡ï¼Œè€—æ—¶0.456sï¼Œæ¯ä¸ªä»»åŠ¡è€—æ—¶0.0934ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ä»»åŠ¡2ï¼šå†™æ—¶é—´æˆ³åˆ°æ–‡æœ¬ä¸­ï¼Œä½†æ¯ä¸ªä»»åŠ¡éœ€è¦è‡³å°‘è€—æ—¶20msï¼ˆwhileç©ºå¾ªç¯ï¼‰</span></span><br><span class="line"><span class="comment">// è¿›ç¨‹æ± ï¼š5000ä¸ªä»»åŠ¡ï¼Œè€—æ—¶15.089sï¼Œæ¯ä¸ªä»»åŠ¡è€—æ—¶3.02ms</span></span><br><span class="line"><span class="comment">// å•çº¿ç¨‹ï¼š5000ä¸ªä»»åŠ¡ï¼Œè€—æ—¶100.260sï¼Œæ¯ä¸ªä»»åŠ¡è€—æ—¶20.052ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç„¶ï¼Œå½“å¤„ç†ç‹¬ç«‹ä¸”è€—æ—¶ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨è¿›ç¨‹æ± æ›´åŠ åˆé€‚ã€‚ä¾‹å¦‚çˆ¬å–ä¿¡æ¯ï¼Œç›´æ¥ä¼šå°†å¯¹æ–¹æœåŠ¡å™¨503ï¼Œ2333333ï½</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> å•çº¿ç¨‹ </tag>
            
            <tag> è¿›ç¨‹æ±  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ</title>
      <link href="/2019/02/27/perfomance/"/>
      <url>/2019/02/27/perfomance/</url>
      
        <content type="html"><![CDATA[<h3 id="å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ"><a href="#å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ"></a>å¦‚ä½•è¯„ä»·å‰ç«¯æ€§èƒ½å¥½åï¼Ÿ</h3><p><strong>åŠ è½½æ—¶é—´</strong>æ˜¯æˆ‘ä»¬ç”¨äºè¯„ä»·å‰ç«¯æ€§èƒ½å¥½åçš„ä¸€ä¸ªå‚è€ƒæ•°æ®ï¼Œä½†æ˜¯åŠ è½½æ—¶é—´ä¸ç”¨æˆ·ä½¿ç”¨çš„æ‰‹æœºç±»å‹ä»¥åŠå½“å‰ç½‘ç»œçŠ¶å†µæœ‰å…³ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå³ä½¿é¡µé¢åŠ è½½å®Œæˆç”¨æˆ·ä¹Ÿå¯èƒ½æ— æ³•æ“ä½œï¼Œæ‰€ä»¥ä»…ä»…ç”¨ä¸€ä¸ª<strong>åŠ è½½æ—¶é—´</strong>æ˜¯ä¸èƒ½æè¿°å‰ç«¯æ€§èƒ½çš„å¥½åï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¥—å®Œæ•´çš„æ€§èƒ½è¯„ä»·ä½“ç³»ã€‚</p><a id="more"></a><p>æ­¤å‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸»è¦çš„äº‹ä»¶æ¥æµ‹é‡æ€§èƒ½ï¼š</p><ol><li>DomContentLoadedï¼šé¡µé¢åŠ è½½æ—¶è§¦å‘ï¼Œä½†è„šæœ¬åˆšåˆšå¼€å§‹æ‰§è¡Œ</li><li>loadï¼šåœ¨é¡µé¢å®Œå…¨åŠ è½½åè§¦å‘ï¼Œæ­¤æ—¶ç”¨æˆ·å·²ç»å¯ä»¥ä½¿ç”¨é¡µé¢å’Œåº”ç”¨</li></ol><p><img src="https://cdn-images-1.medium.com/max/2000/1*hFyHeo1-iI62aMQT8P8ORw.png" alt=""></p><p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç½‘ç»œç¯å¢ƒè¾ƒå·®æˆ–è€…è„šæœ¬æ‰§è¡Œæ—¶é—´å¤ªé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»DCLåˆ°loadä¼šç»å†ä¸€æ®µå¾ˆé•¿å¾ˆé•¿çš„æ—¶é—´ï¼Œå¹¶ä¸”loadäº‹ä»¶è§¦å‘å¤ªæ™šï¼Œå°±æ— æ³•åˆ†æå‡ºé¡µé¢çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªä»é¡µé¢å¼€å§‹åŠ è½½åˆ°åŠ è½½å®Œæˆçš„è¯„ä»·ä½“ç³»ï¼Œè®°å½•ç”¨æˆ·æ•´ä¸ªæ„ŸçŸ¥è¿‡ç¨‹ã€‚</p><h4 id="æ¸è¿›å¼ç½‘é¡µæŒ‡æ ‡"><a href="#æ¸è¿›å¼ç½‘é¡µæŒ‡æ ‡" class="headerlink" title="æ¸è¿›å¼ç½‘é¡µæŒ‡æ ‡"></a>æ¸è¿›å¼ç½‘é¡µæŒ‡æ ‡</h4><p><img src="https://cdn-images-1.medium.com/max/2000/1*-zjNpHphoKaaZJgG7omu2w.png" alt="img"></p><p><img src="https://github.com/w3c/paint-timing/raw/master/filmstrip.png" alt=""></p><p><strong>é¦–æ¬¡ç»˜åˆ¶(FP)</strong>ï¼š æ ‡è®°æµè§ˆå™¨æ¸²æŸ“ä»»ä½•åœ¨è§†è§‰ä¸Šä¸åŒäºå¯¼èˆªå‰å±å¹•å†…å®¹ä¹‹å†…å®¹çš„æ—¶é—´ç‚¹</p><p><strong>é¦–æ¬¡å†…å®¹ç»˜åˆ¶(FCP)</strong>ï¼šæ ‡è®°çš„æ˜¯æµè§ˆå™¨æ¸²æŸ“æ¥è‡ª DOM ç¬¬ä¸€ä½å†…å®¹çš„æ—¶é—´ç‚¹ï¼Œè¯¥å†…å®¹å¯èƒ½æ˜¯æ–‡æœ¬ã€å›¾åƒã€SVG ç”šè‡³ <code>&lt;canvas&gt;</code> å…ƒç´ ã€‚</p><p><strong>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ï¼ˆFMPï¼‰/ä¸»è§’å…ƒç´ è®¡æ—¶</strong>ï¼šæ ‡è®°çš„æ˜¯é¡µé¢ä¸»è¦å†…å®¹ç»˜åˆ¶çš„æ—¶é—´ç‚¹ï¼Œä¾‹å¦‚è§†é¢‘åº”ç”¨çš„è§†é¢‘ç»„ä»¶ã€å¤©æ°”åº”ç”¨çš„å¤©æ°”ä¿¡æ¯ã€æ–°é—»åº”ç”¨ä¸­çš„æ–°é—»æ¡ç›®ã€‚</p><p><strong>å¯äº¤äº’æ—¶é—´ï¼ˆTTIï¼‰</strong>ï¼šé¡µé¢æ¸²æŸ“å®Œæˆï¼Œèƒ½å¯é çš„å“åº”ç”¨æˆ·çš„æ“ä½œçš„æ—¶é—´ç‚¹ã€‚ï¼ˆè¿™ä¸ªæ—¶é—´ä¸ä»…å–å†³äºä¹‹å‰çš„åŠ è½½æ—¶é—´ï¼Œè¿˜å–å†³äºå½“å‰æ˜¯å¦æœ‰é•¿ä»»åŠ¡é˜»å¡ä¸»çº¿ç¨‹ï¼‰</p><h4 id="æµè§ˆå™¨é¡µé¢åŠ è½½æµç¨‹"><a href="#æµè§ˆå™¨é¡µé¢åŠ è½½æµç¨‹" class="headerlink" title="æµè§ˆå™¨é¡µé¢åŠ è½½æµç¨‹"></a>æµè§ˆå™¨é¡µé¢åŠ è½½æµç¨‹</h4><p>å…ˆè°ˆè°ˆæµè§ˆå™¨çš„é¡µé¢å¤§è‡´çš„åŠ è½½æµç¨‹ï¼š</p><ol><li>æµè§ˆå™¨è¾“å…¥urlï¼Œæµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å‘é€HTMLç»™æµè§ˆå™¨ã€‚</li><li>æµè§ˆå™¨ä¸‹è½½HTMLç„¶åä»ä¸Šå¾€ä¸‹è§£æ</li><li>å¦‚æœåœ¨è§£æHTMLè¿‡ç¨‹ä¸­é‡åˆ°CSSã€JSå¤–é“¾ï¼Œä¼šæ‰§è¡Œä¸‹åˆ—æ“ä½œ<ol><li>Send Requestï¼šå‘è¿™ä¸ªå¤–é“¾å¯¹åº”çš„æœåŠ¡å™¨å‘é€è¯·æ±‚</li><li>Receive Responseï¼šæ¥å—å“åº”ï¼Œè¡¨ç¤ºå¯ä»¥å¼€å§‹ä»ç½‘ç»œæ¥å—æ•°æ®</li><li>Receive Dataï¼šå¼€å§‹æ¥å—æ•°æ®</li><li>Finish Lodingï¼šè¡¨ç¤ºå®Œæˆæ•°æ®çš„ä¸‹è½½</li><li>Parse Stylesheet/Evaluateï¼šè§£æCSSæˆ–æ‰§è¡ŒJS</li></ol></li><li>æ‰€æœ‰çš„CSSä¸‹è½½å®Œæˆåè¿›è¡Œparseï¼Œæ„å»ºCSSOM</li><li>DOMå’ŒCSSOMåˆæˆä¸€ä¸ªRender tree</li><li>æ ¹æ®Render treeçš„å†…å®¹è®¡ç®—å¤„å„ä¸ªèŠ‚ç‚¹åœ¨ç½‘é¡µä¸­çš„å¤§å°å’Œä½ç½®ï¼ˆLayoutï¼‰</li><li>æ ¹æ®Layoutç»˜åˆ¶å†…å®¹åœ¨æµè§ˆå™¨ä¸Šï¼ˆPaintï¼‰</li></ol><h4 id="å¦‚ä½•ç»Ÿè®¡ä¸Šè¿°çš„æŒ‡æ ‡"><a href="#å¦‚ä½•ç»Ÿè®¡ä¸Šè¿°çš„æŒ‡æ ‡" class="headerlink" title="å¦‚ä½•ç»Ÿè®¡ä¸Šè¿°çš„æŒ‡æ ‡"></a>å¦‚ä½•ç»Ÿè®¡ä¸Šè¿°çš„æŒ‡æ ‡</h4><p>é€šè¿‡performanceæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å½“å‰é¡µé¢ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ï¼›ç„¶åé€šè¿‡navogator.sendBeaconæˆ–Google Analyticså‘æœåŠ¡å™¨å‘é€ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>é‚£ä¹ˆï¼Œå…·ä½“çš„æ€§èƒ½æŒ‡æ ‡å¦‚ä½•ç»Ÿè®¡å‘¢ï¼ŸğŸ‘‡ğŸ‘‡ğŸ‘‡</p><h5 id="é¦–æ¬¡ç»˜åˆ¶-First-Paintï¼ŒFP"><a href="#é¦–æ¬¡ç»˜åˆ¶-First-Paintï¼ŒFP" class="headerlink" title="é¦–æ¬¡ç»˜åˆ¶(First Paintï¼ŒFP)"></a>é¦–æ¬¡ç»˜åˆ¶(First Paintï¼ŒFP)</h5><p>è¿™ä¸ªæŒ‡æ ‡è¡¨ç¤ºé¡µé¢ç»˜åˆ¶çš„æ—¶é—´ç‚¹ï¼Œä¹Ÿå°±æ˜¯<strong>ç”¨æˆ·ç¬¬ä¸€æ¬¡çœ‹åˆ°â€œç™½å±â€çš„æ—¶é—´</strong>ï¼Œæ ‡å¿—â€œIt is happening?â€</p><p><strong>é¦–æ¬¡ç»˜åˆ¶åŒ…æ‹¬äº†ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„èƒŒæ™¯ç»˜åˆ¶ï¼Œå®ƒæ˜¯é¦–å…ˆå°†åƒç´ ç»˜åˆ¶åˆ°å±å¹•çš„æ—¶åˆ»ã€‚</strong></p><p>ä»€ä¹ˆæ—¶å€™è§¦å‘FPäº‹ä»¶å‘¢ï¼Ÿ<strong>FPäº‹ä»¶æ˜¯åœ¨å›¾å±‚è¿›è¡Œç»˜åˆ¶çš„æ—¶å€™è§¦å‘</strong>ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰å…ƒç´ å‡ºç°çš„æ—¶å€™ï¼ˆè¿™ä¸ªæ—¶å€™è§¦å‘çš„æ˜¯FCPäº‹ä»¶ï¼‰</p><p>æ€ä¹ˆç»Ÿè®¡è¿™ä¸ªFPæ—¶é—´å‘¢ï¼Ÿ</p><ol><li><p>window.perfomance.getEntriesByType(â€˜paintâ€™)ï¼Œè¿™ä¼šè¿”å›FPã€FCPå‘ç”Ÿçš„æ—¶é—´ç‚¹ã€‚å…·ä½“å‚è€ƒ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Performance</a></p></li><li><p>é€šè¿‡ä½¿ç”¨ Google Analyticsï¼Œå¯è·Ÿè¸ªé¦–æ¬¡ç»˜åˆ¶æ—¶é—´</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Add the async Google Analytics snippet first. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.ga=<span class="built_in">window</span>.ga||<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;(ga.q=ga.q||[]).push(<span class="built_in">arguments</span>)&#125;;ga.l=+<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">  ga(<span class="string">'create'</span>, <span class="string">'UA-XXXXX-Y'</span>, <span class="string">'auto'</span>);</span></span><br><span class="line"><span class="javascript">  ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">'https://www.google-analytics.com/analytics.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Register the PerformanceObserver to track paint timing. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> observer = <span class="keyword">new</span> PerformanceObserver(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> list.getEntries()) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// `name` will be either 'first-paint' or 'first-contentful-paint'.</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> metricName = entry.name;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> time = <span class="built_in">Math</span>.round(entry.startTime + entry.duration);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      ga(<span class="string">'send'</span>, <span class="string">'event'</span>, &#123;</span></span><br><span class="line"><span class="javascript">        eventCategory:<span class="string">'Performance Metrics'</span>,</span></span><br><span class="line"><span class="undefined">        eventAction: metricName,</span></span><br><span class="line"><span class="undefined">        eventValue: time,</span></span><br><span class="line"><span class="javascript">        nonInteraction: <span class="literal">true</span>,</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="javascript">  observer.observe(&#123;<span class="attr">entryTypes</span>: [<span class="string">'paint'</span>]&#125;);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Include any stylesheets after creating the PerformanceObserver. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"..."</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é¦–æ¬¡å†…å®¹ç»˜åˆ¶-First-Content-Paintï¼ŒFCP"><a href="#é¦–æ¬¡å†…å®¹ç»˜åˆ¶-First-Content-Paintï¼ŒFCP" class="headerlink" title="é¦–æ¬¡å†…å®¹ç»˜åˆ¶(First Content Paintï¼ŒFCP)"></a>é¦–æ¬¡å†…å®¹ç»˜åˆ¶(First Content Paintï¼ŒFCP)</h5><p>å½“ç”¨æˆ·é¦–æ¬¡çœ‹è§ä¸€äº›å…ƒç´ ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰ï¼‰ï¼Œéâ€ç™½å±â€œçš„æ—¶åˆ»å°±æ˜¯FCPï¼Œè¿™ä¸ªæ ‡å¿—â€œit is running?â€</p><p>ç»Ÿè®¡çš„æ–¹æ³•ä¸ä¸Šè¿°FPçš„ç»Ÿè®¡æ–¹æ³•ç±»ä¼¼ï¼ŒGoogleçš„Analysisç›‘å¬çš„paintå®é™…æœ‰ä¸¤ç§ç±»å‹ï¼Œâ€˜<strong>first paint</strong>â€™å’Œâ€˜<strong>first content pain</strong>â€™ã€‚</p><p>FCPåœ¨æ–‡æœ¬ã€å›¾ç‰‡ã€SVGç­‰ç»˜åˆ¶çš„æ—¶å€™å°±è§¦å‘äº†ï¼Œæ‰€ä»¥è·ŸFPå¯ä»¥ç›¸å·®å‡ æ¯«ç§’ï½å‡ ç§’çš„æ—¶é—´ã€‚</p><h5 id="é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶-First-Meaningful-Paintï¼ŒFMP"><a href="#é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶-First-Meaningful-Paintï¼ŒFMP" class="headerlink" title="é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶(First Meaningful Paintï¼ŒFMP)"></a>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶(First Meaningful Paintï¼ŒFMP)</h5><p>FMPå°±æ˜¯é¡µé¢ä¸»è¦å†…å®¹å‘ˆç°çš„æ—¶åˆ»ï¼Œç›®å‰æ²¡æœ‰æ ‡å‡†åŒ–çš„FMPå®šä¹‰ï¼Œæ‰€ä»¥å¾ˆä»¥é€šç”¨çš„æ–¹å¼ç¡®å®šâ€œæœ‰æ•ˆâ€å¯¹äºæ‰€æœ‰é¡µé¢æ„å‘³ç€ä»€ä¹ˆã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€ä¹ˆç»Ÿè®¡FMPå‘¢ï¼Ÿå®ƒçš„ç»Ÿè®¡åœ¨é¡µé¢å‘ç”Ÿäº†é‡å¤§çš„å¸ƒå±€å˜åŒ–ä¹‹åï¼›LayoutAnalyzerä¼šç»Ÿè®¡æ‰€æœ‰çš„å¸ƒå±€å˜åŒ–ï¼Œå½“å¸ƒå±€å˜åŒ–æœ€å¤§æ—¶ï¼Œè¿™ä¸ªæ—¶åˆ»å°±æ˜¯FMPã€‚</p><p>å¦‚æœä¸»è¦å†…å®¹æ¸²æŸ“å¤ªæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ·å¼ã€å­—ä½“ã€è„šæœ¬ã€å›¾ç‰‡ä¸Šå»æ€è€ƒï¼Œå› ä¸ºè¿™äº›å…ƒç´ æœ‰å¾ˆå¤§å¯èƒ½é˜»å¡äº†FMPã€‚</p><h5 id="å¯äº¤äº’æ—¶é—´ï¼ˆTime-To-Interactiveï¼ŒTTIï¼‰"><a href="#å¯äº¤äº’æ—¶é—´ï¼ˆTime-To-Interactiveï¼ŒTTIï¼‰" class="headerlink" title="å¯äº¤äº’æ—¶é—´ï¼ˆTime To Interactiveï¼ŒTTIï¼‰"></a>å¯äº¤äº’æ—¶é—´ï¼ˆTime To Interactiveï¼ŒTTIï¼‰</h5><p>ä¸ FMP ç›¸åŒï¼Œå¾ˆéš¾è§„èŒƒåŒ–é€‚ç”¨äºæ‰€æœ‰ç½‘é¡µçš„ TTI æŒ‡æ ‡å®šä¹‰ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Google Analyticsæ¥è·Ÿè¸ªåº”ç”¨TTIã€‚</p><p>TTIå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ<strong>FMP &amp;&amp; DOMContentLoaderäº‹ä»¶è§¦å‘ &amp;&amp; é¡µé¢è§†è§‰åŠ è½½85%</strong></p><p>TTIåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæŒ‡æ ‡ï¼ŒTTFIï¼ˆé¦–æ¬¡äº¤äº’æ—¶é—´ï¼‰ã€TTCIï¼ˆé¦–æ¬¡æŒç»­äº¤äº’æ—¶é—´ï¼‰</p><p><strong>TTFI</strong>:</p><p><img src="https://cdn-images-1.medium.com/max/800/0*xWGGBiXh0pLiPeuk." alt=""></p><p>åœ¨FMPå‘ç”Ÿååº”è¯¥æœ‰3sçš„quiet windowï¼Œè¿™ä¸ªæ—¶é—´è¶³å¤Ÿè¯´æ˜é¡µé¢å¯¹ç”¨æˆ·æ˜¯å¯äº¤äº’çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰é•¿ä»»åŠ¡åœ¨è¿™ä¸ªquiet windowæœŸé—´æˆ–ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œå®ƒä»¬å¯ä»¥è¢«å¿½ç•¥ã€‚</p><p><strong>TTCI</strong>:</p><p><img src="https://cdn-images-1.medium.com/max/800/0*6qzJAADPmBaNSwFw." alt=""></p><p>ä»è¿½ç»ˆçº¿çš„å°¾éƒ¨å¼€å§‹çœ‹ï¼Œé¡µé¢åŠ è½½åæœ‰5sçš„quietå¹¶ä¸”æ²¡æœ‰é•¿ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå¾—åˆ°äº†ä¸€æ®µquiet windowã€‚quiet windowä¹‹ååˆ°ç¬¬ä¸€ä¸ªé•¿ä»»åŠ¡ä¹‹å‰çš„æ—¶é—´å°±æ˜¯TTCIã€‚</p><h5 id="å½±å“ä¸Šé¢æŸäº›æŒ‡æ ‡çš„å› ç´ "><a href="#å½±å“ä¸Šé¢æŸäº›æŒ‡æ ‡çš„å› ç´ " class="headerlink" title="å½±å“ä¸Šé¢æŸäº›æŒ‡æ ‡çš„å› ç´ "></a>å½±å“ä¸Šé¢æŸäº›æŒ‡æ ‡çš„å› ç´ </h5><p>FP/FCPï¼šâ€œç™½å±â€ï¼Œä»æ–‡æ¡£çš„ <code>&lt;head&gt;</code> ä¸­ç§»é™¤ä»»ä½•é˜»å¡æ¸²æŸ“çš„è„šæœ¬æˆ–æ ·å¼è¡¨ï¼Œå¯ä»¥å‡å°‘é¦–æ¬¡ç»˜åˆ¶å’Œé¦–æ¬¡å†…å®¹ç»˜åˆ¶å‰çš„ç­‰å¾…æ—¶é—´ã€‚FCPï¼šé¦–æ¬¡å†…å®¹ç»˜åˆ¶è€—æ—¶å¤ªé•¿ï¼Œç›´è§‚ä¸Šå°±æ˜¯<strong>â€œç™½æ¿æ—¶é—´å¤ªé•¿â€</strong>ï¼Œå½±å“å› ç´ å°±æ˜¯ç½‘ç»œè¿æ¥å­˜åœ¨æ€§èƒ½é—®é¢˜ã€èµ„æºï¼ˆä¾‹å¦‚index.htmlï¼‰å¤ªå¤§ä¼ è¾“è€—æ—¶ã€‚</p><p>FMP/TTIï¼šå¦‚æœä¸»è¦å†…å®¹å¾ˆä¹…éƒ½æ²¡å±•ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯å›¾ç‰‡ã€æ ·å¼ã€å­—ä½“ã€JavaScriptæœ‰è¾ƒé«˜çš„åŠ è½½ä¼˜å…ˆçº§ï¼Œé˜»å¡äº†FMPã€‚ç¡®å®šé¡µé¢ä¸Šæœ€å…³é”®çš„ç•Œé¢å…ƒç´ ï¼ˆä¸»è§’å…ƒç´ ï¼‰ä¹‹åï¼Œæ‚¨åº”ç¡®ä¿åˆå§‹è„šæœ¬åŠ è½½ä»…åŒ…å«æ¸²æŸ“è¿™äº›å…ƒç´ å¹¶ä½¿å…¶å¯äº¤äº’æ‰€éœ€çš„ä»£ç ã€‚</p><h4 id="åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„"><a href="#åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„" class="headerlink" title="åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„"></a>åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„</h4><p><strong>ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„å°±æ˜¯è®©åˆ˜ç¯®çƒå°½å¯èƒ½å¿«åœ°ç»˜åˆ¶ç½‘é¡µ</strong>ï¼Œå‡å°‘ç”¨æˆ·çœ‹åˆ°â€œç™½å±çš„æ—¶é—´â€ï¼Œä»FPåˆ°FCPï¼›æ‰€ä»¥æ•´ä¸ªæ—¶é—´å°±åŒ…æ‹¬äº†è·å–èµ„æºï¼ˆCSSã€JSã€HTMLï¼‰ä»¥åŠæµè§ˆå™¨å¤„ç†å¯¹åº”çš„æ–‡ä»¶ã€‚</p><p><strong>å…³é”®èµ„æº</strong>ï¼šå¯èƒ½é˜»æ­¢ç½‘é¡µé¦–æ¬¡æ¸²æŸ“çš„èµ„æº</p><p><strong>å…³é”®è·¯å¾„é•¿åº¦</strong>ï¼šè·å–æ‰€æœ‰å…³é”®èµ„æºæ‰€éœ€çš„å¾€è¿”æ¬¡æ•°æˆ–æ€»æ—¶é—´</p><p><strong>å…³é”®å­—èŠ‚</strong>ï¼šå®ç°ç½‘é¡µé¦–æ¬¡æ¸²æŸ“æ‰€éœ€çš„æ€»å­—èŠ‚æ•°ï¼Œå®ƒæ˜¯æ‰€æœ‰å…³é”®èµ„æºä¼ é€æ–‡ä»¶å¤§å°çš„æ€»å’Œã€‚</p><h5 id="HTMLã€Image"><a href="#HTMLã€Image" class="headerlink" title="HTMLã€Image"></a>HTMLã€Image</h5><p>å¯¹äºHTMLï¼Œæµè§ˆå™¨ä¸‹è½½HTMLæ–‡ä»¶ï¼Œå½“HTMLå†…å®¹å¯ç”¨æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè§£æHTMLï¼Œç”Ÿæˆtokenï¼Œè¿›è€Œæ„å»ºDOMæ ‘ï¼ŒDOMæ ‘æ„å»ºå®ŒæˆåŒæ—¶æ„å‘³ç€DOMContentLoadedäº‹ä»¶è§¦å‘ï¼›è·å–å›¾ç‰‡å¹¶ä¸ä¼šå½±å“DOMContentLoadedäº‹ä»¶çš„è§¦å‘ï¼Œæ‰€ä»¥<strong>å›¾ç‰‡ä¸ä¼šå½±å“åˆ°é¦–æ¬¡ç»˜åˆ¶</strong>ã€‚</p><p><img src="https://developers.google.cn/web/fundamentals/performance/critical-rendering-path/images/analysis-dom.png" alt=""></p><p>å…³é”®èµ„æºï¼ˆHTMLï¼‰ï¼Œå…³é”®è·¯å¾„é•¿åº¦ï¼ˆæœ€å°‘1æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ5KBï¼‰</p><h5 id="HTMLã€CSS"><a href="#HTMLã€CSS" class="headerlink" title="HTMLã€CSS"></a>HTMLã€CSS</h5><p>åŠ è½½è§£æHTMLï¼Œç„¶åè·å–CSSæ–‡ä»¶ï¼Œè§£æä¸ºCSSOMï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œç»˜åˆ¶é¡µé¢ã€‚</p><p><img src="https://developers.google.cn/web/fundamentals/performance/critical-rendering-path/images/analysis-dom-css.png" alt=""></p><p>å…³é”®èµ„æºï¼ˆHTMLã€CSSï¼‰ï¼Œå…³é”®è·¯å¾„é•¿åº¦ï¼ˆæœ€å°‘2æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ9KBï¼‰</p><h5 id="CSSã€JavaScriptã€HTML"><a href="#CSSã€JavaScriptã€HTML" class="headerlink" title="CSSã€JavaScriptã€HTML"></a>CSSã€JavaScriptã€HTML</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critical Path: Measure Script<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"measureCRP()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>web performance<span class="tag">&lt;/<span class="name">span</span>&gt;</span> students!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"awesome-photo.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"timing.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤äº†è·å–HTMLã€è§£æä¸ºDOMæ ‘ï¼Œæˆ‘ä»¬è¿˜ä¼šå»åŠ è½½CSSæ–‡ä»¶æ„å»ºCSSOMï¼Œç„¶åé€šè¿‡DOMå’ŒCSSOMæ„å»ºæ¸²æŸ“æ ‘ï¼ŒæŒ‰é“ç†æ¥è¯´ï¼ŒDCLä¹Ÿåº”è¯¥åœ¨DOMæ ‘ç”Ÿæˆåå°±è§¦å‘ï¼Œä½†æ˜¯æµè§ˆå™¨åœ¨ä¸‹è½½è§£æCSSæ–‡ä»¶ä¹‹å‰ä¼šé˜»æ­¢DCLäº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºJSå¯èƒ½ä¼šå»æŸ¥è¯¢CSSOMã€‚å³ä½¿å°†è„šæœ¬æ›´æ”¹ä¸ºå†…è”ï¼Œä¹Ÿæ— æµäºäº‹ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>åªè¦æµè§ˆå™¨é‡åˆ°scriptæ ‡è®°å°±ä¼šé˜»æ­¢ï¼Œå¹¶ç­‰åˆ°CSSOMæ„å»ºå®Œæ¯•ã€‚</strong><img src="https://developers.google.cn/web/fundamentals/performance/critical-rendering-path/images/analysis-dom-css-js.png" alt=""></p><p>å…³é”®èµ„æºï¼ˆHTMLã€CSSã€JSï¼‰ï¼Œå…³é”®è·¯å¾„ï¼ˆæœ€å°‘2æ¬¡ï¼Œè·å–cssã€jsæ—¶ä¸ºå¹¶è¡Œï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ11KBï¼‰</p><p><strong>asyncï¼Œå¼‚æ­¥è„šæœ¬çš„ç”¨å¤„</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critical Path: Measure Script<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"measureCRP()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>web performance<span class="tag">&lt;/<span class="name">span</span>&gt;</span> students!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"awesome-photo.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"timing.js"</span> <span class="attr">async</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œè§£æHTMLä¹‹åä¸ä¹…å°±ä¼šè§¦å‘DCLäº‹ä»¶ï¼Œæµè§ˆå™¨çŸ¥é“ä¸éœ€è¦é˜»æ­¢JSï¼Œä¸å¿…ç­‰åˆ°CSSæ–‡ä»¶åŠ è½½è§£æåå†æ‰§è¡ŒJSã€‚</p><p><img src="https://developers.google.cn/web/fundamentals/performance/critical-rendering-path/images/analysis-dom-css-js-async.png" alt=""></p><p>å…³é”®èµ„æºï¼ˆHTMLã€CSSï¼‰ï¼Œå…³é”®è·¯å¾„ï¼ˆæœ€å°‘2æ¬¡ï¼‰ï¼Œå…³é”®å­—èŠ‚ï¼ˆ9KBï¼‰</p><h5 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h5><p>ä¸Šé¢æåˆ°ï¼Œæœ‰ä¸‰ç§å› ç´ ï¼ˆå…³é”®èµ„æºã€å…³é”®è·¯å¾„ã€å…³é”®å­—èŠ‚ï¼‰å½±å“ç€é¦–æ¬¡æ¸²æŸ“ï¼Œæ‰€ä»¥ä¼˜åŒ–ä¹Ÿåº”è¯¥ä»è¿™ä¸‰ç‚¹å…¥æ‰‹ã€‚</p><ol><li>å‡å°‘å…³é”®èµ„æºçš„æ•°é‡ï¼šåˆ é™¤ã€å»¶è¿Ÿã€æ ‡è®°å¼‚æ­¥ç­‰</li><li>ä¼˜åŒ–å…³é”®å­—èŠ‚æ•°ä»¥ç¼©çŸ­ä¸‹è½½æ—¶é—´ï¼ˆå‹ç¼©ï¼‰</li><li>ä¼˜åŒ–å…¶ä½™å…³é”®èµ„æºçš„åŠ è½½é¡ºåºï¼ˆå°½æ—©ä¸‹è½½æ‰€æœ‰çš„å…³é”®èµ„äº§ï¼Œç¼©çŸ­å…³é”®è·¯å¾„é•¿åº¦ï¼‰</li></ol></li></ol><h4 id="ä¸šç•Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç­–ç•¥"><a href="#ä¸šç•Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="ä¸šç•Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç­–ç•¥"></a>ä¸šç•Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç­–ç•¥</h4><h5 id="Google-PageSpeed-Insights-Rules"><a href="#Google-PageSpeed-Insights-Rules" class="headerlink" title="Google PageSpeed Insights Rules"></a>Google PageSpeed Insights Rules</h5><pre><code>1. **æ¶ˆé™¤é˜»å¡æ¸²æŸ“çš„JavaScriptå’ŒCSS**(æœ€å¤§é™åº¦å‡å°‘ç½‘é¡µä¸Šå…³é”®èµ„æºçš„æ•°é‡å¹¶å°½å¯èƒ½æ¶ˆé™¤è¿™äº›èµ„æºï¼Œå‡å°‘ä¸‹è½½å…³é”®å­—èŠ‚æ•°ï¼Œä¼˜åŒ–å…³é”®è·¯å¾„é•¿åº¦)2. **ä¼˜åŒ–JavaScriptçš„ä½¿ç”¨**ï¼ˆJavaScriptèµ„æºä¼šé˜»å¡è§£æå™¨ï¼Œæ‰€ä»¥å°†å…¶æ ‡è®°ä¸ºasyncæˆ–é€šè¿‡ä¸“é—¨çš„JavaScriptä»£ç è¿›è¡Œæ·»åŠ ã€‚**é˜»å¡è§£æå™¨çš„JavaScriptå¼ºåˆ¶æµè§ˆå™¨ç­‰å¾…CSSOMå¹¶æš‚åœDOMçš„æ„å»ºï¼Œç»§è€Œå¤§å¤§å»¶è¿Ÿé¦–æ¬¡æ¸²æŸ“çš„æ—¶é—´**ï¼‰3. **å»¶è¿Ÿè§£æJavaScript**ï¼ˆå»¶è¿ŸåŠ è½½å¯¹æ„å»ºé¦–æ¬¡æ¸²æŸ“çš„å¯è§å†…å®¹æ— å…³ç´§è¦çš„è„šæœ¬ï¼‰4. **é¿å…è¿è¡Œæ—¶é—´é•¿çš„JavaScript**5. **ä¼˜åŒ–CSSçš„ä½¿ç”¨**ï¼ˆCSSç½®äºæ–‡æ¡£headæ ‡ç­¾å†…ã€é¿å…ä½¿ç”¨CSS importã€å†…è”é˜»å¡æ¸²æŸ“çš„CSSï¼‰</code></pre><h5 id="Yahoo-Best-Practices-for-Speeding-Up-Your-Web-Site"><a href="#Yahoo-Best-Practices-for-Speeding-Up-Your-Web-Site" class="headerlink" title="Yahoo Best Practices for Speeding Up Your Web Site"></a>Yahoo Best Practices for Speeding Up Your Web Site</h5><ol><li>å‡å°‘httpè¯·æ±‚</li><li>ä½¿ç”¨CDN</li><li>åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜</li><li>å‹ç¼©é¡µé¢å…ƒç´ </li><li>æ ·å¼è¡¨æ”¾åœ¨head</li><li>JavaScriptæ–‡ä»¶æ”¾åœ¨åº•éƒ¨</li><li>é¿å…CSSè¡¨è¾¾å¼</li><li>JSã€CSSæ”¾åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­</li><li>å‡å°‘CDNæŸ¥è¯¢</li><li>å‹ç¼©JavaScript</li><li>é¿å…é‡å®šå‘</li></ol><h4 id="ç°ä»£å‰ç«¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥"><a href="#ç°ä»£å‰ç«¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="ç°ä»£å‰ç«¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥"></a>ç°ä»£å‰ç«¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥</h4><p>   å‰ç«¯èµ„æºæ–‡ä»¶ç¦»çº¿åŒ–</p><p>   é¡µé¢ç»„ä»¶åŒ–å¹¶æŒ‰éœ€åŠ è½½</p><p>   é¢„æ¸²æŸ“æå‡æ„Ÿå®˜æ€§èƒ½</p><h4 id="RAIL"><a href="#RAIL" class="headerlink" title="RAIL"></a>RAIL</h4><p><img src="https://developers.google.com/web/fundamentals/performance/images/rail.png?hl=zh-cn" alt=""></p><h5 id="å“åº”ï¼šåœ¨100msä»¥å†…å“åº”"><a href="#å“åº”ï¼šåœ¨100msä»¥å†…å“åº”" class="headerlink" title="å“åº”ï¼šåœ¨100msä»¥å†…å“åº”"></a>å“åº”ï¼šåœ¨100msä»¥å†…å“åº”</h5><p>åœ¨ç”¨æˆ·æ³¨æ„åˆ°æ»åä¹‹å‰æœ‰100msçš„æ—¶é—´å¯ä»¥å“åº”ç”¨æˆ·è¾“å…¥ã€‚</p><h5 id="åŠ¨ç”»ï¼šæ¯10msç”Ÿæˆä¸€å¸§"><a href="#åŠ¨ç”»ï¼šæ¯10msç”Ÿæˆä¸€å¸§" class="headerlink" title="åŠ¨ç”»ï¼šæ¯10msç”Ÿæˆä¸€å¸§"></a>åŠ¨ç”»ï¼šæ¯10msç”Ÿæˆä¸€å¸§</h5><p>å°½ç®¡æ¯ç§’ç”Ÿæˆ60å¸§ï¼Œä¸€å¸§16.6msï¼Œä½†æ˜¯æ¯å¸§åªæœ‰10msæ¥æ‰§è¡Œä»£ç ï¼Œå…¶ä½™çš„æ—¶é—´ç”¨äºå°†æ–°å¸§ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</p><h5 id="ç©ºé—²ï¼šæœ€å¤§ç¨‹åº¦å¢åŠ ç©ºé—²æ—¶é—´"><a href="#ç©ºé—²ï¼šæœ€å¤§ç¨‹åº¦å¢åŠ ç©ºé—²æ—¶é—´" class="headerlink" title="ç©ºé—²ï¼šæœ€å¤§ç¨‹åº¦å¢åŠ ç©ºé—²æ—¶é—´"></a>ç©ºé—²ï¼šæœ€å¤§ç¨‹åº¦å¢åŠ ç©ºé—²æ—¶é—´</h5><p>åˆ©ç”¨ç©ºé—²æ—¶é—´å®Œæˆæ¨è¿Ÿçš„å·¥ä½œï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è®©ä¸»çº¿ç¨‹åœ¨UIçº¿ç¨‹å’ŒJSçº¿ç¨‹ä¸­åˆ‡æ¢ã€‚</p><h5 id="åŠ è½½ï¼šåœ¨1000msä»¥å†…å‘ˆç°å†…å®¹"><a href="#åŠ è½½ï¼šåœ¨1000msä»¥å†…å‘ˆç°å†…å®¹" class="headerlink" title="åŠ è½½ï¼šåœ¨1000msä»¥å†…å‘ˆç°å†…å®¹"></a>åŠ è½½ï¼šåœ¨1000msä»¥å†…å‘ˆç°å†…å®¹</h5><p>åœ¨ 1 ç§’é’Ÿå†…åŠ è½½æ‚¨çš„ç½‘ç«™ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="https://developers.google.com/web/fundamentals/performance/images/perf-metrics-test-cycle.png?hl=zh-cn" alt=""></p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ol><li><a href="https://codeburst.io/performance-metrics-whats-this-all-about-1128461ad6b" target="_blank" rel="noopener">Performance metrics. Whatâ€™s this all about?</a></li><li><a href="https://w3c.github.io/paint-timing/" target="_blank" rel="noopener">Paint Timing 1</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics?hl=en" target="_blank" rel="noopener">User-centric Performance Metrics</a></li><li><a href="https://speedcurve.com/blog/user-timing-and-custom-metrics/" target="_blank" rel="noopener">User Timing and Custom Metrics</a></li><li><a href="https://developers.google.cn/web/fundamentals/performance/critical-rendering-path/analyzing-crp" target="_blank" rel="noopener">åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/?hl=zh-cn" target="_blank" rel="noopener">æ€§èƒ½ä¸ºä½•å¦‚æ­¤é‡è¦</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/rail?hl=zh-cn" target="_blank" rel="noopener">ä½¿ç”¨RAILæ¨¡å‹è¯„ä¼°æ€§èƒ½</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FP/FCP </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯è·¯ç”±çš„è®¾è®¡æ€æƒ³ä¸å®ç° &amp;&amp; React-Router v4</title>
      <link href="/2019/02/25/react-router/"/>
      <url>/2019/02/25/react-router/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰ç«¯è·¯ç”±çš„å®ç°"><a href="#å‰ç«¯è·¯ç”±çš„å®ç°" class="headerlink" title="å‰ç«¯è·¯ç”±çš„å®ç°"></a>å‰ç«¯è·¯ç”±çš„å®ç°</h3><p>å‰ç«¯è·¯ç”±åˆ†ä¸ºä¸¤ç§å®ç°æ–¹å¼ï¼š</p><ol><li><strong>HashHistory</strong>ï¼Œé€šè¿‡ä¿®æ”¹<code>location.hash</code>ï¼Œç„¶åç›‘å¬<code>hashchange</code>äº‹ä»¶æ¥è¿›è¡Œå¯¹åº”æ“ä½œã€‚</li><li><strong>BroswerHistory</strong>ï¼Œé€šè¿‡HTML5æä¾›çš„Historyå¯¹è±¡çš„<code>pushState</code>ã€<code>replaceState</code>APIï¼Œç„¶åç›‘å¬<code>popstate</code>äº‹ä»¶æ¥è¿›è¡Œå¯¹åº”æ“ä½œã€‚</li></ol><p>äºŒè€…çš„ä¼˜åŠ£ï¼š</p><p>ç¬¬ä¸€ç§æ–¹æ³•å…¼å®¹æ€§æ›´å¥½ï¼Œä½†æ˜¯<strong>å®ç°æ¯”è¾ƒå¤æ‚</strong>ï¼Œå¹¶ä¸”url<strong>æ¯”è¾ƒä¸‘é™‹</strong>ï¼ˆä¾‹å¦‚ï¼š<code>http://www.test.com/#/xxx</code>ï¼‰ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯æµè§ˆå™¨æä¾›çš„èƒ½åŠ›ï¼Œæ‰€ä»¥å®ç°æ¯”è¾ƒç®€å•ï¼Œurlä¸æ­£å¸¸ç›¸åŒï¼ˆä¾‹å¦‚ï¼š<code>http://www.test.com/xxx</code>ï¼‰ï¼Œä½†æ˜¯å¯èƒ½<strong>å­˜åœ¨å…¼å®¹æ€§é—®é¢˜</strong>ã€‚</p><p>å…¶å®è¿˜æœ‰ç¬¬ä¸‰ç§ï¼Œ<strong>MemoryHistory</strong>ï¼Œç”¨äºnon-DOMç¯å¢ƒä¸‹ï¼Œä¾‹å¦‚React Nativeã€‚</p><a id="more"></a><h4 id="åŸºäºhashçš„å‰ç«¯è·¯ç”±å®ç°"><a href="#åŸºäºhashçš„å‰ç«¯è·¯ç”±å®ç°" class="headerlink" title="åŸºäºhashçš„å‰ç«¯è·¯ç”±å®ç°"></a>åŸºäºhashçš„å‰ç«¯è·¯ç”±å®ç°</h4><p>_routesç”¨æ¥å­˜å‚¨è·¯ç”±å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œå½“hashå˜åŒ–æ—¶è°ƒç”¨refreshå‡½æ•°ï¼ˆä»_routesæ€»æ‰¾åˆ°å¯¹åº”çš„å›è°ƒå‡½æ•°ç„¶åæ‰§è¡Œï¼‰ï¼›é€šè¿‡backå‡½æ•°è¿›è¡Œå›é€€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥å¸ƒå°”å€¼åˆ¤å®šå½“å‰æ“ä½œæ˜¯å¦ä¸ºå›é€€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashRouter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>._routes = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">        <span class="keyword">this</span>._history = []</span><br><span class="line">        <span class="keyword">this</span>._currentUrl = <span class="string">''</span></span><br><span class="line">        <span class="keyword">this</span>._backIndex = <span class="keyword">this</span>._routes.length - <span class="number">1</span></span><br><span class="line">        <span class="keyword">this</span>._currentIndex = <span class="keyword">this</span>._routes.length - <span class="number">1</span></span><br><span class="line">        <span class="keyword">this</span>._isBack = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">this</span>._bindEvent()</span><br><span class="line">    &#125;</span><br><span class="line">    _bindEvent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'laod'</span>, <span class="keyword">this</span>.refresh, <span class="literal">false</span>)<span class="comment">// åŠ è½½åå°±è§¦å‘æ›´æ–°</span></span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, <span class="keyword">this</span>.refresh, <span class="literal">false</span>)<span class="comment">//ç›‘å¬hashçš„å˜åŒ–ï¼Œç„¶åè°ƒç”¨æ›´æ–°å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    route(path, cb = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">        <span class="keyword">this</span>._routes.set(path, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    refresh = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._currentUrl = location.hash.slice(<span class="number">1</span>) || <span class="string">'/'</span> <span class="comment">//è¯»å–urlä¸­'#'åé¢çš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">this</span>._history.push(<span class="keyword">this</span>._currentUrl)</span><br><span class="line">        <span class="keyword">this</span>._currentIndex++</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>._isBack) &#123;</span><br><span class="line">            <span class="keyword">this</span>._backIndex = <span class="keyword">this</span>._currentIndex</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> cb = <span class="keyword">this</span>._routes.get(<span class="keyword">this</span>._currentUrl)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cb === <span class="string">'function'</span>) cb()<span class="comment">//æ‰§è¡Œè·¯ç”±å¯¹åº”çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>._isBack = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    back = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._isBack = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._backIndex &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>._backIndex = <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>._backIndex -= <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        location.hash = <span class="string">`#&#123;this._history[this._backIndex]&#125;`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºäºHistoryçš„å‰ç«¯è·¯ç”±å®ç°"><a href="#åŸºäºHistoryçš„å‰ç«¯è·¯ç”±å®ç°" class="headerlink" title="åŸºäºHistoryçš„å‰ç«¯è·¯ç”±å®ç°"></a>åŸºäºHistoryçš„å‰ç«¯è·¯ç”±å®ç°</h4><p>ä¾èµ–äºHTML5æä¾›çš„Historyå¯¹è±¡ï¼ŒRouterçš„å®ç°ç®€ä¾¿å¾ˆå¤šï¼›ä½¿ç”¨goæ¥è¿›è¡Œå‰å¾€æŒ‡å®šè·¯ç”±ï¼Œç”¨backå›é€€ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BroswerRouter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>._routes = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">        <span class="keyword">this</span>._bindEvent()</span><br><span class="line">    &#125;</span><br><span class="line">    _bindEvent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, e =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> path = e.state &amp;&amp; e.state.path</span><br><span class="line">            <span class="keyword">let</span> cb = <span class="keyword">this</span>._routes.get(path)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cb = <span class="string">'function'</span>) cb()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    init(path) &#123;</span><br><span class="line">        history.replaceState(&#123;<span class="attr">path</span>: path&#125;, <span class="string">''</span>, path)</span><br><span class="line">        <span class="keyword">let</span> cb = <span class="keyword">this</span>._routes.get(path)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cb = <span class="string">'function'</span>) cb()</span><br><span class="line">    &#125;</span><br><span class="line">    route(path, cb = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">        <span class="keyword">this</span>._routes.set(path, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    go = <span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">        history.pushState(&#123;<span class="attr">path</span>: path&#125;, <span class="string">''</span>, path)</span><br><span class="line">        <span class="keyword">let</span> cb = <span class="keyword">this</span>._routes.get(path)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> cb === <span class="string">'function'</span>) cb()</span><br><span class="line">    &#125;</span><br><span class="line">    back = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        history.back()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="React-Router-v4"><a href="#React-Router-v4" class="headerlink" title="React-Router v4"></a>React-Router v4</h3><p>ğŸ‘†ğŸ‘†ğŸ‘†åªæ˜¯ç®€å•çš„å‰åº¦è·¯ç”±çš„æ¨¡æ‹Ÿï¼Œä½†æ˜¯æ¶‰åŠåˆ°Reactæˆ–è€…Vueçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–å¤„ç†æ¸²æŸ“é€»è¾‘ï¼Œæ‰€ä»¥ä¼šç‰µæ‰¯åˆ°ç”Ÿå‘½å‘¨æœŸå’Œç»„ä»¶é€šä¿¡ã€‚</p><p>ä¸‹é¢ç®€å•åˆ†ææ¦‚è¿°ä¸€ä¸‹React-Router v4</p><h4 id="æ¨¡å—ç»“æ„"><a href="#æ¨¡å—ç»“æ„" class="headerlink" title="æ¨¡å—ç»“æ„"></a>æ¨¡å—ç»“æ„</h4><p>React-Routeråˆ†ä¸º4ä¸ªpackageï¼Œåˆ†åˆ«ä¸ºï¼šreact-routerã€react-router-domã€react-router-nativeã€react-router-configã€‚</p><p><strong>react-router</strong>ï¼šè´Ÿè´£é€šç”¨çš„è·¯ç”±é€»è¾‘ï¼Œè¢«å…¶ä»–packageæ‰€ä¾èµ–ï¼Œæ— éœ€ç‰¹åˆ«å¼•å…¥ã€‚</p><p><strong>react-router-dom</strong>: è´Ÿè´£æµè§ˆå™¨çš„è·¯ç”±ç®¡ç†ã€‚</p><p>react-router-nativeï¼šè´Ÿè´£react-nativeçš„è·¯ç”±ç®¡ç†ã€‚</p><p>react-router-config: ç”¨äºé…ç½®ç‰¹åˆ«çš„react-routerï¼Œæ¯”å¦‚SSRç¯å¢ƒä¸‹ã€‚</p><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹react-routerä¸­åªè¦çš„æ¨¡å—ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><h5 id="Routerï¼ˆreact-router-Routerã€react-router-RouterContextã€react-router-dom-BrowserRouterï¼‰"><a href="#Routerï¼ˆreact-router-Routerã€react-router-RouterContextã€react-router-dom-BrowserRouterï¼‰" class="headerlink" title="Routerï¼ˆreact-router/Routerã€react-router/RouterContextã€react-router-dom/BrowserRouterï¼‰"></a>Routerï¼ˆreact-router/Routerã€react-router/RouterContextã€react-router-dom/BrowserRouterï¼‰</h5><p>BroswerRouteråœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡historyï¼Œç„¶åé€šè¿‡propsä¼ é€’ç»™Routerç»„ä»¶ï¼ŒRouterç»„ä»¶å†å°†è¿™ä¸ªhistoryå±æ€§ä½œä¸ºcontextä¼ é€’ç»™å­ç»„ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºcontextï¼Œç”¨äºå…¨å±€ä¼ é€’ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> createNamedContext = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> context = React.createContext();</span><br><span class="line">  context.Provider.displayName = <span class="string">`<span class="subst">$&#123;name&#125;</span>.Provider`</span>;</span><br><span class="line">  context.Consumer.displayName = <span class="string">`<span class="subst">$&#123;name&#125;</span>.Consumer`</span>;</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> RouterContext = createNamedContext(<span class="string">'Router'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> computeRootMatch(pathname) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">path</span>: <span class="string">"/"</span>, <span class="attr">url</span>: <span class="string">"/"</span>, <span class="attr">params</span>: &#123;&#125;, <span class="attr">isExact</span>: pathname === <span class="string">"/"</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      location: props.history.location</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is a bit of a hack. We have to start listening for location</span></span><br><span class="line">    <span class="comment">// changes here in the constructor in case there are any &lt;Redirect&gt;s</span></span><br><span class="line">    <span class="comment">// on the initial render. If there are, they will replace/push when</span></span><br><span class="line">    <span class="comment">// they mount and since cDM fires in children before parents, we may</span></span><br><span class="line">    <span class="comment">// get a new location before the &lt;Router&gt; is mounted.</span></span><br><span class="line">    <span class="keyword">this</span>._isMounted = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>._pendingLocation = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!props.staticContext) &#123;</span><br><span class="line">        <span class="comment">//ï¼ï¼ï¼åœ¨è¿™é‡Œè¿›è¡Œç›‘å¬ï¼Œæ¯æ¬¡è·¯ç”±å˜åŒ–éƒ½ä¼šè§¦å‘é¡¶å±‚Routerçš„å›è°ƒäº‹ä»¶ï¼Œç„¶åRouterè¿›è¡ŒsetStateï¼Œå†å‘ä¸‹ä¼ é€’contextï¼Œæœ€ä¸‹é¢çš„Routeæ ¹æ®contextå†…å®¹åˆ¤æ–­æ˜¯å¦è¿›è¡Œæ¸²æŸ“ï¼ï¼ï¼</span></span><br><span class="line">      <span class="keyword">this</span>.unlisten = props.history.listen(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._isMounted) &#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(&#123; location &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>._pendingLocation = location;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>._isMounted = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._pendingLocation) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">location</span>: <span class="keyword">this</span>._pendingLocation &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.unlisten) <span class="keyword">this</span>.unlisten();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Provider</span><br><span class="line">        children=&#123;<span class="keyword">this</span>.props.children || <span class="literal">null</span>&#125;</span><br><span class="line">        value=&#123;&#123;</span><br><span class="line">          history: <span class="keyword">this</span>.props.history,</span><br><span class="line">          location: <span class="keyword">this</span>.state.location,</span><br><span class="line">          match: Router.computeRootMatch(<span class="keyword">this</span>.state.location.pathname),</span><br><span class="line">          staticContext: <span class="keyword">this</span>.props.staticContext</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;this.history&#125;</span> <span class="attr">children</span>=<span class="string">&#123;this.props.children&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="Routeï¼ˆreact-router-Routeï¼‰"><a href="#Routeï¼ˆreact-router-Routeï¼‰" class="headerlink" title="Routeï¼ˆreact-router/Routeï¼‰"></a>Routeï¼ˆreact-router/Routeï¼‰</h5><p>Routeræ˜¯å€ŸåŠ©contextå‘Routeä¼ é€’å†…å®¹çš„ï¼ŒRouterä½œä¸ºProviderã€Routeä½œä¸ºComsumerï¼Œæ‰€ä»¥Routeå¿…é¡»åŒ…å«åœ¨Routerå†…éƒ¨ã€‚</p><p>åŒæ—¶ï¼ŒRouteå€ŸåŠ©contextå°†historyã€locationã€matchä½œä¸ºä¸‰ä¸ªç‹¬ç«‹çš„å±æ€§ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> location = <span class="keyword">this</span>.props.location || context.location</span><br><span class="line">          <span class="keyword">const</span> match = <span class="keyword">this</span>.props.computedMatch</span><br><span class="line">            ? <span class="keyword">this</span>.props.computedMatch <span class="comment">// &lt;Switch&gt; already computed the match for us</span></span><br><span class="line">            : <span class="keyword">this</span>.props.path</span><br><span class="line">              ? matchPath(location.pathname, <span class="keyword">this</span>.props)</span><br><span class="line">              : context.match</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> props = &#123; ...context, location, match &#125;<span class="comment">//ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> &#123; children, component, render &#125; = <span class="keyword">this</span>.props</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Preact uses an empty array as children by</span></span><br><span class="line">          <span class="comment">// default, so use null if that's the case.</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(children) &amp;&amp; children.length === <span class="number">0</span>) &#123;</span><br><span class="line">            children = <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">"function"</span>) &#123;</span><br><span class="line">            children = children(props);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (children === <span class="literal">undefined</span>) &#123;</span><br><span class="line">              children = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">              <span class="comment">//æä¾›äº†å¤šç§æ¸²æŸ“çš„æ–¹å¼ï¼Œchildren(å­å…ƒç´ )ã€componentï¼ˆpropsï¼‰ã€render(props)</span></span><br><span class="line">            &lt;RouterContext.Provider value=&#123;props&#125;&gt;</span><br><span class="line">              &#123;children &amp;&amp; !isEmptyChildren(children)</span><br><span class="line">                ? children</span><br><span class="line">                : props.match</span><br><span class="line">                  ? component</span><br><span class="line">                    ? React.createElement(component, props)<span class="comment">//è¿™é‡Œæ˜¯é€šè¿‡React.creareElementåˆ›å»ºç»„ä»¶çš„ï¼Œæ‰€ä»¥React Diffè®¤ä¸ºæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œæ›´æ–°çš„æ—¶å€™ä¼šå…ˆå¸è½½ä¹‹å‰çš„ç»„ä»¶å†é‡æ–°å®‰è£…æ–°çš„ç»„ä»¶ã€‚</span></span><br><span class="line">                    : render</span><br><span class="line">                      ? render(props)</span><br><span class="line">                      : <span class="literal">null</span></span><br><span class="line">                  : <span class="literal">null</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/RouterContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">          );</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>RouterContext.Consumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Switchï¼ˆreact-router-Switchï¼‰"><a href="#Switchï¼ˆreact-router-Switchï¼‰" class="headerlink" title="Switchï¼ˆreact-router/Switchï¼‰"></a>Switchï¼ˆreact-router/Switchï¼‰</h5><p>Switchçš„ä½œç”¨æ˜¯ï¼Œå½“Switchä¸­çš„ç¬¬ä¸€ä¸ªRouteåŒ¹é…åå°±ä¸ä¼šæ¸²æŸ“å…¶ä»–çš„Routeï¼Œç±»ä¼¼swichè¿™ä¸ªè¯­æ³•ã€‚æºç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Switch</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> location = <span class="keyword">this</span>.props.location || context.location;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> element, match;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// We use React.Children.forEach instead of React.Children.toArray().find()</span></span><br><span class="line">          <span class="comment">// here because toArray adds keys to all child elements and we do not want</span></span><br><span class="line">          <span class="comment">// to trigger an unmount/remount for two &lt;Route&gt;s that render the same</span></span><br><span class="line">          <span class="comment">// component at different URLs.</span></span><br><span class="line">          React.Children.forEach(<span class="keyword">this</span>.props.children, child =&gt; &#123;</span><br><span class="line">         <span class="comment">//æŒ‰childrençš„é¡ºåºä¾æ¬¡éå†å­å…ƒç´ ï¼ŒæˆåŠŸå°±æ ‡è®°è¿™ä¸ªå­å…ƒç´ å’Œå¯¹åº”çš„locationå’ŒcomutedMatchï¼Œæœ€åè°ƒç”¨React.cloneElementæ¸²æŸ“ï¼Œå¦åˆ™è¿”å›null</span></span><br><span class="line">            <span class="keyword">if</span> (match == <span class="literal">null</span> &amp;&amp; React.isValidElement(child)) &#123;</span><br><span class="line">              element = child;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">const</span> path = child.props.path || child.props.from;</span><br><span class="line"><span class="comment">//Switché€šè¿‡matchPathæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸ</span></span><br><span class="line">              match = path</span><br><span class="line">                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)</span><br><span class="line">                : context.match;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> match</span><br><span class="line">            ? React.cloneElement(element, &#123; location, <span class="attr">computedMatch</span>: match &#125;)</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;<span class="regexp">/RouterContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="matchPathï¼ˆreact-router-matchPathï¼‰"><a href="#matchPathï¼ˆreact-router-matchPathï¼‰" class="headerlink" title="matchPathï¼ˆreact-router/matchPathï¼‰"></a>matchPathï¼ˆreact-router/matchPathï¼‰</h5><p>å‰é¢å¤šæ¬¡æåˆ°ä½¿ç”¨matchPathæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯å¦‚ä½•è¿›è¡ŒåŒ¹é…çš„å‘¢ï¼Ÿä¸‹é¢æ˜¯matchPathçš„æºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼“å­˜ï¼Œä¸å¿…æ¯æ¬¡éƒ½ç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç”¨äºåˆ¤æ–­</span></span><br><span class="line"><span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> cacheLimit = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">let</span> cacheCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compilePath</span>(<span class="params">path, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> cacheKey = <span class="string">`<span class="subst">$&#123;options.end&#125;</span><span class="subst">$&#123;options.strict&#125;</span><span class="subst">$&#123;options.sensitive&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> pathCache = cache[cacheKey] || (cache[cacheKey] = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pathCache[path]) <span class="keyword">return</span> pathCache[path];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> keys = [];</span><br><span class="line">  <span class="keyword">const</span> regexp = pathToRegexp(path, keys, options);</span><br><span class="line">  <span class="keyword">const</span> result = &#123; regexp, keys &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cacheCount &lt; cacheLimit) &#123;</span><br><span class="line">    pathCache[path] = result;</span><br><span class="line">    cacheCount++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Public API for matching a URL pathname to a path.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matchPath</span>(<span class="params">pathname, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">"string"</span>) options = &#123; <span class="attr">path</span>: options &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; path, exact = <span class="literal">false</span>, strict = <span class="literal">false</span>, sensitive = <span class="literal">false</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> paths = [].concat(path);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> paths.reduce(<span class="function">(<span class="params">matched, path</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (matched) <span class="keyword">return</span> matched;</span><br><span class="line">    <span class="keyword">const</span> &#123; regexp, keys &#125; = compilePath(path, &#123;</span><br><span class="line">      end: exact,</span><br><span class="line">      strict,</span><br><span class="line">      sensitive</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> match = regexp.exec(pathname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!match) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [url, ...values] = match;</span><br><span class="line">    <span class="keyword">const</span> isExact = pathname === url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exact &amp;&amp; !isExact) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      path, <span class="comment">// the path used to match</span></span><br><span class="line">      url: path === <span class="string">"/"</span> &amp;&amp; url === <span class="string">""</span> ? <span class="string">"/"</span> : url, <span class="comment">// the matched portion of the URL</span></span><br><span class="line">      isExact, <span class="comment">// whether or not we matched exactly</span></span><br><span class="line">      params: keys.reduce(<span class="function">(<span class="params">memo, key, index</span>) =&gt;</span> &#123;</span><br><span class="line">        memo[key.name] = values[index];</span><br><span class="line">        <span class="keyword">return</span> memo;</span><br><span class="line">      &#125;, &#123;&#125;)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Linkï¼ˆreact-router-dom-Linkï¼‰"><a href="#Linkï¼ˆreact-router-dom-Linkï¼‰" class="headerlink" title="Linkï¼ˆreact-router-dom/Linkï¼‰"></a>Linkï¼ˆreact-router-dom/Linkï¼‰</h5><p>Linkæ˜¯react-router-domä¸­çš„ï¼Œè€Œä¸æ˜¯é€šç”¨æ¨¡å—é‡Œçš„å…ƒç´ ï¼›Linkæ˜¯ä¸€ä¸ªç”¨aæ ‡ç­¾åŒ…è£¹ã€ç”¨æ¥å®ç°è·³è½¬çš„å…ƒç´ ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Link</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleClick(event, history) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.onClick) <span class="keyword">this</span>.props.onClick(event);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !event.defaultPrevented &amp;&amp; <span class="comment">// onClick prevented default</span></span><br><span class="line">      event.button === <span class="number">0</span> &amp;&amp; <span class="comment">// ignore everything but left clicks</span></span><br><span class="line">      (!<span class="keyword">this</span>.props.target || <span class="keyword">this</span>.props.target === <span class="string">"_self"</span>) &amp;&amp; <span class="comment">// let browser handle "target=_blank" etc.</span></span><br><span class="line">      !isModifiedEvent(event) <span class="comment">// ignore clicks with modifier keys</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      event.preventDefault();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> method = <span class="keyword">this</span>.props.replace ? history.replace : history.push;</span><br><span class="line"></span><br><span class="line">      method(<span class="keyword">this</span>.props.to);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; innerRef, replace, to, ...rest &#125; = <span class="keyword">this</span>.props; <span class="comment">// eslint-disable-line no-unused-vars</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> location =</span><br><span class="line">            <span class="keyword">typeof</span> to === <span class="string">"string"</span></span><br><span class="line">              ? createLocation(to, <span class="literal">null</span>, <span class="literal">null</span>, context.location)</span><br><span class="line">              : to;</span><br><span class="line">          <span class="keyword">const</span> href = location ? context.history.createHref(location) : <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;a</span><br><span class="line">              &#123;...rest&#125;</span><br><span class="line">              onClick=&#123;event =&gt; <span class="keyword">this</span>.handleClick(event, context.history)&#125;</span><br><span class="line">              href=&#123;href&#125;</span><br><span class="line">              ref=&#123;innerRef&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          );</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;<span class="regexp">/RouterContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>H5çš„historyå¯¹è±¡ä¸­é€šè¿‡pushStateã€replaceStateåªä¼šæ”¹å˜è·¯ç”±è€Œä¸ä¼šå‘ç”Ÿè·³è½¬ï¼Œä½†æ˜¯ä¹‹å‰æçš„Routerä¸­çš„listenå¯ä»¥ç›‘å¬åˆ°è·¯ç”±çš„å˜åŒ–ç„¶åæ›´æ–°propså’Œcontextï¼Œè®©ä¸‹å±‚çš„Routeé‡æ–°åŒ¹é…ï¼Œå®Œæˆéœ€è¦æ¸²æŸ“éƒ¨åˆ†çš„æ›´æ–°ã€‚å¦‚ä½•ç›‘å¬çš„å‘¢ï¼Ÿè¿™éƒ¨åˆ†åœ¨historyåº“ä¸­çš„createTransitionManagerä¸­ï¼ˆReact-Routerä¾èµ–äºhistoryï¼‰ã€‚</p><h5 id="createTransitionManagerï¼ˆhistory-createTransitionManagerï¼‰"><a href="#createTransitionManagerï¼ˆhistory-createTransitionManagerï¼‰" class="headerlink" title="createTransitionManagerï¼ˆhistory/createTransitionManagerï¼‰"></a>createTransitionManagerï¼ˆhistory/createTransitionManagerï¼‰</h5><p>ä¸‹é¢å°±æ˜¯æºç ï¼Œè§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªåº”ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTransitionManager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> prompt = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setPrompt</span>(<span class="params">nextPrompt</span>) </span>&#123;</span><br><span class="line">    prompt = nextPrompt;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (prompt === nextPrompt) prompt = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">confirmTransitionTo</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    location,</span></span></span><br><span class="line"><span class="function"><span class="params">    action,</span></span></span><br><span class="line"><span class="function"><span class="params">    getUserConfirmation,</span></span></span><br><span class="line"><span class="function"><span class="params">    callback</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> If another transition starts while we're still confirming</span></span><br><span class="line">    <span class="comment">// the previous one, we may end up in a weird state. Figure out the</span></span><br><span class="line">    <span class="comment">// best way to handle this.</span></span><br><span class="line">    <span class="keyword">if</span> (prompt != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result =</span><br><span class="line">        <span class="keyword">typeof</span> prompt === <span class="string">'function'</span> ? prompt(location, action) : prompt;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> getUserConfirmation === <span class="string">'function'</span>) &#123;</span><br><span class="line">          getUserConfirmation(result, callback);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         </span><br><span class="line">          callback(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Return false from a transition hook to cancel the transition.</span></span><br><span class="line">        callback(result !== <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      callback(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">appendListener</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> isActive = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (isActive) fn(...args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listeners.push(listener);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      isActive = <span class="literal">false</span>;</span><br><span class="line">      listeners = listeners.filter(<span class="function"><span class="params">item</span> =&gt;</span> item !== listener);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">notifyListeners</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    listeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener(...args));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    setPrompt,</span><br><span class="line">    confirmTransitionTo,</span><br><span class="line">    appendListener,</span><br><span class="line">    notifyListeners</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WithRouterï¼ˆreact-router-WithRouterï¼‰"><a href="#WithRouterï¼ˆreact-router-WithRouterï¼‰" class="headerlink" title="WithRouterï¼ˆreact-router/WithRouterï¼‰"></a>WithRouterï¼ˆreact-router/WithRouterï¼‰</h5><p>å…‰ä»åå­—ä¸Šçœ‹å°±çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªHOCï¼Œè¿™ä¸ªé«˜é˜¶ç»„ä»¶çš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬åœ¨éRouteä¸­çš„ç»„ä»¶ä¹Ÿèƒ½è·å–åˆ°è·¯ç”±ä¿¡æ¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withRouter</span>(<span class="params">Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> C = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; wrappedComponentRef, ...remainingProps &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Route</span><br><span class="line">        children=&#123;routeComponentProps =&gt; (</span><br><span class="line">          &lt;Component</span><br><span class="line">            &#123;...remainingProps&#125;</span><br><span class="line">            &#123;...routeComponentProps&#125;</span><br><span class="line">            ref=&#123;wrappedComponentRef&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  C.displayName = <span class="string">`withRouter(<span class="subst">$&#123;Component.displayName || Component.name&#125;</span>)`</span>;</span><br><span class="line">  C.WrappedComponent = Component;</span><br><span class="line">  <span class="keyword">return</span> hoistStatics(C, Component);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç°åœ¨æˆ‘ä»¬æ¥å¤§è‡´æ¢³ç†ä¸€ä¸‹ï¼Œå‰ç«¯è·¯ç”±çš„è¿‡ç¨‹ã€‚</p><ol><li>å½“Routerç»„ä»¶åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸Šé¢æ³¨å†Œä¸€ä¸ªäº‹ä»¶ç”¨äºç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œä¸€æ—¦è·¯ç”±å˜åŒ–å°±ä¼šè§¦å‘setStateã€‚</li><li>ç‚¹å‡»Linkå…¶å®å°±æ˜¯ç‚¹å‡»aæ ‡ç­¾è¿›è¡Œè·³è½¬ï¼Œä½†æ˜¯æˆ‘ä»¬é˜»æ­¢äº†è·³è½¬ï¼›å®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œè°ƒç”¨historyçš„pushStateæ–¹æ³•ï¼Œå°†å½“å‰pathå­˜å‚¨ï¼Œå¹¶<strong>ä¿®æ”¹è·¯ç”±</strong>ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰æ”¹å˜é¡µé¢çš„æ¸²æŸ“ï¼‰ã€‚</li><li>æ¯æ¬¡è·¯ç”±çš„å˜åŒ–å°±ä¼šè§¦å‘Routerçš„setStateï¼Œæ‰€ä»¥æ­¤æ—¶ä¼šæˆæ–°contextä¼ é€’ç»™ä¸‹å±‚ã€‚</li><li>ä¸‹å±‚çš„Routeæ‹¿åˆ°æ–°çš„contextåæ ¹æ®matchPathåˆ¤æ–­pathæ˜¯å¦å’ŒlocationåŒ¹é…ï¼ŒåŒ¹é…å°±æ¸²æŸ“ï¼Œä¸åŒ¹é…ä¸æ¸²æŸ“ï¼Œæ­¤æ—¶<strong>é¡µé¢çš„æ¸²æŸ“æ”¹å˜</strong>ã€‚</li></ol><p>æ‰€ä»¥è¯´æ•´ä¸ªå‰ç«¯è·¯ç”±çš„æ€è·¯ï¼ˆä»¥React-Routerä¸ºä¾‹ï¼‰å°±æ˜¯ï¼š</p><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œé€šè¿‡context APIå‘ä¸‹ä¼ é€’histpryå¯¹è±¡ï¼Œä»è€Œæ§åˆ¶å…·ä½“çš„æ¸²æŸ“ï¼›ï¼ˆæ¸²æŸ“å˜åŒ–ï¼‰</li><li>æ·»åŠ ä¸€ä¸ªEvent Emitterï¼Œç”¨äºå“åº”è·¯ç”±å˜åŒ–/Hashå˜åŒ–ï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„é€»è¾‘å¤„ç†ï¼›ï¼ˆè·¯ç”±å˜åŒ–ï¼‰</li><li>è·¯ç”±å˜åŒ–/Hashå˜åŒ–å¯¼è‡´contextå˜åŒ–ï¼Œcontextå˜åŒ–åˆå¯¼è‡´æ¸²æŸ“æ”¹å˜ï¼›ï¼ˆæ¸²æŸ“å˜åŒ–ï¼‰</li></ol><p><strong>é‚£ä¹ˆï¼Œå‰ç«¯è·¯ç”±è·Ÿåç«¯è·¯ç”±æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</strong></p><p>åç«¯è·¯ç”±ï¼Œæ•°æ®æ¸²æŸ“æ˜¯ç”±æœåŠ¡å™¨è§£å†³ï¼Œä¾‹å¦‚åˆ©ç”¨expressæ„å»ºçš„æœåŠ¡ç«¯åº”ç”¨ï¼Œrender(â€˜xxx.pugâ€™)ï¼ŒæœåŠ¡å™¨æ¸²æŸ“å¥½é¡µé¢åè¿”å›ç»™æµè§ˆå™¨ç«¯ï¼Œæµè§ˆå™¨æ˜¾ç¤ºã€‚è¡¨ç°å½¢å¼å°±æ˜¯ï¼Œè·³è½¬é¡µé¢ä¼šç™½å±ï¼ŒåŠ è½½ï½</p><p>å‰ç«¯è·¯ç”±ï¼Œæ•°æ®æ¸²æŸ“æ˜¯ç”±æµè§ˆå™¨ç«¯è§£å†³ï¼Œä¾‹å¦‚ä¸Šè¿°çš„ä¾‹å­ï¼Œä½†æ˜¯è·¯ç”±å˜åŒ–å’Œæ¸²æŸ“å˜åŒ–æ˜¯åˆ†éš”å¼€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡<code>hashchange</code> or <code>popstate</code>å°†è·¯ç”±å˜åŒ–å’Œæ¸²æŸ“å˜åŒ–è¿æ¥èµ·æ¥ã€‚è¡¨ç°å½¢å¼åˆ™æ˜¯ï¼Œè·³è½¬é¡µé¢ä¸ä¼šç™½å±ï½</p><p>é‚£æ˜¯ä¸æ˜¯å‰ç«¯è·¯ç”±å°±å¯ä»¥å®Œå…¨å–ä»£åç«¯è·¯ç”±äº†å‘¢ï¼Ÿä¸æ˜¯çš„ï¼Œå‰ç«¯è·¯ç”±ä¹Ÿå­˜åœ¨ä¸è¶³ï¼ŒSEOå°±æ˜¯ä¸€ä¸ªbig problemã€‚</p><p>é‚£æ˜¯ä¸æ˜¯å‰ç«¯è·¯ç”±å’Œåç«¯è·¯ç”±å°±æ˜¯ç›¸äº’éš”ç»çš„å‘¢ï¼Ÿä¸æ˜¯çš„ï¼ŒäºŒè€…ä¹‹é—´åˆè¡ç”Ÿå‡ºè®¸å¤šæ–°çš„hackæ‰‹æ®µï¼Œä¾‹å¦‚é¢„æ¸²æŸ“ï¼ˆæœåŠ¡ç«¯çº¿æ„å»ºå‡ºä¸€éƒ¨åˆ†é™æ€HTMLï¼Œç”¨äºç›´å‡ºæµè§ˆå™¨ï¼Œç„¶åå‰©ä½™ä½¿ç”¨å‰ç«¯æ¸²æŸ“æ¥å®ç°ï¼‰ã€SSRã€‚</p><p><strong>æ—¢ç„¶è°ˆåˆ°äº†é¢„æ¸²æŸ“å’ŒSSRï¼›é‚£å°±å…ˆå ä¸ªå‘ä½ï¼Œå­¦ä¹ ä¸€ä¸‹SSRå’Œé¢„æ¸²æŸ“ï½</strong></p><h3 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h3><ol><li><a href="https://segmentfault.com/a/1190000007238999#articleHeader1" target="_blank" rel="noopener">å‰ç«¯è·¯ç”±çš„ä¸¤ç§å®ç°åŸç†</a></li><li><a href="https://juejin.im/post/5ac61da66fb9a028c71eae1b" target="_blank" rel="noopener">é¢è¯•å®˜ï¼šä½ äº†è§£å‰ç«¯è·¯ç”±å—</a></li><li><a href="https://github.com/ReactTraining/react-router/tree/master/packages/react-router" target="_blank" rel="noopener">React-Routeræºç </a></li><li><a href="https://github.com/ReactTraining/history" target="_blank" rel="noopener">historyæºç â€”Manage session history with JavaScript</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> å‰ç«¯è·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Processes and Threads</title>
      <link href="/2018/12/09/processes-and-threads/"/>
      <url>/2018/12/09/processes-and-threads/</url>
      
        <content type="html"><![CDATA[<p>Process and Thread are most important concepts in Operating System.</p><a id="more"></a><h2 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h2><h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><h4 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h4><p>In process model, all the runnable software on the computer, sometimes include operating system, is organized into a number of <strong>sequential process</strong>.</p><p>A process is just an instance of an executing program, including the current vlaues of program counter, registers, and variables.</p><p>A CPU can really run only one process at a time.</p><p>In traditional operating systems, each process has an address space and a single thread of control.</p><p>In many situations , it is desirable to have multiple threads of control in the same address space running in quasi-parallel, as though they were (almost) separate processes(except for the shared address spaces).</p><h4 id="Process-Creation"><a href="#Process-Creation" class="headerlink" title="Process Creation"></a>Process Creation</h4><ol><li>System initialization.</li><li>Execution of a process-creation system call by running process.</li><li>A user request to create a new process.</li><li>A initiation of a batch job.</li></ol><p>Daemons: Processes that stay in the background to handle some activity.</p><p>Fork: this system call creates an exact clone of the calling process. After the fork, the two processes, the parent and the child, have the same memory image, the same environment strings, and the same open files.</p><h4 id="Process-Termination"><a href="#Process-Termination" class="headerlink" title="Process Termination"></a>Process Termination</h4><ol><li>Normal exit(voluntary).</li><li>Error exit(voluntary).</li><li>Fatal error(involuntary).</li><li>Killed by aother process(involuntary).</li></ol><h4 id="Process-Hierarchies"><a href="#Process-Hierarchies" class="headerlink" title="Process Hierarchies"></a>Process Hierarchies</h4><p>In <strong>UNIX</strong>, a process and all of its children and further descendants together from a process group.</p><p><strong>Windows</strong> has no concept of a process hierarchy, all processes are equal. The only hint of a process hierarchy is that when a process is created, the parent is given a special token (called a handle) that it can use to control the child.</p><h4 id="Process-States"><a href="#Process-States" class="headerlink" title="Process States"></a>Process States</h4><ol><li>Running.ï¼ˆactually using the CPU at that instantï¼‰</li><li>Ready. (runnable; temporatily stopped to let another process run)</li><li>Blocked.(unable to run until some external event happens)</li></ol><h4 id="Implementation-of-Processes"><a href="#Implementation-of-Processes" class="headerlink" title="Implementation of Processes"></a>Implementation of Processes</h4><p><strong>Process Table</strong>: contains per process, each entry contains important information about the process state, including its program counter, stack pointer, memory allocation, the status of its open files, its accounting and scheduling infomation, and everything else about the process that must be saved when the process is switched from running to ready or blocked state so that it can be restarted later as if it had never been stopped.</p><p>Skeleton of what the lowest level of the operating system does when an interrupt occurs:</p><ol><li>Hardware stacks program counter, etc.</li><li>Hardware loads new program counter from interrupt vector.</li><li>Assembly-language procedure saves registers.</li><li>Assembly-language procedure sets up new stack.</li><li>C interrupt service runs (typically reads and buffers input).</li><li>Scheduler decides which process is to run next.</li><li>C procedure returns to the assembly code.</li><li>Assembly-language procedure starts up new current process.</li></ol><p>A process may be interrputed thousands of times during its execution, but the key idea is that after each interrupt the interrupted process returns to precisely the same state it was in before the interrupt occurred.</p><h3 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h3><h4 id="Concept-1"><a href="#Concept-1" class="headerlink" title="Concept"></a>Concept</h4><p>A thread can be reguard as  a miniprocess.</p><p>Why would anyone want to have threads?</p><ol><li>Only now with threads we add a element: the ability for parallel entities to share an address space and all of its data, which is why having multiple processes (with their separate address spaces) will not work.</li><li>Threads are lighter weight than processes, they are easier to create and destory than process.</li><li>Threads yield no performance gain when all of then are CPU bound, but when where is substantial computing and also substantial I/O, having threads allows these activities to overlap, thus speeding up the application.</li></ol><h4 id="The-Classical-Thread-Model"><a href="#The-Classical-Thread-Model" class="headerlink" title="The Classical Thread Model"></a>The Classical Thread Model</h4><p>The process model is based on two independent concepts: resource grouping and execution.</p><p>A process has a  thread of execution, usually shortened to just thread. </p><p>Processes are used to group resources together; threads are the entities scheduled for executing on the CPU.</p><h4 id="Implementing-Threads-in-User-Space"><a href="#Implementing-Threads-in-User-Space" class="headerlink" title="Implementing Threads in User Space"></a>Implementing Threads in User Space</h4><p>Advantage :</p><ol><li>When a thread is finished running for the moment, for example, when it calls thread yield, the code of<br>thread yield can save the threadâ€™s information in the thread table itself. Furthermore, it can then call the thread scheduler to pick another thread to run. The procedure that saves the threadâ€™s state and the scheduler are just local procedures, so invoking them is much more efficient than making a kernel call. Among other issues, no trap is needed, no context switch is needed, the memory cache need not be flushed, and so on. This makes thread scheduling very fast.</li><li>They allow each process to have its own customized scheduling algorithm.</li></ol><p>Problem:</p><ol><li>How implement blocking system call?</li><li>if a thread starts running, no other thread in that process will ever run unless the first thread voluntarily gives up the CPU.</li></ol><h4 id="Implementing-Threads-in-the-Kernel"><a href="#Implementing-Threads-in-the-Kernel" class="headerlink" title="Implementing Threads in the Kernel"></a>Implementing Threads in the Kernel</h4><ol><li>All calls that might block a thread are implemented as system calls, at consid-<br>erably greater cost than a call to a run-time system procedure. </li><li>Kernel threads do not require any new, nonblocking system calls.</li></ol><p>While kernel threads solve some problems, they do not solve all problems. </p><h4 id="Hybird-Implementations"><a href="#Hybird-Implementations" class="headerlink" title="Hybird Implementations"></a>Hybird Implementations</h4><p>Using kernel-level threads and then multiplex user-level threads onto some or all of them.With this approach, the kernel is aware of only the kernel-level threads and schedules those. Some of those threads may have multiple user-level threads multiplexed on top of them.</p><h4 id="Scheduler-Activations"><a href="#Scheduler-Activations" class="headerlink" title="Scheduler Activations"></a>Scheduler Activations</h4><p>The goals of the scheduler activation work are to mimic the functionality of kernel threads, but with the better performance and greater flexibility usually associated with threads packages implemented in user space.</p><p>When scheduler activations are used, the kernel assigns a certain number of virtual processors to each process and lets the (user-space) run-time system allocate threads to processors.</p><p>The basic idea that makes this scheme work is that when the kernel knows that a thread has blocked (e.g., by its having executed a blocking system call or caused a page fault), the kernel notifies the processâ€™ run-time system, passing as parameters on the stack the number of the thread in question and a description of the event that occurred. The notification happens by having the kernel activate the run-time system at a known starting address, roughly analogous to a signal in UNIX. This mechanism is called an upcall.</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»0åˆ°1æ‰“é€ ä¸€æ¬¾æ²¡äººç”¨çš„å‰ç«¯æ¡†æ¶</title>
      <link href="/2018/12/07/X-react/"/>
      <url>/2018/12/07/X-react/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœå¯ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸è‡ªå·±æ‰“é€ ä¸€æ¬¾æ²¡äººç”¨çš„å‰ç«¯æ¡†æ¶å‘¢ï¼Ÿ</p><p>é¦–å…ˆä»‹ç»å¦‚ä½•åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹ä»¥åŠå°†è™šæ‹ŸDOMèŠ‚ç‚¹è½¬åŒ–ä¸ºçœŸå®DOMèŠ‚ç‚¹ï¼Œå‚ç…§React/Preact</p><a id="more"></a><h3 id="åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹"><a href="#åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹"></a>åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹</h3><p>æˆ‘ä»¬åœ¨Reactä¼šç»å¸¸å†™å‡ºä¸‹åˆ—ç±»ä¼¼çš„ä»£ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Example = &lt;span id='example'&gt;Hello, Example&lt;/span&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸æ˜¯åˆæ³•çš„JavaScriptä»£ç ï¼Œè¿™æ®µæ˜¯JSXä»£ç ã€‚<strong>JSXæ˜¯JavaScriptçš„è¯­æ³•æ‹“å±•ï¼Œç”¨æ¥å£°æ˜Reactä¸­çš„å…ƒç´ </strong>ã€‚çœ‹èµ·æ¥å®ƒå°±åƒä¸€ä¸ªæ¨¡ç‰ˆè¯­è¨€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ï¼Œå®ƒæ˜¯å®Œå…¨æ˜¯åœ¨JavaScriptå†…éƒ¨å®ç°çš„ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å†™çš„JSXä»£ç æ˜¯å¦‚ä½•è¢«JavaScriptè§£æçš„å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±ä¸å¾—ä¸æä¸€ä¸‹Babelï¼ŒBabelæ˜¯ä¸€ä¸ªJavaScriptç¼–è¯‘å™¨ï¼Œå°†ç”¨ES6/ES7ç­‰ESæœ€æ–°çš„è¯­æ³•ä¹¦å†™çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨æ”¯æŒçš„ESç‰ˆæœ¬ï¼ˆå¦‚ES5ã€ES3ï¼‰ã€‚è¿™å°±è®©æˆ‘ä»¬å¼€å‘è€…èƒ½å¤Ÿæœ€å¿«çš„ç”¨ä¸ŠESçš„æ–°è¯­æ³•ç³–</p><p> Awesomeï¼ï¼ï¼ğŸ‰ğŸ‰ğŸ‰</p><p>Babelåœ¨è¿™é‡Œç”¨äºå°†æˆ‘ä»¬ä¹¦å†™çš„JSXä»£ç è½¬æ¢ä¸ºæ ‡å‡†javaScriptä»£ç ï¼Œä¸Šé¢çš„ä¾‹å­å°±è¢«è½¬æ¢ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = h(<span class="string">'span'</span>, &#123;<span class="attr">id</span>: <span class="string">'example'</span>&#125;, <span class="string">'Hello, Example'</span>)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¹¦å†™ä¸€ä¸ªhå‡½æ•°ç”¨äºè¢«è½¬è¯‘çš„ä»£ç è°ƒç”¨ï¼Œè‡³äºä¸ºä»€ä¹ˆå«hï¼Œå› ä¸ºå®ƒæ¥æºäº<a href="https://github.com/hyperhype/hyperscript" target="_blank" rel="noopener">hyperscript</a>ä¸­çš„hå‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å®Œæˆä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„hå‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åˆ›å»ºä¸€ä¸ªVirtual DOM å¯¹è±¡</span></span><br><span class="line"><span class="comment">* @param nodeName æ ‡ç­¾åç§°</span></span><br><span class="line"><span class="comment">* @param attributes å±æ€§</span></span><br><span class="line"><span class="comment">* @param ...args ç»„ä»¶çš„å­©å­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">nodeName, attributes, ...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> children = args.length ? [].concat(...args) : <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        nodeName, attributes, children</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½åˆ›å»ºä¸€ä¸ªç®€å•çš„Virtual Domå¯¹è±¡ï¼Œæ¯”å¦‚ä¸Šé¢çš„JSXä¾‹å­ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¼šå¾—åˆ°ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    nodeName: "span",</span><br><span class="line">    attributes: &#123;</span><br><span class="line">        "id": "example"</span><br><span class="line">    &#125;,</span><br><span class="line">    children: ["Hello, Example"]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™ä¸ªå‡½æ•°æ˜¯è¿œè¿œä¸èƒ½æ»¡è¶³å®é™…ç”Ÿäº§ä¸­çš„è¦æ±‚ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬ä¼šæ…¢æ…¢å®Œå–„å®ƒã€‚</p><h3 id="è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOM"><a href="#è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOM" class="headerlink" title="è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOM"></a>è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOM</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªrenderå‡½æ•°ï¼Œç”¨äºå°†Virtual DOMå¯¹è±¡æ¸²æŸ“ä¸ºçœŸå®çš„DOMèŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vnode.split) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(vnode);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">let</span> node = <span class="built_in">document</span>.createElement(vnode.nodeName)</span><br><span class="line">    <span class="keyword">let</span> attributes = vnode.attributes || &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(attributes).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">        node.setAttribute(k, attributes[k])</span><br><span class="line">    &#125;)</span><br><span class="line">    (vnode.children || []).forEach(<span class="function"><span class="params">c</span> =&gt;</span> node.appendChild(render(c)))</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¼šå°†åˆ›å»ºå‡ºæ¥çš„çœŸå®DOMèŠ‚ç‚¹æŒ‚åœ¨ç°å­˜çš„èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥renderå‡½æ•°éœ€è¦æ”¹é€ ä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> container.appendChild(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Preact </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æRedisé›†ç¾¤</title>
      <link href="/2018/11/27/redis-cluster/"/>
      <url>/2018/11/27/redis-cluster/</url>
      
        <content type="html"><![CDATA[<p>Redis Clusteræ˜¯Redisçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œæœ‰æ•ˆåœ°è§£å†³äº†Redisåˆ†å¸ƒå¼æ–¹é¢çš„éœ€æ±‚ã€‚å½“é‡åˆ°å•æœºå†…å­˜ã€å¹¶å‘ã€æµé‡ç­‰ç“¶é¢ˆæ—¶ï¼Œå¯ä»¥é‡‡ç”¨Clusterçš„æ¶æ„æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚</p><a id="more"></a><h3 id="æ•°æ®åˆ†å¸ƒ"><a href="#æ•°æ®åˆ†å¸ƒ" class="headerlink" title="æ•°æ®åˆ†å¸ƒ"></a>æ•°æ®åˆ†å¸ƒ</h3><p>åˆ†å¸ƒå¼æ•°æ®åº“é¦–å…ˆè¦è§£å†³æŠŠæ•´ä¸ªæ•°æ®é›†æŒ‰ç…§åˆ†åŒºè§„åˆ™æ˜ å°„åˆ°å¤šä¸ªèŠ‚ç‚¹çš„é—®é¢˜ï¼Œå³å°†æ•°æ®å§åˆ’åˆ†åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£æ•´ä½“æ•°æ®çš„ä¸€ä¸ªå­é›†ã€‚å¸¸è§çš„åˆ†åŒºè§„åˆ™æœ‰é¡ºåºåˆ†åŒºå’Œå“ˆå¸Œåˆ†åŒºä¸¤ç§ï¼ŒRedisé‡‡ç”¨çš„å“ˆå¸Œåˆ†åŒºè§„åˆ™ã€‚</p><p>ä¸‹é¢æ˜¯å¸¸è§çš„å‡ ç§å“ˆå¸Œåˆ†åŒºè§„åˆ™</p><h4 id="èŠ‚ç‚¹å–ä½™åˆ†åŒº"><a href="#èŠ‚ç‚¹å–ä½™åˆ†åŒº" class="headerlink" title="èŠ‚ç‚¹å–ä½™åˆ†åŒº"></a>èŠ‚ç‚¹å–ä½™åˆ†åŒº</h4><p>ä½¿ç”¨ç‰¹å®šçš„æ•°æ®keyï¼Œå†æ ¹æ®èŠ‚ç‚¹çš„æ•°é‡Nä½¿ç”¨å…¬å¼ï¼šhash(key)%Nè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ® æ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™æ ·çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨è§„åˆ™ï¼Œä¸€èˆ¬é‡‡ç”¨é¢„åˆ†åŒºçš„çš„æ–¹å¼ï¼Œæå‰æ ¹æ®æ•°æ®é‡è§„åˆ’å¥½åˆ†åŒºæ•°ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œæ‰©å®¹å’Œæ”¶ç¼©æ—¶ï¼Œæ•°æ®èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»éœ€è¦é‡æ–°è®¡ç®—ï¼Œä¼šå¯¼è‡´æ•°æ®çš„é‡å†™è¿ç§»ã€‚</p><h4 id="ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"><a href="#ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"></a>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</h4><p>ç³»ç»Ÿä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªtokenï¼ŒèŒƒå›´ä¸€èˆ¬åœ¨0ï½2^32ï¼Œè¿™äº›tokenæ„æˆä¸€ä¸ªå“ˆå¸Œç¯ã€‚æ•°æ®è¯»å†™æ‰§è¡Œæ—¶ï¼Œå…ˆæ ¹æ®keyè®¡ç®—hashå€¼ï¼Œç„¶åé¡ºæ—¶é’ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸å°äºè¯¥å“ˆå¸Œå€¼çš„tokenèŠ‚ç‚¹ã€‚ç›¸å¯¹äºèŠ‚ç‚¹å–ä½™çš„æ–¹å¼ï¼ŒåŠ å…¥æˆ–åˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå–œæ¬¢ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚ä½†æ˜¯ï¼Œä¸€è‡´æ€§å“ˆå¸Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼šåŠ å‡èŠ‚ç‚¹ä¼šé€ æˆå“ˆå¸Œç¯ä¸­éƒ¨åˆ†æ•°æ®æ— æ³•å‘½ä¸­ï¼›å½“ä½¿ç”¨å°‘é‡èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹å˜åŒ–å°†å¤§èŒƒå›´å½±å“å“ˆå¸Œç¯ä¸­æ•°æ®æ˜ å°„ï¼›æ™®é€šçš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºåœ¨å¢å‡èŠ‚ç‚¹æ—¶éœ€è¦å¢åŠ ä¸€å€æˆ–åˆ å»ä¸€æ¯èŠ‚ç‚¹æ‰èƒ½ä¿è¯æ•°æ®å’Œè´Ÿè½½çš„å‡è¡¡ã€‚<a href="http://www.zsythink.net/archives/1182" target="_blank" rel="noopener">ç™½è¯è§£æâ€”ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></p><h4 id="è™šæ‹Ÿæ§½åˆ†åŒº"><a href="#è™šæ‹Ÿæ§½åˆ†åŒº" class="headerlink" title="è™šæ‹Ÿæ§½åˆ†åŒº"></a>è™šæ‹Ÿæ§½åˆ†åŒº</h4><p>è™šæ‹Ÿæ§½åˆ†åŒºä½¿ç”¨åˆ†æ•£åº¦è‰¯å¥½çš„å“ˆå¸Œå‡½æ•°æŠŠæ‰€æœ‰çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šèŒƒå›´çš„æ•´æ•°é›†åˆä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸ºæ§½(slot)ã€‚Redis Clusterçš„æ§½èŒƒå›´ä¸º0ï½16383ï¼Œè¿œè¿œå¤§äºå®é™…ä¸­çš„æ•°æ®èŠ‚ç‚¹æ•°ã€‚slotæ˜¯é›†ç¾¤å†…æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½ã€‚</p><h4 id="Redisæ•°æ®åˆ†åŒº"><a href="#Redisæ•°æ®åˆ†åŒº" class="headerlink" title="Redisæ•°æ®åˆ†åŒº"></a>Redisæ•°æ®åˆ†åŒº</h4><p>Redis Clusteré‡‡ç”¨è™šæ‹Ÿæ§½åˆ†åŒºï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0ï½16383æ•´æ•°æ§½å†…ã€‚æ¯ä¸€ä¸ªç»“ç‚¹å¤åˆ¶ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šè§£è€¦æ•°æ®ä¸èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼›èŠ‚ç‚¹è‡ªèº«ç»´æŠ¤æ§½çš„æ˜ å°„å…³ç³»ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯æˆ–ä»£ç†æœåŠ¡ç»´æŠ¤æ§½åˆ†åŒºå…ƒæ•°æ®ï¼›æ”¯æŒèŠ‚ç‚¹ã€æ§½ã€é”®ä¹‹é—´çš„æ˜ å°„æŸ¥è¯¢ï¼Œç”¨äºæ•°æ®è·¯ç”±ã€åœ¨çº¿ä¼¸ç¼©ç­‰åœºæ™¯ã€‚</p><h3 id="æ­å»ºé›†ç¾¤"><a href="#æ­å»ºé›†ç¾¤" class="headerlink" title="æ­å»ºé›†ç¾¤"></a>æ­å»ºé›†ç¾¤</h3><p>æ­å»ºé›†ç¾¤åˆ†ä¸ºå‡†å¤‡èŠ‚ç‚¹ã€èŠ‚ç‚¹æ¡æ‰‹ã€åˆ†é…æ§½ç­‰ä¸‰ä¸ªæ­¥éª¤ã€‚ï¼ˆå¯ä»¥ç”¨redis-trib.rbæ­å»ºé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®Redisæ‰‹åŠ¨å»ºç«‹ä¸€ä¸ªé›†ç¾¤ï¼‰</p><h4 id="å‡†å¤‡èŠ‚ç‚¹"><a href="#å‡†å¤‡èŠ‚ç‚¹" class="headerlink" title="å‡†å¤‡èŠ‚ç‚¹"></a>å‡†å¤‡èŠ‚ç‚¹</h4><p>ç•¥</p><h4 id="èŠ‚ç‚¹æ¡æ‰‹"><a href="#èŠ‚ç‚¹æ¡æ‰‹" class="headerlink" title="èŠ‚ç‚¹æ¡æ‰‹"></a>èŠ‚ç‚¹æ¡æ‰‹</h4><p>èŠ‚ç‚¹æ¡æ‰‹æ˜¯æŒ‡ä¸€æ‰¹è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é€šè¿‡Gossipåè®®å½¼æ­¤é€šä¿¡ï¼Œè¾¾åˆ°æ„ŸçŸ¥å¯¹æ–¹çš„è¿‡ç¨‹ã€‚</p><h4 id="åˆ†é…æ§½"><a href="#åˆ†é…æ§½" class="headerlink" title="åˆ†é…æ§½"></a>åˆ†é…æ§½</h4><p>åªæœ‰æŠŠ16384ä¸ªæ§½å…¨éƒ¨åˆ†é…ç»™èŠ‚ç‚¹åï¼Œé›†ç¾¤æ‰è¿›å…¥åœ¨çº¿çŠ¶æ€ã€‚Redis Clusterä¼šæŠŠæ‰€æœ‰æ•°æ®æ˜ å°„åˆ°è¿™16384ä¸ªæ§½ä¸­ï¼Œæ¯ä¸ªkeyä¼šæ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„æ§½ä¸­ï¼Œåªæœ‰å½“èŠ‚ç‚¹åˆ†é…äº†æ§½ï¼Œæ‰èƒ½å“åº”å’Œè¿™äº›æ§½å…³è”çš„é”®å‘½ä»¤ã€‚</p><h3 id="èŠ‚ç‚¹é€šä¿¡"><a href="#èŠ‚ç‚¹é€šä¿¡" class="headerlink" title="èŠ‚ç‚¹é€šä¿¡"></a>èŠ‚ç‚¹é€šä¿¡</h3><p>åœ¨åˆ†å¸ƒå¼å­˜å‚¨ä¸­éœ€è¦æä¾›ç»´æŠ¤èŠ‚ç‚¹å…ƒæ•°æ®ï¼ˆèŠ‚ç‚¹è´Ÿè´£å“ªäº›æ•°æ®ï¼Œæ˜¯å¦å‡ºç°æ•…éšœç­‰çŠ¶æ€ä¿¡æ¯ï¼‰ä¿¡æ¯çš„æœºåˆ¶ã€‚Redis Clusteré‡‡ç”¨ç”¨äºp2pçš„Gossipåè®®ï¼ŒGossipåè®®çš„å·¥ä½œåŸç†å°±æ˜¯èŠ‚ç‚¹ä¸æ–­é€šä¿¡äº¤æ¢ä¿¡æ¯ï¼Œä¸€æ®µæ—¶é—´åæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šçŸ¥é“é›†ç¾¤å®Œæ•´çš„ä¿¡æ¯ï¼Œç±»ä¼¼æµè¡Œç—…ä¼ æ’­ã€‚</p><h4 id="é€šä¿¡è¿‡ç¨‹"><a href="#é€šä¿¡è¿‡ç¨‹" class="headerlink" title="é€šä¿¡è¿‡ç¨‹"></a>é€šä¿¡è¿‡ç¨‹</h4><ol><li>é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå•ç‹¬å¼€è¾Ÿä¸€ä¸ªTCPé€šé“ï¼Œç”¨äºèŠ‚ç‚¹ä¹‹é—´å½¼æ­¤é€šä¿¡ï¼Œé€šä¿¡ç«¯å£å·åœ¨åŸºç¡€ç«¯å£ä¸ŠåŠ 10000ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹åœ¨å›ºå®šå‘¨æœŸå†…é€šè¿‡ç‰¹å®šè§„åˆ™é€‰æ‹©å‡ ä¸ªèŠ‚ç‚¹å‘é€pingæ¶ˆæ¯ã€‚</li><li>æ¥åˆ°pingæ¶ˆæ¯çš„èŠ‚ç‚¹ç”¨pongæ¶ˆæ¯ä½œä¸ºå“åº”ã€‚</li></ol><h4 id="Gossipæ¶ˆæ¯"><a href="#Gossipæ¶ˆæ¯" class="headerlink" title="Gossipæ¶ˆæ¯"></a>Gossipæ¶ˆæ¯</h4><p>Gossipåè®®çš„ä¸»è¦èŒè´£å°±æ˜¯ä¿¡æ¯äº¤æ¢ï¼Œä¿¡æ¯äº¤æ¢çš„è½½ä½“å°±æ˜¯èŠ‚ç‚¹å½¼æ­¤å‘é€çš„Gossipæ¶ˆæ¯ã€‚å¸¸ç”¨çš„Gossipæ¶ˆæ¯åˆ†ä¸ºï¼špingæ¶ˆæ¯ã€pongæ¶ˆæ¯ã€meetæ¶ˆæ¯ã€failæ¶ˆæ¯ã€‚æ‰€æœ‰çš„æ¶ˆæ¯æ ¼å¼åˆ’åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´åŒ…å«å‘é€èŠ‚ç‚¹è‡ªèº«çŠ¶æ€æ•°æ®ï¼Œæ¥å—èŠ‚ç‚¹æ ¹æ®æ¶ˆæ¯å¤´å°±å¯ä»¥è·å–åˆ°å‘é€èŠ‚ç‚¹çš„ç›¸å…³æ•°æ®ã€‚</p><p>meetæ¶ˆæ¯ï¼šç”¨äºé€šçŸ¥æ–°èŠ‚ç‚¹åŠ å…¥ã€‚</p><p>pingæ¶ˆæ¯ï¼šé›†ç¾¤å†…äº¤æ¢æœ€é¢‘ç¹çš„æ¶ˆæ¯ï¼Œé›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹æ¯ç§’å‘å¤šä¸ªå…¶ä»–èŠ‚ç‚¹å‘é€pingæ¶ˆæ¯ï¼Œç”¨äºæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿å’Œäº¤æ¢å½¼æ­¤çŠ¶æ€æ¶ˆæ¯ã€‚</p><p>pongæ¶ˆæ¯ï¼šå½“æ¥æ”¶åˆ°pingã€meetæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºå“åº”æ¶ˆæ¯å›å¤ç»™å‘é€æ–¹ ç¡®è®¤æ¶ˆæ¯æ­£å¸¸é€šä¿¡ã€‚pongæ¶ˆæ¯å†…éƒ¨é£ä¸­äº†è‡ªèº«çŠ¶æ€æ•°æ®ã€‚</p><p>failæ¶ˆæ¯ï¼šå½“èŠ‚ç‚¹åˆ¤æ–­é›†ç¾¤å†…å¦ä¸€ä¸ªç»“ç‚¹ä¸‹çº¿æ—¶ï¼Œä¼šå‘é›†ç¾¤å†…å¹¿æ’­ä¸€ä¸ªfailæ¶ˆæ¯ï¼Œå…¶ä»–èŠ‚ç‚¹æ¥æ”¶åˆ°failæ¶ˆæ¯ä¹‹åæŠŠå¯¹åº”èŠ‚ç‚¹æ›´æ–°ä¸ºä¸‹çº¿çŠ¶æ€ã€‚</p><h4 id="èŠ‚ç‚¹é€‰æ‹©"><a href="#èŠ‚ç‚¹é€‰æ‹©" class="headerlink" title="èŠ‚ç‚¹é€‰æ‹©"></a>èŠ‚ç‚¹é€‰æ‹©</h4><p>Redis Clusterå†…èŠ‚ç‚¹é€šä¿¡é‡‡ç”¨å›ºå®šé¢‘ç‡ï¼ˆå®šæ—¶ä»»åŠ¡æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼‰ã€‚å› æ­¤èŠ‚ç‚¹æ¯æ¬¡é€‰æ‹©éœ€è¦é€šä¿¡çš„èŠ‚ç‚¹åˆ—è¡¨å˜å¾—éå¸¸é‡è¦ã€‚é€šä¿¡èŠ‚ç‚¹é€‰æ‹©è¿‡å¤šè™½ç„¶å¯ä»¥åšåˆ°ä¿¡æ¯åŠæ—¶äº¤æ¢ä½†æˆæœ¬è¿‡é«˜ï¼ŒèŠ‚ç‚¹é€‰æ‹©è¿‡å°‘ä¼šé™ä½é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹å½¼æ­¤ä¿¡æ¯äº¤æ¢é¢‘ç‡ï¼Œä»è€Œå½±å“æ•…éšœåˆ¤æ–­ã€æ–°èŠ‚ç‚¹å‘ç°ç­‰éœ€æ±‚çš„é€Ÿåº¦ã€‚</p><h3 id="é›†ç¾¤ä¼¸ç¼©"><a href="#é›†ç¾¤ä¼¸ç¼©" class="headerlink" title="é›†ç¾¤ä¼¸ç¼©"></a>é›†ç¾¤ä¼¸ç¼©</h3><p>Redis Clusteræä¾›äº†çµæ´»çš„èŠ‚ç‚¹æ‰©å®¹å’Œæ”¶ç¼©æ–¹æ¡ˆï¼Œåœ¨ä¸å½±å“å¯¹å¤–æœåŠ¡çš„åŒæ—¶ï¼Œä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹æˆ–ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹è¿›è¡Œç¼©å®¹ï¼Œå…¶ä¸­åŸç†å¯æŠ½è±¡ä¸ºæ§½å’Œå¯¹åº”æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´çµæ´»ç§»åŠ¨ã€‚</p><h4 id="æ‰©å®¹é›†ç¾¤"><a href="#æ‰©å®¹é›†ç¾¤" class="headerlink" title="æ‰©å®¹é›†ç¾¤"></a>æ‰©å®¹é›†ç¾¤</h4><p>æ‰©å®¹é›†ç¾¤çš„è¿‡ç¨‹ä¸ºå‡†å¤‡æ–°èŠ‚ç‚¹ã€æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€è¿ç§»æ§½å’Œæ•°æ®ç­‰ä¸‰ä¸ªæ­¥éª¤ã€‚</p><h5 id="è¿ç§»æ§½å’Œæ•°æ®"><a href="#è¿ç§»æ§½å’Œæ•°æ®" class="headerlink" title="è¿ç§»æ§½å’Œæ•°æ®"></a>è¿ç§»æ§½å’Œæ•°æ®</h5><p>æ§½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œé›†ç¾¤å¯ä»¥æ­£å¸¸æä¾›è¯»å†™æœåŠ¡ã€‚æ§½æ˜¯Redis Clusteræ•°æ®ç®¡ç†å’Œè¿ç§»çš„æœ€å°å•ä½ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦ä¸ºæ–°èŠ‚ç‚¹åˆ¶å®šæ§½è¿ç§»è®¡åˆ’ã€‚æ§½è¿ç§»è®¡åˆ’éœ€è¦ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹åˆ†é…çš„æ§½æ•°é‡æ¥è¿‘ï¼Œä»è€Œä¿è¯å„èŠ‚ç‚¹çš„æ•°æ®å‡åŒ€ã€‚</p><p>æ•°æ®è¿ç§»è¿‡ç¨‹æ˜¯é€ä¸ªæ§½è¿›è¡Œçš„ï¼Œå¤§ä½“æµç¨‹ä¸ºï¼šï¼ˆ1ï¼‰ç›®æ ‡èŠ‚ç‚¹å‡†å¤‡å¯¼å…¥æ§½ï¼›ï¼ˆ2ï¼‰æºèŠ‚ç‚¹å‡†å¤‡å¯¼å‡ºæ§½ï¼›ï¼ˆ3ï¼‰è·å–æ§½ä¸‹{count}ä¸ªé”®ï¼›ï¼ˆ4ï¼‰æ‰¹é‡è¿ç§»ç›¸å…³é”®çš„æ•°æ®ï¼›ï¼ˆ5ï¼‰å¾ªç¯è¿ç§»é”®ï¼Œé‡å¤ç¬¬3ã€4æ­¥ï¼›ï¼ˆ6ï¼‰é€šçŸ¥æ§½åˆ†é…ç»™ç›®æ ‡èŠ‚ç‚¹ã€‚</p><h4 id="æ”¶ç¼©é›†ç¾¤"><a href="#æ”¶ç¼©é›†ç¾¤" class="headerlink" title="æ”¶ç¼©é›†ç¾¤"></a>æ”¶ç¼©é›†ç¾¤</h4><p>æ”¶ç¼©é›†ç¾¤ä»¥ä¸ºéœ€è¦ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯åˆ†ä¸ºä¸‹çº¿è¿ç§»æ§½ã€å¿˜è®°èŠ‚ç‚¹ç­‰ä¸¤ä¸ªæ­¥éª¤ã€‚</p><h5 id="ä¸‹çº¿è¿ç§»æ§½"><a href="#ä¸‹çº¿è¿ç§»æ§½" class="headerlink" title="ä¸‹çº¿è¿ç§»æ§½"></a>ä¸‹çº¿è¿ç§»æ§½</h5><p>ä¸æ‰©å®¹é›†ç¾¤ä¸­çš„è¿ç§»æ§½å’Œæ•°æ®ç›¸ä¼¼ï½</p><h5 id="å¿˜è®°èŠ‚ç‚¹"><a href="#å¿˜è®°èŠ‚ç‚¹" class="headerlink" title="å¿˜è®°èŠ‚ç‚¹"></a>å¿˜è®°èŠ‚ç‚¹</h5><p>ç”±äºé›†ç¾¤å†…çš„èŠ‚ç‚¹ä¸æ–­é€šè¿‡Gossipæ¶ˆæ¯å½¼æ­¤äº¤æ¢èŠ‚ç‚¹çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦è®©å…¶ä»–èŠ‚ç‚¹ä¸å†ä¸è¦ä¸‹çº¿çš„èŠ‚ç‚¹è¿›è¡ŒGossipæ¶ˆæ¯äº¤æ¢ã€‚</p><h3 id="è¯·æ±‚è·¯ç”±"><a href="#è¯·æ±‚è·¯ç”±" class="headerlink" title="è¯·æ±‚è·¯ç”±"></a>è¯·æ±‚è·¯ç”±</h3><p>ä¸ºäº†è¿½æ±‚æ€§èƒ½æœ€å¤§åŒ–ï¼ŒRedis Clusteré‡‡ç”¨çš„æ˜¯å®¢æˆ·ç«¯ç›´è¿èŠ‚ç‚¹çš„æ–¹å¼ã€‚</p><h4 id="è¯·æ±‚é‡å®šå‘"><a href="#è¯·æ±‚é‡å®šå‘" class="headerlink" title="è¯·æ±‚é‡å®šå‘"></a>è¯·æ±‚é‡å®šå‘</h4><p>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRedisæ¥å—ä»»ä½•keyç›¸å…³çš„å‘½ä»¤æ—¶é¦–å…ˆè®¡ç®—å¯¹åº”çš„æ§½ï¼Œå†æ ¹æ®æ§½æ‰¾å‡ºå¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯è‡ªèº«ï¼Œåˆ™å¤„ç†å‘½ä»¤ï¼›å¦åˆ™è¿”å›MOVEDé‡å®šå‘é”™è¯¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯è¯·æ±‚æ­£ç¡®çš„èŠ‚ç‚¹ã€‚èŠ‚ç‚¹å¯¹äºä¸å±äºå®ƒçš„é”®å‘½ä»¤åªå›å¤é‡å®šå‘å“åº”ï¼Œå¹¶ä¸è´Ÿè´£è½¬å‘ã€‚é”®å‘½ä»¤æ‰§è¡Œæ­¥éª¤ä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼šè®¡ç®—æ§½ã€æŸ¥æ‰¾æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ã€‚</p><h5 id="è®¡ç®—æ§½"><a href="#è®¡ç®—æ§½" class="headerlink" title="è®¡ç®—æ§½"></a>è®¡ç®—æ§½</h5><p>é€šè¿‡CRC16è®¡ç®—keyçš„æœ‰æ•ˆéƒ¨åˆ†çš„hashå€¼ï¼Œå†å¯¹16383å–ä½™ï¼Œä½¿æ¯ä¸ªé”®éƒ½èƒ½æ˜ å°„åˆ°0ï½16383æ§½èŒƒå›´å†…ã€‚</p><h5 id="æ§½èŠ‚ç‚¹æŸ¥è¯¢"><a href="#æ§½èŠ‚ç‚¹æŸ¥è¯¢" class="headerlink" title="æ§½èŠ‚ç‚¹æŸ¥è¯¢"></a>æ§½èŠ‚ç‚¹æŸ¥è¯¢</h5><p>Redisè®¡ç®—å¾—åˆ°keyå¯¹åº”çš„æ§½åï¼Œéœ€è¦æŸ¥è¯¢å¯¹åº”çš„èŠ‚ç‚¹ã€‚é›†ç¾¤å†…é€šè¿‡æ¶ˆæ¯äº¤æ¢æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šçŸ¥é“æ‰€æœ‰èŠ‚ç‚¹çš„æ§½ä¿¡æ¯ï¼Œå†…éƒ¨ä¿å­˜åœ¨clusterStateç»“æ„ä¸­ã€‚</p><h4 id="Smartå®¢æˆ·ç«¯"><a href="#Smartå®¢æˆ·ç«¯" class="headerlink" title="Smartå®¢æˆ·ç«¯"></a>Smartå®¢æˆ·ç«¯</h4><p>Smartå®¢æˆ·ç«¯åœ¨å†…éƒ¨ç»´æŠ¤è€…ä»slot-&gt;nodeçš„æ˜ å°„å…³ç³»ï¼Œæœ¬åœ°å°±å¯ä»¥å®ç°é”®åˆ°èŠ‚ç‚¹çš„æŸ¥è¯¢ï¼Œä»è€Œä¿è¯IOæ•ˆç‡æœ€å¤§åŒ–ï¼Œè€ŒMOVEDé‡å®šå‘è´Ÿè´£ååŠ©Smartå®¢æˆ·ç«¯æ›´æ–°slot-&gt;nodeæ˜ å°„ã€‚</p><h4 id="ASKé‡å®šå‘"><a href="#ASKé‡å®šå‘" class="headerlink" title="ASKé‡å®šå‘"></a>ASKé‡å®šå‘</h4><p>Redisé›†ç¾¤æ”¯æŒåœ¨çº¿è¿ç§»æ§½å’Œæ•°æ®æ¥å®Œæˆæ°´å¹³ä¼¸ç¼©ã€‚ASKé‡å®šå‘è¯´æ˜é›†ç¾¤æ­£åœ¨è¿›è¡Œslotæ•°æ®è¿ç§»ï¼Œå®¢æˆ·ç«¯æ— æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™è¿ç§»å®Œæˆï¼Œå› æ­¤åªèƒ½æ˜¯ä¸´æ—¶æ€§çš„é‡å®šå‘ï¼Œå®¢æˆ·ç«¯ä¸ä¼šæ›´æ–°slotsç¼“å­˜ã€‚ä½†æ˜¯MOVEDé‡å®šå‘è¯´æ˜é”®å¯¹åº”çš„æ§½å·²ç»æ˜ç¡®æŒ‡å®šåˆ°æ–°çš„èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦æ›´æ–°slotsç¼“å­˜ã€‚</p><h3 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><p>Redis Clusterå®ç°äº†é«˜å¯ç”¨ï¼Œå½“é›†ç¾¤å†…å°‘é‡èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶é€šè¿‡è‡ªåŠ¨æ•…éšœè½¬ç§»ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸çš„å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h4 id="æ•…éšœå‘ç°"><a href="#æ•…éšœå‘ç°" class="headerlink" title="æ•…éšœå‘ç°"></a>æ•…éšœå‘ç°</h4><p>Redisé›†ç¾¤å†…èŠ‚ç‚¹é€šè¿‡ping/pongæ¶ˆæ¯å®ç°èŠ‚ç‚¹é€šä¿¡ï¼Œæ¶ˆæ¯ä¸ä½†å¯ä»¥ä¼ æ’­èŠ‚ç‚¹æ§½ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä¼ æ’­ä¸»ä»çŠ¶æ€ã€èŠ‚ç‚¹æ•…éšœç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ•…éšœå‘ç°ä¹Ÿæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ æ’­æœºåˆ¶å®ç°çš„ã€‚</p><h5 id="ä¸»è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿</h5><p>æŒ‡æŸä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå³ä¸‹çº¿çŠ¶æ€ã€‚</p><h5 id="å®¢è§‚ä¸‹çº¿"><a href="#å®¢è§‚ä¸‹çº¿" class="headerlink" title="å®¢è§‚ä¸‹çº¿"></a>å®¢è§‚ä¸‹çº¿</h5><p>æŒ‡æ ‡è®°ä¸€ä¸ªèŠ‚ç‚¹çœŸæ­£çš„ä¸‹çº¿ï¼Œé›†ç¾¤å†…å¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œä»è€Œè¾¾æˆå…±è¯†çš„ç»“æœã€‚</p><h4 id="æ•…éšœæ¢å¤"><a href="#æ•…éšœæ¢å¤" class="headerlink" title="æ•…éšœæ¢å¤"></a>æ•…éšœæ¢å¤</h4><p>æ•…éšœèŠ‚ç‚¹å˜ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå¦‚æœä¸‹çº¿èŠ‚ç‚¹æ˜¯æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦ä»å®ƒçš„ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªæ›¿æ¢ä»–ï¼Œä»è€Œä¿è¯è§çš„é«˜å¯ç”¨ã€‚æ•´ä¸ªå¤§è‡´åˆ†ä¸ºèµ„æ ¼æ£€æŸ¥ã€å‡†å¤‡é€‰ä¸¾æ—¶é—´ã€å‘èµ·é€‰ä¸¾ã€é€‰ä¸¾æŠ•ç¥¨ã€æ›¿æ¢ä¸»èŠ‚ç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> é›†ç¾¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æRediså“¨å…µå®ç°åŸç†</title>
      <link href="/2018/11/23/redis-sentinel/"/>
      <url>/2018/11/23/redis-sentinel/</url>
      
        <content type="html"><![CDATA[<p>Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„(SentinelèŠ‚ç‚¹ã€Redisæ•°æ®èŠ‚ç‚¹ã€Rediså®¢æˆ·ç«¯åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†èŠ‚ç‚¹ä¸Š)ï¼Œå…¶ä¸­åŒ…æ‹¬äº†è‹¥å¹²ä¸ªSentinelèŠ‚ç‚¹å’ŒRedisæ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹å¯¹æ•°æ®èŠ‚ç‚¹å’Œå…¶ä»–SentinelèŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå½“å®ƒå‘ç°èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œä¼šå¯¹èŠ‚ç‚¹åšä¸‹çº¿æ ‡è¯†ã€‚è‹¥è¯¥èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹ï¼Œå®ƒä¼šå’Œå…¶ä»–SentinelèŠ‚ç‚¹å…±åŒåå•†ï¼Œè‹¥å¤§éƒ¨åˆ†èŠ‚ç‚¹çš†è¡¨ç¤ºè¯¥ä¸»èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œé‚£ä¹ˆå°±ä¼šä»Sentinelä¸­é€‰ä¸¾å‡ºä¸€ä¸ªSentinelèŠ‚ç‚¹æ¥å®Œæˆè‡ªåŠ¨æ•…éšœè½¬ç§»çš„å·¥ä½œï¼ŒåŒæ—¶å°†è¿™ä¸ªå˜åŒ–å®æ—¶é€šçŸ¥ç»™Redisåº”ç”¨æ–¹ã€‚</p><a id="more"></a><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><h3 id="ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡"><a href="#ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡" class="headerlink" title="ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡"></a>ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡</h3><p>Redisé€šè¿‡ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡å®Œæˆå¯¹å„ä¸ªèŠ‚ç‚¹çš„å‘ç°å’Œç›‘æ§ã€‚<strong>_</strong>s_</p><h4 id="è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„"><a href="#è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„" class="headerlink" title="è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„"></a>è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„</h4><p>æ¯éš”10sï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€<code>info</code>å‘½ä»¤è·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æ„ã€‚</p><p>ä½œç”¨ï¼š</p><ol><li>é€šè¿‡å‘ä¸»èŠ‚ç‚¹æ‰§è¡Œinfoå‘½ä»¤ï¼Œè·å–ä»èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ‰€ä»¥SentinelèŠ‚ç‚¹ä¸éœ€è¦æ˜¾å¼é…ç½®ç›‘æ§ä»èŠ‚ç‚¹ã€‚</li><li>å½“æœ‰æ–°çš„ä»èŠ‚ç‚¹åŠ å…¥æ—¶éƒ½å¯ä»¥ç«‹åˆ»æ„ŸçŸ¥å‡ºæ¥ã€‚</li><li>èŠ‚ç‚¹ä¸å¯è¾¾æˆ–è€…æ•…éšœè½¬ç§»åï¼Œå¯ä»¥é€šè¿‡infoå‘½ä»¤å®æ—¶æ›´æ–°èŠ‚ç‚¹æ‹“æ‰‘ä¿¡æ¯ã€‚</li></ol><h4 id="SentinelèŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…sentinel-helloé¢‘é“"><a href="#SentinelèŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…sentinel-helloé¢‘é“" class="headerlink" title="SentinelèŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…sentinel:helloé¢‘é“"></a>SentinelèŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…<strong>sentinel</strong>:helloé¢‘é“</h4><p>æ¯éš”2sï¼Œæ¯ä¸ªSentinelèŠ‚ç‚¹ä¼šå‘Redisæ•°æ®èŠ‚ç‚¹çš„<strong>__</strong>sentinel__:helloé¢‘é“å‘é€è¯¥sentinelèŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ä»¥åŠå½“å‰SentinelèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ¯ä¸ªSentinelèŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¯¥é¢‘é“æ¥äº†è§£å…¶ä»–SentinelèŠ‚ç‚¹ä»¥åŠå®ƒä»¬å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ã€‚</p><p>ä½œç”¨ï¼š</p><ol><li>å‘ç°æ–°çš„SentinelèŠ‚ç‚¹ã€‚</li><li>SentinelèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä½œä¸ºåé¢å®¢è§‚ä¸‹çº¿ä»¥åŠé¢†å¯¼è€…é€‰ä¸¾çš„ä¾æ®ã€‚</li></ol><h4 id="å¿ƒè·³æ£€æµ‹"><a href="#å¿ƒè·³æ£€æµ‹" class="headerlink" title="å¿ƒè·³æ£€æµ‹"></a>å¿ƒè·³æ£€æµ‹</h4><p>æ¯éš”1sï¼Œæ¯éš”SentinelèŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶ä½™SentinelèŠ‚ç‚¹å‘é€ä¸€æ¡pingå‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œæ¥ç¡®å®šè¿™äº›èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚</p><p>ä½œç”¨ï¼š</p><ol><li>åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å¯è¾¾çš„é‡è¦ä¾æ®ã€‚</li></ol><h3 id="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿</h3><h4 id="ä¸»è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿</h4><p>ä¸Šé¢æåˆ°å¿ƒè·³æ£€æµ‹ï¼Œå¦‚æœè¿™äº›èŠ‚ç‚¹è¶…è¿‡down-after-millionsectionsè¿˜æ²¡æœ‰è¿›è¡Œæœ‰æ•ˆå›å¤ï¼ŒSentinelèŠ‚ç‚¹å°±ä¼šå¯¹è¯¥èŠ‚ç‚¹åšå¤±è´¥åˆ¤æ–­ï¼Œè¿™ä¸ªè¡Œä¸ºå«åšä¸»è§‚ä¸‹çº¿ã€‚SentinelèŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ï¼Œä¸»è§‚ä¸‹çº¿åæ²¡æœ‰åç»­çš„æ•…éšœè½¬ç§»æ“ä½œã€‚</p><h4 id="å®¢è§‚ä¸‹çº¿"><a href="#å®¢è§‚ä¸‹çº¿" class="headerlink" title="å®¢è§‚ä¸‹çº¿"></a>å®¢è§‚ä¸‹çº¿</h4><p>å½“SentinelèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹æ—¶ï¼Œè¯¥SentinelèŠ‚ç‚¹ä¼šé€šè¿‡<code>sentinel is-master-down-by-addr</code>å‘½ä»¤å‘å…¶ä»–SentinelèŠ‚ç‚¹è¯¢é—®å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“è¶…è¿‡<quorum>ä¸ªæ•°ï¼ŒSentinelè®¤ä¸ºä¸»èŠ‚ç‚¹çš„ç¡®å‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶è¯¥Sentinelå¯¹ä¸»èŠ‚ç‚¹åšå‡ºå®¢è§‚ä¸‹çº¿çš„å†³å®šã€‚</quorum></p><h3 id="é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾"><a href="#é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾" class="headerlink" title="é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾"></a>é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾</h3><p>å½“SentinelèŠ‚ç‚¹å¯¹ä¸»èŠ‚ç‚¹å®Œæˆäº†å®¢è§‚ä¸‹çº¿åï¼ŒSentinelèŠ‚ç‚¹ä¹‹é—´è¿˜ä¼šé€‰ä¸¾å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºé¢†å¯¼è€…è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œï¼›Redisä½¿ç”¨äº†Raftç®—æ³•å®ç°é¢†å¯¼è€…é€‰ä¸¾ã€‚</p><h4 id="Raftç®—æ³•å¤§è‡´æ€è·¯"><a href="#Raftç®—æ³•å¤§è‡´æ€è·¯" class="headerlink" title="Raftç®—æ³•å¤§è‡´æ€è·¯"></a>Raftç®—æ³•å¤§è‡´æ€è·¯</h4><ol><li>æ¯ä¸ªåœ¨çº¿çš„SentinelèŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œå½“å®ƒç¡®è®¤ä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿åï¼Œä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€<code>sentinel is-master-down-by-addr</code>å‘½ä»¤ï¼Œè¦æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…ã€‚</li><li>æ”¶åˆ°å‘½ä»¤çš„SentinelèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–çš„SentinelèŠ‚ç‚¹çš„<code>sentinel is-master-down-by-addr</code>å‘½ä»¤ï¼Œå°†åŒæ„è¯¥è¯·æ±‚ï¼Œåä¹‹æ‹’ç»ã€‚</li><li>å¦‚æœè¯¥SentinelèŠ‚ç‚¹å‘ç°è‡ªå·±çš„ç¥¨æ•°å·²ç»å¤§äºæˆ–ç­‰äºmax(quorum, num(sentinels) / 2 + 1)ï¼Œé‚£ä¹ˆå®ƒå°±æˆä¸ºé¢†å¯¼è€…ã€‚</li><li>å¦‚æœæ­¤è¿‡ç¨‹æ²¡æœ‰é€‰ä¸¾å‡ºé¢†å¯¼è€…ï¼Œå°†è¿›å…¥ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚</li><li>åŸºæœ¬ä¸Šè°å…ˆå®Œæˆå®¢è§‚ä¸‹çº¿ï¼Œè°å°±æ˜¯é¢†å¯¼è€…ã€‚</li></ol><h3 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><p>é¢†å¯¼è€…é€‰ä¸¾å‡ºçš„Sentinelå°†è´Ÿè´£æ•…éšœè½¬ç§»ã€‚</p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li>ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚<ul><li>è¿‡æ»¤æ‰ä¸ä¸»è§‚ä¸‹çº¿ã€æ‰çº¿ã€5ç§’å†…æ²¡æœ‰å›å¤Sentinel pingå“åº”ç­‰ç­‰çš„èŠ‚ç‚¹â€¦</li><li>é€‰æ‹©ä»èŠ‚ç‚¹ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚</li><li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚</li><li>é€‰æ‹©runidæœ€å°çš„ä»èŠ‚ç‚¹ã€‚</li></ul></li><li>å¯¹é€‰ä¸¾å‡ºçš„èŠ‚ç‚¹æ‰§è¡Œslave of no oneï¼Œå‡çº§ä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li>Sentinelé¢†å¯¼è€…èŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</li><li>Sentinelé›†åˆèŠ‚ç‚¹å°†åŸä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå¹¶ä¿æŒå¯¹å…¶å…³æ³¨ï¼Œå½“å…¶æ¢å¤åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å“¨å…µ </tag>
            
            <tag> é«˜å¯ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æRediså¤åˆ¶åŸç†</title>
      <link href="/2018/11/11/Redis-Replication/"/>
      <url>/2018/11/11/Redis-Replication/</url>
      
        <content type="html"><![CDATA[<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸ºäº†è§£å†³å•ç‚¹é—®é¢˜ï¼Œé€šå¸¸ä¼šæŠŠæ•°æ®å¤åˆ¶æˆå¤šä¸ªå‰¯æœ¬éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œä»¥æ»¡è¶³è´Ÿè½½å‡è¡¡å’Œæ•…éšœæ¢å¤ç­‰éœ€æ±‚ï¼ŒRedisä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒRedisæ”¯æŒç®€å•ä¸”æ˜“ç”¨çš„<strong>ä¸»ä»å¤åˆ¶ï¼ˆmaster-slave replicationï¼‰</strong>åŠŸèƒ½ã€‚</p><a id="more"></a><h3 id="å¤åˆ¶è¿‡ç¨‹"><a href="#å¤åˆ¶è¿‡ç¨‹" class="headerlink" title="å¤åˆ¶è¿‡ç¨‹"></a>å¤åˆ¶è¿‡ç¨‹</h3><p><img src="https://i.loli.net/2018/11/11/5be8246daff44.png" alt=""></p><ol><li>slaveæ‰§è¡Œslaveofå‘½ä»¤ï¼Œslaveåªä¿å­˜masterçš„åœ°å€ä¿¡æ¯åå°±è¿”å›ã€‚</li><li>slaveé€šè¿‡å†…éƒ¨æ¯ç§’è¿è¡Œçš„å®šæ—¶ä»»åŠ¡ç»´æŠ¤å¤åˆ¶ç›¸å…³çš„é€»è¾‘ï¼Œå½“å®šæ—¶ä»»åŠ¡å‘ç°æ–°çš„masterä¿¡æ¯æ—¶ï¼Œå¼€å§‹å°è¯•ä¸masterå»ºç«‹ç½‘ç»œè¿æ¥ã€‚å¦‚æœæ— æ³•å»ºç«‹è¿æ¥ï¼Œslaveä¼šä¸€ç›´æ— é™æ¬¡é‡è¿ç›´åˆ°è¿æ¥æˆåŠŸæˆ–è€…å–æ¶ˆå¤åˆ¶ã€‚</li><li>è¿æ¥å»ºç«‹æˆåŠŸåslaveä¼šå‘é€pingè¯·æ±‚è¿›è¡Œé¦–æ¬¡é€šä¿¡ï¼Œæ£€æµ‹ä¸»ä»ä¹‹é—´ç½‘ç»œå¥—æ¥å­—æ˜¯å¦å¯ç”¨ã€æ£€æµ‹msaterå½“å‰æ˜¯å¦å¯æ¥å—å¤„ç†å‘½ä»¤ã€‚</li><li>å¦‚æœmasterè®¾ç½®äº†requirepasså‚æ•°ï¼Œåˆ™éœ€è¦å¯†ç éªŒè¯ã€‚</li><li>é¦–æ¬¡å»ºç«‹å¤åˆ¶ï¼Œä¸»ä»èŠ‚ç‚¹ä¼šè¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ã€‚</li><li>åŒæ­¥æ•°æ®é›†æˆåŠŸåï¼ŒmasteræŒç»­æŠŠåç»­çš„å†™å‘½ä»¤å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»ä¸€è‡´æ€§ã€‚</li></ol><h3 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h3><h4 id="å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Ÿ"></a>å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Ÿ</h4><h5 id="å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"><a href="#å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰" class="headerlink" title="å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"></a>å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰</h5><p>å‚ä¸ä¸»ä»å¤åˆ¶çš„masterå’Œslaveä¼šä¿å­˜å„è‡ªçš„å¤åˆ¶åç§»é‡ï¼Œslaveçš„å¤åˆ¶åç§»é‡åˆå§‹å€¼ä¸º-1ã€‚masterå¤„ç†å†™å…¥å‘½ä»¤åï¼Œä¼šå¯¹è‡ªå·±çš„å¤åˆ¶åç§»é‡è¿›è¡Œç´¯åŠ ï¼›slaveæ”¶åˆ°masterå‘é€çš„å‘½ä»¤åï¼Œä¹Ÿä¼šå¯¹è‡ªå·±çš„å¤åˆ¶åç§»é‡è¿›è¡Œç´¯åŠ ï¼Œå¹¶ä¸”slaveæ¯ç§’ä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ç»™masterï¼Œæ‰€ä»¥masterä¹Ÿä¿å­˜äº†slaveçš„å¤åˆ¶åç§»é‡ã€‚å€˜è‹¥ä¸»ä»å¤åˆ¶åç§»é‡å·®è·è¿‡å¤§ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯å› ä¸ºé˜»å¡æˆ–ç½‘ç»œå»¶è¿Ÿé«˜é€ æˆçš„ã€‚</p><h5 id="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"><a href="#å¤åˆ¶ç§¯å‹ç¼“å†²åŒº" class="headerlink" title="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"></a>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</h5><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¿å­˜åœ¨masterä¸Šçš„ä¸€ä¸ªå›ºå®šé•¿åº¦çš„é˜Ÿåˆ—ã€‚å½“masterå¤„ç†å†™å…¥å‘½ä»¤åï¼Œä¸ä»…ä¼šæŠŠå‘½ä»¤å‘é€ç»™slaveï¼Œä¹Ÿä¼šæŠŠå‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚å¤åˆ¶ç§¯å‹ç¼“å†²åŒºç”¨äºä¿å­˜æœ€è¿‘å·²å¤åˆ¶æ•°æ®ï¼Œå¯ç”¨äºéƒ¨åˆ†å¤åˆ¶æˆ–å¤åˆ¶å‘½ä»¤ä¸¢å¤±çš„æ•°æ®è¡¥æ•‘ã€‚</p><h5 id="ä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼ˆrunIdï¼‰"><a href="#ä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼ˆrunIdï¼‰" class="headerlink" title="ä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼ˆrunIdï¼‰"></a>ä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼ˆrunIdï¼‰</h5><p>æ¯ä¸ªRediså¯åŠ¨åä¼šåŠ¨æ€åˆ†é…ä¸€ä¸ª40ä½çš„åå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²ä½œä¸ºè¿è¡ŒIDï¼Œè¿è¡ŒIDçš„ä¸»è¦ä½œç”¨æ˜¯å”¯ä¸€è¯†åˆ«RedisèŠ‚ç‚¹ã€‚å¦‚æœmasterè¿è¡ŒIDå‘ç”Ÿå˜åŒ–åï¼Œä¸»ä»èŠ‚ç‚¹å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚</p><h5 id="psyncå‘½ä»¤"><a href="#psyncå‘½ä»¤" class="headerlink" title="psyncå‘½ä»¤"></a>psyncå‘½ä»¤</h5><p>slaveä½¿ç”¨psyncå‘½ä»¤å®Œæˆéƒ¨åˆ†å¤åˆ¶å’Œå…¨é‡å¤åˆ¶åŠŸèƒ½ï¼Œå‘½ä»¤æ ¼å¼ï¼špsync {runId} {offset}ã€‚slaveå‘é€psyncå‘½ä»¤ç»™masterï¼Œmasteræ ¹æ®psyncçš„å‚æ•°å’Œè‡ªèº«æ•°æ®å†³å®šå“åº”ç»“æœï¼ˆå…¨é‡å¤åˆ¶ã€éƒ¨åˆ†å¤åˆ¶ã€é”™è¯¯ï¼‰ã€‚</p><h4 id="å…¨é‡å¤åˆ¶"><a href="#å…¨é‡å¤åˆ¶" class="headerlink" title="å…¨é‡å¤åˆ¶"></a>å…¨é‡å¤åˆ¶</h4><p>å…¨é‡å¤åˆ¶æ˜¯redisæœ€æ—©æ”¯æŒçš„å¤åˆ¶æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹åå¿…é¡»ç»å†çš„é˜¶æ®µã€‚</p><h5 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h5><p><img src="https://i.loli.net/2018/11/11/5be83c2112548.png" alt=""></p><ol><li>å‘é€psyncå‘½ä»¤è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œå¤åˆ¶ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰å¤åˆ¶åç§»é‡å’Œä¸»èŠ‚ç‚¹è¿è¡ŒIDï¼Œæ‰€ä»¥å‘é€psync ? -1ã€‚</li><li>ä¸»èŠ‚ç‚¹æ ¹æ®psyncè§£æå½“å‰ä¸ºå…¨é‡å¤åˆ¶ï¼Œå›å¤+FULLRESYNCå“åº”ã€‚</li><li>slaveæ¥æ”¶åˆ°masterçš„å“åº”æ•°æ®ï¼Œä¿å­˜runIdå’Œoffsetã€‚</li><li>masterå¼€å§‹æ‰§è¡Œbgsaveï¼Œä¿å­˜RDBåˆ°æœ¬åœ°ã€‚</li><li>masterå‘é€RDBæ–‡ä»¶ç»™slaveï¼Œslaveæ¥å—åˆ°RDBæ–‡ä»¶åå­˜å‚¨ä¸ºè‡ªå·±çš„æ•°æ®æ–‡ä»¶ã€‚ï¼ˆå¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œå­˜åœ¨è¶…æ—¶å…¨é‡å¤åˆ¶å¤±è´¥çš„é£é™©ï¼‰ã€‚</li><li>ä»slaveå¼€å§‹æ¥å—RDBåˆ°æ¥å—å®ŒæˆæœŸé—´ï¼Œmasterä»åœ¨å¤„ç†è¯»å†™å‘½ä»¤ã€‚åœ¨è¿™æœŸé—´ï¼Œmasterå°†å†™å‘½ä»¤å†™å…¥å®¢æˆ·ç«¯ç¼“å†²åŒºï¼Œå½“slaveåŠ è½½å®ŒRDBåï¼Œå†æŠŠç¼“å†²åŒºå†…çš„æ•°æ®å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>slaveæ¥å—å®Œmasterä¼ é€çš„æ•°æ®åä¼šæ¸…ç©ºè‡ªèº«æ—§æ•°æ®ã€‚</li><li>slaveæ¸…ç©ºæ•°æ®åå¼€å§‹ä»·å€¼RDBæ–‡ä»¶ï¼Œå¦‚æœRDBæ–‡ä»¶è¿‡å¤§ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸è€—æ—¶ã€‚å¦‚æœslaveæ­£å¤„äºå…¨é‡å¤åˆ¶é˜¶æ®µæˆ–è€…å¤åˆ¶ä¸­æ–­ï¼Œé‚£ä¹ˆslaveå“åº”è¯»å‘½ä»¤æ—¶å¯èƒ½æ‹¿åˆ°è¿‡æœŸæˆ–é”™è¯¯çš„æ•°æ®ï¼Œæ•°æ®å‡ºç°ä¸ä¸€è‡´ã€‚ï¼ˆå¯ä»¥é€šè¿‡è®¾ç½®slave-serve-stable-dataå‚æ•°æ¥å…³é—­å¯¹è¯»å‘½ä»¤çš„å“åº”ï¼‰</li><li>slaveåŠ è½½å®ŒRDBåï¼Œå¦‚æœslaveå¼€å¯äº†AOFæŒä¹…åŒ–ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œbgrewriteaofæ“ä½œï¼Œä¿è¯å…¨é‡å¤åˆ¶åAOFæŒä¹…åŒ–æ–‡ä»¶ç«‹åˆ»å¯ç”¨ã€‚</li></ol><h5 id="æ—¶é—´å¼€é”€"><a href="#æ—¶é—´å¼€é”€" class="headerlink" title="æ—¶é—´å¼€é”€"></a>æ—¶é—´å¼€é”€</h5><ol><li>master bgsaveæ—¶é—´</li><li>RDBæ–‡ä»¶ç½‘ç»œä¼ è¾“æ—¶é—´</li><li>salveæ¸…ç©ºæ•°æ®æ—¶é—´</li><li>slaveåŠ è½½RDBæ—¶é—´</li><li>å¯èƒ½çš„AOFé‡å†™æ—¶é—´</li></ol><p>ç”±æ­¤å¯è§ï¼Œå…¨é‡å¤åˆ¶çš„æ—¶é—´å¼€é”€å¤§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„CPUã€å†…å­˜ã€ç½‘ç»œèµ„æºã€‚æ‰€ä»¥é™¤äº†ç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œå…¶ä½™åœºæ™¯åº”è¯¥è§„é¿å…¨é‡å¤åˆ¶çš„å‘ç”Ÿã€‚</p><h4 id="éƒ¨åˆ†å¤åˆ¶"><a href="#éƒ¨åˆ†å¤åˆ¶" class="headerlink" title="éƒ¨åˆ†å¤åˆ¶"></a>éƒ¨åˆ†å¤åˆ¶</h4><p>éƒ¨åˆ†å¤åˆ¶ä¸»è¦æ˜¯Redisé’ˆå¯¹å…¨é‡å¤åˆ¶è¿‡é«˜å¼€é”€ä½œå‡ºçš„ä¸€ç§ä¼˜åŒ–æªæ–½ã€‚å½“slaveæ­£åœ¨å¤åˆ¶masteræ—¶ï¼Œå¦‚æœå‡ºç°ç½‘ç»œé—ªæ–­æˆ–è€…å‘½ä»¤ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼Œslaveä¼šå‘masterè¦æ±‚è¡¥å‘ä¸¢å¤±çš„å‘½ä»¤æ•°æ®ï¼Œå¦‚æœmasterçš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå†…å­˜åœ¨è¿™éƒ¨åˆ†æ•°æ®åˆ™ä¹‹é—´å‘ç»™slaveï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä¸»ä»èŠ‚ç‚¹å¤åˆ¶çš„ä¸€è‡´æ€§ã€‚è¡¥å‘çš„è¿™éƒ¨åˆ†æ•°æ®ä¸€èˆ¬è¿œè¿œå°äºå…¨é‡æ•°æ®ï¼Œæ‰€ä»¥å¼€é”€å¾ˆå°ã€‚</p><h5 id="è¿‡ç¨‹-1"><a href="#è¿‡ç¨‹-1" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h5><p><img src="https://i.loli.net/2018/11/11/5be83a9d22ddf.png" alt=""></p><ol><li>ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºç°ä¸­æ–­æ—¶ï¼Œå¦‚æœè¶…è¿‡repl-timeoutæ—¶é—´ï¼Œmasterä¼šè®¤ä¸ºslaveæ•…éšœå¹¶ä¸­æ–­å¤åˆ¶è¿æ¥ã€‚</li><li>ä¸»ä»è¿æ¥ä¸­æ–­æœŸé—´masterä¾ç„¶å“åº”å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œä½†å¤åˆ¶è¿æ¥ä¸­æ–­å‘½ä»¤æ— æ³•å‘é€ç»™slaveï¼Œä¸è¿‡masterå†…éƒ¨å­˜åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œå¯ä»¥ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å‘½ä»¤æ•°æ®ï¼Œé»˜è®¤æœ€å¤§ç¼“å­˜1MBã€‚</li><li>ä¸»ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼Œslaveå†æ¬¡è¿ä¸Šmasterã€‚</li><li>ä¸»ä»è¿æ¥æ¢å¤åï¼Œç”±äºslaveä¿å­˜äº†è‡ªèº«å·²å¤åˆ¶çš„åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDï¼Œæ­¤æ—¶å°†ä»–ä»¬ä½œä¸ºå‚æ•°å‘é€ç»™masterï¼Œè¦æ±‚è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚</li><li>masteræ¥åˆ°psyncå‘½ä»¤åè¿›è¡Œæ ¸å¯¹ï¼Œç„¶åæ ¹æ®offsetåœ¨è‡ªèº«å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ’åº§ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äºç¼“å†²åŒºï¼Œåˆ™å¯¹slaveå‘é€+CONTINUEå“åº”ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚</li><li>masteræ ¹æ®offsetæŠŠå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œçš„æ•°æ®å‘é€ç»™slaveï¼Œä¿è¯ä¸»ä»å¤åˆ¶è¿›å…¥æ­£å¸¸çŠ¶æ€ã€‚</li></ol><h4 id="å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å‘½ä»¤åŒæ­¥ï¼‰"><a href="#å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å‘½ä»¤åŒæ­¥ï¼‰" class="headerlink" title="å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å‘½ä»¤åŒæ­¥ï¼‰"></a>å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å‘½ä»¤åŒæ­¥ï¼‰</h4><p>masterä¸ä»…è´Ÿè´£æ•°æ®è¯»å†™ï¼Œè¿˜è´Ÿè´£æŠŠå†™å‘½ä»¤åŒæ­¥ç»™slaveã€‚å†™å‘½ä»¤çš„å‘é€æ˜¯å¼‚æ­¥å®Œæˆï¼Œmasterè‡ªèº«å¤„ç†å®Œå†™å‘½ä»¤åç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ç­‰å¾…slaveå¤åˆ¶å®Œæˆã€‚ç”±äºä¸»ä»å¤åˆ¶è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå°±ä¼šé€ æˆsalveæ•°æ®ç›¸å¯¹masterå­˜åœ¨å»¶è¿Ÿã€‚</p><h4 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h4><p>ä¸»ä»èŠ‚ç‚¹å»ºç«‹å¤åˆ¶åï¼Œå®ƒä»¬ä¹‹é—´ç»´æŠ¤ç€é•¿è¿æ¥å¹¶å½¼æ­¤å‘é€å¿ƒè·³å‘½ä»¤ã€‚</p><h5 id="ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶"><a href="#ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶" class="headerlink" title="ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶"></a>ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶</h5><ol><li>ä¸»ä»èŠ‚ç‚¹å„è‡ªéƒ½æœ‰å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œå„è‡ªæ¨¡æ‹Ÿæˆå¯¹æ–¹çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚</li><li>masteré»˜è®¤æ¯éš”10så¯¹slaveå‘é€pingå‘½ä»¤ï¼Œåˆ¤æ–­slaveçš„å­˜æ´»æ€§å’Œè¿æ¥çŠ¶æ€ã€‚</li><li>slaveæ¯éš”1så¯¹masterå‘é€replconf ack {offset}å‘½ä»¤ï¼Œç»™masterä¸ŠæŠ¥è‡ªèº«å½“å‰çš„å¤åˆ¶åç§»é‡ã€‚replconfå‘½ä»¤å¸¸ç”¨äºæ£€æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ã€ä¸ŠæŠ¥è‡ªèº«å¤åˆ¶åç§»é‡ï¼Œæ£€æµ‹å¤åˆ¶æ•°æ®æ˜¯å¦ä¸¢å¤±ï¼Œå¦‚æœslaveæ•°æ®ä¸¢å¤±ï¼Œå†ä»masterçš„å¤åˆ¶ç¼“å†²åŒºæ‹‰å–ä¸¢å¤±æ•°æ®ã€‚ã€å®ç°ä¿è¯slaveçš„æ•°é‡å’Œå»¶è¿Ÿæ€§åŠŸèƒ½ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸»ä»å¤åˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•äº†è§£Redisä¸­çš„æŒä¹…åŒ–æœºåˆ¶</title>
      <link href="/2018/11/09/Redis-Rersistence/"/>
      <url>/2018/11/09/Redis-Rersistence/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ</h3><p>æŒä¹…åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹è½¬æ¢ä¸ºå­˜å‚¨æ¨¡å‹ï¼Œæ›´é€šä¿—çš„è¯´ï¼Œå°±æ˜¯å°†æ•°æ®ä¿å­˜åˆ°ç³»ç»Ÿç¡¬ç›˜ä¸­ã€‚</p><p>Redisæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦ç¨‹åºå´©æºƒæˆ–é‡å¯ï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–ã€‚</p><a id="more"></a><h3 id="RDBï¼ˆé»˜è®¤å¼€å¯ï¼‰"><a href="#RDBï¼ˆé»˜è®¤å¼€å¯ï¼‰" class="headerlink" title="RDBï¼ˆé»˜è®¤å¼€å¯ï¼‰"></a>RDBï¼ˆé»˜è®¤å¼€å¯ï¼‰</h3><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>RDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹ï¼Œé€‚ç”¨äºå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ã€‚</p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li>æ‰§è¡Œbgsaveå‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹å¦‚AOFå­è¿›ç¨‹ï¼Œè‹¥æœ‰ç›´æ¥è¿”å›ã€‚</li><li>çˆ¶è¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œforkæ“ä½œä¼šé˜»å¡çˆ¶è¿›ç¨‹ã€‚</li><li>forkå®Œæˆåï¼Œçˆ¶è¿›ç¨‹å¤„ç†å…¶ä»–å‘½ä»¤ã€‚</li><li>å­è¿›ç¨‹åˆ›å»ºRDBæ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆåå¯¹æ—§æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢ã€‚</li><li>å­è¿›ç¨‹å‘é€ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡æ¶ˆæ¯ã€‚</li></ol><p><img src="https://i.loli.net/2018/11/09/5be58cf902601.png" alt=""></p><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ol><li>RDBæ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¿å­˜ç€Redisåœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¸Šçš„æ•°æ®é›†ï¼Œéå¸¸é€‚åˆå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ã€‚</li><li>RDBéå¸¸é€‚ç”¨äºç¾éš¾æ¢å¤ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”éå¸¸ç´§å‡‘ï¼Œå¯ä»¥åŠ å¯†åä¼ é€åˆ°å…¶ä»–æ•°æ®ä¸­å¿ƒã€‚</li><li>çˆ¶è¿›ç¨‹ä¿å­˜RDBæ–‡ä»¶æ—¶ä»…ä»…éœ€è¦èŠ±è´¹forkä¸€ä¸ªå­è¿›ç¨‹çš„æ—¶é—´ï¼Œæ— éœ€æ‰§è¡Œä»»ä½•ç£ç›˜I/Oæ“ä½œã€‚</li><li>RedisåŠ è½½RDBæ¢å¤æ•°æ®è¿œè¿œå¿«äºAOFçš„æ–¹å¼ã€‚</li></ol><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol><li>å› ä¸ºRDBæ–‡ä»¶éœ€è¦ä¿å­˜æ•´ä¸ªæ•°æ®é›†çš„çŠ¶æ€ï¼ŒèŠ±è´¹æ•°åˆ†é’Ÿçš„æ—¶é—´ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç”Ÿæ•…éšœåœæœºï¼Œå¯èƒ½ä¼šä¸¢å¤±æ•°åˆ†é’Ÿçš„æ•°æ®ã€‚</li><li>æ¯æ¬¡ä¿å­˜RDBæ—¶ï¼ŒRediséœ€è¦forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ç”±å­è¿›ç¨‹è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼›å¦‚æœæ•°æ®é›†å¾ˆåºå¤§ï¼Œfork()å¯èƒ½ä¼šéå¸¸è€—æ—¶ï¼Œé€ æˆæœåŠ¡å™¨åœ¨çŸ­æ—¶é—´ï¼ˆæ¯«ç§’çº§ï¼‰å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯ï¼›å¦‚æœCPUæ¯”è¾ƒç´§å¼ ï¼Œforkè¿‡ç¨‹å¯èƒ½é•¿è¾¾æ•´æ•´ä¸€ç§’ã€‚</li></ol><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>AOFæŒä¹…åŒ–æ˜¯ä»¥ç‹¬ç«‹çš„æ—¥å¿—è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼ŒRedisé‡å¯çš„æ—¶å€™æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚</p><h4 id="è¿‡ç¨‹-1"><a href="#è¿‡ç¨‹-1" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li>æ‰€æœ‰å†™å‘½ä»¤éƒ½ä¼šè¿½åŠ åˆ°AOFç¼“å†²åŒºã€‚</li><li>AOFç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œã€‚</li><li>éšç€AOFæ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å®šæœŸå¯¹AOFæ–‡ä»¶è¿›è¡Œé‡å†™ä»¥è¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚</li></ol><p><img src="https://i.loli.net/2018/11/09/5be5935373f4f.png" alt=""></p><h5 id="AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥"><a href="#AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥" class="headerlink" title="AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥"></a>AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥</h5><p>å¯ä»¥é…ç½®Rediså¤šä¹…å°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸€æ¬¡ã€‚</p><ul><li>always: æ¯æ¬¡æœ‰å†™å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒºæ—¶å°±è°ƒç”¨ç³»ç»Ÿfsyncæ“ä½œåŒæ­¥åˆ°AOFæ–‡ä»¶ã€‚</li><li>everysecï¼šå‘½ä»¤å†™å…¥AOFç¼“å†²åŒºåè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼ŒfsyncåŒæ­¥æ–‡ä»¶æ“ä½œç”±ä¸“é—¨çº¿ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>noï¼šå‘½ä»¤å†™å…¥AOFç¼“å†²åŒºåè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼Œä¸å¯¹AOFæ–‡ä»¶åšfsyncæ“ä½œï¼ŒåŒæ­¥ç¡¬ç›˜ç”±ç³»ç»Ÿè´Ÿè´£ï¼Œé€šå¸¸åŒæ­¥å‘¨æœŸä¸º30sã€‚</li></ul><h5 id="AOFé‡å†™æœºåˆ¶"><a href="#AOFé‡å†™æœºåˆ¶" class="headerlink" title="AOFé‡å†™æœºåˆ¶"></a>AOFé‡å†™æœºåˆ¶</h5><p>AOFæ–‡ä»¶é‡å†™æ˜¯æŠŠRedisè¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–°AOFæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ï¼ˆå› ä¸ºé‡å†™AOFæ–‡ä»¶æ—¶ï¼ŒRedisä¼šåˆå¹¶å¤šæ¡å†™å‘½ä»¤ã€ä¸¢å¼ƒè¶…æ—¶çš„æ•°æ®ã€åˆ é™¤æ— æ•ˆå‘½ä»¤ï¼Œæ‰€ä»¥é‡å†™åçš„AOFæ–‡ä»¶è¦å°äºæ—§æ–‡ä»¶ï¼‰</p><p><img src="https://i.loli.net/2018/11/09/5be5998076507.png" alt=""></p><h4 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ol><li>ä½¿ç”¨AOFæŒä¹…åŒ–ä½¿å¾—Redisæ›´åŠ è€ä¹…ï¼ŒAOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥å¯ä»¥ä½¿å¾—Rediså°±ç®—å‘ç”Ÿæ•…éšœåœæœºï¼Œä¹Ÿæœ€å¤šä¸¢å¤±1sçš„æ•°æ®ï¼ˆå®é™…ä¸Šæœ€å¤šä¸º2sï¼‰ã€‚</li><li>AOFæ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥Redisåè®®çš„æ ¼å¼ä¿å­˜ï¼Œæ–‡ä»¶å†…å®¹æ˜“æ‡‚ä¸”å®¹æ˜“åˆ†æã€å¯¼å‡ºã€‚</li></ol><h4 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol><li>AOFæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸å¤§äºRDBæ–‡ä»¶çš„ä½“ç§¯ã€‚</li><li>AOFçš„é€Ÿåº¦å¯èƒ½æ…¢äºRDBã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŒä¹…åŒ– ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•å…¥é—¨ä¹‹åˆçº§æ’åºï¼ˆé€‰æ‹©ã€æ’å…¥ã€å¸Œå°”ï¼‰</title>
      <link href="/2018/10/03/sort-1/"/>
      <url>/2018/10/03/sort-1/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹é¢æ˜¯é€‰æ‹©æ’åºã€æ’å…¥æ’åºã€å¸Œå°”æ’åºç­‰åˆçº§æ’åºçš„ç®€å•ä»‹ç»åŠå®ç°ã€‚</p><a id="more"></a><h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol><li>é¦–å…ˆæ‰¾åˆ°æ•°ç»„ä¸­æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ç½®æ¢ä½ç½®ã€‚</li><li>ä»å‰©ä½™çš„å…ƒç´ ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶ä¸ç¬¬äºŒä¸ªå…ƒç´ ç½®æ¢ä½ç½®ã€‚</li><li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ•°ç»„å®Œå…¨æœ‰åºã€‚</li></ol><p><strong>é€‰æ‹©æ’åºæ‰€éœ€çš„æ—¶é—´å–å†³äºå…ƒç´ çš„æ•°é‡</strong></p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Selection</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = a.length;</span><br><span class="line">        <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> min = i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[min] &gt; a[j]) &#123;</span><br><span class="line">                    min = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        temp = a[min];</span><br><span class="line">            a[min] = a[i];</span><br><span class="line">            a[i] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h3><h4 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol><li>ç¬¬äºŒä¸ªå…ƒç´ ä¸å·¦ä¾§çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚</li><li>ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸å·¦ä¾§çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚</li><li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ•°ç»„å®Œå…¨æœ‰åºã€‚</li></ol><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Insertion</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = a.length;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[j] &lt; a[j-<span class="number">1</span>]) &#123;</span><br><span class="line">          temp = a[j];</span><br><span class="line">          a[j] = a[j-<span class="number">1</span>];</span><br><span class="line">          a[j-<span class="number">1</span>] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ’å…¥æ’åºæ‰€éœ€çš„æ—¶é—´å–å†³äºå…ƒç´ çš„åˆå§‹é¡ºåº</strong></p><h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><p>å¸Œå°”æ’åºæ˜¯<strong>åŸºäºæ’å…¥æ’åº</strong>çš„å¿«é€Ÿæ’åºï¼Œæ€æƒ³æ˜¯ä½¿æ•°ç»„ä¸­<strong>ä»»æ„é—´éš”ä¸ºhçš„å…ƒç´ æ˜¯æœ‰åºçš„ã€‚</strong></p><h4 id="æ­¥éª¤ï¼ˆåºåˆ—1-2-3-k-1-ï¼‰"><a href="#æ­¥éª¤ï¼ˆåºåˆ—1-2-3-k-1-ï¼‰" class="headerlink" title="æ­¥éª¤ï¼ˆåºåˆ—1/2(3^k - 1)ï¼‰"></a>æ­¥éª¤ï¼ˆåºåˆ—1/2(3^k - 1)ï¼‰</h4><ol><li>å¢å¹…hä¸ºæ•°ç»„é•¿åº¦çš„æŸä¸ªå€æ•°ï¼ˆæœ€å°å€¼ä¸º1ï¼‰ï¼Œç„¶åè®¡ç®—å‡ºå¢é•¿åºåˆ—(1, 4, 13, â€¦)ã€‚</li><li>h = h(max)ï¼Œç¡®ä¿é—´éš”ä¸ºhçš„å…ƒç´ æœ‰åºã€‚</li><li>h = h / 3ï¼Œç¡®ä¿é—´éš”ä¸ºhçš„å…ƒç´ æœ‰åºã€‚</li><li>é‡å¤ç¬¬3æ­¥ï¼Œç›´è‡³æ•°ç»„å®Œå…¨æœ‰åºã€‚</li></ol><h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shell</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = a.length;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    System.out.print(h);</span><br><span class="line">    <span class="keyword">while</span> (h &lt; N / <span class="number">3</span>)</span><br><span class="line">      h = h * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = h; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= h; j -= h) &#123;</span><br><span class="line">          <span class="keyword">if</span> (a[j - h] &gt; a[j]) &#123;</span><br><span class="line">            temp = a[j - h];</span><br><span class="line">            a[j - h] = a[j];</span><br><span class="line">            a[j] = temp;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      h /= <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>åç§°</th><th>ä½¿ç”¨åœºæ™¯</th><th>æ—¶é—´å¤æ‚åº¦</th><th>æ•ˆç‡å½±å“å› ç´ </th></tr></thead><tbody><tr><td>é€‰æ‹©æ’åº</td><td>å°å‹æ•°ç»„</td><td>O(N^2)</td><td>æ•°ç»„å¤§å°</td></tr><tr><td>æ’å…¥æ’åº</td><td>å°å‹æ•°ç»„ï¼Œæ•°ç»„éƒ¨åˆ†æœ‰åº</td><td>O(N^2)</td><td>å…ƒç´ åˆå§‹é¡ºåº</td></tr><tr><td>å¸Œå°”æ’åº</td><td>ä¸­å°å‹æ•°ç»„ï¼Œæ•°ç»„éƒ¨åˆ†æœ‰åº</td><td>O(N^3/2), O(N^4/3), O(N^6/5)â€¦</td><td>å…ƒç´ åˆå§‹é¡ºåºï¼Œå¢é•¿åºåˆ—</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React Diff</title>
      <link href="/2018/09/23/react-diff/"/>
      <url>/2018/09/23/react-diff/</url>
      
        <content type="html"><![CDATA[<p>è®¡ç®—ä¸€æ£µæ ‘å½¢ç»“æ„è½¬æ¢æˆå¦ä¸€æ£µæ ‘å½¢ç»“æ„ï¼Œä¼ ç»Ÿçš„diffç®—æ³•ç®—æ³•å¤æ‚åº¦è¾¾åˆ°<strong>O(n^3)</strong>ã€‚Reacté€šè¿‡åˆ¶å®šç­–ç•¥ï¼Œå°†O(n^3)å¤æ‚åº¦çš„é—®é¢˜è½¬æ¢æˆ<strong>O(n)</strong>å¤æ‚åº¦ã€‚</p><a id="more"></a><h4 id="Diff-ç­–ç•¥"><a href="#Diff-ç­–ç•¥" class="headerlink" title="Diff ç­–ç•¥"></a>Diff ç­–ç•¥</h4><ol><li>Web UI ä¸­DOMèŠ‚ç‚¹è·¨å±‚çº§çš„ç§»åŠ¨æ“ä½œç‰¹åˆ«å°‘ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li><li>æ‹¥æœ‰ç›¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆç›¸ä¼¼çš„æ ‘å½¢ç»“æ„ï¼Œæ‹¥æœ‰ä¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆä¸åŒçš„æ ‘å½¢ç»“æ„ã€‚</li><li>å¯¹äºåŒä¸€å±‚çº§çš„ä¸€ç»„å­èŠ‚ç‚¹ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡å”¯ä¸€idè¿›è¡ŒåŒºåˆ†ã€‚</li></ol><h4 id="Tree-Diff"><a href="#Tree-Diff" class="headerlink" title="Tree Diff"></a>Tree Diff</h4><p>å¯¹æ ‘è¿›è¡Œåˆ†å±‚æ¯”è¾ƒï¼Œä¸¤æ£µæ ‘åªä¼šå¯¹åŒä¸€å±‚æ¬¡çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å½“èŠ‚ç‚¹è·¨å±‚çº§ç§»åŠ¨æ—¶ï¼Œå¹¶ä¸ä¼šå‡ºç°æƒ³è±¡ä¸­çš„ç§»åŠ¨æ“ä½œï¼Œè€Œæ˜¯è¿›è¡Œcreate-deleteæ“ä½œï¼ˆå½±å“æ€§èƒ½ï¼‰ã€‚</p><h4 id="Component-Diff"><a href="#Component-Diff" class="headerlink" title="Component Diff"></a>Component Diff</h4><ol><li>å¦‚æœæ˜¯åŒç±»å‹çš„ç»„ä»¶ï¼ŒæŒ‰åŸç­–ç•¥ç»§ç»­æ¯”è¾ƒVirtual DOM treeã€‚</li><li>å¦‚æœä¸æ˜¯åŒç±»å‹çš„ç»„ä»¶ï¼Œåˆ™å°†ç»„ä»¶åˆ¤æ–­ä¸ºdirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</li><li>å¦‚æœæ˜¯åŒä¸€ç±»å‹çš„ç»„ä»¶ï¼Œå¹¶ä¸”Virtual DOMæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šçœä¸‹å¤§é‡çš„diffè¿ç®—æ—¶é—´ï¼Œå› æ­¤Reactå…è®¸ç”¨æˆ·é€šè¿‡shouldComponentUpdate()æ¥åˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦è¿›è¡Œdiffã€‚</li></ol><h4 id="Element-Diff"><a href="#Element-Diff" class="headerlink" title="Element Diff"></a>Element Diff</h4><p>å½“èŠ‚ç‚¹å¤„äºåŒä¸€å±‚çº§æ—¶ï¼ŒReact Diffæä¾›äº†ä¸‰ç§èŠ‚ç‚¹æ“ä½œï¼Œåˆ†åˆ«ä¸ºï¼šINSERT_MARKUPã€MOVE_EXISTINGã€REMOVE_NODE</p><ul><li>INSERT_MARKUP:  åŸé›†åˆä¸åŒ…å«æ–°çš„componentç±»å‹ï¼Œæ–°èŠ‚ç‚¹éœ€æ‰§è¡Œæ’å…¥æ“ä½œ</li><li>MOVE_EXISTING:  åŸé›†åˆåŒ…å«æ–°çš„componentç±»å‹ï¼Œä¸”elementæ—¶å¯æ›´æ–°çš„ç±»å‹ï¼ŒgenerateComponentChildrenå·²è°ƒç”¨receiveComponetï¼Œè¿™ç§æƒ…å†µä¸‹prevChild=nextChildï¼Œå°±éœ€è¦åšç§»åŠ¨æ“ä½œï¼Œå¯ä»¥å¤ç”¨ä»¥å‰çš„DOMèŠ‚ç‚¹ã€‚</li><li>REMOVE_NODE:  è€componeç±»å‹ï¼Œåœ¨æ–°é›†åˆä¹Ÿæœ‰ï¼Œä½†å¯¹åº”çš„elementä¸åŒåˆ™ä¸èƒ½ç›´æ¥å¤ç”¨å’Œæ›´æ–°ï¼Œéœ€æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œæˆ–è€…è€componentä¸åœ¨æ–°é›†åˆä¸­ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</li></ul><p>å…è®¸å¼€å‘è€…å¯¹åŒä¸€å±‚çº§çš„åŒç»„å­èŠ‚ç‚¹æ·»åŠ å”¯ä¸€keyä½œä¸ºæ ‡è¯†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£JavaScriptä¹‹Event Loop</title>
      <link href="/2018/06/27/event-loop/"/>
      <url>/2018/06/27/event-loop/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘é˜…è¯»ã€Šé«˜æ€§èƒ½JavaScriptã€‹æ—¶ï¼Œç¬¬å…­ç« è°ˆåˆ°â€œé€šè¿‡å®šæ—¶å™¨å°†JavaScriptæ‰§è¡Œä»£ç çš„æ§åˆ¶æƒå…ˆè®©ç»™æµè§ˆå™¨ç”¨äºæ›´æ–°UIçŠ¶æ€ï¼Œç„¶åå†å°†æ§åˆ¶æƒäº¤å›ç»™JavaScriptä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿å¾—é¡µé¢æ›´ä¸ºæµç•…â€ï¼Œå°±è”æƒ³åˆ°äº†ä¹‹å‰ç†è§£çš„äº‹ä»¶å¾ªç¯ã€‚</p><p>è¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¹ˆåšå¯ä»¥æå‡é¡µé¢çš„æµç•…åº¦ã€‚<br><a id="more"></a></p><h2 id="äº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰"><a href="#äº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰" class="headerlink" title="äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰"></a>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</h2><p><img src="https://user-gold-cdn.xitu.io/2018/6/27/1643fed5a4908e8a?w=574&amp;h=430&amp;f=gif&amp;s=6755" alt="Internal.gif"></p><h3 id="å•çº¿ç¨‹çš„JavaScript"><a href="#å•çº¿ç¨‹çš„JavaScript" class="headerlink" title="å•çº¿ç¨‹çš„JavaScript"></a>å•çº¿ç¨‹çš„JavaScript</h3><p>æ€»æ‰€å‘¨çŸ¥ï¼ŒJavaScriptè¯­è¨€çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯<strong>å•çº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªæ—¶é—´æ®µé‡Œï¼ŒJavaScriptåªèƒ½åšä¸€ä»¶äº‹æƒ…ï¼ˆæµè§ˆå™¨æ˜¯å¤šçº¿ç¨‹ï¼‰ã€‚<br><strong>å¤šçº¿ç¨‹å¯ä»¥å®ç°åº”ç”¨çš„å¹¶è¡Œå¤„ç†ï¼Œä»è€Œä»¥æ›´é«˜çš„CPUåˆ©ç”¨ç‡æé«˜æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œååé‡</strong>ã€‚</p><p><em>ä½†æ˜¯JavaScriptå´ä»¥å•çº¿ç¨‹è¿›è¡Œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</em></p><p>JavaScriptæ˜¯æµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œç”¨äºä¸ç”¨æˆ·äº¤äº’ä»¥åŠæ“ä½œDOMã€‚<br>è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå¹¶å‘çš„æ“ä½œï¼Œå¯¹åŒä¸€ä¸ªDOMèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œåˆ é™¤å’Œä¿®æ”¹æ ·å¼ï¼Œæ­¤æ—¶æµè§ˆå™¨å°±æ— æ³•å†³å®šåˆ°åº•é‡‡ç”¨å“ªä¸ªçº¿ç¨‹çš„æ“ä½œã€‚ç±»ä¼¼æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨â€œé”â€æ¥å¤„ç†å¹¶å‘ï¼Œä½†æ˜¯è¿™ä¼šå¹³æ·»å¤æ‚åº¦ã€‚æ‰€ä»¥ï¼ŒJavaScriptè¯­è¨€æ²¡æœ‰æ”¯æŒå¤šçº¿ç¨‹æ“ä½œã€‚<br>é‚£åˆè€ƒè™‘è¿™ç§æƒ…å†µï¼Œæ—¢ç„¶JavaScriptæ˜¯å•çº¿ç¨‹ï¼Œ<strong>åœ¨æŸä¸€æ—¶åˆ»å†…åªèƒ½æ‰§è¡Œç‰¹å®šçš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šé˜»å¡å…¶å®ƒä»»åŠ¡æ‰§è¡Œ</strong>ã€‚é‚£ä¹ˆå¦‚æœç”¨æˆ·è§¦å‘äº†ä¸€ä¸ªéå¸¸è€—æ—¶çš„I/Oæ“ä½œï¼Œé‚£ä¹ˆæŒ‰é“ç†åç»­çš„æ‰€æœ‰æ“ä½œéƒ½å¾—ç­‰åˆ°I/Oæ“ä½œå®Œæˆåæ–¹å¯è¿›è¡Œã€‚ä½†æ˜¯ï¼Œäº‹å®ä¸Šï¼Œåç»­çš„ä»»åŠ¡ä¸å¿…ç­‰å¾…è¿™ä¸ªè€—æ—¶çš„I/Oæ“ä½œå®Œæˆï¼ŒåŸå› å°±æ˜¯JavaScriptä¸ç”Ÿä¿±æ¥çš„<strong>å¼‚æ­¥å’Œå›è°ƒ</strong>ã€‚</p><p>è€Œè¿™èƒŒåæ°å¥½å°±æ˜¯æœ¬æ–‡çš„ä¸»é¢˜â€”â€”â€”â€”â€”â€”<strong>äº‹ä»¶å¾ªç¯</strong></p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>äº‹ä»¶å¾ªç¯åŒ…å«äº†è‡³å°‘ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œ<strong>å®ä»»åŠ¡</strong>é˜Ÿåˆ—å’Œ<strong>å¾®ä»»åŠ¡</strong>é˜Ÿåˆ—ã€‚</p><h3 id="å®ä»»åŠ¡"><a href="#å®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡"></a>å®ä»»åŠ¡</h3><p>å®ä»»åŠ¡åŒ…å«åˆ›å»ºæ–‡æ¡£å¯¹è±¡ã€è§£æHTMLã€æ‰§è¡Œä¸»çº¿JavaScriptä»£ç ã€æ›´æ”¹å½“å‰URLä»¥åŠå„ç§äº‹ä»¶ï¼Œä¾‹å¦‚é¡µé¢åŠ è½½ã€è¾“å…¥ã€ç½‘ç»œäº‹ä»¶å’Œå®šæ—¶å™¨ç­‰ç­‰ã€‚å®ä»»åŠ¡è¿è¡Œå®Œæˆåï¼Œæµè§ˆå™¨ç»§ç»­å…¶ä»–çš„ä»»åŠ¡è°ƒåº¦ï¼Œå¦‚é‡æ–°æ¸²æŸ“é¡µé¢æˆ–è€…åƒåœ¾å›æ”¶ã€‚</p><h3 id="å¾®ä»»åŠ¡"><a href="#å¾®ä»»åŠ¡" class="headerlink" title="å¾®ä»»åŠ¡"></a>å¾®ä»»åŠ¡</h3><p>å¾®ä»»åŠ¡åŒ…æ‹¬promiseã€å›è°ƒå‡½æ•°ã€DOMå‘ç”Ÿå˜åŒ–ç­‰ã€‚å¾®ä»»åŠ¡æ›´æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå¿…é¡»åœ¨æµè§ˆå™¨ä»»åŠ¡ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼ˆæ¸²æŸ“UIè§†å›¾æˆ–è€…è¿›è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼‰ä¹‹å‰æ‰§è¡Œã€‚</p><h3 id="ä¸¤ä¸ªåŸºæœ¬åŸåˆ™"><a href="#ä¸¤ä¸ªåŸºæœ¬åŸåˆ™" class="headerlink" title="ä¸¤ä¸ªåŸºæœ¬åŸåˆ™"></a>ä¸¤ä¸ªåŸºæœ¬åŸåˆ™</h3><ol><li>ä¸€æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡</li><li>ä¸€ä¸ªä»»åŠ¡å¼€å§‹ç›´åˆ°è¿è¡Œå®Œæˆï¼Œä¸ä¼šè¢«å…¶ä»–ä»»åŠ¡ä¸­æ–­</li></ol><p><img src="https://user-gold-cdn.xitu.io/2018/6/27/1643fed5a7765dd2?w=872&amp;h=1088&amp;f=png&amp;s=191689" alt="EC06193617CCE1FF11A9C3C68CF8DDF3.png"><br>æ— è®ºæ˜¯å®ä»»åŠ¡é˜Ÿåˆ—è¿˜æ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒäºŒè€…åœ¨åŒä¸€æ—¶åˆ»éƒ½åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¸è¿‡äºŒè€…ä¹Ÿæœ‰é‡è¦çš„åŒºåˆ«ï¼š<strong>åœ¨ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œæœ€å¤šå¤„ç†ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè€Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å¾®ä»»åŠ¡éƒ½ä¼šè¢«å¤„ç†</strong>ã€‚</p><p>åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œäº‹ä»¶å¾ªç¯ä¼šæ£€æŸ¥å½“å‰æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“UIï¼Œå¦‚æœéœ€è¦åˆ™æ¸²æŸ“UIè§†å›¾ã€‚</p><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><ol><li>ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—éƒ½æ˜¯ç‹¬ç«‹äºäº‹ä»¶å¾ªç¯çš„ï¼Œè¿™æ„å‘³ç€ä»»åŠ¡é˜Ÿåˆ—çš„æ·»åŠ å‘ç”Ÿåœ¨äº‹ä»¶å¾ªç¯å¤–ã€‚</li><li>æ‰€æœ‰å¾®ä»»åŠ¡éƒ½ä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“å‰å®Œæˆï¼Œç›®çš„æ˜¯åœ¨æ¸²æŸ“å‰æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚</li><li>æµè§ˆå™¨ä¼šå°è¯•ä»¥æ¯ç§’æ¸²æŸ“60æ¬¡é¡µé¢ï¼Œä»¥è¾¾åˆ°æ¯ç§’60å¸§çš„é€Ÿåº¦ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡å¾ªç¯æœ€ç†æƒ³çš„æ—¶é—´åº”è¯¥ä¸è¶…è¿‡16msã€‚</li><li>æµè§ˆå™¨å®Œæˆé¡µé¢æ¸²æŸ“åï¼Œè¿›å…¥ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯è¿­ä»£åï¼Œå¯èƒ½å‡ºç°3ç§æƒ…å†µ<ol><li>å¦‚æœäº‹ä»¶å¾ªç¯æ‰§è¡Œåˆ°â€œis rendering neededâ€ä¸”æµè§ˆå™¨å¤„äºå¦ä¸€ä¸ª16msç»“æŸä¹‹å‰ï¼ˆå³æµè§ˆå™¨å°šæœªè‡ªåŠ¨è§¦å‘é¡µé¢æ¸²æŸ“æ—¶ï¼‰ï¼Œæµè§ˆå™¨å¯èƒ½ä¸ä¼šé€‰æ‹©åœ¨å½“å‰çš„æ—¶é—´å¾ªç¯ä¸­æ‰§è¡Œæ›´æ–°UIæ“ä½œï¼Œå› ä¸ºæ›´æ–°UIæ˜¯ä¸€ä¸ªå¤æ‚ä¸”è€—æ€§èƒ½çš„æ“ä½œã€‚</li><li>å¦‚æœäº‹ä»¶å¾ªç¯æ‰§è¡Œåˆ°â€œis rendering neededâ€ä¸”æµè§ˆå™¨åˆšå¥½ç¦»ä¸Šä¸€æ¬¡æ¸²æŸ“16mså·¦å³æ—¶ï¼ˆå³æµè§ˆå™¨å³å°†è‡ªåŠ¨è§¦å‘é¡µé¢æ¸²æŸ“æ—¶ï¼‰ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šè¿›è¡ŒUIæ›´æ–°ã€‚</li><li>æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è€—æ—¶è¶…è¿‡16msï¼Œæµè§ˆå™¨å°†æ— æ³•ä»¥ç›®æ ‡å¸§ç‡é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œä¸”UIæ— æ³•è¢«æ›´æ–°ã€‚å¦‚æœå»¶è¿Ÿä¸å¤§æ˜¯å¾ˆéš¾å¯Ÿè§‰åˆ°ï¼Œä½†æ˜¯ï¼Œå¦‚æœæœ‰éå¸¸è€—æ—¶çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·ä¼šè§‰å¾—ç½‘é¡µååˆ†å¡é¡¿ï¼Œç”šè‡³æµè§ˆå™¨ä¼šæç¤ºâ€œæ— å“åº”è„šæœ¬â€ã€‚</li></ol></li></ol><h2 id="å‰æƒ…å›é¡¾"><a href="#å‰æƒ…å›é¡¾" class="headerlink" title="å‰æƒ…å›é¡¾"></a>å‰æƒ…å›é¡¾</h2><p>ç°åœ¨ï¼Œç”¨äº‹ä»¶å¾ªç¯å’Œç®€å•çš„ä¾‹å­æ¥åˆ†æã€Šé«˜æ€§èƒ½çš„JavaScriptã€‹ä¸­çš„é‚£å¥è¯ã€‚<br>éœ€æ±‚ï¼šç»™åŒ…å«1000ä¸ªæ•°å­—çš„æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å–ç»å¯¹å€¼ï¼ˆå‡è®¾å¯¹ä¸€ä¸ªæ•°å­—è¿›è¡Œéœ€æ±‚æ“ä½œè€—æ—¶1msï¼‰ã€‚</p><p>æƒ…å†µ1ï¼ˆä¸ä½¿ç”¨å®šæ—¶å™¨ï¼‰:<br>ç”±äºJavaScriptä¸»çº¿ç¨‹ä»£ç å±äºå®ä»»åŠ¡çš„ä¸€ç§ï¼Œæ‰€ä»¥ä¸€æ¬¡äº‹ä»¶å¾ªç¯éœ€è¦å¤„ç†1000ä¸ªæ•°å­—ï¼Œæ‰€ä»¥1säº‹ä»¶å¾ªç¯æ‰è¿›è¡Œåˆ°UIæ›´æ–°é˜¶æ®µï¼Œä½†æ˜¯ç”±äºè€—æ—¶è¿‡é•¿ï¼ŒUIçŠ¶æ€ä¸ä¼šè¢«æ›´æ–°ï¼Œé¡µé¢å‡ºç°å¡é¡¿ç”šè‡³å µå¡ã€‚</p><p>æƒ…å†µ2ï¼ˆä½¿ç”¨å®šæ—¶å™¨ï¼‰ï¼š<br>å°†ä¸€æ¬¡å¤„ç†1000ä¸ªæ•°å­—çš„ä»»åŠ¡åˆ†å‰²ä¸º20ä¸ªæ¯æ¬¡å¤„ç†50ä¸ªæ•°å­—çš„ä»»åŠ¡ã€‚ç”±äºå®šæ—¶å™¨æ˜¯å®ä»»åŠ¡çš„ä¸€ç§ï¼Œæ‰€ä»¥ä¸€æ¬¡äº‹ä»¶å¾ªç¯åªå¤„ç†50ä¸ªæ•°å­—ï¼Œç”±äºæ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰€ä»¥50msåäº‹ä»¶å¾ªç¯è¿›è¡Œåˆ°UIæ›´æ–°é˜¶æ®µï¼Œç„¶åæ ¹æ®æƒ…å†µè¿›è¡ŒUIæ¸²æŸ“ï¼Œé¡µé¢æœªå‡ºç°å¡é¡¿æˆ–è€…å µå¡ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœåªæ˜¯å•çº¯çš„å¤„ç†æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨<strong>Web Workers</strong>ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>JavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼ŒåŒä¸€æ—¶åˆ»æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚</li><li>äº‹ä»¶å¾ªç¯åŒ…å«ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—å’Œè‡³å°‘ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯ä¸€æ¬¡è¿­ä»£ï¼Œè‡³å¤šæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ä½†æ˜¯ä¼šæ‰§è¡Œå®Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚</li><li>Webåº”ç”¨è¶Šå¤æ‚ï¼Œç§¯æä¸»åŠ¨ç®¡ç†UIçº¿ç¨‹å°±è¶Šé‡è¦ï¼Œå³ä½¿JavaScriptä»£ç å¾ˆé‡è¦ï¼Œä¹Ÿä¸èƒ½å½±å“ç”¨æˆ·ä½“éªŒã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://book.douban.com/subject/4183808/" target="_blank" rel="noopener">ã€ŠHigh Performance JavaScriptã€‹</a></li><li><a href="https://book.douban.com/subject/3176860/" target="_blank" rel="noopener">ã€ŠSecrets of the JavaScript Ninjaã€‹</a></li><li><a href="https://www.w3.org/TR/html52/webappapis.html#event-loops-definitions" target="_blank" rel="noopener">ã€ŠHTML 5.2ã€‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> JavaScriptæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€æ¬¡é¢è¯•ç»å†</title>
      <link href="/2018/05/24/my-first-interview/"/>
      <url>/2018/05/24/my-first-interview/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡æŠ•ç®€å†é¢è¯•â€¦â€¦<br><a id="more"></a></p><h2 id="è…¾è®¯MIGäº‹ä¸šç¾¤-äº‘å®‰å…¨éƒ¨ï¼ˆ5-21ï¼‰"><a href="#è…¾è®¯MIGäº‹ä¸šç¾¤-äº‘å®‰å…¨éƒ¨ï¼ˆ5-21ï¼‰" class="headerlink" title="è…¾è®¯MIGäº‹ä¸šç¾¤ äº‘å®‰å…¨éƒ¨ï¼ˆ5.21ï¼‰"></a>è…¾è®¯MIGäº‹ä¸šç¾¤ äº‘å®‰å…¨éƒ¨ï¼ˆ5.21ï¼‰</h2><p>ç¬¬ä¸€æ¬¡æŠ€æœ¯é¢è¯•ï¼Œæ¯”è¾ƒç´§å¼ ï¼Œé¢è¯•è¿‡ç¨‹20å¤šåˆ†é’Ÿï¼Œæœ€åé—®äº†é¢è¯•å®˜é¹…å‚å‰ç«¯ç”Ÿæ€å’Œéƒ¨é—¨æŠ€æœ¯æ ˆï¼Œä¸‹é¢æ˜¯é¢è¯•å†…å®¹ï¼š</p><ol><li>ä»‹ç»ä¸€ä¸‹è‡ªå·±ï¼Œæœ€è¿‘åœ¨çœ‹ä»€ä¹ˆä¹¦ï¼Œå¦‚ä½•å­¦ä¹ å‰ç«¯çš„ã€‚</li><li>CSSå¦‚ä½•å®ç°å‚ç›´å±…ä¸­ã€æ°´å¹³å±…ä¸­</li><li>å¯¹CSS3äº†è§£ç¨‹åº¦ï¼Œç”¨è¿‡å“ªäº›ç‰¹æ€§</li><li>HTTPçŠ¶æ€ç ã€Webç¼“å­˜</li><li>è·¨åŸŸ</li><li>ä»‹ç»ä¸€ä¸‹XSSå’ŒCSRFï¼Œå¦‚ä½•é¿å…</li><li>JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹</li><li>MVVMçš„åŸç†</li><li>è¯´è¯´ä½ çš„é¡¹ç›®ï¼Œè®²è®²æ”¶è·å¤§çš„åœ°æ–¹ã€‚</li></ol><p>5.17å°±æ¥åˆ°äº†è…¾è®¯é¢è¯•å®˜çš„ç”µè¯ï¼Œé—®äº†æˆ‘ä¸€äº›åŸºæœ¬æƒ…å†µï¼Œçœ‹äº†æˆ‘çš„githubå’Œåšå®¢ï¼Œåé¢ä¹ŸåŠ äº†å¾®ä¿¡ï¼Œç»™äº†æˆ‘ä¸€äº›å¾ˆå¥½çš„å»ºè®®ï¼Œäººéå¸¸niceã€‚ï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡é¢è¯•ï¼‰</p><h2 id="ç™¾åº¦å‰ç«¯æŠ€æœ¯éƒ¨ï¼ˆ5-23ï¼‰"><a href="#ç™¾åº¦å‰ç«¯æŠ€æœ¯éƒ¨ï¼ˆ5-23ï¼‰" class="headerlink" title="ç™¾åº¦å‰ç«¯æŠ€æœ¯éƒ¨ï¼ˆ5.23ï¼‰"></a>ç™¾åº¦å‰ç«¯æŠ€æœ¯éƒ¨ï¼ˆ5.23ï¼‰</h2><p>è¿™æ¬¡é¢è¯•ä¹Ÿæ˜¯ä¸€ä½å°å§å§å®˜ï¼Œä¸€å¼€å§‹æ¯”è¾ƒç´§å¼ ï¼Œåé¢å°±å¥½å¤šäº†ï¼Œé¢è¯•è¿‡ç¨‹50åˆ†é’Ÿã€‚åœ¨ç¬¬ä¸€ä¸ªé—®é¢˜ä¸­ï¼Œé¢è¯•å®˜è®¤ä¸ºæˆ‘çš„æ–¹æ³•ä¸å¯è¡Œï¼ˆfilter + indexOfï¼‰ï¼Œåæ¥è¢«è®¤å¯äº†ã€‚å› ä¸ºæ²¡é—®æˆ‘JavaScriptæˆ‘è§‰å¾—é‡è¦çš„æ¦‚å¿µï¼ˆåŸå‹ã€é—­åŒ…ã€äº‹ä»¶å¾ªç¯ç­‰ï¼‰æ¯”è¾ƒæƒŠè®¶ï¼Œç„¶åé¢è¯•å®˜è®©æˆ‘ä»‹ç»ï¼ˆè™½ç„¶ç­”ä¸Šäº†ï¼Œä½†æ˜¯ä¸‹æ¬¡å†ä¹Ÿä¸ä¸»åŠ¨ç»™è‡ªå·±åŠ é¢˜äº†ğŸ¤¦ï¸ï¼‰ï¼Œæœ€åæˆ‘é—®äº†é—®å¥¹ä»¬éƒ¨é—¨çš„ä¸šåŠ¡å’Œç”Ÿæ€ã€‚ä¸‹é¢æ˜¯é¢è¯•å†…å®¹ï¼š</p><ol><li>æ•°ç»„å»é‡</li><li>å¦‚ä½•å®ç°å›¾ç‰‡å……æ»¡ç›’å­</li><li>å¦‚ä½•å®ç°CSSå‚ç›´å±…ä¸­</li><li>CSS3çš„æ–°ç‰¹æ€§</li><li>Flexå¸ƒå±€</li><li>HTTPçŠ¶æ€ç </li><li>Webç¼“å­˜</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>äº‹ä»¶æµ</li><li>ç”¨è¿‡çš„ES6ç‰¹æ€§</li><li>è°ˆè°ˆé¡¹ç›®ä¸­æ¯”è¾ƒéš¾çš„åœ°æ–¹</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è…¾è®¯å’Œç™¾åº¦ä¸¤æ¬¡é¢è¯•éƒ½æ˜¯å¾ˆå¥½çš„ä½“éªŒï¼Œå› ä¸ºæ‰å¤§äºŒï¼Œæ‰€ä»¥æ²¡æœ‰åšé¢è¯•çš„å‡†å¤‡ï¼ŒæŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€æŠ•é€’äº†ç®€å†ï¼Œé¢è¯•è¿‡ç¨‹ä¸­ä¹Ÿå‘ç°è‡ªå·±çš„ä¸€äº›ä¸è¶³ï¼Œå¤§ç¥ä»¬çš„å»ºè®®ä¼šä»”ç»†å¬å–çš„ã€‚æœ€åä¹Ÿæ‹¿åˆ°äº†å®ä¹ offerï¼ŒKeep hungry, keep foolish.</p>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…ç½®NginxäºŒçº§åŸŸåå¹¶éƒ¨ç½²hexoåšå®¢</title>
      <link href="/2018/05/09/how-to-deploy-a-static-website/"/>
      <url>/2018/05/09/how-to-deploy-a-static-website/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºæœ‰ä¸åŒçš„é¡¹ç›®éœ€è¦éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—ä¸ºæ¯ä¸ªé¡¹ç›®åˆ†é…ä¸€ä¸ªäºŒçº§åŸŸåã€‚ä¸‹é¢æ˜¯æ•´ä¸ªæµç¨‹çš„å¤ç›˜:<br><a id="more"></a></p><h3 id="å®‰è£…nginxå’Œgit"><a href="#å®‰è£…nginxå’Œgit" class="headerlink" title="å®‰è£…nginxå’Œgit"></a>å®‰è£…nginxå’Œgit</h3><p><code>yum -y install nginx git</code></p><h3 id="è·å–èµ„æºæ–‡ä»¶"><a href="#è·å–èµ„æºæ–‡ä»¶" class="headerlink" title="è·å–èµ„æºæ–‡ä»¶"></a>è·å–èµ„æºæ–‡ä»¶</h3><ol><li>æ–°å»º <code>/var/www/blog</code> ç›®å½•ï¼š<code>mkidr /var/www/blog</code></li><li>åˆ‡æ¢åˆ°blogç›®å½•ä¸‹å¹¶è·å–æ–‡ä»¶ï¼š <code>cd /var/www/blog &amp;&amp; git clone git@github.com:GeniusFunny/GeniusFunny.github.io.git</code>, æ­¤æ—¶blogç›®å½•ä¸‹æœ‰ä¸€ä¸ªGeniusFunny.github.ioæ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯æˆ‘çš„hexoèµ„æºæ–‡ä»¶å¤¹ï¼Œé…ç½®.confæ–‡ä»¶æ—¶ä¼šç”¨åˆ°ã€‚</li></ol><h3 id="DNSæ·»åŠ äºŒçº§åŸŸå"><a href="#DNSæ·»åŠ äºŒçº§åŸŸå" class="headerlink" title="DNSæ·»åŠ äºŒçº§åŸŸå"></a>DNSæ·»åŠ äºŒçº§åŸŸå</h3><p>å‰å¾€ä½ è´­ä¹°çš„æœåŠ¡å™¨å•†ï¼ˆæˆ‘è´­ä¹°çš„æ˜¯è…¾è®¯äº‘çš„æœåŠ¡ï¼‰ä¸ºåœ¨åŸŸåè§£æä¸­æ·»åŠ è§£æè®°å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br><a href="https://i.loli.net/2018/05/16/5afb7dc3b68dc.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc3b68dc.png" alt="nginx-subadmin.png"></a><br>ç‚¹å‡»æ·»åŠ è®°å½•ï¼Œåœ¨ä¸»æœºè®°å½•æ·»åŠ ä½ è¦çš„åŸŸåï¼ˆå¦‚blogï¼‰ï¼Œåœ¨è®°å½•å€¼å¤„å¡«å†™æœåŠ¡å™¨çš„ipåœ°å€ã€‚é‚£ä¹ˆå°±æœ‰ä¸€ä¸ªæ–°çš„åŸŸåï¼Œå¦‚:<a href="blog.geniusfunny.xyz">blog.geniusfunny.xyz</a>ã€‚<br>æ·»åŠ å®Œæˆåï¼Œæˆ‘ä»¬å°±å¼€å§‹é…ç½®æˆ‘ä»¬çš„nginxã€‚</p><h3 id="nginxé…ç½®äºŒçº§åŸŸåå¹¶éƒ¨ç½²"><a href="#nginxé…ç½®äºŒçº§åŸŸåå¹¶éƒ¨ç½²" class="headerlink" title="nginxé…ç½®äºŒçº§åŸŸåå¹¶éƒ¨ç½²"></a>nginxé…ç½®äºŒçº§åŸŸåå¹¶éƒ¨ç½²</h3><ol><li>è¿›å…¥nginxé»˜è®¤é…ç½®æ–‡ä»¶<code>vim /etc/nginx/nginx.conf</code></li><li>åœ¨httpæ¨¡å—ä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼ˆå¼•å…¥sites-enabledæ–‡ä»¶å¤¹ï¼‰ï¼š<code>include    /etc/nginx/sites-enabled/*;</code></li><li>åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªsites-enabledæ–‡ä»¶å¤¹ï¼š<code>mkdir sites-enabled</code></li><li>è¿›å…¥sites-enabledæ–‡ä»¶å¤¹ï¼Œæ·»åŠ ä»¥äºŒçº§åŸŸåï¼ˆblog.geniusfunny.xyzï¼‰ä¸ºåç§°çš„é…ç½®æ–‡ä»¶: <code>vim blog.geniusfunny.xyz</code></li><li>é…ç½®äºŒçº§åŸŸåé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name blog.geniusfunny.xyz;</span><br><span class="line">    root /var/www/blog/GeniusFunny.github.io;   //è¿™æ˜¯æˆ‘ä»¬çš„èµ„æºæ–‡ä»¶ç›®å½•</span><br><span class="line">    index index.html index.htm index.nginx-debian.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®å¿«æ·linuxå‘½ä»¤"><a href="#é…ç½®å¿«æ·linuxå‘½ä»¤" class="headerlink" title="é…ç½®å¿«æ·linuxå‘½ä»¤"></a>é…ç½®å¿«æ·linuxå‘½ä»¤</h3><ol><li>è¿›å…¥.bashrcæ–‡ä»¶ï¼Œ<code>vim ~/.bashrc</code></li><li>æ·»åŠ å¿«æ·linuxè‡ªå®šä¹‰å‘½ä»¤ï¼Œ<code>alias myBlog=&#39;cd /var/www/blog/GeniusFunny.github.io</code>, ä¿å­˜</li><li>ä½¿.bashrcæ–‡ä»¶ç”Ÿæ•ˆï¼Œ<code>source ~/.bashrc</code></li><li>ä»¥åæˆ‘ä»¬å°±å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹è¾“å…¥<code>myBlog</code>è¿›å…¥èµ„æºæ–‡ä»¶å¤¹ç›®å½•ï¼Œç„¶å<code>git pull</code>ï¼Œè·å–æœ€æ–°çš„èµ„æº</li></ol><h3 id="å¸¸ç”¨çš„å…³äºnginxçš„å‘½ä»¤"><a href="#å¸¸ç”¨çš„å…³äºnginxçš„å‘½ä»¤" class="headerlink" title="å¸¸ç”¨çš„å…³äºnginxçš„å‘½ä»¤"></a>å¸¸ç”¨çš„å…³äºnginxçš„å‘½ä»¤</h3><p>æ£€æŸ¥nginxé…ç½®ï¼š<code>nginx -t nginx.conf</code><br>å¼€å¯nginxæœåŠ¡ï¼š<code>nginx</code><br>å…³é—­nginxæœåŠ¡ï¼š<code>nginx -s stop</code><br>å¼ºåˆ¶å…³é—­nginxæœåŠ¡ï¼š<code>pkill -9 nginx</code><br>é‡å¯nginxæœåŠ¡ï¼š<code>nginx -s reload</code></p>]]></content>
      
      
      <categories>
          
          <category> å®è·µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»ä¸€è¡Œurlåˆ°ä¸€ä¸ªé¡µé¢æˆ‘ä»¬ç»å†äº†ä»€ä¹ˆï¼Ÿ(æ›´æ–°ä¸­)</title>
      <link href="/2018/05/03/web-life-cycle/"/>
      <url>/2018/05/03/web-life-cycle/</url>
      
        <content type="html"><![CDATA[<p><strong>å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä¸€è¡Œurlï¼Œæ•´ä¸ªé¡µé¢å‘ˆç°ï¼Œæ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæˆ‘å¤§è‡´æŠŠæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³ç½‘ç»œè¡Œä¸ºä¸é¡µé¢å‘¨æœŸã€‚<br>æµè§ˆå™¨ç¼“å­˜ â€”&gt; DNS  â€”&gt; TCPè¿æ¥ â€“&gt; HTTPè¯·æ±‚/å“åº” â€”&gt; æ„å»ºé¡µé¢ â€”&gt; äº‹ä»¶å¤„ç†</strong><br><a id="more"></a></p><h2 id="ç½‘ç»œè¡Œä¸º"><a href="#ç½‘ç»œè¡Œä¸º" class="headerlink" title="ç½‘ç»œè¡Œä¸º"></a>ç½‘ç»œè¡Œä¸º</h2><h3 id="æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"><a href="#æµè§ˆå™¨ç¼“å­˜æœºåˆ¶" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"></a>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</h3><p>æµè§ˆå™¨å’ŒæœåŠ¡å™¨æ˜¯åº”ç­”æ¨¡å¼ï¼Œå³ï¼šæµè§ˆå™¨å‘èµ·HTTPè¯·æ±‚ â€”&gt; æœåŠ¡å™¨è¿”å›å“åº”ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æ‹¿åˆ°çš„HTTPå“åº”å¤´çš„é…ç½®æ¥å†³å®šæ˜¯å¦ç¼“å­˜æ­¤æ¬¡çš„å“åº”ç»“æœã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><a href="https://i.loli.net/2018/05/16/5afb7dc040b2d.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc040b2d.png" alt="ç¬¬ä¸€æ¬¡HTTPè¯·æ±‚.png"></a><br><strong>1. æµè§ˆå™¨æ¯æ¬¡å‘èµ·HTTPè¯·æ±‚æ—¶ï¼Œéƒ½ä¼šæ ¹æ®è¯·æ±‚å»æµè§ˆå™¨ç¼“å­˜ä¸­åŒ¹é…å¯¹åº”çš„è¯·æ±‚ç»“æœå’Œç¼“å­˜æ ‡è¯†ã€‚</strong><br><strong>2. æµè§ˆå™¨æ¯æ¬¡æˆåŠŸè·å–åˆ°è¯·æ±‚ç»“æœï¼Œéƒ½ä¼šå°†è¯·æ±‚ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ã€‚</strong><br>æ ¹æ®æµè§ˆå™¨æ˜¯å¦éœ€è¦å‘æœåŠ¡å™¨é‡æ–°å‘èµ·HTTPè¯·æ±‚ï¼Œå°†ç¼“å­˜è¿‡ç¨‹åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼š<strong>å¼ºåˆ¶ç¼“å­˜</strong>ä¸<strong>åå•†ç¼“å­˜</strong></p><h4 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h4><h5 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>å¼ºåˆ¶ç¼“å­˜å°±æ˜¯å‘æµè§ˆå™¨ç¼“å­˜æŸ¥æ‰¾å¯¹åº”çš„è¯·æ±‚ç»“æœï¼Œå¹¶æ ¹æ®è¯¥ç»“æœçš„ç¼“å­˜è§„åˆ™æ¥å†³å®šæ˜¯å¦ä½¿ç”¨è¯¥ç¼“å­˜ç»“æœçš„è¿‡ç¨‹ã€‚</p><h5 id="åœºæ™¯ä¸€ï¼šä¸å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚"><a href="#åœºæ™¯ä¸€ï¼šä¸å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚" class="headerlink" title="åœºæ™¯ä¸€ï¼šä¸å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚"></a>åœºæ™¯ä¸€ï¼šä¸å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚</h5><p>å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šé‡æ–°å‘æœåŠ¡å™¨å‘èµ·HTTPè¯·æ±‚ã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dbfec6d6.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dbfec6d6.png" alt="ForcingCache-1.png"></a></p><h5 id="åœºæ™¯äºŒï¼š-å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä½†å·²å¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œé‡‡ç”¨åå•†ç¼“å­˜"><a href="#åœºæ™¯äºŒï¼š-å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä½†å·²å¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œé‡‡ç”¨åå•†ç¼“å­˜" class="headerlink" title="åœºæ™¯äºŒï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä½†å·²å¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œé‡‡ç”¨åå•†ç¼“å­˜"></a>åœºæ™¯äºŒï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä½†å·²å¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆï¼Œé‡‡ç”¨åå•†ç¼“å­˜</h5><p>å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ï¼Œä½†ç¼“å­˜å·²ç»å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šé‡‡ç”¨åå•†ç¼“å­˜ã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dc1aa00b.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc1aa00b.png" alt="ForcingCache-2.png"></a></p><h5 id="åœºæ™¯ä¸‰ï¼š-å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥è¿”å›è¯¥ç»“æœ"><a href="#åœºæ™¯ä¸‰ï¼š-å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥è¿”å›è¯¥ç»“æœ" class="headerlink" title="åœºæ™¯ä¸‰ï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥è¿”å›è¯¥ç»“æœ"></a>åœºæ™¯ä¸‰ï¼š å­˜åœ¨è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥è¿”å›è¯¥ç»“æœ</h5><p>å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­å­˜åœ¨å¯¹åº”çš„ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†ä¸”ç¼“å­˜å°šæœªå¤±æ•ˆï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¼“å­˜ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dc072ebb.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc072ebb.png" alt="ForcingCache-3.png"></a></p><h5 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><p>å¼ºåˆ¶ç¼“å­˜ä¸HTTPå“åº”å¤´ä¸­çš„å­—æ®µ<strong>Cache-Control</strong>å’Œ<strong>Expires</strong>æœ‰å…³ï¼ŒCache-Controlä¼˜å…ˆäºExpiresã€‚<br><strong>Cache-Control</strong>: HTTP/1.1ï¼Œä¸»è¦å–å€¼å¦‚ä¸‹ï¼š</p><ol><li>public: å“åº”å¯ä»¥è¢«ä»»ä½•ç¼“å­˜åŒºï¼ˆå®¢æˆ·ç«¯ã€ä»£ç†æœåŠ¡å™¨ï¼‰ç¼“å­˜</li><li>private: å“åº”åªå¯ä»¥è¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼ˆCache-Controlé»˜è®¤å€¼ï¼‰</li><li>no-cache: å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œä½†éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡ŒéªŒè¯åæ–¹å¯ä½¿ç”¨</li><li>no-store: ç¦æ­¢ç¼“å­˜å¯¹å“åº”è¿›è¡Œå¤åˆ¶</li><li>max-age=xxx: ç¼“å­˜å°†åœ¨xxxç§’åè¿‡æœŸ<br><strong>Expires</strong>: HTTP/1.0, é™„åŠ ä¸€ä¸ªExpiresæ—¥æœŸé¦–éƒ¨åˆ°å“åº”ä¸­å»,è¿™ä¸ªæ—¥æœŸä¸ºç»å¯¹æ—¥æœŸï¼Œä¾‹å¦‚ï¼šExpires: Fri, 05 Jul 2002, 05:00:00 GMT   </li></ol><h4 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h4><h5 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>åå•†ç¼“å­˜å°±æ˜¯åœ¨å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆåï¼Œæµè§ˆå™¨æºå¸¦ç¼“å­˜æ ‡è¯†å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„è¿‡ç¨‹ã€‚</p><h5 id="åœºæ™¯ä¸€ï¼š-åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å›304"><a href="#åœºæ™¯ä¸€ï¼š-åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å›304" class="headerlink" title="åœºæ™¯ä¸€ï¼š åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å›304"></a>åœºæ™¯ä¸€ï¼š åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å›304</h5><p>å¦‚æœæœåŠ¡å™¨æç¤ºèµ„æºå°šæœªå¤±æ•ˆï¼Œåˆ™è¿”å›304ï¼Œæµè§ˆå™¨å¯ç»§ç»­ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ä¸­è¯¥èµ„æºçš„ç¼“å­˜ç»“æœã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dbfec715.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dbfec715.png" alt="consult-cache-1.png"></a></p><h5 id="åœºæ™¯äºŒï¼š-åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å›200"><a href="#åœºæ™¯äºŒï¼š-åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å›200" class="headerlink" title="åœºæ™¯äºŒï¼š åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å›200"></a>åœºæ™¯äºŒï¼š åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å›200</h5><p>å¦‚æœæœåŠ¡å™¨æç¤ºèµ„æºå°šå·²å¤±æ•ˆï¼Œåˆ™è¿”å›200ï¼ŒæœåŠ¡å™¨é‡æ–°è¿”å›æœ€æ–°çš„èµ„æºï¼Œæµè§ˆå™¨å°†ç¼“å­˜ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dc145822.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc145822.png" alt="consult-cache-2.png"></a></p><h5 id="è§„åˆ™-1"><a href="#è§„åˆ™-1" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><p><em>HTTPå…è®¸ç¼“å­˜å‘åŸå§‹æœåŠ¡å™¨å‘é€ä¸€ä¸ªâ€œæ¡ä»¶GETâ€ï¼Œè¯·æ±‚æœåŠ¡å™¨åªæœ‰åœ¨æ–‡æ¡£ä¸ç¼“å­˜ä¸­ç°æœ‰çš„å‰¯æœ¬ä¸åŒæ—¶ï¼Œæ‰å›é€å¯¹è±¡çš„ä¸»ä½“ã€‚â€”- ã€ŠHTTPæƒå¨æŒ‡å—ã€‹</em><br>åå•†ç¼“å­˜ä¸HTTPå¤´ä¸­çš„å­—æ®µ<strong>Last-Modified / If-Modified-Sinceï¼ˆè¯·æ±‚å¤´ï¼‰</strong>å’Œ<strong>Etag / If-None-Match(è¯·æ±‚å¤´)</strong>æœ‰å…³ï¼ŒEtag / If-None-Matchä¼˜å…ˆçº§æ¯”Last-Modified / If-Modified-Sinceé«˜ã€‚<br><strong>Last-Modified / If-Modified-Since</strong>:<br><strong>If-Modified-Since:Dateå†éªŒè¯è¯·æ±‚</strong>é€šå¸¸è¢«ç§°ä¸ºIMSè¯·æ±‚ï¼Œåªæœ‰æŸä¸ªæ—¥æœŸä¹‹åèµ„æºå‘ç”Ÿäº†æ”¹å˜ï¼ŒIMSè¯·æ±‚æ‰ä¼šæŒ‡ç¤ºæœåŠ¡å™¨æ‰§è¡Œè¯·æ±‚ï¼š<br>1.å¦‚æœè‡ªæŒ‡å®šæ—¥æœŸåï¼Œèµ„æºæ›´æ–°äº†ï¼ŒIf-Modified-Sinceæ¡ä»¶å°±ä¸ºçœŸï¼Œé€šå¸¸GETå°±ä¼šæ‰§è¡Œï¼Œæºå¸¦æ–°é¦–éƒ¨ï¼ˆé™¤äº†å…¶ä»–ä¿¡æ¯è¿˜æœ‰ä¸€ä¸ªæ–°çš„è¿‡æœŸæ—¥æœŸï¼‰çš„æ–°èµ„æºå°±ä¼šè¿”å›ç»™ç¼“å­˜ã€‚<br>2.å¦‚æœè‡ªæŒ‡å®šæ—¥æœŸåï¼Œèµ„æºæœªæ›´æ–°ï¼ŒIf-Modified-Sinceæ¡ä»¶å°±ä¸ºå‡ï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå°çš„304 Not Modified å“åº”æŠ¥æ–‡ï¼Œä¸ºäº†æé«˜æœ‰æ•ˆæ€§ï¼ŒæŠ¥æ–‡ä¸­ä¸ä¼šåŒ…å«èµ„æºçš„ä¸»ä½“ã€‚<br>ä¾‹ï¼šIf-Modified-Since: Sat, 29 Jun 2002, 14:30:00 GMT<br><strong>Etag / If-None-Match å®ä½“æ ‡ç­¾å†éªŒè¯</strong>:<br>æœ‰äº›æƒ…å†µï¼ˆå‘¨æœŸæ€§åœ°é‡å†™ã€èµ„æºä¿®æ”¹æ— å½±å“çš„éƒ¨åˆ†ã€æœ‰äº›æœåŠ¡å™¨æ— æ³•å‡†ç¡®åˆ¤æ–­å…¶é¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´ç­‰ç­‰ï¼‰ä¸‹ä»…æ ¹æ®ä¿®æ”¹æ—¥æœŸè¿›è¡Œå†éªŒè¯æ˜¯ä¸å¤Ÿçš„ï¼ŒHTTPå…è®¸ç”¨æˆ·å¯¹è¢«ç§°ä¸º<em>å®ä½“æ ‡ç­¾ï¼ˆEtagï¼‰</em>çš„â€œç‰ˆæœ¬æ ‡è¯†ç¬¦â€è¿›è¡Œæ¯”è¾ƒã€‚å½“å‘å¸ƒè€…å¯¹èµ„æºè¿›è¡Œä¿®æ”¹æ—¶ï¼Œå°±å¯ä»¥ä¿®æ”¹èµ„æºçš„å®ä½“æ ‡ç­¾æ¥è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚<br>1.å¦‚æœå®ä½“æ ‡ç­¾ä»åŒ¹é…ï¼ŒIf-None-Matchå†éªŒè¯æˆåŠŸï¼Œè¿”å›304 Not Modifiedã€‚<br>2.å¦‚æœæœåŠ¡å™¨ä¸Šçš„å®ä½“æ ‡ç­¾å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ä¸€ä¸ª200 OK å“åº”ä¸­è¿”å›æ–°çš„å†…å®¹åŠç›¸åº”çš„æ–°Etagã€‚<br>ä¾‹ï¼š<br>If-None-Match: â€œv2.6â€<br>If-None-Match: â€œv2.4â€, â€œv2.5â€</p><h4 id="æµè§ˆå™¨çš„ç¼“å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ"><a href="#æµè§ˆå™¨çš„ç¼“å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="æµè§ˆå™¨çš„ç¼“å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ"></a>æµè§ˆå™¨çš„ç¼“å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ</h4><p>æµè§ˆå™¨çš„ç¼“å­˜é€šå¸¸å­˜æ”¾å…¥ç¡¬ç›˜ï¼ˆfrom disk cacheï¼‰æˆ–å†…å­˜ï¼ˆfrom memory cacheï¼‰ã€‚</p><h5 id="from-disk-cache"><a href="#from-disk-cache" class="headerlink" title="from disk cache"></a>from disk cache</h5><p>ç¡¬ç›˜ç¼“å­˜(from disk cache)åˆ™æ˜¯ç›´æ¥å°†ç¼“å­˜å†™å…¥ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œè¯»å–ç¼“å­˜éœ€è¦å¯¹è¯¥ç¼“å­˜å­˜æ”¾çš„ç¡¬ç›˜æ–‡ä»¶è¿›è¡ŒI/Oæ“ä½œï¼Œç„¶åé‡æ–°è§£æè¯¥ç¼“å­˜å†…å®¹ï¼Œè¯»å–å¤æ‚ï¼Œé€Ÿåº¦æ¯”å†…å­˜ç¼“å­˜æ…¢ã€‚</p><h5 id="from-memory-cache"><a href="#from-memory-cache" class="headerlink" title="from memory cache"></a>from memory cache</h5><p>å†…å­˜ç¼“å­˜(from memory cache)ï¼šå†…å­˜ç¼“å­˜å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼Œåˆ†åˆ«æ˜¯<strong>å¿«é€Ÿè¯»å–</strong>å’Œ<strong>æ—¶æ•ˆæ€§</strong>ï¼š<br><strong>å¿«é€Ÿè¯»å–</strong>ï¼šå†…å­˜ç¼“å­˜ä¼šå°†ç¼–è¯‘è§£æåçš„æ–‡ä»¶ï¼Œç›´æ¥å­˜å…¥è¯¥è¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œå æ®è¯¥è¿›ç¨‹ä¸€å®šçš„å†…å­˜èµ„æºï¼Œä»¥æ–¹ä¾¿ä¸‹æ¬¡è¿è¡Œä½¿ç”¨æ—¶çš„å¿«é€Ÿè¯»å–ã€‚<br><strong>æ—¶æ•ˆæ€§</strong>ï¼šä¸€æ—¦è¯¥è¿›ç¨‹å…³é—­ï¼Œåˆ™è¯¥è¿›ç¨‹çš„å†…å­˜åˆ™ä¼šæ¸…ç©ºã€‚</p><h5 id="è§„åˆ™-2"><a href="#è§„åˆ™-2" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œæµè§ˆå™¨ä¼šåœ¨jså’Œå›¾ç‰‡ç­‰æ–‡ä»¶è§£ææ‰§è¡Œåç›´æ¥å­˜å…¥å†…å­˜ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå½“åˆ·æ–°é¡µé¢æ—¶åªéœ€ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¯»å–(from memory cache)ï¼›è€Œcssæ–‡ä»¶åˆ™ä¼šå­˜å…¥ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡æ¸²æŸ“é¡µé¢éƒ½éœ€è¦ä»ç¡¬ç›˜è¯»å–ç¼“å­˜(from disk cache)ã€‚</p><h4 id="ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"><a href="#ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"></a>ç¼“å­˜æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h4><ol><li>å‡å°‘äº†æ•°æ®çš„å†—ä½™ä¼ è¾“</li><li>ç¼“è§£äº†ç½‘ç»œçš„å¸¦å®½ç“¶é¢ˆé—®é¢˜</li><li>å‡è½»äº†æœåŠ¡å™¨çš„è´Ÿæ‹…</li><li>å‡è½»äº†è·ç¦»æ—¶å»¶</li></ol><h4 id="ç¼“å­˜ä¸cookie"><a href="#ç¼“å­˜ä¸cookie" class="headerlink" title="ç¼“å­˜ä¸cookie"></a>ç¼“å­˜ä¸cookie</h4><p>ç¼“å­˜é‚£äº›ä¸cookieäº‹åŠ¡æœ‰å…³çš„æ–‡æ¡£æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œcookieå’Œç¼“å­˜çš„è§„åˆ™æ²¡æœ‰å¾ˆå¥½åœ°å»ºç«‹èµ·æ¥ã€‚ä¸‹é¢æ˜¯å¤„ç†ç¼“å­˜æ—¶çš„ä¸€äº›æŒ‡å¯¼æ€§è§„åˆ™ï¼š</p><ol><li>å¦‚æœæ— æ³•ç¼“å­˜æ–‡æ¡£ï¼Œè¦å°†å…¶è¡¨ç¤ºå‡ºæ¥ã€‚<br>å¦‚å¯¹ä¸å¯ç¼“å­˜çš„æ–‡æ¡£è®¾ç½®ï¼š<strong>Cache-Control:no-cache=â€Set-Cookieâ€</strong>ï¼Œå¯¹å¯ç¼“å­˜çš„æ–‡æ¡£è®¾ç½®ï¼š Cache-Control:publicã€‚</li><li>ç¼“å­˜Set-Cookieé¦–éƒ¨è¦å°å¿ƒã€‚<br>å¦‚æœå‘å¤šä¸ªç”¨æˆ·å‘é€äº†ç›¸åŒçš„Set-Cookieé¦–éƒ¨å¯èƒ½ä¼šç ´åç”¨æˆ·çš„å®šä½ï¼›æœ‰äº›ç¼“å­˜ä¼šåœ¨å°†å“åº”ç¼“å­˜èµ·æ¥ä¹‹å‰åˆ é™¤Set-Cookieé¦–éƒ¨ï¼Œé‚£ä¹ˆè¯·æ±‚ç¼“å­˜çš„æ—¶å€™å®¢æˆ·ç«¯å°±æ‹¿ä¸åˆ°cookieäº†ã€‚<br>å¼ºåˆ¶ç¼“å­˜ä¸åŸå§‹æœåŠ¡å™¨é‡æ–°éªŒè¯æ¯æ¡è¯·æ±‚ï¼Œå¹¶å°†Set-Cookieé¦–éƒ¨åˆå¹¶åˆ°å®¢æˆ·ç«¯çš„å“åº”ä¸­å»ï¼Œå°±å¯ä»¥æ”¹å–„è¿™ç§æƒ…å†µï¼ŒåŸå§‹æœåŠ¡å™¨å¯å‘ç¼“å­˜å‰¯æœ¬æ·»åŠ è¿™ä¸ªé¦–éƒ¨æ¥è¿›è¡Œè¿™ç§éªŒè¯ï¼šCache-Control: must-revalidate, max-age=0</li><li>å°å¿ƒå¤„ç†å¸¦æœ‰cookieé¦–éƒ¨çš„è¯·æ±‚<br>å¸¦æœ‰cookieçš„è¯·æ±‚ç»“æœåˆ°è¾¾æ—¶ï¼Œå°±æ˜¯æç¤ºæˆ‘ä»¬ï¼Œè¿™ä¸ªè¯·æ±‚ç»“æœå¯èƒ½æ˜¯ç§æœ‰å†…å®¹ï¼Œå¿…é¡»å°†ç§æœ‰å†…å®¹æ ‡è¯†ä¸ºä¸å¯ç¼“å­˜ã€‚</li></ol><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><h4 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4><p>DNSï¼ˆ<strong>Domain Name Systemï¼ŒåŸŸåè§£æç³»ç»Ÿ</strong>ï¼‰çš„ä½œç”¨æ˜¯å°†ä¸»æœºåï¼ˆhostnameï¼‰è§£æä¸ºå¯¹åº”çš„IPåœ°å€ã€‚DNSæ˜¯ä¸€ä¸ªç”±<strong>åˆ†å±‚</strong>çš„DNSæœåŠ¡å™¨å®ç°çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä¸€ä¸ªä½¿å¾—ä¸»æœºèƒ½å¤ŸæŸ¥è¯¢åˆ†å¸ƒå¼æ•°æ®åº“çš„<strong>åº”ç”¨å±‚åè®®</strong>ã€‚DNSåè®®è¿è¡Œåœ¨UDPä¸Šï¼Œä½¿ç”¨53å·ç«¯å£ã€‚</p><h4 id="å¸¸è§„æµç¨‹"><a href="#å¸¸è§„æµç¨‹" class="headerlink" title="å¸¸è§„æµç¨‹"></a>å¸¸è§„æµç¨‹</h4><ol><li>æµè§ˆå™¨ä»URLä¸­æŠ½å‡ºä¸»æœºåï¼Œå°†å…¶å‘é€ç»™è¿è¡Œä¸­çš„DNSåº”ç”¨å®¢æˆ·ç«¯ã€‚</li><li>DNSå®¢æˆ·ç«¯å‘DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ä¸»æœºåçš„è¯·æ±‚ã€‚</li><li>DNSå®¢æˆ·ç«¯ä¼šæ”¶åˆ°æ¥è‡ªDNSæœåŠ¡å™¨çš„å›ç­”æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸ä¸»æœºåå¯¹åº”çš„IPåœ°å€ã€‚</li><li>æµè§ˆå™¨è·å–åˆ°IPåœ°å€ï¼Œå‘ä½äºè¯¥åœ°å€çš„æœåŠ¡å™¨è¿›ç¨‹çš„æŸä¸ªç«¯å£ï¼ˆHTTPä¸º80ç«¯å£ï¼ŒHTTPSä¸º443ç«¯å£ï¼‰å‘èµ·ä¸€ä¸ªTCPè¿æ¥ã€‚</li></ol><h4 id="åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“"><a href="#åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“" class="headerlink" title="åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“"></a>åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“</h4><p>DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­çš„DNSæœåŠ¡å™¨å¤§è‡´æœ‰ä¸‰ç§ï¼Œ<em>æ ¹DNSæœåŠ¡å™¨</em>ã€<em>é¡¶çº§åŸŸDNSæœåŠ¡å™¨</em>ã€<em>æƒå¨DNSæœåŠ¡å™¨</em>ã€‚æ ¹DNSæœåŠ¡å™¨â€”&gt;é¡¶çº§åŸŸDNSæœåŠ¡å™¨â€”&gt;æƒå¨DNSæœåŠ¡å™¨ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ã€‚<br>å¦‚æœè¦æŸ¥è¯¢www.baidu.comå¯¹åº”çš„IPåœ°å€ï¼ŒæŸ¥è¯¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼ˆåˆ†çº§æŸ¥è¯¢ï¼‰ï¼š</p><ol><li>é¦–å…ˆè·Ÿæ ¹æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—é¡¶çº§åŸŸåcomçš„TLDæœåŠ¡å™¨çš„IPåœ°å€ã€‚</li><li>ç„¶åTLDæœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—baidu.comæƒå¨æœåŠ¡å™¨çš„IPåœ°å€ã€‚</li><li>æœ€åä¸baidu.comæƒå¨æœåŠ¡å™¨ä¹‹ä¸€è”ç³»ï¼Œè·å¾—ä¸»æœºåwww.baidu.comå¯¹åº”çš„IPåœ°å€ã€‚</li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç±»DNSæœåŠ¡å™¨å¾ˆé‡è¦ï¼Œå³ï¼šæœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆå°½ç®¡å®ƒä¸åœ¨DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­ï¼‰ã€‚æ¯ä¸ªISPéƒ½æœ‰ä¸€ä¸ªæœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå½“ä¸»æœºä¸è¯¥ISPè¿æ¥æ—¶ï¼ŒISPä¼šè¿”å›ä¸€ä¸ªIPåœ°å€ï¼Œè¯¥åœ°å€å…·æœ‰ä¸€å°æˆ–å¤šå°çš„æœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚<strong>å½“ä¸»æœºå‘èµ·DNSè¯·æ±‚æ—¶ï¼Œè¯·æ±‚è¢«å‘é€åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå®ƒèµ·ç€ä»£ç†å’Œå°†è¯·æ±‚è½¬å‘åˆ°DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­ï¼ˆç±»ä¼¼HTTPçš„ä»£ç†æœåŠ¡å™¨ï¼‰</strong>ã€‚<br><a href="https://i.loli.net/2018/05/16/5afb92dfa36da.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb92dfa36da.png" alt="DNSæŸ¥è¯¢ï¼ˆä¸€ï¼‰.png"></a><br>ä»è¯·æ±‚ä¸»æœºåˆ°æœ¬åœ°DNSæœåŠ¡å™¨çš„æŸ¥è¯¢æ˜¯<strong>é€’å½’æŸ¥è¯¢</strong>ï¼ˆå› ä¸ºæŸ¥è¯¢è¯·æ±‚æ˜¯ä»¥è‡ªå·±çš„åä¹‰ï¼ŒæŸ¥è¯¢ç»“æœç›´æ¥è¿”å›ç»™è¯·æ±‚ä¸»æœºï¼‰ï¼Œå…¶ä½™ä¸º<strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼ˆæŸ¥è¯¢è¯·æ±‚æ˜¯ä»¥æœ¬åœ°DNSæœåŠ¡å™¨ä¸ºåä¹‰ï¼Œè¿”å›çš„ç»“æœä¹Ÿæ˜¯ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼‰</p><h4 id="DNSç¼“å­˜"><a href="#DNSç¼“å­˜" class="headerlink" title="DNSç¼“å­˜"></a>DNSç¼“å­˜</h4><p>ä¸ºäº†æ”¹å–„å®éªŒæ€§èƒ½å¹¶å‡å°‘åœ¨å› ç‰¹ç½‘ä¸Šåˆ°å¤„ä¼ æ’­çš„DNSæŠ¥æ–‡æ•°é‡ï¼ŒDNSå¹¿æ³›ä½¿ç”¨äº†ç¼“å­˜æŠ€æœ¯ã€‚<strong>åœ¨ä¸€ä¸ªè¯·æ±‚é“¾ä¸­ï¼Œå½“æŸä¸ªDNSæœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªDNSå›ç­”æ—¶ï¼Œå®ƒèƒ½å°†è¯¥ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°å­˜å‚¨å™¨ä¸­</strong>ï¼ˆä¾‹å¦‚ï¼Œå…±ç”¨ä¸€ä¸ªISPçš„å°æ˜ã€å°çº¢ï¼Œå¦‚æœå°æ˜æŸ¥è¯¢äº†www.baidu.comçš„IPåœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªIPåœ°å€å°±å­˜åœ¨äº†æœ¬åœ°DNSæœåŠ¡å™¨ä¸­ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆå‰ï¼Œå°çº¢å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°DNSæœåŠ¡å™¨ä¸­è·å–åˆ°www.baidu.comçš„IPåœ°å€ï¼‰ã€‚æœ¬åœ°æœåŠ¡å™¨èƒ½å¤Ÿç¼“å­˜é¡¶çº§åŸŸæœåŠ¡å™¨çš„IPåœ°å€ï¼Œå› è€Œå…è®¸æœ¬åœ°DNSç»•è¿‡æŸ¥è¯¢é“¾ä¸­çš„æ ¹DNSæœåŠ¡å™¨ã€‚</p><h3 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h3><p>ä¸€ä¸ªTCPè¿æ¥æ˜¯ç”±ä¸€å¯¹ç«¯ç‚¹æˆ–å¥—æ¥å­—æ„æˆï¼Œå…¶ä¸­é€šä¿¡çš„æ¯ä¸€ç«¯éƒ½ç”±ä¸€å¯¹ï¼ˆIPåœ°å€ï¼Œç«¯å£å·ï¼‰æ‰€å”¯ä¸€æ ‡è¯†ã€‚<br>ä¸€ä¸ªTCPè¿æ¥é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå¯åŠ¨ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ã€æ•°æ®ä¼ è¾“ã€é€€å‡ºï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰ã€‚</p><h4 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h4><h5 id="æ¦‚è§ˆ-1"><a href="#æ¦‚è§ˆ-1" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h5><p><a href="https://i.loli.net/2018/05/16/5afb7dc3ce2c6.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc3ce2c6.png" alt="three-shake.png"></a><br>å¦‚å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯ä¸­çš„TCPä¼šç”¨ä¸€ä¸‹æ–¹å¼ä¸æœåŠ¡å™¨ä¸­TCPå»ºç«‹ä¸€æ¡TCPè¿æ¥ï¼š</p><ol><li>ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯çš„TCPé¦–å…ˆå‘æœåŠ¡å™¨çš„TCPå‘é€ä¸€ä¸ªç‰¹æ®Šçš„TCPæŠ¥æ–‡æ®µï¼Œè¯¥æŠ¥æ–‡æ®µä¸åŒ…å«åº”ç”¨å±‚çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨æŠ¥æ–‡æ®µçš„é¦–éƒ¨ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼ˆå³SYNæ¯”ç‰¹ï¼‰è¢«ç½®ä¸º1ï¼Œå› æ­¤è¿™ä¸ªç‰¹æ®ŠæŠ¥æ–‡æ®µè¢«ç§°ä¸º<strong>SYNæŠ¥æ–‡æ®µ</strong>ã€‚å®¢æˆ·ç«¯ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·ï¼ˆJï¼‰å¹¶å°†æ­¤åºå·æ”¾ç½®äºè¯¥èµ·å§‹çš„TCP SYNæŠ¥æ–‡æ®µçš„åºå·å­—æ®µé‡Œï¼Œæ•´ä¸ªæŠ¥æ–‡å­—æ®µä¼šå°è£…åœ¨ä¸€ä¸ªIPæ•°æ®æŠ¥ä¸­å¹¶å‘ç»™æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥<strong>SYN-SENTçŠ¶æ€</strong>ã€‚</li><li>ç¬¬äºŒæ­¥ï¼Œä¸€æ—¦åŒ…å«TCP SYNæŠ¥æ–‡æ®µçš„IPæ•°æ®æŠ¥åˆ°è¾¾äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±ä¼šä»æ•°æ®æŠ¥ä¸­æå–å‡ºTCP SYNæŠ¥æ–‡æ®µï¼Œä¸ºè¯¥TCPè¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€å…è®¸è¿æ¥çš„æŠ¥æ–‡æ®µï¼ˆACK(J + 1)ï¼‰ï¼Œè¯¥æŠ¥æ–‡æ®µä¹Ÿä¸åŒ…å«åº”ç”¨å±‚æ•°æ®ã€‚ä¸æ­¤åŒæ—¶æœåŠ¡å™¨ä¹Ÿéšæœºé€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·ï¼ˆKï¼‰å¹¶å°†æ­¤åºå·æ”¾ç½®äºTCPæŠ¥æ–‡æ®µé¦–éƒ¨çš„åºå·å­—æ®µä¸­ï¼Œå³ï¼ˆSYN(K)ï¼‰,éšç¡®è®¤å­—æ®µACKä¸€å¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚æ­¤æŠ¥æ–‡å­—æ®µé€šå¸¸è¢«ç§°ä¸º<strong>SYNACKæŠ¥æ–‡æ®µ</strong>ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥<strong>SYN-RECEIVEDçŠ¶æ€</strong>ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°<strong>SYNACKæŠ¥æ–‡æ®µ</strong>ï¼Œä¸ºè¯¥è¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥<strong>ESTABLISHEDçŠ¶æ€</strong>ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¦å¤–ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µæ˜¯å¯¹æœåŠ¡å™¨çš„å…è®¸è¿æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼ˆACK(K + 1)ï¼‰ï¼Œä¸å‰ä¸¤æ¬¡ä¸åŒï¼Œè¿™æ¬¡æŠ¥æ–‡æ®µä¸­å¯æºå¸¦åº”ç”¨å±‚æ•°æ®ï¼Œç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼ŒSYNæ¯”ç‰¹è¢«ç½®ä¸º0ã€‚æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µåï¼Œä¹Ÿè¿›å…¥<strong>ESTABISHEDçŠ¶æ€</strong>ã€‚<br>å®Œæˆè¿™ä¸‰ä¸ªæ­¥éª¤åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ¯ä¸€ä¸ªæŠ¥æ–‡æ®µä¸­éƒ½å¯ä»¥æºå¸¦åº”ç”¨å±‚çš„æ•°æ®ï¼Œä¸”SYNæ¯”ç‰¹éƒ½å°†è¢«ç½®ä¸º0ã€‚å»ºç«‹TCPè¿æ¥çš„ä¸‰ä¸ªæ­¥éª¤ä¹Ÿè¢«ç§°ä¸ºTCP<strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚<br><em>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„ä¸ä»…åœ¨äºè®©é€šä¿¡åŒæ–¹äº†è§£ä¸€ä¸ªè¿æ¥æ­£åœ¨å»ºç«‹ï¼Œ è¿˜åœ¨äºåˆ©ç”¨æ•°æ®åŒ…çš„é€‰é¡¹æ¥æ‰¿è½½ç‰¹æ®Šçš„ä¿¡æ¯ï¼Œäº¤æ¢åˆå§‹åºåˆ—å·ã€‚â€”â€”-ã€ŠTCP/IP è¯¦è§£ å·ä¸€ï¼šåè®®ã€‹</em></li></ol><h5 id="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ</h5><p>ä¸‰æ¬¡æ¡æ‰‹ï¼š<br>Aâ€”-&gt;B: [A: Iâ€™m A.]<br>Bâ€”-&gt;A: [B: Hello A, Iâ€™m B.]<br>Aâ€”-&gt;B: [A: Hello B, nice to meet you.]<br>ç„¶åæ„‰å¿«çš„py</p><p>äºŒæ¬¡æ¡æ‰‹ï¼š<br>Aâ€”-&gt;B: [Iâ€™m A.]<br>Bâ€”-&gt;A: [Hello A, Iâ€™m B.]<br>å¦‚æœAæ”¶åˆ°äº†â€œHello A,Iâ€™m Bâ€ï¼Œæ„‰å¿«çš„py<br>å¦‚æœAæ²¡æœ‰æ”¶åˆ°â€œHello A,Iâ€™m Bâ€ï¼Œé‚£ä¹ˆwhile(true){ Aâ€”-&gt;B: [Iâ€™m A.] }, ç–¯ç‹‚æ¡æ‰‹<br>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ç¡®è®¤Aâ€”&gt;B, Bâ€”&gt;Aè¿™ä¸¤ä¸ªä¿¡é“éƒ½æ˜¯å¯é çš„ï¼›å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹å°±æ— æ³•ç¡®è®¤Bâ€”&gt;Açš„ä¿¡é“æ˜¯å¦å¯é ã€‚å¦‚æœåªéœ€è¦Aâ€”&gt;Bä¿¡é“å¯é ï¼Œé‚£å°±ç±»ä¼¼äºUDPçš„éœ€æ±‚äº†ã€‚</p><h4 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h4><h5 id="æ¦‚è§ˆ-2"><a href="#æ¦‚è§ˆ-2" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h5><p>è¿æ¥çš„ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥å‘èµ·å…³é—­è¿æ¥ï¼Œåœ¨ä¼ ç»Ÿæƒ…å†µä¸‹å¾€å¾€ç”±å®¢æˆ·ç«¯æ¥å‘èµ·å…³é—­è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><a href="https://i.loli.net/2018/05/16/5afb7dc3b7ef7.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/05/16/5afb7dc3b7ef7.png" alt="four-wave.png"></a></p><ol><li>ç¬¬ä¸€æ­¥ï¼šå®¢æˆ·ç«¯å‘é€FINåŒ…ï¼ˆåŒ…å«äº†å®¢æˆ·ç«¯çš„åºåˆ—å·M)ï¼Œæ­¤å¤–FINåŒ…è¿˜åŒ…å«äº†ä¸€ä¸ªACKæ®µç”¨äºç¡®è®¤å¯¹æ–¹æœ€åä¸€æ¬¡å‘é€çš„æ•°æ®ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„FINåŒ…åï¼Œå°†Må€¼+1ä½œä¸ºå“åº”çš„ACKå€¼ï¼Œè¡¨æ˜å®ƒå·²ç»æˆåŠŸæ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯å‘é€çš„FINã€‚æ­¤æ—¶ï¼Œå¤„äºä¸Šå±‚çš„åº”ç”¨ç¨‹åºä¼šè¢«å‘ŠçŸ¥è¿æ¥çš„å¦ä¸€æ–¹å‘èµ·äº†å…³é—­è¿æ¥çš„è¯·æ±‚ï¼Œè¿™å°†å¯¼è‡´åº”ç”¨ç¨‹åºå‘åŠ¨è‡ªå·±çš„å…³é—­æ“ä½œã€‚æœåŠ¡å™¨ä»è¢«åŠ¨å…³é—­è€…å˜ä¸ºä¸»åŠ¨å…³é—­è€…ï¼Œå‘å®¢æˆ·ç«¯å‘é€FIN(åŒ…å«äº†æœåŠ¡å™¨çš„åºåˆ—å·N)ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šä¸ºäº†å®Œæˆè¿æ¥çš„å…³é—­ï¼Œå®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨æœ€åçš„æŠ¥æ–‡æ®µä¸­åŒ…å«äº†ä¸€ä¸ªç¡®è®¤æœåŠ¡å™¨å‘é€çš„FINçš„ACKå­—æ®µã€‚</li></ol><h5 id="ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h5><p>å››æ¬¡æŒ¥æ‰‹ï¼š<br>A â€”&gt; B, [A: â€˜æˆ‘æƒ³å…³é—­è¿æ¥â€™]<br>B â€”&gt; A, [B: â€˜å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œæˆ‘ä¸è¦æ”¶åˆ°ä½ çš„ä¸œè¥¿äº†â€™]<br>B â€”&gt; A, [B: â€˜æˆ‘æƒ³å…³é—­è¿æ¥â€™]<br>A â€”&gt; B, [A: â€˜å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œæˆ‘ä¹Ÿä¸è¦æ”¶åˆ°ä½ çš„ä¸œè¥¿äº†â€™]<br>ä¸»åŠ¨æ–¹å‘é€å…³é—­è¯·æ±‚ï¼Œè¢«åŠ¨æ–¹æ¥å—å¹¶ç¡®è®¤è¯·æ±‚åï¼Œè¢«åŠ¨æ–¹å°±æ— æ³•æ”¶åˆ°ä¸»åŠ¨æ–¹å‘é€çš„æ•°æ®äº†ã€‚åœ¨å‰ä¸¤æ¬¡æŒ¥æ‰‹åï¼ŒæœåŠ¡å™¨å°±æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®äº†ï¼ˆæœåŠ¡å™¨é‡Šæ”¾äº†å…³äºå®¢æˆ·ç«¯çš„èµ„æºï¼‰ï¼Œä½†æ˜¯æœåŠ¡å™¨å¯ä»¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæ‰€ä»¥æœ‰äº†ç¬¬ä¸‰æ¬¡ã€ç¬¬å››æ¬¡æŒ¥æ‰‹ã€‚</p><h2 id="é¡µé¢å‘¨æœŸæ¦‚è§ˆ"><a href="#é¡µé¢å‘¨æœŸæ¦‚è§ˆ" class="headerlink" title="é¡µé¢å‘¨æœŸæ¦‚è§ˆ"></a>é¡µé¢å‘¨æœŸæ¦‚è§ˆ</h2><h3 id="é¡µé¢æ„å»º"><a href="#é¡µé¢æ„å»º" class="headerlink" title="é¡µé¢æ„å»º"></a>é¡µé¢æ„å»º</h3><h4 id="DOM-Tree"><a href="#DOM-Tree" class="headerlink" title="DOM Tree"></a>DOM Tree</h4><h4 id="Style-Rules"><a href="#Style-Rules" class="headerlink" title="Style Rules"></a>Style Rules</h4><h4 id="Rendering-Tree"><a href="#Rendering-Tree" class="headerlink" title="Rendering Tree"></a>Rendering Tree</h4><h3 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h3><h2 id="å‚è€ƒæ–‡çŒ®ï¼š"><a href="#å‚è€ƒæ–‡çŒ®ï¼š" class="headerlink" title="å‚è€ƒæ–‡çŒ®ï¼š"></a>å‚è€ƒæ–‡çŒ®ï¼š</h2><ol><li><a href="https://heyingye.github.io/2018/04/16/%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener">å½»åº•ç†è§£æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶</a></li><li><a href="https://juejin.im/post/5a7835a46fb9a063606eb801" target="_blank" rel="noopener">å›¾è§£TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡åˆ†æ‰‹</a></li><li><a href="https://item.jd.com/11056556.html" target="_blank" rel="noopener">ã€ŠHTTPæƒå¨æŒ‡å—ã€‹</a></li><li><a href="https://item.jd.com/12306772.html" target="_blank" rel="noopener">ã€ŠJavaScriptå¿è€…ç§˜ç±ã€‹</a></li><li><a href="https://item.jd.com/11556873.html" target="_blank" rel="noopener">ã€Šè®¡ç®—æœºç½‘ç»œï¼ˆè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼‰ã€‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webç¼“å­˜ </tag>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> æµè§ˆå™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8</title>
      <link href="/2018/04/14/async-await/"/>
      <url>/2018/04/14/async-await/</url>
      
        <content type="html"><![CDATA[<h2 id="åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8"><a href="#åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8" class="headerlink" title="åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8"></a>åœæ­¢ä¹¦å†™å›è°ƒå‡½æ•°å¹¶çˆ±ä¸ŠES8</h2><p>ä»¥å‰ï¼ŒJavaScripté¡¹ç›®ä¼šé€æ¸â€˜å¤±å»æ§åˆ¶â€™ï¼Œå…¶ä¸­ä¸»è¦ä¸€ä¸ªåŸå› å°±æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œä¸€æ—¦ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å°±éš¾å…ä¹¦å†™ä¸€äº›å†—é•¿ã€å¤æ‚ã€åµŒå¥—çš„ä»£ç å—ï¼ˆ<em>å›è°ƒåœ°ç‹±</em>ï¼‰ï¼Œè¿™ä¼šä¸¥é‡é™ä½ä»£ç çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚ç°åœ¨ï¼ŒJavaScriptæä¾›äº†ä¸€ç§æ–°çš„è¯­æ³•ç³–æ¥å–ä»£å›è°ƒå‡½æ•°ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ç®€æ˜ã€å¯è¯»æ€§é«˜çš„å¼‚æ­¥ä»£ç ã€‚<br><a id="more"></a></p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><p>å…ˆæ¥å›é¡¾ä¸€ä¸‹å†å²ã€‚åœ¨20ä¸–çºª90å¹´ä»£åæœŸï¼ŒAjaxæ˜¯å¼‚æ­¥JavaScriptçš„ç¬¬ä¸€ä¸ªé‡å¤§çªç ´ã€‚è¿™ä¸€æŠ€æœ¯å…è®¸ç½‘ç«™åœ¨åŠ è½½HTMLåè·å–å¹¶æ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„æƒ³æ³•ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå¤§å¤šæ•°ç½‘ç«™ä¼šå†æ¬¡ä¸‹è½½æ•´ä¸ªé¡µé¢æ¥æ˜¾ç¤ºæ›´æ–°çš„å†…å®¹ã€‚è¿™ä¸€æŠ€æœ¯(åœ¨jQueryä¸­ä»¥ajaxçš„åç§°æµè¡Œ)ä¸»å¯¼äº†2000-2010çš„webå¼€å‘å¹¶ä¸”Ajaxæ˜¯ç›®å‰ç½‘ç«™ç”¨æ¥è·å–æ•°æ®çš„ä¸»è¦æŠ€æœ¯ï¼Œä½†æ˜¯XMLåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–ä»£äº†JSONã€‚</p><h3 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h3><p>å½“NodeJSåœ¨2009å¹´é¦–æ¬¡å‘å¸ƒæ—¶ï¼ŒæœåŠ¡å™¨ç«¯ç¯å¢ƒçš„ä¸»è¦ç„¦ç‚¹æ˜¯å…è®¸ç¨‹åºä¼˜é›…åœ°å¤„ç†å¹¶å‘æ€§ã€‚å¤§å¤šæ•°æœåŠ¡å™¨ç«¯è¯­è¨€é€šè¿‡é˜»å¡ä»£ç æ¥å¤„ç†I/Oæ“ä½œï¼Œç›´åˆ°æ“ä½œå®Œæˆä¸ºæ­¢ã€‚ç›¸åï¼ŒNodeJSä½¿ç”¨çš„æ˜¯äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œè¿™æ ·å¼€å‘äººå‘˜å¯ä»¥åœ¨éé˜»å¡å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œè°ƒç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†é€»è¾‘ï¼ˆç±»ä¼¼äºAjaxçš„å·¥ä½œæ–¹å¼ï¼‰ã€‚</p><h3 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h3><p>å‡ å¹´åï¼ŒNodeJSå’Œæµè§ˆå™¨ç¯å¢ƒä¸­å‡ºç°äº†ä¸€ç§æ–°çš„æ ‡å‡†ï¼Œç§°ä¸ºâ€Promiseâ€ï¼ŒPromiseæä¾›äº†ä¸€ç§å¼ºå¤§çš„ã€æ ‡å‡†åŒ–çš„æ–¹å¼æ¥ç»„æˆå¼‚æ­¥æ“ä½œã€‚Promiseä»ç„¶ä½¿ç”¨åŸºäºå›è°ƒçš„æ ¼å¼ï¼Œä½†ä¸ºé“¾å¼å’Œç»„åˆå¼‚æ­¥æ“ä½œæä¾›äº†ä¸€è‡´çš„è¯­æ³•ã€‚åœ¨2015å¹´ï¼Œç”±æµè¡Œçš„å¼€æºåº“æ‰€å€¡å¯¼çš„Promiseæœ€ç»ˆè¢«æ·»åŠ ä¸ºJavaScriptçš„åŸç”Ÿç‰¹æ€§ã€‚<br>Promiseæ˜¯ä¸€ä¸ªä¸é”™çš„æ”¹è¿›ï¼Œä½†å®ƒä»¬ä»ç„¶å¸¸å¸¸æ˜¯ä¸€äº›å†—é•¿è€Œéš¾ä»¥é˜…è¯»çš„ä»£ç å—çš„åŸå› ã€‚<br>è€Œç°åœ¨æœ‰äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚<br>Async/Awaitæ˜¯ä¸€ç§æ–°çš„è¯­æ³•(ä».netå’ŒC#ä¸­å€Ÿç”¨)ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç¼–å†™Promiseï¼Œä½†å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥ä»£ç ï¼Œæ²¡æœ‰å›è°ƒï¼Œå¯ä»¥ç”¨æ¥ç®€åŒ–å‡ ä¹ä»»ä½•ç°æœ‰çš„JSåº”ç”¨ç¨‹åºã€‚Async/Awaitæ˜¯JavaScriptè¯­è¨€çš„æ–°å¢çš„ç‰¹æ€§ï¼Œåœ¨ES7ä¸­è¢«æ­£å¼æ·»åŠ ä¸ºJavaScriptçš„åŸç”Ÿç‰¹æ€§ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>æˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥å±•ç¤ºAsync/Awaitçš„é­…åŠ›</p><p><em>*æ³¨</em>ï¼šè¿è¡Œä¸‹é¢çš„ç¤ºä¾‹ä¸éœ€è¦ä»»ä½•åº“ã€‚Async/Awaitå·²ç»è¢«æœ€æ–°ç‰ˆæœ¬çš„Chromeã€FireFoxã€Safariã€Edgeå®Œå…¨æ”¯æŒï¼Œä½ å¯ä»¥åœ¨ä½ çš„æµè§ˆå™¨æ§åˆ¶å°é‡Œè¿è¡Œä¾‹å­ã€‚Async/Awaitéœ€è¦è¿è¡Œåœ¨NodeJS 7.6ç‰ˆæœ¬åŠä»¥ä¸Šï¼ŒåŒæ—¶ä¹Ÿè¢«Babelã€TypeScriptè½¬è¯‘å™¨æ”¯æŒã€‚æ‰€ä»¥Async/Awaitå¯ä»¥è¢«ç”¨äºå®é™…å¼€å‘ä¹‹ä¸­ã€‚*</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„APIç±»ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„ç”µè„‘ä¸Šè¿è¡Œã€‚è¿™ä¸ªç±»é€šè¿‡è¿”å›promiseæ¥æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œpromiseè¢«è°ƒç”¨åï¼Œ200msåä¼šå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>.user = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'test'</span> &#125;</span><br><span class="line">    <span class="keyword">this</span>.friends = [ <span class="keyword">this</span>.user, <span class="keyword">this</span>.user, <span class="keyword">this</span>.user ]</span><br><span class="line">    <span class="keyword">this</span>.photo = <span class="string">'not a real photo'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getUser () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="keyword">this</span>.user), <span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getFriends (userId) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="keyword">this</span>.friends.slice()), <span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getPhoto (userId) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="keyword">this</span>.photo), <span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  throwError () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Intentional Error'</span>)), <span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¯ä¸ªç¤ºä¾‹ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹ä¸‰ä¸ªæ“ä½œï¼š è·å–ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œè·å–è¯¥ç”¨æˆ·çš„æœ‹å‹ï¼Œ è·å–è¯¥ç”¨æˆ·çš„ç…§ç‰‡ã€‚åœ¨æœ€åï¼Œæˆ‘ä»¬ä¼šåœ¨æ§åˆ¶å°ä¸­æ‰“å°è¿™äº›ç»“æœã€‚</p><h4 id="æ–¹æ³•ä¸€-â€”-Nested-Promise-Callback-Functions"><a href="#æ–¹æ³•ä¸€-â€”-Nested-Promise-Callback-Functions" class="headerlink" title="æ–¹æ³•ä¸€ â€” Nested Promise Callback Functions"></a>æ–¹æ³•ä¸€ â€” Nested Promise Callback Functions</h4><p>ä½¿ç”¨åµŒå¥—çš„promiseå›è°ƒå‡½æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackHell</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">let</span> user, friends</span><br><span class="line">  api.getUser().then(<span class="function"><span class="keyword">function</span> (<span class="params">returnedUser</span>) </span>&#123;</span><br><span class="line">    user = returnedUser</span><br><span class="line">    api.getFriends(user.id).then(<span class="function"><span class="keyword">function</span> (<span class="params">returnedFriends</span>) </span>&#123;</span><br><span class="line">      friends = returnedFriends</span><br><span class="line">      api.getPhoto(user.id).then(<span class="function"><span class="keyword">function</span> (<span class="params">photo</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'callbackHell'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯¹äºä»»ä½•ä¸€ä¸ªä»äº‹è¿‡JavaScripté¡¹ç›®å¼€å‘çš„äººæ¥è¯´ï¼Œè¿™ä¸ªä»£ç å—éå¸¸ç†Ÿæ‚‰ã€‚éå¸¸ç®€å•çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯ä»£ç å´æ˜¯å†—é•¿ã€æ·±åµŒå¥—ï¼Œå¹¶ä¸”ä»¥è¿™ä¸ªç»“å°¾â€¦..<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ¯ä¸ªå›è°ƒå‡½æ•°å¯èƒ½æ›´å¤æ‚ï¼Œä»£ç å—ä¼šä»¥ä¸€å †å……æ»¡å±‚æ¬¡æ„Ÿçš„<code>})</code>ä¸ºç»“å°¾ã€‚â€œå›è°ƒå‡½æ•°é‡Œé¢åµŒå¥—ç€å›è°ƒå‡½æ•°åµŒå¥—ç€å›è°ƒå‡½æ•°â€ï¼Œè¿™å°±æ˜¯è¢«ä¼ è¯´ä¸­çš„â€œå›è°ƒåœ°ç‹±â€ï¼ˆâ€œå›è°ƒåœ°ç‹±â€çš„è¯ç”Ÿä¸åªæ˜¯å› ä¸ºä»£ç å—çš„æ··ä¹±ï¼Œä¹Ÿæºäºä¿¡ä»»é—®é¢˜ã€‚ï¼‰ã€‚<br>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–ï¼Œè¿˜æ²¡æœ‰åšé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¦‚æœåŠ ä¸Šäº†rejectâ€¦â€¦ç»†æ€ææ</p><h4 id="æ–¹æ³•äºŒ-â€”-Promise-Chain"><a href="#æ–¹æ³•äºŒ-â€”-Promise-Chain" class="headerlink" title="æ–¹æ³•äºŒ â€” Promise Chain"></a>æ–¹æ³•äºŒ â€” Promise Chain</h4><p>è®©æˆ‘ä»¬ä¼˜é›…èµ·æ¥<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseChain</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">let</span> user, friends</span><br><span class="line">  api.getUser()</span><br><span class="line">    .then(<span class="function">(<span class="params">returnedUser</span>) =&gt;</span> &#123;</span><br><span class="line">      user = returnedUser</span><br><span class="line">      <span class="keyword">return</span> api.getFriends(user.id)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">returnedFriends</span>) =&gt;</span> &#123;</span><br><span class="line">      friends = returnedFriends</span><br><span class="line">      <span class="keyword">return</span> api.getPhoto(user.id)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">photo</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'promiseChain'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Promiseæœ‰ä¸€ä¸ªå¾ˆæ£’çš„ç‰¹æ€§ï¼šPromise.prototype.then()å’ŒPromise.prototype.catch()è¿”å›Promiseå¯¹è±¡ï¼Œè¿™å°±ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†è¿™äº›promiseè¿æ¥æˆä¸€ä¸ªpromiseé“¾ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å›è°ƒå‡½æ•°æ”¾åœ¨ä¸€ä¸ªç¼©è¿›å±‚æ¬¡é‡Œã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ç®€åŒ–äº†å›è°ƒå‡½æ•°å£°æ˜ã€‚<br>å¯¹æ¯”ä¹‹å‰çš„å›è°ƒåœ°ç‹±ï¼Œä½¿ç”¨promiseé“¾ä½¿å¾—ä»£ç çš„å¯è¯»æ€§å¤§å¤§æé«˜å¹¶ä¸”æ‹¥æœ‰ç€æ›´å¥½çš„åºåˆ—æ„Ÿï¼Œä½†æ˜¯çœ‹èµ·æ¥è¿˜æ˜¯éå¸¸å†—é•¿å¹¶ä¸”æœ‰ä¸€ç‚¹å¤æ‚ã€‚</p><h4 id="æ–¹æ³•ä¸‰-â€”-Async-Await"><a href="#æ–¹æ³•ä¸‰-â€”-Async-Await" class="headerlink" title="æ–¹æ³•ä¸‰ â€” Async/Await"></a>æ–¹æ³•ä¸‰ â€” Async/Await</h4><p>æˆ‘ä»¬å¯ä¸å¯ä»¥ä¸å†™å›è°ƒå‡½æ•°ï¼Ÿå°±å†™7è¡Œä»£ç èƒ½è§£å†³å—ï¼Ÿ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitIsYourNewBestFriend</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> api.getUser()</span><br><span class="line">  <span class="keyword">const</span> friends = <span class="keyword">await</span> api.getFriends(user.id)</span><br><span class="line">  <span class="keyword">const</span> photo = <span class="keyword">await</span> api.getPhoto(user.id)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'asyncAwaitIsYourNewBestFriend'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¼˜é›…å¤šäº†ï¼Œè°ƒç”¨awaitä¹‹å‰æˆ‘ä»¬ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°promiseè¢«å†³è®®å¹¶å°†å€¼èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡ã€‚é€šè¿‡async/awaitï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¼‚æ­¥æ“ä½œæµç¨‹è¿›è¡Œæ§åˆ¶ï¼Œå°±å¥½åƒå®ƒæ˜¯åŒæ­¥ä»£ç ã€‚</p><p><strong>æ³¨ï¼šawaitå¿…é¡»æ­é…asyncä¸€èµ·ä½¿ç”¨ï¼Œæ³¨æ„ä¸Šé¢çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†å…³é”®å­—asyncæ”¾åœ¨äº†å‡½æ•°çš„å£°æ˜å‰ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚ç¨åï¼Œæˆ‘ä»¬ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜</strong></p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><p>Async/Awaitå¯ä»¥è®©ä»¥å‰å¾ˆå¤šå¤æ‚çš„ä»£ç å˜å¾—ç®€æ˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŒ‰åºæ£€ç´¢æ¯ä¸ªç”¨æˆ·çš„æœ‹å‹çš„æœ‹å‹åˆ—è¡¨ã€‚</p><h4 id="æ–¹æ³•ä¸€-â€”-Recursive-Promise-Loop"><a href="#æ–¹æ³•ä¸€-â€”-Recursive-Promise-Loop" class="headerlink" title="æ–¹æ³•ä¸€ â€” Recursive Promise Loop"></a>æ–¹æ³•ä¸€ â€” Recursive Promise Loop</h4><p>ä¸‹é¢æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„promiseæ¥æŒ‰åºè·å–æ¯ä¸ªæœ‹å‹çš„æœ‹å‹åˆ—è¡¨<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseLoops</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  api.getUser()</span><br><span class="line">    .then(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> api.getFriends(user.id)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">returnedFriends</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> getFriendsOfFriends = <span class="function">(<span class="params">friends</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (friends.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> friend = friends.pop()</span><br><span class="line">          <span class="keyword">return</span> api.getFriends(friend.id)</span><br><span class="line">            .then(<span class="function">(<span class="params">moreFriends</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">'promiseLoops'</span>, moreFriends)</span><br><span class="line">              <span class="keyword">return</span> getFriendsOfFriends(friends)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> getFriendsOfFriends(returnedFriends)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬åˆ›å»ºåœ¨promiseLoopsä¸­åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç”¨äºé€’å½’åœ°å»è·å–æœ‹å‹çš„æœ‹å‹åˆ—è¡¨ã€‚è¿™ä¸ªå‡½æ•°ä½“ç°äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªç®€å•çš„ä»»åŠ¡è€Œè¨€ï¼Œè¿™ä¾æ—§æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="æ–¹æ³•äºŒ-â€”-Async-Await-For-Loop"><a href="#æ–¹æ³•äºŒ-â€”-Async-Await-For-Loop" class="headerlink" title="æ–¹æ³•äºŒ â€” Async/Await For-Loop"></a>æ–¹æ³•äºŒ â€” Async/Await For-Loop</h4><p>è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹Async/Await<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitLoops</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> api.getUser()</span><br><span class="line">  <span class="keyword">const</span> friends = <span class="keyword">await</span> api.getFriends(user.id)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> friend <span class="keyword">of</span> friends) &#123;</span><br><span class="line">    <span class="keyword">let</span> moreFriends = <span class="keyword">await</span> api.getFriends(friend.id)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'asyncAwaitLoops'</span>, moreFriends)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸éœ€è¦å†™é€’å½’promiseé—­åŒ…ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªforå¾ªç¯å°±èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p><h3 id="å¹¶è¡Œ"><a href="#å¹¶è¡Œ" class="headerlink" title="å¹¶è¡Œ"></a>å¹¶è¡Œ</h3><p>ä¸€ä¸ªä¸€ä¸ªåœ°å»è·å–æœ‹å‹çš„æœ‹å‹çš„åˆ—è¡¨çœ‹èµ·æ¥æœ‰ç‚¹æ…¢ï¼Œä¸ºä»€ä¹ˆä¸å¹¶è¡Œå¤„ç†è¯·æ±‚å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨async/awaitæ¥å¤„ç†å¹¶è¡Œä»»åŠ¡å—ï¼Ÿ<br>å½“ç„¶<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitLoopsParallel</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> api.getUser()</span><br><span class="line">  <span class="keyword">const</span> friends = <span class="keyword">await</span> api.getFriends(user.id)</span><br><span class="line">  <span class="keyword">const</span> friendPromises = friends.map(<span class="function"><span class="params">friend</span> =&gt;</span> api.getFriends(friend.id))</span><br><span class="line">  <span class="keyword">const</span> moreFriends = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(friendPromises)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'asyncAwaitLoopsParallel'</span>, moreFriends)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†å¹¶è¡Œè¯·æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªpromiseæ•°ç»„å¹¶å°†å®ƒä¼ é€’ç»™æ–¹æ³•Promise.all()ï¼ŒPromise.all()ä¼šè¿”å›ä¸€ä¸ªpromiseï¼Œä¸€æ—¦æ‰€æœ‰çš„è¯·æ±‚å®Œæˆå°±ä¼šå†³è®®ã€‚</p><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><p>ç„¶è€Œï¼Œåœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­æœ‰ä¸€ä¸ªä¸»è¦çš„é—®é¢˜è¿˜æ²¡è§£å†³ï¼šé”™è¯¯å¤„ç†ã€‚åœ¨å¼‚æ­¥æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªæ“ä½œç¼–å†™å•ç‹¬çš„é”™è¯¯å¤„ç†å›è°ƒï¼Œåœ¨è°ƒç”¨æ ˆçš„é¡¶éƒ¨å»æ‰¾å‡ºæ­£ç¡®çš„æŠ¥é”™ä½ç½®å¯èƒ½å¾ˆå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åœ¨æ¯ä¸ªå›è°ƒå¼€å§‹æ—¶å°±å»æ£€æŸ¥æ˜¯å¦æŠ›å‡ºäº†é”™è¯¯ã€‚æ‰€ä»¥ï¼Œå¼•å…¥é”™è¯¯å¤„ç†åçš„å›è°ƒå‡½æ•°ä¼šæ¯”ä¹‹å‰å¤æ‚åº¦æˆå€å¢åŠ ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨å®šä½åˆ°æŠ¥é”™çš„ä½ç½®ï¼Œè¿™äº›é”™è¯¯ç”šè‡³ä¼šè¢«â€œåæ‰â€ã€‚<br>ç°åœ¨ï¼Œæˆ‘ä»¬ç»™ä¹‹å‰çš„ä¾‹å­æ·»ä¸Šé”™è¯¯å¤„ç†æœºåˆ¶ã€‚ä¸ºäº†æµ‹è¯•é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨çœŸæ­£è·å–åˆ°ç”¨æˆ·å›¾ç‰‡ä¹‹å‰ä½¿ç”¨æŠ½è±¡ç±»é‡Œçš„<code>api.throwError()</code>æ–¹æ³•ã€‚</p><h4 id="æ–¹æ³•ä¸€-â€”-Promise-Error-Callbacks"><a href="#æ–¹æ³•ä¸€-â€”-Promise-Error-Callbacks" class="headerlink" title="æ–¹æ³•ä¸€ â€” Promise Error Callbacks"></a>æ–¹æ³•ä¸€ â€” Promise Error Callbacks</h4><p>è®©æˆ‘ä»¬çœ‹çœ‹æœ€åçš„æƒ…å†µ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackErrorHell</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">let</span> user, friends</span><br><span class="line">  api.getUser().then(<span class="function"><span class="keyword">function</span> (<span class="params">returnedUser</span>) </span>&#123;</span><br><span class="line">    user = returnedUser</span><br><span class="line">    api.getFriends(user.id).then(<span class="function"><span class="keyword">function</span> (<span class="params">returnedFriends</span>) </span>&#123;</span><br><span class="line">      friends = returnedFriends</span><br><span class="line">      api.throwError().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Error was not thrown'</span>)</span><br><span class="line">        api.getPhoto(user.id).then(<span class="function"><span class="keyword">function</span> (<span class="params">photo</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'callbackErrorHell'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»£ç é™¤äº†åˆé•¿åˆä¸‘é™‹ä»¥å¤–ï¼Œä»£ç æ“ä½œæµä¹Ÿä¸ç›´è§‚ï¼Œä¸åƒåŒæ­¥ã€å¯è¯»æ€§é«˜çš„ä»£ç é‚£æ ·ä»ä¸Šå¾€ä¸‹ã€‚</p><h4 id="æ–¹æ³•äºŒ-â€”-Promise-Chain-â€œCatchâ€-Method"><a href="#æ–¹æ³•äºŒ-â€”-Promise-Chain-â€œCatchâ€-Method" class="headerlink" title="æ–¹æ³•äºŒ â€” Promise Chain â€œCatchâ€ Method"></a>æ–¹æ³•äºŒ â€” Promise Chain â€œCatchâ€ Method</h4><p>æˆ‘ä»¬å¯ä»¥ç»™promiseé“¾æ·»åŠ <code>catch</code>æ–¹æ³•æ¥æ”¹å–„ä¸€äº›<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackErrorPromiseChain</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">let</span> user, friends</span><br><span class="line">  api.getUser()</span><br><span class="line">    .then(<span class="function">(<span class="params">returnedUser</span>) =&gt;</span> &#123;</span><br><span class="line">      user = returnedUser</span><br><span class="line">      <span class="keyword">return</span> api.getFriends(user.id)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">returnedFriends</span>) =&gt;</span> &#123;</span><br><span class="line">      friends = returnedFriends</span><br><span class="line">      <span class="keyword">return</span> api.throwError()</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Error was not thrown'</span>)</span><br><span class="line">      <span class="keyword">return</span> api.getPhoto(user.id)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">photo</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'callbackErrorPromiseChain'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çœ‹èµ·æ¥å¥½å¤šäº†ï¼Œæˆ‘ä»¬é€šè¿‡ç»™promiseæ·»åŠ ä¸€ä¸ªé”™è¯¯å¤„ç†å–ä»£äº†ä¹‹å‰ç»™æ¯ä¸ªå›è°ƒå‡½æ•°æ·»åŠ é”™è¯¯å¤„ç†ã€‚ä½†æ˜¯ï¼Œè¿™è¿˜æ˜¯æœ‰ä¸€ç‚¹å¤æ‚å¹¶ä¸”æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å›è°ƒæ¥å¤„ç†å¼‚æ­¥é”™è¯¯è€Œä¸æ˜¯åƒå¯¹å¾…æ­£å¸¸çš„JavaScripté”™è¯¯é‚£æ ·å¤„ç†å®ƒä»¬ã€‚</p><h4 id="æ–¹æ³•ä¸‰-â€”-Normal-Try-Catch-Block"><a href="#æ–¹æ³•ä¸‰-â€”-Normal-Try-Catch-Block" class="headerlink" title="æ–¹æ³•ä¸‰ â€” Normal Try/Catch Block"></a>æ–¹æ³•ä¸‰ â€” Normal Try/Catch Block</h4><p>æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">aysncAwaitTryCatch</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> api.getUser()</span><br><span class="line">    <span class="keyword">const</span> friends = <span class="keyword">await</span> api.getFriends(user.id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> api.throwError()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Error was not thrown'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> photo = <span class="keyword">await</span> api.getPhoto(user.id)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async/await'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å°†å¼‚æ­¥æ“ä½œæ”¾è¿›äº†å¤„ç†åŒæ­¥ä»£ç çš„try/catchä»£ç å—ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åƒå¯¹å¾…åŒæ­¥ä»£ç çš„ä¸€æ ·å¤„ç†å¼‚æ­¥ä»£ç çš„é”™è¯¯ã€‚ä»£ç çœ‹èµ·æ¥éå¸¸ç®€æ˜</p><h3 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h3><p>æˆ‘åœ¨å‰é¢æåŠäº†ä»»ä½•ä»¥<code>async</code>çš„å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªpromiseã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥çœŸæ­£è½»æ¾åœ°ç»„åˆå¼‚æ­¥æ§åˆ¶æµ<br>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ•´ç†å‰é¢çš„ä¾‹å­ï¼Œå°†è·å–æ•°æ®å’Œå¤„ç†æ•°æ®åˆ†å¼€ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒç”¨asyncå‡½æ•°è·å–æ•°æ®ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> api = <span class="keyword">new</span> Api()</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> api.getUser()</span><br><span class="line">  <span class="keyword">const</span> friends = <span class="keyword">await</span> api.getFriends(user.id)</span><br><span class="line">  <span class="keyword">const</span> photo = <span class="keyword">await</span> api.getPhoto(user.id)</span><br><span class="line">  <span class="keyword">return</span> &#123; user, friends, photo &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseUserInfo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  getUserInfo().then(<span class="function">(<span class="params">&#123; user, friends, photo &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promiseUserInfo'</span>, &#123; user, friends, photo &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ›´æ£’çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®æ¥å—å‡½æ•°é‡Œä½¿ç”¨async/awaitï¼Œè¿™å°†ä½¿å¾—æ•´ä¸ªå¼‚æ­¥æ¨¡å—æ›´åŠ æ˜æ˜¾ã€‚<br>å¦‚æœæˆ‘ä»¬è¦è·å–å‰é¢10ä¸ªç”¨æˆ·çš„æ•°æ®å‘¢ï¼Ÿ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getLotsOfUserData</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> users = []</span><br><span class="line">  <span class="keyword">while</span> (users.length &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    users.push(<span class="keyword">await</span> getUserInfo())</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'getLotsOfUserData'</span>, users)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¹¶å‘å‘¢ï¼Ÿå¹¶ä¸”åŠ ä¸Šé”™è¯¯å¤„ç†å‘¢ï¼Ÿ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getLotsOfUserDataFaster</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userPromises = <span class="built_in">Array</span>(<span class="number">10</span>).fill(getUserInfo())</span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(userPromises)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'getLotsOfUserDataFaster'</span>, users)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>éšç€SPAçš„å…´èµ·å’ŒNodeJSçš„å¹¿æ³›åº”ç”¨ï¼Œå¯¹äºJavaScriptå¼€å‘äººå‘˜æ¥è¯´ï¼Œä¼˜é›…åœ°å¤„ç†å¹¶å‘æ€§æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½è¦é‡è¦ã€‚Async/Awaitç¼“è§£äº†è®¸å¤šå› ä¸ºbugå¼•èµ·ä¸”å·²ç»å½±å“JavaScriptå¾ˆå¤šå¹´çš„æ§åˆ¶æµé—®é¢˜ï¼Œå¹¶ä¸”ä½¿å¾—ä»£ç æ›´åŠ ä¼˜é›…ã€‚å¦‚ä»Šï¼Œä¸»æµçš„æµè§ˆå™¨å’ŒNodeJSéƒ½å·²ç»æ”¯æŒäº†è¿™äº›è¯­æ³•ç³–ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯ä½¿ç”¨Async/Awaitçš„æœ€å¥½æ—¶æœºã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.patricktriest.com/what-is-async-await-why-should-you-care/" target="_blank" rel="noopener">https://blog.patricktriest.com/what-is-async-await-why-should-you-care/</a><br>æ˜é‡‘åœ°å€ï¼š<a href="https://juejin.im/post/5ad1cab8f265da238a30e137" target="_blank" rel="noopener">https://juejin.im/post/5ad1cab8f265da238a30e137</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¿»è¯‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> æ˜é‡‘ç¿»è¯‘è®¡åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡Nginxåå‘ä»£ç†è·¨åŸŸ</title>
      <link href="/2018/04/08/Cross-Origin-using-Nginx/"/>
      <url>/2018/04/08/Cross-Origin-using-Nginx/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºé¡¹ç›®å‰åç«¯åˆ†ç¦»ä¸”åç«¯çœŸå®æ¥å£å·²å‡ºï¼Œæ‰€ä»¥æˆ‘å¼€å‘æ—¶é¦–å…ˆè€ƒè™‘é€šè¿‡è·¨åŸŸè·å–çœŸå®æ¥å£æ•°æ®é…åˆå‰ç«¯å¼€å‘ã€‚ï¼ˆèµ¶å·¥æœŸå•Šï¼šï¼‰<br>æ ¹æ®create-react-appå®˜æ–¹æç¤ºï¼Œåœ¨package.jsonä¸­æ·»åŠ å­—æ®µ<br><code>&quot;proxy&quot;: &quot;http://admin.xiaoyaoeden.top&quot;</code><br>emmm<br>ğŸ¤­æ— æ•ˆ ğŸ˜‚<br>æ‰€ä»¥æ”¹ä¸ºä½¿ç”¨Nginxåå‘ä»£ç†è·¨åŸŸğŸ˜Š<br>current originï¼š<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a><br>target originï¼š<a href="http://admin.xiaoyaoeden.top" target="_blank" rel="noopener">http://admin.xiaoyaoeden.top</a><br><a id="more"></a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><code>brew install nginx</code></p><h2 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h2><p>é¦–å…ˆè¿›å…¥nginxçš„é…ç½®æ–‡ä»¶</p><p><code>vim /usr/local/etc/nginx/nginx.conf</code></p><p>å¢åŠ å¦‚ä¸‹ä¸€ä¸ªserver</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       3001;</span><br><span class="line">       server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">           proxy_pass http://localhost:3000;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /api/ &#123;</span><br><span class="line">           add_header Access-Control-Allow-Origin *;</span><br><span class="line">           proxy_pass http://admin.xiaoyaoeden.top;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="é‡å¯NginxæœåŠ¡"><a href="#é‡å¯NginxæœåŠ¡" class="headerlink" title="é‡å¯NginxæœåŠ¡"></a>é‡å¯NginxæœåŠ¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æ‰“å¼€localhost:3001ï¼Œè·¨åŸŸé—®é¢˜è§£å†³äº†ï¼Œç°åœ¨å¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„æµ‹è¯•æ¥å£å•¦</p>]]></content>
      
      
      <categories>
          
          <category> å®è·µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¨åŸŸ </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„ç±»å‹ï¼ˆäºŒï¼‰â€”â€”â€”â€” å¼ºåˆ¶ç±»å‹è½¬æ¢</title>
      <link href="/2018/02/15/type-juggling/"/>
      <url>/2018/02/15/type-juggling/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>JavaScriptä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ç»å¸¸è®©äººè¯Ÿç—…ï¼Œä½†æ˜¯ä¹Ÿå¹¶éä¸€æ— æ˜¯å¤„ã€‚<br>å°†<strong>å€¼</strong>ä»ä¸€ç§ç±»å‹è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ç§°ä¸ºç±»å‹è½¬æ¢ï¼Œéšå¼è½¬æ¢ç§°ä¸º<strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼›ä¸æ­¤åŒæ—¶ä¹Ÿæœ‰å¦å¤–ä¸€ç§åŒºåˆ†æ–¹å¼ï¼Œç±»å‹è½¬æ¢å‘ç”Ÿåœ¨é™æ€è¯­è¨€ç¼–è¯‘é˜¶æ®µè€Œå¼ºåˆ¶ç±»å‹å‘ç”Ÿåœ¨åŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶ã€‚åœ¨JavaScriptä¸­ï¼Œç»Ÿç§°ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ˜¾éšä¹‹åˆ†å¤šå–å†³äºç¼–ç è€…æ˜¯å¦çŸ¥é“è½¬æ¢çš„æ•ˆæœå’Œå‰¯ä½œç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>â€œå·¥ä½œå®¤æ‹›æ–°é¡µé¢é¡¹ç›®â€å®è·µä¸­é‡åˆ°çš„é—®é¢˜ï¼ˆä¸€ï¼‰â€”â€”â€”â€” Reactç»„ä»¶é€šä¿¡</title>
      <link href="/2018/02/13/React-Problem-1/"/>
      <url>/2018/02/13/React-Problem-1/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å­¦äº†ReactåŸºç¡€çŸ¥è¯†ï¼Œæ‰€ä»¥æœ‰æ‰“ç®—åšä¸€ä¸ªé¡¹ç›®æ¥è¸©å‘ï¼Œæ°å¥½é€‚é€¢å¤§äºŒå¯’å‡å¹¶ä¸”å·¥ä½œå®¤æ°å¥½éœ€è¦åœ¨å¼€å­¦åæ‹›æ–°ï¼Œæ‰€ä»¥å¤©æ—¶åœ°åˆ©äººå’Œï¼Œæˆ‘å°±ç”¨Reactä½œä¸ºè¿™ä¸ªé¡¹ç›®çš„æŠ€æœ¯æ ˆã€‚äºæ˜¯é¡¹ç›®å¼€å‘ä¸­çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±è¯ç”Ÿäº†â€”â€”â€”â€”Reactç»„ä»¶é€šä¿¡<br><a id="more"></a></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h3><p>material-uiä¸­çš„ç»„ä»¶AppBarå’ŒDrawerä¹‹é—´çš„é€šä¿¡ï¼ŒäºŒè€…ä¸ºå…„å¼Ÿç»„ä»¶ã€‚</p><p>AppBarç»„ä»¶<br><img src="http://chuantu.biz/t6/230/1518587193x-1404764720.png" alt=""></p><p>Drawerç»„ä»¶<br><img src="http://chuantu.biz/t6/230/1518587161x-1404764720.png" alt=""></p><h3 id="åŠŸèƒ½éœ€æ±‚ï¼š"><a href="#åŠŸèƒ½éœ€æ±‚ï¼š" class="headerlink" title="åŠŸèƒ½éœ€æ±‚ï¼š"></a>åŠŸèƒ½éœ€æ±‚ï¼š</h3><ol><li>æˆ‘éœ€è¦ç‚¹å‡»AppBarçš„å·¦ä¾§çš„iconè°ƒå‡ºDrawerã€‚</li><li>ç‚¹å‡»Drawerä¸­çš„MenuItemè·³è½¬åˆ°å…¶ä»–é¡µé¢</li><li>è°ƒå‡ºDraweråç‚¹å‡»éDrawerç»„ä»¶åæ”¶èµ·Drawerã€‚</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>é€šè®¯æ˜¯å•å‘çš„ï¼Œæ•°æ®å¿…é¡»æ˜¯ç”±ä¸€æ–¹ä¼ åˆ°å¦ä¸€æ–¹ã€‚</p><h4 id="çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„é€šä¿¡"><a href="#çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„é€šä¿¡" class="headerlink" title="çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„é€šä¿¡"></a>çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„é€šä¿¡</h4><p>åœ¨ React ä¸­ï¼Œçˆ¶ç»„ä»¶å¯ä»¥å‘å­ç»„ä»¶é€šè¿‡ä¼  props çš„æ–¹å¼ï¼Œå‘å­ç»„ä»¶è¿›è¡Œé€šè®¯ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      msg: <span class="string">'ä»Šå¤©æ˜¯æƒ…äººèŠ‚è€¶'</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Child msg=&#123;<span class="keyword">this</span>.state.msg&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Child extends Component &#123;</span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;this.props.msg&lt;/</span>p&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„é€šä¿¡"><a href="#å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„é€šä¿¡" class="headerlink" title="å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„é€šä¿¡"></a>å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„é€šä¿¡</h4><p>å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼ŒåŒæ ·éœ€è¦çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’propsï¼Œä¸è¿‡è¿™æ¬¡æ˜¯ä¼ é€’çš„æ˜¯ä»¥çˆ¶ç»„ä»¶è‡ªèº«ä¸ºä½œç”¨åŸŸçš„å‡½æ•°ï¼Œå­ç»„ä»¶è´Ÿè´£è°ƒç”¨ï¼Œå°†è¦ä¼ é€’çš„ä¿¡æ¯ä¼ å…¥å‡½æ•°ä¸­ï¼Œä½œä¸ºå‚æ•°ï¼Œä¼ é€’åˆ°çˆ¶ç»„ä»¶çš„ä½œç”¨åŸŸä¸­ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      msg: <span class="string">'ä»Šå¤©æ˜¯æƒ…äººèŠ‚è€¶'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.transferMsg = <span class="keyword">this</span>.transferMsg.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.msg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.msg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  transferMsg(msg) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      msg: msg</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Child transferMsg=&#123;<span class="keyword">this</span>.transferMsg&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Child extends Component &#123;</span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp">    this.msg = 'æˆ‘ä¹Ÿå–œæ¬¢ä½ ';</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  componentDidMount() &#123;</span></span><br><span class="line"><span class="regexp">    this.props.transferMsg(this.msg);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;æƒ…äººèŠ‚å•Š&lt;/</span>p&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡"><a href="#å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡" class="headerlink" title="å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡"></a>å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡</h4><p>å› ä¸ºAppBarå’ŒDrawerä¸ºå…„å¼Ÿç»„ä»¶ï¼Œå®ƒä»¬çš„å…±åŒç‚¹æ˜¯æ‹¥æœ‰ä¸€ä¸ªç›¸åŒçš„çˆ¶ç»„ä»¶ã€‚<br>å…ˆçœ‹çœ‹ç»„ä»¶ç»“æ„ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Nav&gt;</span><br><span class="line">  &lt;AppBar /&gt;</span><br><span class="line">  &lt;Drawer /&gt;</span><br><span class="line">&lt;<span class="regexp">/Nav&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†çˆ¶ç»„ä»¶Navä½œä¸ºä¸­è½¬ç«™ï¼ŒAppBarä¼ é€’ä¿¡æ¯ç»™Navï¼ŒNavå†å°†ä¿¡æ¯ä¼ é€’ç»™Drawer;Draweä¼ é€’ä¿¡æ¯ç»™AppBarä¸æ­¤ç±»ä¼¼ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼Œæˆ‘ä»¬å°†Drawerçš„å¼€å…³çŠ¶æ€æ”¾åœ¨äº†Navçš„stateä¸­ï¼Œå£°æ˜äº†æ›´æ”¹openå€¼çš„transferMsgå‡½æ•°ï¼Œç„¶åå°†è¿™ä¸ªå‡½æ•°åˆ†åˆ«ä¼ é€’ä¸ªNavBarå’ŒDrawerï¼Œè¿™æ ·ä»¥æ¥çœŸæ­£æ§åˆ¶opençš„å€¼å°±æ˜¯NavBarå’ŒDrawerç»„ä»¶ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      open: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.transferMsg = <span class="keyword">this</span>.transferMsg.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  transferMsg() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      open: !<span class="keyword">this</span>.state.open</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;nav&gt;</span><br><span class="line">        &lt;NavBar transferMsg=&#123;<span class="keyword">this</span>.transferMsg&#125;/&gt;</span><br><span class="line">        &lt;NavDrawer</span><br><span class="line">          msg=&#123;<span class="keyword">this</span>.state.open&#125;</span><br><span class="line">          transferMsg=&#123;<span class="keyword">this</span>.transferMsg&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/nav&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class NavBar extends Component &#123;</span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp">    this.handleMenuClick = this.handleMenuClick.bind(this);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  handleMenuClick(event) &#123;</span></span><br><span class="line"><span class="regexp">    this.props.transferMsg();</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;AppBar</span></span><br><span class="line"><span class="regexp">        title="CTG Club"</span></span><br><span class="line"><span class="regexp">        iconClassNameRight="mudiocs-icon-navigation-expand-more"</span></span><br><span class="line"><span class="regexp">        onLeftIconButtonClick=&#123;this.handleMenuClick&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavDrawer</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleToggle= <span class="keyword">this</span>.handleToggle.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleClose = <span class="keyword">this</span>.handleClose.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleToggle() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.transferMsg();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClose() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.transferMsg();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Drawer</span><br><span class="line">          docked=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">          width=&#123;<span class="number">200</span>&#125;</span><br><span class="line">          open=&#123;<span class="keyword">this</span>.props.msg&#125;</span><br><span class="line">          onRequestChange=&#123;<span class="keyword">this</span>.handleToggle&#125;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;<span class="regexp">/Drawer&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªé¡¹ç›®ä¸­çš„é—®é¢˜è¿åˆƒè€Œè§£ã€‚è¿™ä»£ç ç»“æ„ï¼Œä»¿ä½›è¿˜æœ‰ä¸€ç‚¹ä¸œè¥¿ã€‚</p><h3 id="å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼"><a href="#å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼"></a>å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼åˆå«<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚åœ¨ JavaScriptå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨<strong>äº‹ä»¶æ¨¡å‹</strong>æ¥æ›¿ä»£ä¼ ç»Ÿçš„å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ã€‚</p><p>####è¿ç”¨<br>1.å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼å¯ä»¥å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œåªæ˜¯ä¸€ç§æ›¿ä»£å›è°ƒå‡½æ•°çš„æ–¹æ¡ˆã€‚<br>2ã€‚å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼å¯ä»¥å–ä»£å¯¹è±¡ä¹‹é—´ç¡¬ç¼–ç çš„é€šçŸ¥æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡ä¸å†æ˜¾å¼è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ¥å£ï¼Œè®©ä¸¤ä¸ªå¯¹è±¡æ¾è€¦åˆåœ°è”ç³»åœ¨ä¸€èµ·ã€‚ï¼ˆè¿™ä¸€ç‚¹å°±å¯ä»¥ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆçš„ä¸è¶³çš„åœ°æ–¹ï¼‰</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>æœ€è¿‘ä¸€å¹´é‡åº†æˆ¿ä»·è¹­è¹­å¾€ä¸Šæ¶¨ï¼Œå°æ˜è¿«äºå®¶é‡Œçš„å‹åŠ›ï¼Œæ‰“ç®—åœ¨è§£æ”¾ç¢‘ä¹°ç½®ä¸€å¥—æ€»ä»·200ä¸‡çš„ä¸‰å±…å®¤ã€‚å°æ˜åˆ°äº†å”®æ¥¼å¤„æ‰å‘ç°å¿ƒä»ªçš„æˆ¿å­å·²ç»è¢«åˆ«äººä¹°äº†ï¼Œä¸è¿‡åç»­è¿˜æœ‰ä¸€äº›å°¾æˆ¿æ¨å‡ºï¼Œä½†æ˜¯å¼€å‘å•†ä¹Ÿä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™æ¨å‡ºè¿™äº›å°¾æˆ¿ã€‚<br>äºæ˜¯å”®æ¥¼MMè®°ä¸‹äº†å°æ˜çš„ç”µè¯ï¼Œç­”åº”ä»–å°¾æˆ¿ä¸€æ—¦æ¨å‡ºå°±æ‰“ç”µè¯ç»™ä»–ã€‚åç»­å°ç ä¹Ÿç•™äº†å·ç ï¼Œæ¯å¤©ç­‰ç€å”®æ¥¼MMçš„ç”µè¯ã€‚<br>è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼çš„ä¾‹å­ï¼Œé€»è¾‘ä»£ç å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠŠå‘å¸ƒâ€”è®¢é˜…çš„åŠŸèƒ½æå–å‡ºæ¥ï¼Œæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡å†…:</span></span><br><span class="line"><span class="keyword">const</span> event = &#123;</span><br><span class="line">  clientList: [],</span><br><span class="line">  listen(key, fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.clientList[key]) &#123;  <span class="comment">//å¦‚æœè¿˜æ²¡æœ‰è®¢é˜…è¿‡æ­¤ç±»æ¶ˆæ¯ï¼Œç»™è¯¥ç±»æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ—è¡¨</span></span><br><span class="line">      <span class="keyword">this</span>.clientList[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.clientList[key].push(fn);  <span class="comment">// è®¢é˜…çš„æ¶ˆæ¯æ·»åŠ è¿›æ¶ˆæ¯ç¼“å­˜åˆ—è¡¨</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  trigger(...message) &#123;</span><br><span class="line">    <span class="keyword">let</span> key = <span class="built_in">Array</span>.prototype.shift.call(message),  <span class="comment">//å–å‡ºæ¶ˆæ¯ç±»å‹</span></span><br><span class="line">      fns = <span class="keyword">this</span>.clientList[key]; <span class="comment">//å–å‡ºè¯¥æ¶ˆæ¯å¯¹åº”çš„å›è°ƒå‡½æ•°é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span> (!fns || fns.length === <span class="number">0</span>) &#123; <span class="comment">//å¦‚æœæ²¡æœ‰è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œåˆ™è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, fn = fns[i++]; ) &#123;</span><br><span class="line">      fn.apply(<span class="keyword">this</span>, message); <span class="comment">//messageæ˜¯å‘å¸ƒæ¶ˆæ¯æ—¶é™„é€çš„å‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  remove(key, fn) &#123;</span><br><span class="line">    <span class="keyword">let</span> fns = <span class="keyword">this</span>.clientList[key];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!fns) &#123; <span class="comment">// å¦‚æœ key å¯¹åº”çš„æ¶ˆæ¯æ²¡æœ‰è¢«äººè®¢é˜…ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!fn) &#123;  <span class="comment">//// å¦‚æœæ²¡æœ‰ä¼ å…¥å…·ä½“çš„å›è°ƒå‡½æ•°ï¼Œè¡¨ç¤ºéœ€è¦å–æ¶ˆ key å¯¹åº”æ¶ˆæ¯çš„æ‰€æœ‰è®¢é˜…</span></span><br><span class="line">      fns &amp;&amp; (fns.length = <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = fns.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123; <span class="comment">// åå‘éå†è®¢é˜…çš„å›è°ƒå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">let</span> _fn = fns[i];</span><br><span class="line">        <span class="keyword">if</span> (_fn === fn) &#123;</span><br><span class="line">          fns.splice(i, <span class="number">1</span>); <span class="comment">// åˆ é™¤è®¢é˜…è€…çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†å®šä¹‰ä¸€ä¸ª installEvent å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç»™æ‰€æœ‰çš„å¯¹è±¡éƒ½åŠ¨æ€å®‰è£…å‘å¸ƒâ€”è®¢é˜…åŠŸèƒ½:</span></span><br><span class="line"><span class="keyword">const</span> installEvent = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> event) &#123;</span><br><span class="line">    obj[i] = event[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> salesOffices = &#123;&#125;;</span><br><span class="line">installEvent(salesOffices);</span><br><span class="line">salesOffices.listen(<span class="string">'squareMeter88'</span>, fn1 = <span class="function"><span class="keyword">function</span> (<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ä»·æ ¼= '</span> + price);</span><br><span class="line">&#125;);</span><br><span class="line">salesOffices.listen(<span class="string">'squareMeter88'</span>, fn2 = <span class="function"><span class="keyword">function</span> (<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ä»·æ ¼= '</span> + price);</span><br><span class="line">&#125;);</span><br><span class="line">salesOffices.remove(<span class="string">'squareMeter88'</span>, fn1); <span class="comment">// åˆ é™¤å°æ˜çš„è®¢é˜…</span></span><br><span class="line"><span class="comment">// å°æ˜è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">// å°çº¢è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">salesOffices.trigger(<span class="string">'squareMeter88'</span>, <span class="number">2000000</span>); <span class="comment">// è¾“å‡º:2000000</span></span><br></pre></td></tr></table></figure></p><p>å¯¹äºæ­¤é¡¹ç›®ä¸­é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">onã€oneï¼šon ä¸ one å‡½æ•°ç”¨äºè®¢é˜…è€…ç›‘å¬ç›¸åº”çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶å“åº”æ—¶çš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œon ä¸ one çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œä½¿ç”¨ one è¿›è¡Œè®¢é˜…çš„å‡½æ•°ï¼Œåªä¼šè§¦å‘ä¸€æ¬¡ï¼Œè€Œ ä½¿ç”¨ on è¿›è¡Œè®¢é˜…çš„å‡½æ•°ï¼Œæ¯æ¬¡äº‹ä»¶å‘ç”Ÿç›¸åº”æ—¶éƒ½ä¼šè¢«è§¦å‘ã€‚</span></span><br><span class="line"><span class="comment">triggerï¼štrigger ç”¨äºå‘å¸ƒè€…å‘å¸ƒäº‹ä»¶ï¼Œå°†é™¤ç¬¬ä¸€å‚æ•°ï¼ˆäº‹ä»¶åï¼‰çš„å…¶ä»–å‚æ•°ï¼Œä½œä¸ºæ–°çš„å‚æ•°ï¼Œè§¦å‘ä½¿ç”¨ one ä¸ on è¿›è¡Œè®¢é˜…çš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">offï¼šç”¨äºè§£é™¤æ‰€æœ‰è®¢é˜…äº†æŸä¸ªäº‹ä»¶çš„æ‰€æœ‰å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> eventProxy = &#123;</span><br><span class="line">  onObj: &#123;&#125;,</span><br><span class="line">  oneObj: &#123;&#125;,</span><br><span class="line">  on: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.onObj[key] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onObj[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.onObj[key].push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line">  one: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.oneObj[key] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.oneObj[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.oneObj[key].push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line">  off: <span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.onObj[key] = [];</span><br><span class="line">    <span class="keyword">this</span>.oneObj[key] = [];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  trigger: <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> key;</span><br><span class="line">    <span class="keyword">if</span> (args.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    key = args[<span class="number">0</span>];</span><br><span class="line">    args = [].concat(<span class="built_in">Array</span>.prototype.slice.call(args, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.onObj[key] !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">this</span>.onObj[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> <span class="keyword">this</span>.onObj[key]) &#123;</span><br><span class="line">        <span class="keyword">this</span>.onObj[key][i].apply(<span class="literal">null</span>, args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.oneObj[key] !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">this</span>.oneObj[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> <span class="keyword">this</span>.oneObj[key]) &#123;</span><br><span class="line">        <span class="keyword">this</span>.oneObj[key][i].apply(<span class="literal">null</span>, args);</span><br><span class="line">        <span class="keyword">this</span>.oneObj[key][i] = <span class="literal">undefined</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.oneObj[key] = [];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BranchItemDatas = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Webç ”å‘éƒ¨'</span>,</span><br><span class="line">    imgUrl: <span class="literal">null</span>,</span><br><span class="line">    imgTitle: <span class="literal">null</span>,</span><br><span class="line">    intro: <span class="literal">null</span>,</span><br><span class="line">    key:<span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'ç§»åŠ¨å¼€å‘éƒ¨'</span>,</span><br><span class="line">    imgUrl: <span class="literal">null</span>,</span><br><span class="line">    imgTitle: <span class="literal">null</span>,</span><br><span class="line">    intro: <span class="literal">null</span>,</span><br><span class="line">    key: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'è§†è§‰è®¾è®¡éƒ¨'</span>,</span><br><span class="line">    imgUrl: <span class="literal">null</span>,</span><br><span class="line">    imgTitle: <span class="literal">null</span>,</span><br><span class="line">    intro: <span class="literal">null</span>,</span><br><span class="line">    key: <span class="number">3</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'äº§å“è¿è¥éƒ¨'</span>,</span><br><span class="line">    imgUrl: <span class="literal">null</span>,</span><br><span class="line">    imgTitle: <span class="literal">null</span>,</span><br><span class="line">    intro: <span class="literal">null</span>,</span><br><span class="line">    key: <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'è¿ç»´å®‰å…¨éƒ¨'</span>,</span><br><span class="line">    imgUrl: <span class="literal">null</span>,</span><br><span class="line">    imgTitle: <span class="literal">null</span>,</span><br><span class="line">    intro: <span class="literal">null</span>,</span><br><span class="line">    key: <span class="number">5</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;nav&gt;</span><br><span class="line">        &lt;NavBar /&gt;</span><br><span class="line">        &lt;NavDrawer /&gt;</span><br><span class="line">      &lt;<span class="regexp">/nav&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class NavBar extends Component &#123;</span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp">    this.handleMenuClick = this.handleMenuClick.bind(this);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  handleMenuClick() &#123;</span></span><br><span class="line"><span class="regexp">    eventProxy.trigger('open', true);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;AppBar</span></span><br><span class="line"><span class="regexp">        title="CTG Club"</span></span><br><span class="line"><span class="regexp">        onLeftIconButtonClick=&#123;this.handleMenuClick&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavDrawer</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleToggle = <span class="keyword">this</span>.handleToggle.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleClose = <span class="keyword">this</span>.handleClose.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      open: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleToggle() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      open: !<span class="keyword">this</span>.state.open</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClose() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      open: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    eventProxy.on(<span class="string">'open'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        open: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    eventProxy.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        open: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Drawer</span><br><span class="line">        docked=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        width=&#123;<span class="number">200</span>&#125;</span><br><span class="line">        open=&#123;<span class="keyword">this</span>.state.open&#125;</span><br><span class="line">        onRequestChange=&#123;<span class="keyword">this</span>.handleToggle&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;MenuItems /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Drawer&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class MenuItems extends Component &#123;</span></span><br><span class="line"><span class="regexp">  handleMenuItemClick() &#123;</span></span><br><span class="line"><span class="regexp">    eventProxy.trigger('close', false);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;ul className='normal-list'&gt;</span></span><br><span class="line"><span class="regexp">        &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;0&#125;&gt;é¦–é¡µ&lt;/</span>MenuItem&gt;</span><br><span class="line">        &#123;BranchItemDatas.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;MenuItem onClick=&#123;<span class="keyword">this</span>.handleMenuItemClick&#125; key=&#123;item.key&#125;&gt;&#123;item.name&#125;&lt;<span class="regexp">/MenuItem&gt;</span></span><br><span class="line"><span class="regexp">          );</span></span><br><span class="line"><span class="regexp">        &#125;)&#125;</span></span><br><span class="line"><span class="regexp">        &lt;MenuItem onClick=&#123;this.handleMenuItemClick&#125; key=&#123;6&#125;&gt;å…³äºCTG&lt;/</span>MenuItem&gt;</span><br><span class="line">        &lt;MenuItem onClick=&#123;<span class="keyword">this</span>.handleMenuItemClick&#125; key=&#123;<span class="number">7</span>&#125;&gt;è”ç³»æˆ‘ä»¬&lt;<span class="regexp">/MenuItem&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h2><p><strong>å‚è€ƒä¹¦ç±æˆ–åšæ–‡ï¼š</strong><br><a href="http://www.ituring.com.cn/book/1632" target="_blank" rel="noopener">ã€ŠJavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹</a><br><a href="http://taobaofed.org/blog/2016/11/17/react-components-communication/" target="_blank" rel="noopener">â€œReact ç»„ä»¶é—´é€šè®¯â€â€”â€”â€”â€”æ·˜å®å‰ç«¯å›¢é˜Ÿ</a></p><p><em>æƒ…äººèŠ‚å¿«ä¹å•Š</em><br><em>æƒ…äººèŠ‚å¿«ä¹å•Š</em><br><em>æƒ…äººèŠ‚å¿«ä¹å•Š</em><br><em>æƒ…äººèŠ‚å¿«ä¹å•Š</em></p>]]></content>
      
      
      <categories>
          
          <category> å®è·µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning PostCSS(ä¸€)</title>
      <link href="/2018/02/07/postCSS-1/"/>
      <url>/2018/02/07/postCSS-1/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>PostCSSæ˜¯ç›®å‰CSSå¤„ç†å™¨ä¸­æœ€æµè¡Œçš„ä¸€ä¸ªå¤„ç†å™¨ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚<br><img src="https://s1.ax1x.com/2018/02/07/91UDxK.jpg" alt=""><br><a id="more"></a><br>å®ƒä¸ç­‰åŒäºSassã€Lessç­‰é¢„å¤„ç†å™¨ï¼Œä¹Ÿä¸ç­‰åŒäºCompassï¼ˆCompasså·²ç»æ­»äº†ï¼‰è¿™æ ·çš„åå¤„ç†å™¨ï¼Œå°½ç®¡å®ƒå¸¦æœ‰Postè¿™ä¸ªè‹±æ–‡å•è¯ã€‚<br>PostCSSçš„åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼šç¬¬ä¸€ï¼ŒæŠŠCSSè§£ææˆJavaScriptå¯ä»¥æ“ä½œçš„AST(Abstact Syntax tree,æŠ½è±¡è¯­æ³•æ ‘);ç¬¬äºŒï¼Œè°ƒç”¨æ’ä»¶æ¥å¤„ç†ASTå¹¶å¾—åˆ°ç»“æœã€‚PostCSSçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶ä¸æ–­å‘å±•çš„æ’ä»¶ç”Ÿæ€ã€‚<br><img src="https://s1.ax1x.com/2018/02/07/91UhGt.jpg" alt=""></p><h2 id="åˆ›å»ºå˜é‡å’Œæ··åˆå®"><a href="#åˆ›å»ºå˜é‡å’Œæ··åˆå®" class="headerlink" title="åˆ›å»ºå˜é‡å’Œæ··åˆå®"></a>åˆ›å»ºå˜é‡å’Œæ··åˆå®</h2>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PostCSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„ç±»å‹ï¼ˆä¸€ï¼‰â€”â€”â€”â€” ç±»å‹</title>
      <link href="/2018/02/06/type-js/"/>
      <url>/2018/02/06/type-js/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>ç±»å‹ï¼šå¯¹è¯­è¨€å¼•æ“å’Œå¼€å‘äººå‘˜æ¥è¯´ï¼Œ<strong>ç±»å‹</strong>æ˜¯å€¼çš„å†…éƒ¨ç‰¹å¾ï¼Œå®ƒå®šä¹‰äº†å€¼çš„è¡Œä¸ºï¼Œä»¥ä½¿å…¶åŒºåˆ«äºå…¶ä»–å€¼ã€‚<br>JavaScriptæ˜¯ä¸€é—¨å¼±ç±»å‹ï¼ˆåå‘å®¹å¿éšå¼ç±»å‹è½¬æ¢ï¼‰è¯­è¨€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹ï¼ˆç¼–è¯‘çš„æ—¶å€™å°±çŸ¥é“æ¯ä¸ªå˜é‡çš„ç±»å‹ï¼‰è¯­è¨€ã€‚<br><img src="http://chuantu.biz/t6/222/1517887204x-1404764355.jpg" alt=""><br>æ²¡æœ‰ä¸¥æ ¼çš„ç±»å‹çš„é™åˆ¶ï¼Œä½¿å¾—JavaScriptæˆä¸ºäº†ä¸€é—¨ç‰¹åˆ«çµæ´»çš„è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†ä¸€äº›éº»çƒ¦ï¼Œä¾‹å¦‚<strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ã€‚<br><a id="more"></a></p><h2 id="å†…ç½®ç±»å‹"><a href="#å†…ç½®ç±»å‹" class="headerlink" title="å†…ç½®ç±»å‹"></a>å†…ç½®ç±»å‹</h2><p>JavaScriptä¸­æš‚æ—¶æœ‰7ç§å†…ç½®ç±»å‹ï¼š</p><ul><li>ç©ºå€¼ï¼ˆnullï¼‰</li><li>æœªå®šä¹‰ï¼ˆundefinedï¼‰</li><li>å¸ƒå°”å€¼ï¼ˆbooleanï¼‰</li><li>æ•°å­—ï¼ˆnumberï¼‰</li><li>å­—ç¬¦ä¸²ï¼ˆstringï¼‰</li><li>å¯¹è±¡ï¼ˆobjectï¼‰</li><li>ç¬¦å·ï¼ˆsymbolï¼‰<br>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡typeofæ“ä½œç¬¦æ¥æŸ¥çœ‹å€¼çš„ç±»å‹ï¼Œå®ƒä¼šè¿”å›ç±»å‹çš„å­—ç¬¦ä¸²å€¼ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è¿™ä¸ƒç§ç±»å‹å’Œå®ƒä»¬çš„å­—ç¬¦ä¸²å€¼å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸‹é¢å…­ç§ç±»å‹å‡æœ‰åŒåçš„å­—ç¬¦ä¸²å€¼ä¸ä¹‹å¯¹åº”,'==='ä¼šè¿”å›trueã€‚</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> === <span class="string">'undefined'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">false</span> === <span class="string">'boolsean'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">3</span> === <span class="string">'number'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">'3'</span> === <span class="string">'string'</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;<span class="attr">number</span>: <span class="number">3</span>&#125; === <span class="string">'object'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>() === <span class="string">'symbol'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹äºnullç±»å‹ï¼Œå­˜åœ¨ä¸€ä¸ªbugï¼ˆä»JavaScriptè¯ç”Ÿå°±ä¸€ç›´å­˜åœ¨ï¼Œä»¥åä¼°è®¡ä¹Ÿä¼šå­˜åœ¨ï¼‰ï¼Œå¯¹nullè¿›è¡Œtypeofæ“ä½œï¼Œè¿”å›çš„å€¼å±…ç„¶æ˜¯'object'ï¼›</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> === <span class="string">'object'</span>    <span class="comment">//true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> === <span class="string">'null'</span> <span class="comment">//false</span></span><br><span class="line"><span class="comment">//æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤åˆæ¡ä»¶æ¥æ£€æµ‹nullå€¼çš„ç±»å‹ï¼š</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//å¯¹äº&amp;&amp;æ“ä½œï¼Œå¦‚æœè¿ç®—ç¬¦å·¦è¾¹çš„å€¼ä¸ºçœŸï¼Œåˆ™è¯¥è¡¨è¾¾å¼ç›´æ¥è¿”å›å³è¾¹çš„å€¼ï¼Œä¾‹å¦‚ 'true &amp;&amp; 3'è¡¨è¾¾å¼çš„ç»“æœä¸º3ã€‚</span></span><br><span class="line">(!a &amp;&amp; <span class="keyword">typeof</span> a === <span class="string">"object"</span>);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>å‡½æ•°æ˜¯â€™objectâ€™çš„ä¸€ä¸ªå­ç±»å‹ï¼Œå‡½æ•°æ˜¯ä¸€ä¸ªâ€œå¯è°ƒç”¨å¯¹è±¡â€ï¼Œå®ƒæœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§[[Call]]ï¼Œè¯¥å±æ€§ä½¿å…¶å¯ä»¥è¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¯¹å‡½æ•°è¿›è¡Œtypeofæ“ä½œæ—¶ï¼Œè¿”å›çš„å€¼å¯ä¸æ˜¯â€™objectâ€™ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; === <span class="string">'object'</span>    <span class="comment">//false</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; === <span class="string">'function'</span>  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><p>æ²¡é”™ï¼Œå°±æ˜¯â€™functionâ€™ã€‚çœ‹èµ·æ¥functionå°±æ˜¯å¦å¤–ä¸€ç§å†…ç½®ç±»å‹ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ã€‚ï¼šï¼‰</p><h2 id="å€¼å’Œç±»å‹"><a href="#å€¼å’Œç±»å‹" class="headerlink" title="å€¼å’Œç±»å‹"></a>å€¼å’Œç±»å‹</h2><p><strong>å˜é‡æ²¡æœ‰ç±»å‹ï¼Œå€¼æ‰æœ‰ç±»å‹</strong><br>JavaScriptä¸­çš„å˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œåªæœ‰å€¼æ‰å…·æœ‰ç±»å‹ï¼Œå˜é‡å¯ä»¥éšæ—¶æŒæœ‰ä»»ä½•ç±»å‹çš„å€¼ã€‚å‰é¢æåˆ°è¿‡ï¼ŒJavaScriptæ˜¯ä¸€é—¨åŠ¨æ€å¼±ç±»å‹çš„è¯­è¨€ã€‚ä¾‹å¦‚ï¼šå˜é‡aæŒæœ‰çš„å€¼ä¸º42ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼çš„ç±»å‹ä¸ºnumberï¼Œå¹¶ä¸”æ— æ³•ç›´æ¥æ›´æ”¹42çš„ç±»å‹ï¼ˆnumberï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡å¼ºåˆ¶è½¬æ¢å°†è¿™42è½¬æ¢ä¸ºâ€™42â€™ï¼Œæ­¤æ—¶å€¼æ‹¥æœ‰çš„ç±»å‹å°±ä¸ºå­—ç¬¦ä¸²ï¼ˆstring)ã€‚</p><h3 id="undefined-and-undeclared"><a href="#undefined-and-undeclared" class="headerlink" title="undefined and undeclared"></a>undefined and undeclared</h3><p>å˜é‡æœªæŒæœ‰å€¼æ—¶ä¸ºundefinedï¼Œæ­¤æ—¶typeofè¿”å›â€™undefinedâ€™ã€‚<br><strong>å·²åœ¨ä½œç”¨åŸŸä¸­å£°æ˜ä½†æœªèµ‹å€¼çš„æ¯”å˜é‡æ˜¯undefinedçš„ï¼Œæœªåœ¨ä½œç”¨åŸŸå£°æ˜è¿‡çš„å˜é‡æ˜¯undeclaredçš„ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a;</span><br><span class="line">a;  <span class="comment">//undefined</span></span><br><span class="line">b;  <span class="comment">//ReferenceError:b is not definedï¼ŒæŠ¥é”™</span></span><br></pre></td></tr></table></figure></p><p>æ¯æ¬¡çœ‹åˆ°â€œnot definedâ€,æ€»ä»¥ä¸ºç­‰ä»·äºâ€undefinedâ€ï¼ŒçœŸè®©äººç³Ÿå¿ƒï¼Œè¿˜æœ‰æ›´ç³Ÿå¿ƒçš„ï¼šï¼‰<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">typeof</span> a;   <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure></p><p>ä¸€å‘è¢«è®¤ä¸ºæ¯”è¾ƒå®‰å…¨çš„æ“ä½œç¬¦typeofä¹Ÿä¼šè¿™æ ·é—¹ç€ç©ï¼šï¼‰<br>æ³¨ï¼šæ¨èä¸€æœ¬å¿…çœ‹çš„ä¹¦ã€ŠJavaScriptè¯­è¨€ç²¾ç²¹ã€‹ï¼Œä½œè€…æ˜¯Douglas Crockfordï¼ˆå¤§ç¥ï¼‰ã€‚</p><h3 id="å®‰å…¨é˜²èŒƒæœºåˆ¶"><a href="#å®‰å…¨é˜²èŒƒæœºåˆ¶" class="headerlink" title="å®‰å…¨é˜²èŒƒæœºåˆ¶"></a>å®‰å…¨é˜²èŒƒæœºåˆ¶</h3><p>å¹¶ä¸æ˜¯æ²¡æœ‰åŠæ³•è®©å¼€å‘äººå‘˜è§£å†³â€™undeclaredâ€™é—®é¢˜ï¼Œæœ‰æ—¶å€™é€šè¿‡typeofçš„å®‰å…¨é˜²èŒƒæœºåˆ¶ï¼ˆé˜»æ­¢æŠ¥é”™ï¼‰æ¥æ£€æŸ¥undeclaredå˜é‡ä¸å¤±ä¸ºä¸€ä¸ªæ–¹æ³•ã€‚<br>å½“ä¸€ä¸ªçª—å£åŠ è½½å¤šä¸ª.jsæ–‡ä»¶æ—¶ï¼Œè¿™äº›.jsæ–‡ä»¶ä¸­çš„ä»£ç ä¼šå…±äº«ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸï¼Œå¦‚æœæœ‰é‡åçš„å˜é‡åï¼Œé‚£ä¹ˆå°±å¤ªå¯æ€•äº†â€¦â€¦å‡å°‘å…¨å±€å˜é‡æ˜¯ç¼–å†™å¯ç»´æŠ¤çš„ä»£ç çš„åŸºç¡€ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½åº”è¯¥è¢«å°è£…åˆ°æ¨¡å—æˆ–è€…ç§æœ‰/ç‹¬ç«‹çš„å‘½åç©ºé—´é‡Œã€‚<br>ä¾‹å¦‚ï¼šè°ƒè¯•æ¨¡å¼ä¸‹ï¼Œåœ¨debug.jså£°æ˜äº†ä¸€ä¸ªDEBUGçš„å…¨å±€å˜é‡ï¼ŒæŠŠå®ƒä½œä¸ºè°ƒè¯•æ¨¡å¼çš„å¼€å…³ï¼Œåœ¨è¾“å‡ºè°ƒè¯•ä¿¡æ¯æ—¶æˆ‘ä»¬ä¼šå…ˆåˆ¤æ–­DEBUGæ˜¯å¦å·²ç»è¢«å£°æ˜ã€‚å¯æ˜¯å¦‚ä½•åœ¨ç¨‹åºä¸­æ£€æŸ¥å…¨å±€å˜é‡DEBUGä¸”ä¸ä¼šå‡ºç°ReferenceErroré”™è¯¯å‘¢ï¼Ÿtypeofçš„å®‰å…¨é˜²èŒƒæœºåˆ¶å°±æˆäº†æˆ‘ä»¬çš„å¸®æ‰‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™æ ·åšæ˜¯è¦æŒ¨Errorçš„</span></span><br><span class="line"><span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"è°ƒè¯•å¼€å§‹å•°"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™æ ·å°±æ¯”è¾ƒå®‰å…¨äº†</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> DEBUG !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"è°ƒè¯•å¼€å§‹å•°"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸ä»…å¯¹äºè‡ªå®šä¹‰çš„å˜é‡æœ‰ç”¨ï¼Œå¯¹äºå†…å»ºçš„APIä¹Ÿæœ‰å¸®åŠ©ã€‚ç”šè‡³ä¸ä¸€å®šè¦æ±‚ä½œç”¨åŸŸä¸ºå…¨å±€ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ£€æŸ¥æˆ‘ä»¬çš„å˜é‡æ˜¯å¦åœ¨å®¿ä¸»ä½œç”¨åŸŸå£°æ˜è¿‡ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯æ£€æŸ¥æ‰€æœ‰å…¨å±€å˜é‡æ˜¯å¦æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œæµè§ˆå™¨çš„å…¨å±€å¯¹è±¡æ˜¯windowï¼ŒæœåŠ¡å™¨ç«¯çš„å…¨å±€å¯¹è±¡ä¸ºglobalã€‚ä¸Šè¿°çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.DEBUG) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è®¿é—®ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§ä¸undeclaredå˜é‡ä¸åŒï¼Œæ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚</p><h2 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h2><p>å‚è€ƒæ–‡çŒ®ï¼š<br>ã€Šä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸­å·ï¼‰ã€‹<br>ã€ŠJavaScriptè¯­è¨€ç²¾ç²¹ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸­çš„ç»§æ‰¿æ–¹å¼</title>
      <link href="/2018/02/03/inherit-in-js/"/>
      <url>/2018/02/03/inherit-in-js/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>ç»§æ‰¿æ˜¯OOPçš„æ ¸å¿ƒå†…å®¹ä¹‹ä¸€ã€‚JavaScriptä¸­å¸¸è§ç»§æ‰¿æ–¹å¼ä¸ºï¼šç±»å¼ç»§æ‰¿ã€æ„é€ å‡½æ•°å¼ç»§æ‰¿ã€ç»„åˆå¼ç»§æ‰¿ã€åŸå‹å¼ç»§æ‰¿ã€å¯„ç”Ÿå¼ç»§æ‰¿ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ã€‚<br><a id="more"></a></p><h2 id="ç±»å¼ç»§æ‰¿"><a href="#ç±»å¼ç»§æ‰¿" class="headerlink" title="ç±»å¼ç»§æ‰¿"></a>ç±»å¼ç»§æ‰¿</h2><p><strong>ç±»å¼ç»§æ‰¿ï¼Œé€šè¿‡å­ç±»çš„åŸå‹prototypeå¯¹çˆ¶ç±»çš„å®ä¾‹åŒ–å®ç°ã€‚ç”±äºå­ç±»é€šè¿‡å…¶åŸå‹prototypeå¯¹çˆ¶ç±»å®ä¾‹åŒ–ç»§æ‰¿äº†çˆ¶ç±»ï¼Œæ‰€ä»¥çˆ¶ç±»ä¸­çš„å…±æœ‰å±æ€§è¦æ˜¯å¼•ç”¨ç±»å‹å°±ä¼šåœ¨å­ç±»ä¸­è¢«æ‰€æœ‰å®ä¾‹å…±ç”¨ã€‚ç”±äºå­ç±»å®ç°çš„ç»§æ‰¿æ˜¯é å…¶åŸå‹prototypeå¯¹çˆ¶ç±»çš„å®ä¾‹åŒ–å®ç°çš„ï¼Œå› æ­¤åœ¨åˆ›å»ºçˆ¶ç±»æ—¶æ˜¯æ— æ³•å‘çˆ¶ç±»ä¼ é€’å‚æ•°çš„ï¼Œå› è€Œåœ¨å®ä¾‹åŒ–çˆ¶ç±»æ—¶æ— æ³•å¯¹çˆ¶ç±»æ„é€ å‡½æ•°å†…çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperClass</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.superValue = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸ºçˆ¶ç±»æ·»åŠ å…±æœ‰æ–¹æ³•</span></span><br><span class="line">SuperClass.prototype.getsuperValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.superValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å£°æ˜å­ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubClass</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.subValue = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»§æ‰¿çˆ¶ç±»ï¼ˆ</span></span><br><span class="line">SubClass.prototype = <span class="keyword">new</span> SuperClass();</span><br><span class="line"><span class="comment">//ä¸ºå­ç±»æ·»åŠ å…±æœ‰æ–¹æ³•</span></span><br><span class="line">SubClass.prototype.getsubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.subValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ„é€ å‡½æ•°å¼ç»§æ‰¿"><a href="#æ„é€ å‡½æ•°å¼ç»§æ‰¿" class="headerlink" title="æ„é€ å‡½æ•°å¼ç»§æ‰¿"></a>æ„é€ å‡½æ•°å¼ç»§æ‰¿</h2><p><strong>æ„é€ å‡½æ•°ç»§æ‰¿ï¼Œé€šè¿‡åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä½œç”¨ç¯å¢ƒä¸­æ‰§è¡Œä¸€æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®ç°ï¼›ç”±äºæ²¡ç”¨æ¶‰åŠprototypeï¼Œæ‰€ä»¥çˆ¶ç±»çš„åŸå‹æ–¹æ³•ä¸ä¼šè¢«å­ç±»ç»§æ‰¿ã€‚è¦æƒ³è¢«å­ç±»ç»§æ‰¿ï¼Œå°±å¾—æŠŠå±æ€§å’Œå‡½æ•°æ”¾åˆ°çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œå¹¶ä¸”åˆ›å»ºå‡ºæ¥çš„ï¼ˆå­ç±»çš„ï¼‰å®ä¾‹éƒ½ä¼šå•ç‹¬æ‹¥æœ‰ä¸€ä»½ï¼Œè¿èƒŒäº† â€œä»£ç å¤ç”¨â€ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperClass</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//å¼•ç”¨ç±»å‹å…±æœ‰å±æ€§</span></span><br><span class="line">  <span class="keyword">this</span>.books = [<span class="string">'JavaScript'</span>, <span class="string">'html'</span>, <span class="string">'css'</span>];</span><br><span class="line">  <span class="comment">//å€¼ç±»å‹å…±æœ‰å±æ€§</span></span><br><span class="line">  <span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//çˆ¶ç±»å£°æ˜åŸå‹æ–¹æ³•</span></span><br><span class="line">SuperClass.prototype.showBooks = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.books);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å£°æ˜å­ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubClass</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line">  SuperClass.call(<span class="keyword">this</span>, id); <span class="comment">//å°†å­ç±»çš„å˜é‡åœ¨çˆ¶ç±»ä¸­éƒ½æ‰§è¡Œä¸€éï¼Œçˆ¶ç±»ä¸­æ˜¯ç»™thisç»‘å®šå±æ€§çš„ï¼Œæ‰€ä»¥é€šè¿‡callå°±ä½¿å¾—å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å…±æœ‰å±æ€§ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç»„åˆç»§æ‰¿"><a href="#ç»„åˆç»§æ‰¿" class="headerlink" title="ç»„åˆç»§æ‰¿"></a>ç»„åˆç»§æ‰¿</h2><p><strong>ç»„åˆç»§æ‰¿ï¼Œå°†ç±»å¼ç»§æ‰¿å’Œæ„é€ å‡½æ•°å¼ç»§æ‰¿ç»¼åˆï¼Œæ„é€ å‡½æ•°ç»§æ‰¿æ—¶æ‰§è¡Œäº†ä¸€éçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåœ¨å®ç°å­ç±»åŸå‹çš„ç±»å¼ç»§æ‰¿åˆè°ƒç”¨ä¸€éçˆ¶ç±»æ„é€ å‡½æ•°ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperClass</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.books = [<span class="string">"javascript"</span>, <span class="string">"html"</span>, <span class="string">"css"</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperClass.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubClass</span>(<span class="params">name, time</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//æ„é€ å‡½æ•°å¼åŸºç¡€çˆ¶ç±»nameå±æ€§</span></span><br><span class="line">  SuperClass.call(<span class="keyword">this</span>, name);</span><br><span class="line">  <span class="comment">//å­ç±»æ–°å¢å…±æœ‰å±æ€§</span></span><br><span class="line">  <span class="keyword">this</span>.time = time;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç±»å¼ç»§æ‰¿ å­ç±»åŸå‹ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line">SubClass.prototype = <span class="keyword">new</span> SuperClass();</span><br><span class="line"><span class="comment">//å­ç±»åŸå‹æ–¹æ³•</span></span><br><span class="line">SubClass.prototype.getTime = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åŸå‹å¼ç»§æ‰¿"><a href="#åŸå‹å¼ç»§æ‰¿" class="headerlink" title="åŸå‹å¼ç»§æ‰¿"></a>åŸå‹å¼ç»§æ‰¿</h2><p><strong>åŸå‹å¼ç»§æ‰¿ï¼Œå€ŸåŠ©åŸå‹prototypeå¯ä»¥æ ¹æ®å·²æœ‰çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŒæ—¶ä¸å¿…åˆ›å»ºæ–°çš„è‡ªå®šä¹‰å¯¹è±¡ç±»å‹ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹ç±»å¼ç»§æ‰¿çš„å°è£…</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritObejct</span>(<span class="params">o</span>) </span>&#123; </span><br><span class="line">  <span class="comment">//å£°æ˜ä¸€ä¸ªè¿‡æ¸¡å‡½æ•°å¯¹è±¡</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="comment">//è¿‡æ¸¡å¯¹è±¡çš„åŸå‹ç»§æ‰¿çˆ¶å¯¹è±¡</span></span><br><span class="line">  F.prototype = o;</span><br><span class="line">  <span class="comment">//è¿”å›è¿‡æ¸¡å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œ è¯¥å¯¹è±¡çš„åŸå‹ç»§æ‰¿äº†çˆ¶å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸºäºè¿™ç§åœ¨å¯¹è±¡ä¹‹é—´ç›´æ¥æ„å»ºç»§æ‰¿å…³ç³»çš„ç†å¿µï¼ŒDCå¤§ç¥ç»™å‡ºäº†ä¸Šè¿°çš„å‡½æ•°ï¼Œè¿™ä¸ªinheritObjectå‡½æ•°åæ¥è¢«ES5é‡‡çº³ï¼Œæ›´åä¸ºObject.create()ã€‚</p><h2 id="å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿå¼ç»§æ‰¿"></a>å¯„ç”Ÿå¼ç»§æ‰¿</h2><p><strong>å¯„ç”Ÿå¼ç»§æ‰¿,å¯¹åŸå‹ç»§æ‰¿çš„ç¬¬äºŒæ¬¡å°è£…ï¼Œå¹¶ä¸”åœ¨æ­¤è¿‡ç¨‹ä¸­å¯¹ç»§æ‰¿çš„å¯¹è±¡è¿›è¡Œäº†æ‹“å±•ã€‚</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜åŸºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> book = &#123;</span><br><span class="line">  name: <span class="string">'js book'</span>,</span><br><span class="line">  alikeBook: [<span class="string">"css book"</span>, <span class="string">"html book"</span>,<span class="string">"html book"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createBook</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//é€šè¿‡åŸå‹ç»§æ‰¿æ–¹å¼åˆ›å»ºæ–°å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> o = <span class="keyword">new</span> inheritObejct(obj);</span><br><span class="line">  <span class="comment">//æ‹“å±•æ–°å¯¹è±¡</span></span><br><span class="line">  o.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è¿”å›æ‹“å±•åçš„æ–°å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h2><p><strong>è¿™é‡Œçš„å¯„ç”Ÿç»§æ‰¿å¤„ç†çš„æ˜¯ç±»çš„åŸå‹</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inhreitPrototype</span>(<span class="params">SubClass, SuperClass</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//å¤åˆ¶ä¸€ä»½çˆ¶ç±»çš„åŸå‹å‰¯æœ¬ä¿å­˜åœ¨å˜é‡ä¸­</span></span><br><span class="line">  <span class="keyword">let</span> p = inheritObejct(SuperClass.prototype);</span><br><span class="line">  <span class="comment">//ä¿®æ­£å› ä¸ºé‡å†™å­ç±»åŸå‹å¯¼è‡´å­ç±»çš„constructorå±æ€§è¢«ä¿®æ”¹</span></span><br><span class="line">  p.constructor = SubClass;</span><br><span class="line">  <span class="comment">//è®¾ç½®å­ç±»çš„åŸå‹</span></span><br><span class="line">  SubClass.prototype = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®ä¾‹</span></span><br><span class="line"><span class="comment">//å®šä¹‰çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperClass</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰çˆ¶ç±»çš„åŸå‹æ–¹æ³•</span></span><br><span class="line">SuperClass.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰å­ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubClass</span>(<span class="params">name, time</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//æ„é€ å‡½æ•°å¼ç»§æ‰¿</span></span><br><span class="line">  SuperClass.call(<span class="keyword">this</span>,name);</span><br><span class="line">  <span class="comment">//å­ç±»æ–°å¢å±æ€§</span></span><br><span class="line">  <span class="keyword">this</span>.time = time;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å¯„ç”Ÿå¼ç»§æ‰¿çˆ¶ç±»åŸå‹*/</span></span><br><span class="line">inhreitPrototype(SubClass, SuperClass);</span><br><span class="line"><span class="comment">/*å­ç±»æ–°å¢åŸå‹æ–¹æ³•*/</span></span><br><span class="line">SubClass.prototype.getTime = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="extendä¸deepCopy"><a href="#extendä¸deepCopy" class="headerlink" title="extendä¸deepCopy"></a>extendä¸deepCopy</h2><p><strong>åœ¨JavaScriptä¸­ç»§æ‰¿æ˜¯ä¾èµ–äºåŸå‹prototypeé“¾å®ç°çš„ï¼Œåªæœ‰ä¸€æ¡åŸå‹é“¾ï¼Œç†è®ºä¸Šä¸èƒ½ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚ä½†æ˜¯ç”±äºJavaScriptæ˜¯ä¸€é—¨å¾ˆçµæ´»çš„è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯æ˜¯è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªç»§æ‰¿å¤šå¯¹è±¡å±æ€§çš„å‡½æ•°ã€‚</strong></p><h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>JavaScriptä¸­æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æŸä¸€å¯¹è±¡çš„prototypeå±æ€§ï¼Œè¯¥å‡½æ•°è¢«newæ“ä½œç¬¦è°ƒç”¨æ—¶ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæŒ‡å‘å…¶åŸå‹å¯¹è±¡çš„<strong>proto</strong>å±æ€§ï¼Œå¼•æ“åœ¨èƒŒåé€šè¿‡è¿ç”¨<strong>proto</strong>å¯ä»¥ä½¿å¾—æ–°å»ºçš„å¯¹è±¡å¯ä»¥è°ƒç”¨ç›¸å…³åŸå‹çš„å¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§ã€‚åŸå‹å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æœ¬èº«ä¹ŸåŒ…å«äº†æŒ‡å‘å…¶åŸå‹çš„<strong>proto</strong>,ç”±æ­¤å°±å½¢æˆäº†ä¸€æ¡é“¾ï¼Œç§°ä¹‹ä¸ºåŸå‹é“¾ã€‚</p><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p><img src="https://s1.ax1x.com/2018/02/07/91MwdK.jpg" alt=""><br>å¦‚å›¾ï¼Œæœ‰äº†åŸå‹é“¾ï¼Œå¦‚æœæŸä¸ªå±æ€§åœ¨å¯¹è±¡Bä¸­è€Œä¸åœ¨å¯¹è±¡Aä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æŠŠè¿™ä¸ªå±æ€§å½“ä½œAçš„å±æ€§æ¥è®¿é—®ã€‚è¿™å°±æ˜¯ç»§æ‰¿çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥ä½¿å¾—æ¯ä¸ªå¯¹è±¡éƒ½èƒ½è®¿é—®å…¶ç»§æ‰¿é“¾ä¸Šçš„ä»»ä½•å±æ€§ã€‚</p><h3 id="ç»§æ‰¿å•å¯¹è±¡å±æ€§çš„extendæ–¹æ³•ï¼ˆé’ˆå¯¹å€¼ç±»å‹çš„å±æ€§ï¼‰"><a href="#ç»§æ‰¿å•å¯¹è±¡å±æ€§çš„extendæ–¹æ³•ï¼ˆé’ˆå¯¹å€¼ç±»å‹çš„å±æ€§ï¼‰" class="headerlink" title="ç»§æ‰¿å•å¯¹è±¡å±æ€§çš„extendæ–¹æ³•ï¼ˆé’ˆå¯¹å€¼ç±»å‹çš„å±æ€§ï¼‰"></a>ç»§æ‰¿å•å¯¹è±¡å±æ€§çš„extendæ–¹æ³•ï¼ˆé’ˆå¯¹å€¼ç±»å‹çš„å±æ€§ï¼‰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">child, parent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> parent) &#123;</span><br><span class="line">    child[prop] = parent[prop];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»§æ‰¿å¤šå¯¹è±¡çš„å±æ€§"><a href="#ç»§æ‰¿å¤šå¯¹è±¡çš„å±æ€§" class="headerlink" title="ç»§æ‰¿å¤šå¯¹è±¡çš„å±æ€§"></a>ç»§æ‰¿å¤šå¯¹è±¡çš„å±æ€§</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mix</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">1</span>,</span><br><span class="line">      len = <span class="built_in">arguments</span>.length,</span><br><span class="line">      child = <span class="built_in">arguments</span>[<span class="number">0</span>],</span><br><span class="line">      arg;</span><br><span class="line">  <span class="keyword">for</span>(; i &lt; len; i++) &#123;</span><br><span class="line">    arg = <span class="built_in">arguments</span>[i];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">let</span> prop <span class="keyword">in</span> arg) &#123;</span><br><span class="line">      child[prop] = arg[prop];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h3><p><strong>åœ¨JavaScriptä¸­å¤åˆ¶ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§ä¸ºå€¼ç±»å‹åˆ™åªéœ€è¦ç®€å•çš„èµ‹å€¼è¯­å¥å³å¯ï¼Œå¦‚æœå±æ€§ä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆ™éœ€è¦ä¾æ¬¡å¤åˆ¶è¯¥å±æ€§çš„å±æ€§ï¼Œè¿™é‡Œé‡‡ç”¨é€’å½’çš„æ€æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ï¼ˆå¦‚æœä¸ä½¿ç”¨é€’å½’ï¼Œåˆ™é€šè¿‡JSONè§£æè§£å†³ï¼‰</strong></p><h4 id="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</h4><p>å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°±è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸä¸ªç‰©ç†ä½ç½®ï¼Œç›¸å…³çš„å˜é‡å’Œå±æ€§å°±ä¼šæŒ‡å‘è¿™äº›ä½ç½®ã€‚<br><img src="https://s1.ax1x.com/2018/02/07/91lUUK.jpg" alt=""></p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶è®©å˜é‡AæŒ‡å‘è¯¥å¯¹è±¡ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°å˜é‡Bï¼Œå¹¶è®¾ç½®å…¶ä¸Aç›¸ç­‰ï¼Œæ­¤æ—¶Bå’ŒAæŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ä¸­çš„åŒä¸€ä¸ªåœ°å€ã€‚</li><li>ä¿®æ”¹å˜é‡Bæ‰€æŒ‡çš„å¯¹è±¡çš„colorå±æ€§ï¼Œå°†å®ƒè®¾ç½®ä¸ºâ€whiteâ€,æ­¤æ—¶A.color çš„å€¼ä¹Ÿä¸ºâ€whiteâ€ã€‚</li><li>å†åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè®©å˜é‡BæŒ‡å‘è¿™ä¸ªæ–°å¯¹è±¡ï¼ŒAå’ŒBæ­¤æ—¶æŒ‡å‘äº†å†…å­˜ä¸­ä¸åŒçš„ä½ç½®ï¼ŒAã€Bä»æ­¤å†æ— å…³è”ã€‚<h4 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span>(<span class="params">parent, child</span>) </span>&#123;</span><br><span class="line">    child = child || &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> parent) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent.hasOwnProperty(prop)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> parent[prop] === <span class="string">'object'</span>) &#123;</span><br><span class="line">                child[i] = <span class="built_in">Array</span>.isArray(parent[prop])? [] : &#123;&#125;;</span><br><span class="line">                deepCopy( parent[prop], child);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                child[prop] = parent[prop];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="https://s1.ax1x.com/2018/02/07/918qat.jpg" alt=""><br><img src="https://s1.ax1x.com/2018/02/07/918XPf.jpg" alt=""><br><img src="https://s1.ax1x.com/2018/02/07/918bVI.jpg" alt=""><br><img src="https://s1.ax1x.com/2018/02/07/918LIP.jpg" alt=""></p><h2 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h2><p>å‚è€ƒæ–‡çŒ®ï¼š<br>ã€ŠJavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹æŒ‡å—ã€‹<br>ã€ŠJavaScriptè®¾è®¡æ¨¡å¼ã€‹<br>ã€Šä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸Šå·ï¼‰ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> JavaScriptè®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2018/02/03/hello-world/"/>
      <url>/2018/02/03/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.<br><a id="more"></a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†ç±»</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
